var V3=Object.defineProperty;var W3=(e,t,r)=>t in e?V3(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ie=(e,t,r)=>W3(e,typeof t!="symbol"?t+"":t,r);function G3(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();function MC(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function q3(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var TC={exports:{}},Af={},EC={exports:{}},Qt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fu=Symbol.for("react.element"),K3=Symbol.for("react.portal"),H3=Symbol.for("react.fragment"),Q3=Symbol.for("react.strict_mode"),X3=Symbol.for("react.profiler"),J3=Symbol.for("react.provider"),Y3=Symbol.for("react.context"),Z3=Symbol.for("react.forward_ref"),eF=Symbol.for("react.suspense"),tF=Symbol.for("react.memo"),rF=Symbol.for("react.lazy"),gT=Symbol.iterator;function nF(e){return e===null||typeof e!="object"?null:(e=gT&&e[gT]||e["@@iterator"],typeof e=="function"?e:null)}var PC={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},kC=Object.assign,SC={};function Vl(e,t,r){this.props=e,this.context=t,this.refs=SC,this.updater=r||PC}Vl.prototype.isReactComponent={};Vl.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Vl.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function CC(){}CC.prototype=Vl.prototype;function H0(e,t,r){this.props=e,this.context=t,this.refs=SC,this.updater=r||PC}var Q0=H0.prototype=new CC;Q0.constructor=H0;kC(Q0,Vl.prototype);Q0.isPureReactComponent=!0;var _T=Array.isArray,$C=Object.prototype.hasOwnProperty,X0={current:null},IC={key:!0,ref:!0,__self:!0,__source:!0};function AC(e,t,r){var n,s={},i=null,a=null;if(t!=null)for(n in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)$C.call(t,n)&&!IC.hasOwnProperty(n)&&(s[n]=t[n]);var o=arguments.length-2;if(o===1)s.children=r;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];s.children=l}if(e&&e.defaultProps)for(n in o=e.defaultProps,o)s[n]===void 0&&(s[n]=o[n]);return{$$typeof:Fu,type:e,key:i,ref:a,props:s,_owner:X0.current}}function sF(e,t){return{$$typeof:Fu,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function J0(e){return typeof e=="object"&&e!==null&&e.$$typeof===Fu}function iF(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var yT=/\/+/g;function Cm(e,t){return typeof e=="object"&&e!==null&&e.key!=null?iF(""+e.key):t.toString(36)}function kh(e,t,r,n,s){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Fu:case K3:a=!0}}if(a)return a=e,s=s(a),e=n===""?"."+Cm(a,0):n,_T(s)?(r="",e!=null&&(r=e.replace(yT,"$&/")+"/"),kh(s,t,r,"",function(c){return c})):s!=null&&(J0(s)&&(s=sF(s,r+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(yT,"$&/")+"/")+e)),t.push(s)),1;if(a=0,n=n===""?".":n+":",_T(e))for(var o=0;o<e.length;o++){i=e[o];var l=n+Cm(i,o);a+=kh(i,t,r,l,s)}else if(l=nF(e),typeof l=="function")for(e=l.call(e),o=0;!(i=e.next()).done;)i=i.value,l=n+Cm(i,o++),a+=kh(i,t,r,l,s);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function zd(e,t,r){if(e==null)return e;var n=[],s=0;return kh(e,n,"","",function(i){return t.call(r,i,s++)}),n}function aF(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Hn={current:null},Sh={transition:null},oF={ReactCurrentDispatcher:Hn,ReactCurrentBatchConfig:Sh,ReactCurrentOwner:X0};function jC(){throw Error("act(...) is not supported in production builds of React.")}Qt.Children={map:zd,forEach:function(e,t,r){zd(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return zd(e,function(){t++}),t},toArray:function(e){return zd(e,function(t){return t})||[]},only:function(e){if(!J0(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Qt.Component=Vl;Qt.Fragment=H3;Qt.Profiler=X3;Qt.PureComponent=H0;Qt.StrictMode=Q3;Qt.Suspense=eF;Qt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oF;Qt.act=jC;Qt.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=kC({},e.props),s=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=X0.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)$C.call(t,l)&&!IC.hasOwnProperty(l)&&(n[l]=t[l]===void 0&&o!==void 0?o[l]:t[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];n.children=o}return{$$typeof:Fu,type:e.type,key:s,ref:i,props:n,_owner:a}};Qt.createContext=function(e){return e={$$typeof:Y3,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:J3,_context:e},e.Consumer=e};Qt.createElement=AC;Qt.createFactory=function(e){var t=AC.bind(null,e);return t.type=e,t};Qt.createRef=function(){return{current:null}};Qt.forwardRef=function(e){return{$$typeof:Z3,render:e}};Qt.isValidElement=J0;Qt.lazy=function(e){return{$$typeof:rF,_payload:{_status:-1,_result:e},_init:aF}};Qt.memo=function(e,t){return{$$typeof:tF,type:e,compare:t===void 0?null:t}};Qt.startTransition=function(e){var t=Sh.transition;Sh.transition={};try{e()}finally{Sh.transition=t}};Qt.unstable_act=jC;Qt.useCallback=function(e,t){return Hn.current.useCallback(e,t)};Qt.useContext=function(e){return Hn.current.useContext(e)};Qt.useDebugValue=function(){};Qt.useDeferredValue=function(e){return Hn.current.useDeferredValue(e)};Qt.useEffect=function(e,t){return Hn.current.useEffect(e,t)};Qt.useId=function(){return Hn.current.useId()};Qt.useImperativeHandle=function(e,t,r){return Hn.current.useImperativeHandle(e,t,r)};Qt.useInsertionEffect=function(e,t){return Hn.current.useInsertionEffect(e,t)};Qt.useLayoutEffect=function(e,t){return Hn.current.useLayoutEffect(e,t)};Qt.useMemo=function(e,t){return Hn.current.useMemo(e,t)};Qt.useReducer=function(e,t,r){return Hn.current.useReducer(e,t,r)};Qt.useRef=function(e){return Hn.current.useRef(e)};Qt.useState=function(e){return Hn.current.useState(e)};Qt.useSyncExternalStore=function(e,t,r){return Hn.current.useSyncExternalStore(e,t,r)};Qt.useTransition=function(){return Hn.current.useTransition()};Qt.version="18.3.1";EC.exports=Qt;var ke=EC.exports;const lF=MC(ke);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cF=ke,uF=Symbol.for("react.element"),dF=Symbol.for("react.fragment"),hF=Object.prototype.hasOwnProperty,fF=cF.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pF={key:!0,ref:!0,__self:!0,__source:!0};function OC(e,t,r){var n,s={},i=null,a=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(n in t)hF.call(t,n)&&!pF.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:uF,type:e,key:i,ref:a,props:s,_owner:fF.current}}Af.Fragment=dF;Af.jsx=OC;Af.jsxs=OC;TC.exports=Af;var f=TC.exports,f_={},NC={exports:{}},vs={},DC={exports:{}},FC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(X,ae){var le=X.length;X.push(ae);e:for(;0<le;){var ne=le-1>>>1,L=X[ne];if(0<s(L,ae))X[ne]=ae,X[le]=L,le=ne;else break e}}function r(X){return X.length===0?null:X[0]}function n(X){if(X.length===0)return null;var ae=X[0],le=X.pop();if(le!==ae){X[0]=le;e:for(var ne=0,L=X.length,F=L>>>1;ne<F;){var G=2*(ne+1)-1,oe=X[G],H=G+1,Te=X[H];if(0>s(oe,le))H<L&&0>s(Te,oe)?(X[ne]=Te,X[H]=le,ne=H):(X[ne]=oe,X[G]=le,ne=G);else if(H<L&&0>s(Te,le))X[ne]=Te,X[H]=le,ne=H;else break e}}return ae}function s(X,ae){var le=X.sortIndex-ae.sortIndex;return le!==0?le:X.id-ae.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],d=1,h=null,u=3,p=!1,m=!1,y=!1,P=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(X){for(var ae=r(c);ae!==null;){if(ae.callback===null)n(c);else if(ae.startTime<=X)n(c),ae.sortIndex=ae.expirationTime,t(l,ae);else break;ae=r(c)}}function w(X){if(y=!1,b(X),!m)if(r(l)!==null)m=!0,Z(M);else{var ae=r(c);ae!==null&&J(w,ae.startTime-X)}}function M(X,ae){m=!1,y&&(y=!1,g(S),S=-1),p=!0;var le=u;try{for(b(ae),h=r(l);h!==null&&(!(h.expirationTime>ae)||X&&!U());){var ne=h.callback;if(typeof ne=="function"){h.callback=null,u=h.priorityLevel;var L=ne(h.expirationTime<=ae);ae=e.unstable_now(),typeof L=="function"?h.callback=L:h===r(l)&&n(l),b(ae)}else n(l);h=r(l)}if(h!==null)var F=!0;else{var G=r(c);G!==null&&J(w,G.startTime-ae),F=!1}return F}finally{h=null,u=le,p=!1}}var E=!1,T=null,S=-1,A=5,j=-1;function U(){return!(e.unstable_now()-j<A)}function W(){if(T!==null){var X=e.unstable_now();j=X;var ae=!0;try{ae=T(!0,X)}finally{ae?B():(E=!1,T=null)}}else E=!1}var B;if(typeof _=="function")B=function(){_(W)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,Q=ee.port2;ee.port1.onmessage=W,B=function(){Q.postMessage(null)}}else B=function(){P(W,0)};function Z(X){T=X,E||(E=!0,B())}function J(X,ae){S=P(function(){X(e.unstable_now())},ae)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(X){X.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,Z(M))},e.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<X?Math.floor(1e3/X):5},e.unstable_getCurrentPriorityLevel=function(){return u},e.unstable_getFirstCallbackNode=function(){return r(l)},e.unstable_next=function(X){switch(u){case 1:case 2:case 3:var ae=3;break;default:ae=u}var le=u;u=ae;try{return X()}finally{u=le}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(X,ae){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var le=u;u=X;try{return ae()}finally{u=le}},e.unstable_scheduleCallback=function(X,ae,le){var ne=e.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?ne+le:ne):le=ne,X){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=le+L,X={id:d++,callback:ae,priorityLevel:X,startTime:le,expirationTime:L,sortIndex:-1},le>ne?(X.sortIndex=le,t(c,X),r(l)===null&&X===r(c)&&(y?(g(S),S=-1):y=!0,J(w,le-ne))):(X.sortIndex=L,t(l,X),m||p||(m=!0,Z(M))),X},e.unstable_shouldYield=U,e.unstable_wrapCallback=function(X){var ae=u;return function(){var le=u;u=ae;try{return X.apply(this,arguments)}finally{u=le}}}})(FC);DC.exports=FC;var mF=DC.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gF=ke,ws=mF;function et(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var LC=new Set,cu={};function Co(e,t){$l(e,t),$l(e+"Capture",t)}function $l(e,t){for(cu[e]=t,e=0;e<t.length;e++)LC.add(t[e])}var Bi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),p_=Object.prototype.hasOwnProperty,_F=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wT={},vT={};function yF(e){return p_.call(vT,e)?!0:p_.call(wT,e)?!1:_F.test(e)?vT[e]=!0:(wT[e]=!0,!1)}function wF(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function vF(e,t,r,n){if(t===null||typeof t>"u"||wF(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Qn(e,t,r,n,s,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var $n={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){$n[e]=new Qn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];$n[t]=new Qn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){$n[e]=new Qn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){$n[e]=new Qn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){$n[e]=new Qn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){$n[e]=new Qn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){$n[e]=new Qn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){$n[e]=new Qn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){$n[e]=new Qn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Y0=/[\-:]([a-z])/g;function Z0(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Y0,Z0);$n[t]=new Qn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Y0,Z0);$n[t]=new Qn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Y0,Z0);$n[t]=new Qn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){$n[e]=new Qn(e,1,!1,e.toLowerCase(),null,!1,!1)});$n.xlinkHref=new Qn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){$n[e]=new Qn(e,1,!1,e.toLowerCase(),null,!0,!0)});function ey(e,t,r,n){var s=$n.hasOwnProperty(t)?$n[t]:null;(s!==null?s.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(vF(t,r,s,n)&&(r=null),n||s===null?yF(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,n=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var qi=gF.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Bd=Symbol.for("react.element"),ll=Symbol.for("react.portal"),cl=Symbol.for("react.fragment"),ty=Symbol.for("react.strict_mode"),m_=Symbol.for("react.profiler"),RC=Symbol.for("react.provider"),zC=Symbol.for("react.context"),ry=Symbol.for("react.forward_ref"),g_=Symbol.for("react.suspense"),__=Symbol.for("react.suspense_list"),ny=Symbol.for("react.memo"),la=Symbol.for("react.lazy"),BC=Symbol.for("react.offscreen"),xT=Symbol.iterator;function xc(e){return e===null||typeof e!="object"?null:(e=xT&&e[xT]||e["@@iterator"],typeof e=="function"?e:null)}var Ur=Object.assign,$m;function Bc(e){if($m===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);$m=t&&t[1]||""}return`
`+$m+e}var Im=!1;function Am(e,t){if(!e||Im)return"";Im=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=n.stack.split(`
`),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==i[o]){var l=`
`+s[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=o);break}}}finally{Im=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Bc(e):""}function xF(e){switch(e.tag){case 5:return Bc(e.type);case 16:return Bc("Lazy");case 13:return Bc("Suspense");case 19:return Bc("SuspenseList");case 0:case 2:case 15:return e=Am(e.type,!1),e;case 11:return e=Am(e.type.render,!1),e;case 1:return e=Am(e.type,!0),e;default:return""}}function y_(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case cl:return"Fragment";case ll:return"Portal";case m_:return"Profiler";case ty:return"StrictMode";case g_:return"Suspense";case __:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case zC:return(e.displayName||"Context")+".Consumer";case RC:return(e._context.displayName||"Context")+".Provider";case ry:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ny:return t=e.displayName||null,t!==null?t:y_(e.type)||"Memo";case la:t=e._payload,e=e._init;try{return y_(e(t))}catch{}}return null}function bF(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return y_(t);case 8:return t===ty?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Ma(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function UC(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function MF(e){var t=UC(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(a){n=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ud(e){e._valueTracker||(e._valueTracker=MF(e))}function VC(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=UC(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function qh(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function w_(e,t){var r=t.checked;return Ur({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function bT(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Ma(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function WC(e,t){t=t.checked,t!=null&&ey(e,"checked",t,!1)}function v_(e,t){WC(e,t);var r=Ma(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?x_(e,t.type,r):t.hasOwnProperty("defaultValue")&&x_(e,t.type,Ma(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function MT(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function x_(e,t,r){(t!=="number"||qh(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Uc=Array.isArray;function bl(e,t,r,n){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Ma(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,n&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function b_(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(et(91));return Ur({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function TT(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(et(92));if(Uc(r)){if(1<r.length)throw Error(et(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Ma(r)}}function GC(e,t){var r=Ma(t.value),n=Ma(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function ET(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function qC(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function M_(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?qC(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Vd,KC=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Vd=Vd||document.createElement("div"),Vd.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Vd.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function uu(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Xc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},TF=["Webkit","ms","Moz","O"];Object.keys(Xc).forEach(function(e){TF.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Xc[t]=Xc[e]})});function HC(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Xc.hasOwnProperty(e)&&Xc[e]?(""+t).trim():t+"px"}function QC(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,s=HC(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,s):e[r]=s}}var EF=Ur({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function T_(e,t){if(t){if(EF[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(et(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(et(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(et(61))}if(t.style!=null&&typeof t.style!="object")throw Error(et(62))}}function E_(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var P_=null;function sy(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var k_=null,Ml=null,Tl=null;function PT(e){if(e=zu(e)){if(typeof k_!="function")throw Error(et(280));var t=e.stateNode;t&&(t=Ff(t),k_(e.stateNode,e.type,t))}}function XC(e){Ml?Tl?Tl.push(e):Tl=[e]:Ml=e}function JC(){if(Ml){var e=Ml,t=Tl;if(Tl=Ml=null,PT(e),t)for(e=0;e<t.length;e++)PT(t[e])}}function YC(e,t){return e(t)}function ZC(){}var jm=!1;function e$(e,t,r){if(jm)return e(t,r);jm=!0;try{return YC(e,t,r)}finally{jm=!1,(Ml!==null||Tl!==null)&&(ZC(),JC())}}function du(e,t){var r=e.stateNode;if(r===null)return null;var n=Ff(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(et(231,t,typeof r));return r}var S_=!1;if(Bi)try{var bc={};Object.defineProperty(bc,"passive",{get:function(){S_=!0}}),window.addEventListener("test",bc,bc),window.removeEventListener("test",bc,bc)}catch{S_=!1}function PF(e,t,r,n,s,i,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(d){this.onError(d)}}var Jc=!1,Kh=null,Hh=!1,C_=null,kF={onError:function(e){Jc=!0,Kh=e}};function SF(e,t,r,n,s,i,a,o,l){Jc=!1,Kh=null,PF.apply(kF,arguments)}function CF(e,t,r,n,s,i,a,o,l){if(SF.apply(this,arguments),Jc){if(Jc){var c=Kh;Jc=!1,Kh=null}else throw Error(et(198));Hh||(Hh=!0,C_=c)}}function $o(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function t$(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function kT(e){if($o(e)!==e)throw Error(et(188))}function $F(e){var t=e.alternate;if(!t){if(t=$o(e),t===null)throw Error(et(188));return t!==e?null:e}for(var r=e,n=t;;){var s=r.return;if(s===null)break;var i=s.alternate;if(i===null){if(n=s.return,n!==null){r=n;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===r)return kT(s),e;if(i===n)return kT(s),t;i=i.sibling}throw Error(et(188))}if(r.return!==n.return)r=s,n=i;else{for(var a=!1,o=s.child;o;){if(o===r){a=!0,r=s,n=i;break}if(o===n){a=!0,n=s,r=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===r){a=!0,r=i,n=s;break}if(o===n){a=!0,n=i,r=s;break}o=o.sibling}if(!a)throw Error(et(189))}}if(r.alternate!==n)throw Error(et(190))}if(r.tag!==3)throw Error(et(188));return r.stateNode.current===r?e:t}function r$(e){return e=$F(e),e!==null?n$(e):null}function n$(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=n$(e);if(t!==null)return t;e=e.sibling}return null}var s$=ws.unstable_scheduleCallback,ST=ws.unstable_cancelCallback,IF=ws.unstable_shouldYield,AF=ws.unstable_requestPaint,Yr=ws.unstable_now,jF=ws.unstable_getCurrentPriorityLevel,iy=ws.unstable_ImmediatePriority,i$=ws.unstable_UserBlockingPriority,Qh=ws.unstable_NormalPriority,OF=ws.unstable_LowPriority,a$=ws.unstable_IdlePriority,jf=null,bi=null;function NF(e){if(bi&&typeof bi.onCommitFiberRoot=="function")try{bi.onCommitFiberRoot(jf,e,void 0,(e.current.flags&128)===128)}catch{}}var oi=Math.clz32?Math.clz32:LF,DF=Math.log,FF=Math.LN2;function LF(e){return e>>>=0,e===0?32:31-(DF(e)/FF|0)|0}var Wd=64,Gd=4194304;function Vc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Xh(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,s=e.suspendedLanes,i=e.pingedLanes,a=r&268435455;if(a!==0){var o=a&~s;o!==0?n=Vc(o):(i&=a,i!==0&&(n=Vc(i)))}else a=r&~s,a!==0?n=Vc(a):i!==0&&(n=Vc(i));if(n===0)return 0;if(t!==0&&t!==n&&!(t&s)&&(s=n&-n,i=t&-t,s>=i||s===16&&(i&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-oi(t),s=1<<r,n|=e[r],t&=~s;return n}function RF(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zF(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-oi(i),o=1<<a,l=s[a];l===-1?(!(o&r)||o&n)&&(s[a]=RF(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}}function $_(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function o$(){var e=Wd;return Wd<<=1,!(Wd&4194240)&&(Wd=64),e}function Om(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Lu(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-oi(t),e[t]=r}function BF(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-oi(r),i=1<<s;t[s]=0,n[s]=-1,e[s]=-1,r&=~i}}function ay(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-oi(r),s=1<<n;s&t|e[n]&t&&(e[n]|=t),r&=~s}}var ur=0;function l$(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var c$,oy,u$,d$,h$,I_=!1,qd=[],ma=null,ga=null,_a=null,hu=new Map,fu=new Map,ua=[],UF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function CT(e,t){switch(e){case"focusin":case"focusout":ma=null;break;case"dragenter":case"dragleave":ga=null;break;case"mouseover":case"mouseout":_a=null;break;case"pointerover":case"pointerout":hu.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":fu.delete(t.pointerId)}}function Mc(e,t,r,n,s,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[s]},t!==null&&(t=zu(t),t!==null&&oy(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function VF(e,t,r,n,s){switch(t){case"focusin":return ma=Mc(ma,e,t,r,n,s),!0;case"dragenter":return ga=Mc(ga,e,t,r,n,s),!0;case"mouseover":return _a=Mc(_a,e,t,r,n,s),!0;case"pointerover":var i=s.pointerId;return hu.set(i,Mc(hu.get(i)||null,e,t,r,n,s)),!0;case"gotpointercapture":return i=s.pointerId,fu.set(i,Mc(fu.get(i)||null,e,t,r,n,s)),!0}return!1}function f$(e){var t=ho(e.target);if(t!==null){var r=$o(t);if(r!==null){if(t=r.tag,t===13){if(t=t$(r),t!==null){e.blockedOn=t,h$(e.priority,function(){u$(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ch(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=A_(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);P_=n,r.target.dispatchEvent(n),P_=null}else return t=zu(r),t!==null&&oy(t),e.blockedOn=r,!1;t.shift()}return!0}function $T(e,t,r){Ch(e)&&r.delete(t)}function WF(){I_=!1,ma!==null&&Ch(ma)&&(ma=null),ga!==null&&Ch(ga)&&(ga=null),_a!==null&&Ch(_a)&&(_a=null),hu.forEach($T),fu.forEach($T)}function Tc(e,t){e.blockedOn===t&&(e.blockedOn=null,I_||(I_=!0,ws.unstable_scheduleCallback(ws.unstable_NormalPriority,WF)))}function pu(e){function t(s){return Tc(s,e)}if(0<qd.length){Tc(qd[0],e);for(var r=1;r<qd.length;r++){var n=qd[r];n.blockedOn===e&&(n.blockedOn=null)}}for(ma!==null&&Tc(ma,e),ga!==null&&Tc(ga,e),_a!==null&&Tc(_a,e),hu.forEach(t),fu.forEach(t),r=0;r<ua.length;r++)n=ua[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<ua.length&&(r=ua[0],r.blockedOn===null);)f$(r),r.blockedOn===null&&ua.shift()}var El=qi.ReactCurrentBatchConfig,Jh=!0;function GF(e,t,r,n){var s=ur,i=El.transition;El.transition=null;try{ur=1,ly(e,t,r,n)}finally{ur=s,El.transition=i}}function qF(e,t,r,n){var s=ur,i=El.transition;El.transition=null;try{ur=4,ly(e,t,r,n)}finally{ur=s,El.transition=i}}function ly(e,t,r,n){if(Jh){var s=A_(e,t,r,n);if(s===null)Wm(e,t,n,Yh,r),CT(e,n);else if(VF(s,e,t,r,n))n.stopPropagation();else if(CT(e,n),t&4&&-1<UF.indexOf(e)){for(;s!==null;){var i=zu(s);if(i!==null&&c$(i),i=A_(e,t,r,n),i===null&&Wm(e,t,n,Yh,r),i===s)break;s=i}s!==null&&n.stopPropagation()}else Wm(e,t,n,null,r)}}var Yh=null;function A_(e,t,r,n){if(Yh=null,e=sy(n),e=ho(e),e!==null)if(t=$o(e),t===null)e=null;else if(r=t.tag,r===13){if(e=t$(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yh=e,null}function p$(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jF()){case iy:return 1;case i$:return 4;case Qh:case OF:return 16;case a$:return 536870912;default:return 16}default:return 16}}var fa=null,cy=null,$h=null;function m$(){if($h)return $h;var e,t=cy,r=t.length,n,s="value"in fa?fa.value:fa.textContent,i=s.length;for(e=0;e<r&&t[e]===s[e];e++);var a=r-e;for(n=1;n<=a&&t[r-n]===s[i-n];n++);return $h=s.slice(e,1<n?1-n:void 0)}function Ih(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Kd(){return!0}function IT(){return!1}function xs(e){function t(r,n,s,i,a){this._reactName=r,this._targetInst=s,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(r=e[o],this[o]=r?r(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Kd:IT,this.isPropagationStopped=IT,this}return Ur(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Kd)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Kd)},persist:function(){},isPersistent:Kd}),t}var Wl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uy=xs(Wl),Ru=Ur({},Wl,{view:0,detail:0}),KF=xs(Ru),Nm,Dm,Ec,Of=Ur({},Ru,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dy,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ec&&(Ec&&e.type==="mousemove"?(Nm=e.screenX-Ec.screenX,Dm=e.screenY-Ec.screenY):Dm=Nm=0,Ec=e),Nm)},movementY:function(e){return"movementY"in e?e.movementY:Dm}}),AT=xs(Of),HF=Ur({},Of,{dataTransfer:0}),QF=xs(HF),XF=Ur({},Ru,{relatedTarget:0}),Fm=xs(XF),JF=Ur({},Wl,{animationName:0,elapsedTime:0,pseudoElement:0}),YF=xs(JF),ZF=Ur({},Wl,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),eL=xs(ZF),tL=Ur({},Wl,{data:0}),jT=xs(tL),rL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function iL(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=sL[e])?!!t[e]:!1}function dy(){return iL}var aL=Ur({},Ru,{key:function(e){if(e.key){var t=rL[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ih(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?nL[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dy,charCode:function(e){return e.type==="keypress"?Ih(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ih(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),oL=xs(aL),lL=Ur({},Of,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),OT=xs(lL),cL=Ur({},Ru,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dy}),uL=xs(cL),dL=Ur({},Wl,{propertyName:0,elapsedTime:0,pseudoElement:0}),hL=xs(dL),fL=Ur({},Of,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),pL=xs(fL),mL=[9,13,27,32],hy=Bi&&"CompositionEvent"in window,Yc=null;Bi&&"documentMode"in document&&(Yc=document.documentMode);var gL=Bi&&"TextEvent"in window&&!Yc,g$=Bi&&(!hy||Yc&&8<Yc&&11>=Yc),NT=" ",DT=!1;function _$(e,t){switch(e){case"keyup":return mL.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function y$(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ul=!1;function _L(e,t){switch(e){case"compositionend":return y$(t);case"keypress":return t.which!==32?null:(DT=!0,NT);case"textInput":return e=t.data,e===NT&&DT?null:e;default:return null}}function yL(e,t){if(ul)return e==="compositionend"||!hy&&_$(e,t)?(e=m$(),$h=cy=fa=null,ul=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return g$&&t.locale!=="ko"?null:t.data;default:return null}}var wL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function FT(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!wL[e.type]:t==="textarea"}function w$(e,t,r,n){XC(n),t=Zh(t,"onChange"),0<t.length&&(r=new uy("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Zc=null,mu=null;function vL(e){$$(e,0)}function Nf(e){var t=fl(e);if(VC(t))return e}function xL(e,t){if(e==="change")return t}var v$=!1;if(Bi){var Lm;if(Bi){var Rm="oninput"in document;if(!Rm){var LT=document.createElement("div");LT.setAttribute("oninput","return;"),Rm=typeof LT.oninput=="function"}Lm=Rm}else Lm=!1;v$=Lm&&(!document.documentMode||9<document.documentMode)}function RT(){Zc&&(Zc.detachEvent("onpropertychange",x$),mu=Zc=null)}function x$(e){if(e.propertyName==="value"&&Nf(mu)){var t=[];w$(t,mu,e,sy(e)),e$(vL,t)}}function bL(e,t,r){e==="focusin"?(RT(),Zc=t,mu=r,Zc.attachEvent("onpropertychange",x$)):e==="focusout"&&RT()}function ML(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Nf(mu)}function TL(e,t){if(e==="click")return Nf(t)}function EL(e,t){if(e==="input"||e==="change")return Nf(t)}function PL(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var di=typeof Object.is=="function"?Object.is:PL;function gu(e,t){if(di(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!p_.call(t,s)||!di(e[s],t[s]))return!1}return!0}function zT(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function BT(e,t){var r=zT(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=zT(r)}}function b$(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?b$(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function M$(){for(var e=window,t=qh();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=qh(e.document)}return t}function fy(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function kL(e){var t=M$(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&b$(r.ownerDocument.documentElement,r)){if(n!==null&&fy(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,i=Math.min(n.start,s);n=n.end===void 0?i:Math.min(n.end,s),!e.extend&&i>n&&(s=n,n=i,i=s),s=BT(r,i);var a=BT(r,n);s&&a&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var SL=Bi&&"documentMode"in document&&11>=document.documentMode,dl=null,j_=null,eu=null,O_=!1;function UT(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;O_||dl==null||dl!==qh(n)||(n=dl,"selectionStart"in n&&fy(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),eu&&gu(eu,n)||(eu=n,n=Zh(j_,"onSelect"),0<n.length&&(t=new uy("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=dl)))}function Hd(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var hl={animationend:Hd("Animation","AnimationEnd"),animationiteration:Hd("Animation","AnimationIteration"),animationstart:Hd("Animation","AnimationStart"),transitionend:Hd("Transition","TransitionEnd")},zm={},T$={};Bi&&(T$=document.createElement("div").style,"AnimationEvent"in window||(delete hl.animationend.animation,delete hl.animationiteration.animation,delete hl.animationstart.animation),"TransitionEvent"in window||delete hl.transitionend.transition);function Df(e){if(zm[e])return zm[e];if(!hl[e])return e;var t=hl[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in T$)return zm[e]=t[r];return e}var E$=Df("animationend"),P$=Df("animationiteration"),k$=Df("animationstart"),S$=Df("transitionend"),C$=new Map,VT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ka(e,t){C$.set(e,t),Co(t,[e])}for(var Bm=0;Bm<VT.length;Bm++){var Um=VT[Bm],CL=Um.toLowerCase(),$L=Um[0].toUpperCase()+Um.slice(1);ka(CL,"on"+$L)}ka(E$,"onAnimationEnd");ka(P$,"onAnimationIteration");ka(k$,"onAnimationStart");ka("dblclick","onDoubleClick");ka("focusin","onFocus");ka("focusout","onBlur");ka(S$,"onTransitionEnd");$l("onMouseEnter",["mouseout","mouseover"]);$l("onMouseLeave",["mouseout","mouseover"]);$l("onPointerEnter",["pointerout","pointerover"]);$l("onPointerLeave",["pointerout","pointerover"]);Co("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Co("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Co("onBeforeInput",["compositionend","keypress","textInput","paste"]);Co("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Co("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Co("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),IL=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wc));function WT(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,CF(n,t,void 0,e),e.currentTarget=null}function $$(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],s=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;WT(s,o,c),i=l}else for(a=0;a<n.length;a++){if(o=n[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;WT(s,o,c),i=l}}}if(Hh)throw e=C_,Hh=!1,C_=null,e}function Sr(e,t){var r=t[R_];r===void 0&&(r=t[R_]=new Set);var n=e+"__bubble";r.has(n)||(I$(t,e,2,!1),r.add(n))}function Vm(e,t,r){var n=0;t&&(n|=4),I$(r,e,n,t)}var Qd="_reactListening"+Math.random().toString(36).slice(2);function _u(e){if(!e[Qd]){e[Qd]=!0,LC.forEach(function(r){r!=="selectionchange"&&(IL.has(r)||Vm(r,!1,e),Vm(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Qd]||(t[Qd]=!0,Vm("selectionchange",!1,t))}}function I$(e,t,r,n){switch(p$(t)){case 1:var s=GF;break;case 4:s=qF;break;default:s=ly}r=s.bind(null,t,r,e),s=void 0,!S_||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),n?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function Wm(e,t,r,n,s){var i=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var o=n.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=n.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=ho(o),a===null)return;if(l=a.tag,l===5||l===6){n=i=a;continue e}o=o.parentNode}}n=n.return}e$(function(){var c=i,d=sy(r),h=[];e:{var u=C$.get(e);if(u!==void 0){var p=uy,m=e;switch(e){case"keypress":if(Ih(r)===0)break e;case"keydown":case"keyup":p=oL;break;case"focusin":m="focus",p=Fm;break;case"focusout":m="blur",p=Fm;break;case"beforeblur":case"afterblur":p=Fm;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=AT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=QF;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=uL;break;case E$:case P$:case k$:p=YF;break;case S$:p=hL;break;case"scroll":p=KF;break;case"wheel":p=pL;break;case"copy":case"cut":case"paste":p=eL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=OT}var y=(t&4)!==0,P=!y&&e==="scroll",g=y?u!==null?u+"Capture":null:u;y=[];for(var _=c,b;_!==null;){b=_;var w=b.stateNode;if(b.tag===5&&w!==null&&(b=w,g!==null&&(w=du(_,g),w!=null&&y.push(yu(_,w,b)))),P)break;_=_.return}0<y.length&&(u=new p(u,m,null,r,d),h.push({event:u,listeners:y}))}}if(!(t&7)){e:{if(u=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",u&&r!==P_&&(m=r.relatedTarget||r.fromElement)&&(ho(m)||m[Ui]))break e;if((p||u)&&(u=d.window===d?d:(u=d.ownerDocument)?u.defaultView||u.parentWindow:window,p?(m=r.relatedTarget||r.toElement,p=c,m=m?ho(m):null,m!==null&&(P=$o(m),m!==P||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=c),p!==m)){if(y=AT,w="onMouseLeave",g="onMouseEnter",_="mouse",(e==="pointerout"||e==="pointerover")&&(y=OT,w="onPointerLeave",g="onPointerEnter",_="pointer"),P=p==null?u:fl(p),b=m==null?u:fl(m),u=new y(w,_+"leave",p,r,d),u.target=P,u.relatedTarget=b,w=null,ho(d)===c&&(y=new y(g,_+"enter",m,r,d),y.target=b,y.relatedTarget=P,w=y),P=w,p&&m)t:{for(y=p,g=m,_=0,b=y;b;b=Xo(b))_++;for(b=0,w=g;w;w=Xo(w))b++;for(;0<_-b;)y=Xo(y),_--;for(;0<b-_;)g=Xo(g),b--;for(;_--;){if(y===g||g!==null&&y===g.alternate)break t;y=Xo(y),g=Xo(g)}y=null}else y=null;p!==null&&GT(h,u,p,y,!1),m!==null&&P!==null&&GT(h,P,m,y,!0)}}e:{if(u=c?fl(c):window,p=u.nodeName&&u.nodeName.toLowerCase(),p==="select"||p==="input"&&u.type==="file")var M=xL;else if(FT(u))if(v$)M=EL;else{M=ML;var E=bL}else(p=u.nodeName)&&p.toLowerCase()==="input"&&(u.type==="checkbox"||u.type==="radio")&&(M=TL);if(M&&(M=M(e,c))){w$(h,M,r,d);break e}E&&E(e,u,c),e==="focusout"&&(E=u._wrapperState)&&E.controlled&&u.type==="number"&&x_(u,"number",u.value)}switch(E=c?fl(c):window,e){case"focusin":(FT(E)||E.contentEditable==="true")&&(dl=E,j_=c,eu=null);break;case"focusout":eu=j_=dl=null;break;case"mousedown":O_=!0;break;case"contextmenu":case"mouseup":case"dragend":O_=!1,UT(h,r,d);break;case"selectionchange":if(SL)break;case"keydown":case"keyup":UT(h,r,d)}var T;if(hy)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else ul?_$(e,r)&&(S="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(S="onCompositionStart");S&&(g$&&r.locale!=="ko"&&(ul||S!=="onCompositionStart"?S==="onCompositionEnd"&&ul&&(T=m$()):(fa=d,cy="value"in fa?fa.value:fa.textContent,ul=!0)),E=Zh(c,S),0<E.length&&(S=new jT(S,e,null,r,d),h.push({event:S,listeners:E}),T?S.data=T:(T=y$(r),T!==null&&(S.data=T)))),(T=gL?_L(e,r):yL(e,r))&&(c=Zh(c,"onBeforeInput"),0<c.length&&(d=new jT("onBeforeInput","beforeinput",null,r,d),h.push({event:d,listeners:c}),d.data=T))}$$(h,t)})}function yu(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Zh(e,t){for(var r=t+"Capture",n=[];e!==null;){var s=e,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=du(e,r),i!=null&&n.unshift(yu(e,i,s)),i=du(e,t),i!=null&&n.push(yu(e,i,s))),e=e.return}return n}function Xo(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function GT(e,t,r,n,s){for(var i=t._reactName,a=[];r!==null&&r!==n;){var o=r,l=o.alternate,c=o.stateNode;if(l!==null&&l===n)break;o.tag===5&&c!==null&&(o=c,s?(l=du(r,i),l!=null&&a.unshift(yu(r,l,o))):s||(l=du(r,i),l!=null&&a.push(yu(r,l,o)))),r=r.return}a.length!==0&&e.push({event:t,listeners:a})}var AL=/\r\n?/g,jL=/\u0000|\uFFFD/g;function qT(e){return(typeof e=="string"?e:""+e).replace(AL,`
`).replace(jL,"")}function Xd(e,t,r){if(t=qT(t),qT(e)!==t&&r)throw Error(et(425))}function ef(){}var N_=null,D_=null;function F_(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var L_=typeof setTimeout=="function"?setTimeout:void 0,OL=typeof clearTimeout=="function"?clearTimeout:void 0,KT=typeof Promise=="function"?Promise:void 0,NL=typeof queueMicrotask=="function"?queueMicrotask:typeof KT<"u"?function(e){return KT.resolve(null).then(e).catch(DL)}:L_;function DL(e){setTimeout(function(){throw e})}function Gm(e,t){var r=t,n=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(n===0){e.removeChild(s),pu(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=s}while(r);pu(t)}function ya(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function HT(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Gl=Math.random().toString(36).slice(2),xi="__reactFiber$"+Gl,wu="__reactProps$"+Gl,Ui="__reactContainer$"+Gl,R_="__reactEvents$"+Gl,FL="__reactListeners$"+Gl,LL="__reactHandles$"+Gl;function ho(e){var t=e[xi];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Ui]||r[xi]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=HT(e);e!==null;){if(r=e[xi])return r;e=HT(e)}return t}e=r,r=e.parentNode}return null}function zu(e){return e=e[xi]||e[Ui],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function fl(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(et(33))}function Ff(e){return e[wu]||null}var z_=[],pl=-1;function Sa(e){return{current:e}}function Cr(e){0>pl||(e.current=z_[pl],z_[pl]=null,pl--)}function Tr(e,t){pl++,z_[pl]=e.current,e.current=t}var Ta={},Rn=Sa(Ta),ts=Sa(!1),wo=Ta;function Il(e,t){var r=e.type.contextTypes;if(!r)return Ta;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in r)s[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function rs(e){return e=e.childContextTypes,e!=null}function tf(){Cr(ts),Cr(Rn)}function QT(e,t,r){if(Rn.current!==Ta)throw Error(et(168));Tr(Rn,t),Tr(ts,r)}function A$(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var s in n)if(!(s in t))throw Error(et(108,bF(e)||"Unknown",s));return Ur({},r,n)}function rf(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ta,wo=Rn.current,Tr(Rn,e),Tr(ts,ts.current),!0}function XT(e,t,r){var n=e.stateNode;if(!n)throw Error(et(169));r?(e=A$(e,t,wo),n.__reactInternalMemoizedMergedChildContext=e,Cr(ts),Cr(Rn),Tr(Rn,e)):Cr(ts),Tr(ts,r)}var Di=null,Lf=!1,qm=!1;function j$(e){Di===null?Di=[e]:Di.push(e)}function RL(e){Lf=!0,j$(e)}function Ca(){if(!qm&&Di!==null){qm=!0;var e=0,t=ur;try{var r=Di;for(ur=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Di=null,Lf=!1}catch(s){throw Di!==null&&(Di=Di.slice(e+1)),s$(iy,Ca),s}finally{ur=t,qm=!1}}return null}var ml=[],gl=0,nf=null,sf=0,js=[],Os=0,vo=null,Li=1,Ri="";function to(e,t){ml[gl++]=sf,ml[gl++]=nf,nf=e,sf=t}function O$(e,t,r){js[Os++]=Li,js[Os++]=Ri,js[Os++]=vo,vo=e;var n=Li;e=Ri;var s=32-oi(n)-1;n&=~(1<<s),r+=1;var i=32-oi(t)+s;if(30<i){var a=s-s%5;i=(n&(1<<a)-1).toString(32),n>>=a,s-=a,Li=1<<32-oi(t)+s|r<<s|n,Ri=i+e}else Li=1<<i|r<<s|n,Ri=e}function py(e){e.return!==null&&(to(e,1),O$(e,1,0))}function my(e){for(;e===nf;)nf=ml[--gl],ml[gl]=null,sf=ml[--gl],ml[gl]=null;for(;e===vo;)vo=js[--Os],js[Os]=null,Ri=js[--Os],js[Os]=null,Li=js[--Os],js[Os]=null}var _s=null,gs=null,jr=!1,si=null;function N$(e,t){var r=Ds(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function JT(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,_s=e,gs=ya(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,_s=e,gs=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=vo!==null?{id:Li,overflow:Ri}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Ds(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,_s=e,gs=null,!0):!1;default:return!1}}function B_(e){return(e.mode&1)!==0&&(e.flags&128)===0}function U_(e){if(jr){var t=gs;if(t){var r=t;if(!JT(e,t)){if(B_(e))throw Error(et(418));t=ya(r.nextSibling);var n=_s;t&&JT(e,t)?N$(n,r):(e.flags=e.flags&-4097|2,jr=!1,_s=e)}}else{if(B_(e))throw Error(et(418));e.flags=e.flags&-4097|2,jr=!1,_s=e}}}function YT(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;_s=e}function Jd(e){if(e!==_s)return!1;if(!jr)return YT(e),jr=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!F_(e.type,e.memoizedProps)),t&&(t=gs)){if(B_(e))throw D$(),Error(et(418));for(;t;)N$(e,t),t=ya(t.nextSibling)}if(YT(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(et(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){gs=ya(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}gs=null}}else gs=_s?ya(e.stateNode.nextSibling):null;return!0}function D$(){for(var e=gs;e;)e=ya(e.nextSibling)}function Al(){gs=_s=null,jr=!1}function gy(e){si===null?si=[e]:si.push(e)}var zL=qi.ReactCurrentBatchConfig;function Pc(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(et(309));var n=r.stateNode}if(!n)throw Error(et(147,e));var s=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var o=s.refs;a===null?delete o[i]:o[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(et(284));if(!r._owner)throw Error(et(290,e))}return e}function Yd(e,t){throw e=Object.prototype.toString.call(t),Error(et(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ZT(e){var t=e._init;return t(e._payload)}function F$(e){function t(g,_){if(e){var b=g.deletions;b===null?(g.deletions=[_],g.flags|=16):b.push(_)}}function r(g,_){if(!e)return null;for(;_!==null;)t(g,_),_=_.sibling;return null}function n(g,_){for(g=new Map;_!==null;)_.key!==null?g.set(_.key,_):g.set(_.index,_),_=_.sibling;return g}function s(g,_){return g=ba(g,_),g.index=0,g.sibling=null,g}function i(g,_,b){return g.index=b,e?(b=g.alternate,b!==null?(b=b.index,b<_?(g.flags|=2,_):b):(g.flags|=2,_)):(g.flags|=1048576,_)}function a(g){return e&&g.alternate===null&&(g.flags|=2),g}function o(g,_,b,w){return _===null||_.tag!==6?(_=Zm(b,g.mode,w),_.return=g,_):(_=s(_,b),_.return=g,_)}function l(g,_,b,w){var M=b.type;return M===cl?d(g,_,b.props.children,w,b.key):_!==null&&(_.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===la&&ZT(M)===_.type)?(w=s(_,b.props),w.ref=Pc(g,_,b),w.return=g,w):(w=Lh(b.type,b.key,b.props,null,g.mode,w),w.ref=Pc(g,_,b),w.return=g,w)}function c(g,_,b,w){return _===null||_.tag!==4||_.stateNode.containerInfo!==b.containerInfo||_.stateNode.implementation!==b.implementation?(_=eg(b,g.mode,w),_.return=g,_):(_=s(_,b.children||[]),_.return=g,_)}function d(g,_,b,w,M){return _===null||_.tag!==7?(_=yo(b,g.mode,w,M),_.return=g,_):(_=s(_,b),_.return=g,_)}function h(g,_,b){if(typeof _=="string"&&_!==""||typeof _=="number")return _=Zm(""+_,g.mode,b),_.return=g,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Bd:return b=Lh(_.type,_.key,_.props,null,g.mode,b),b.ref=Pc(g,null,_),b.return=g,b;case ll:return _=eg(_,g.mode,b),_.return=g,_;case la:var w=_._init;return h(g,w(_._payload),b)}if(Uc(_)||xc(_))return _=yo(_,g.mode,b,null),_.return=g,_;Yd(g,_)}return null}function u(g,_,b,w){var M=_!==null?_.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return M!==null?null:o(g,_,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Bd:return b.key===M?l(g,_,b,w):null;case ll:return b.key===M?c(g,_,b,w):null;case la:return M=b._init,u(g,_,M(b._payload),w)}if(Uc(b)||xc(b))return M!==null?null:d(g,_,b,w,null);Yd(g,b)}return null}function p(g,_,b,w,M){if(typeof w=="string"&&w!==""||typeof w=="number")return g=g.get(b)||null,o(_,g,""+w,M);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Bd:return g=g.get(w.key===null?b:w.key)||null,l(_,g,w,M);case ll:return g=g.get(w.key===null?b:w.key)||null,c(_,g,w,M);case la:var E=w._init;return p(g,_,b,E(w._payload),M)}if(Uc(w)||xc(w))return g=g.get(b)||null,d(_,g,w,M,null);Yd(_,w)}return null}function m(g,_,b,w){for(var M=null,E=null,T=_,S=_=0,A=null;T!==null&&S<b.length;S++){T.index>S?(A=T,T=null):A=T.sibling;var j=u(g,T,b[S],w);if(j===null){T===null&&(T=A);break}e&&T&&j.alternate===null&&t(g,T),_=i(j,_,S),E===null?M=j:E.sibling=j,E=j,T=A}if(S===b.length)return r(g,T),jr&&to(g,S),M;if(T===null){for(;S<b.length;S++)T=h(g,b[S],w),T!==null&&(_=i(T,_,S),E===null?M=T:E.sibling=T,E=T);return jr&&to(g,S),M}for(T=n(g,T);S<b.length;S++)A=p(T,g,S,b[S],w),A!==null&&(e&&A.alternate!==null&&T.delete(A.key===null?S:A.key),_=i(A,_,S),E===null?M=A:E.sibling=A,E=A);return e&&T.forEach(function(U){return t(g,U)}),jr&&to(g,S),M}function y(g,_,b,w){var M=xc(b);if(typeof M!="function")throw Error(et(150));if(b=M.call(b),b==null)throw Error(et(151));for(var E=M=null,T=_,S=_=0,A=null,j=b.next();T!==null&&!j.done;S++,j=b.next()){T.index>S?(A=T,T=null):A=T.sibling;var U=u(g,T,j.value,w);if(U===null){T===null&&(T=A);break}e&&T&&U.alternate===null&&t(g,T),_=i(U,_,S),E===null?M=U:E.sibling=U,E=U,T=A}if(j.done)return r(g,T),jr&&to(g,S),M;if(T===null){for(;!j.done;S++,j=b.next())j=h(g,j.value,w),j!==null&&(_=i(j,_,S),E===null?M=j:E.sibling=j,E=j);return jr&&to(g,S),M}for(T=n(g,T);!j.done;S++,j=b.next())j=p(T,g,S,j.value,w),j!==null&&(e&&j.alternate!==null&&T.delete(j.key===null?S:j.key),_=i(j,_,S),E===null?M=j:E.sibling=j,E=j);return e&&T.forEach(function(W){return t(g,W)}),jr&&to(g,S),M}function P(g,_,b,w){if(typeof b=="object"&&b!==null&&b.type===cl&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Bd:e:{for(var M=b.key,E=_;E!==null;){if(E.key===M){if(M=b.type,M===cl){if(E.tag===7){r(g,E.sibling),_=s(E,b.props.children),_.return=g,g=_;break e}}else if(E.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===la&&ZT(M)===E.type){r(g,E.sibling),_=s(E,b.props),_.ref=Pc(g,E,b),_.return=g,g=_;break e}r(g,E);break}else t(g,E);E=E.sibling}b.type===cl?(_=yo(b.props.children,g.mode,w,b.key),_.return=g,g=_):(w=Lh(b.type,b.key,b.props,null,g.mode,w),w.ref=Pc(g,_,b),w.return=g,g=w)}return a(g);case ll:e:{for(E=b.key;_!==null;){if(_.key===E)if(_.tag===4&&_.stateNode.containerInfo===b.containerInfo&&_.stateNode.implementation===b.implementation){r(g,_.sibling),_=s(_,b.children||[]),_.return=g,g=_;break e}else{r(g,_);break}else t(g,_);_=_.sibling}_=eg(b,g.mode,w),_.return=g,g=_}return a(g);case la:return E=b._init,P(g,_,E(b._payload),w)}if(Uc(b))return m(g,_,b,w);if(xc(b))return y(g,_,b,w);Yd(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,_!==null&&_.tag===6?(r(g,_.sibling),_=s(_,b),_.return=g,g=_):(r(g,_),_=Zm(b,g.mode,w),_.return=g,g=_),a(g)):r(g,_)}return P}var jl=F$(!0),L$=F$(!1),af=Sa(null),of=null,_l=null,_y=null;function yy(){_y=_l=of=null}function wy(e){var t=af.current;Cr(af),e._currentValue=t}function V_(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Pl(e,t){of=e,_y=_l=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(es=!0),e.firstContext=null)}function zs(e){var t=e._currentValue;if(_y!==e)if(e={context:e,memoizedValue:t,next:null},_l===null){if(of===null)throw Error(et(308));_l=e,of.dependencies={lanes:0,firstContext:e}}else _l=_l.next=e;return t}var fo=null;function vy(e){fo===null?fo=[e]:fo.push(e)}function R$(e,t,r,n){var s=t.interleaved;return s===null?(r.next=r,vy(t)):(r.next=s.next,s.next=r),t.interleaved=r,Vi(e,n)}function Vi(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var ca=!1;function xy(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function z$(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function zi(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function wa(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,rr&2){var s=n.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),n.pending=t,Vi(e,r)}return s=n.interleaved,s===null?(t.next=t,vy(n)):(t.next=s.next,s.next=t),n.interleaved=t,Vi(e,r)}function Ah(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,ay(e,r)}}function eE(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var s=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?s=i=a:i=i.next=a,r=r.next}while(r!==null);i===null?s=i=t:i=i.next=t}else s=i=t;r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function lf(e,t,r,n){var s=e.updateQueue;ca=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?i=c:a.next=c,a=l;var d=e.alternate;d!==null&&(d=d.updateQueue,o=d.lastBaseUpdate,o!==a&&(o===null?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=l))}if(i!==null){var h=s.baseState;a=0,d=c=l=null,o=i;do{var u=o.lane,p=o.eventTime;if((n&u)===u){d!==null&&(d=d.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=e,y=o;switch(u=t,p=r,y.tag){case 1:if(m=y.payload,typeof m=="function"){h=m.call(p,h,u);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,u=typeof m=="function"?m.call(p,h,u):m,u==null)break e;h=Ur({},h,u);break e;case 2:ca=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,u=s.effects,u===null?s.effects=[o]:u.push(o))}else p={eventTime:p,lane:u,tag:o.tag,payload:o.payload,callback:o.callback,next:null},d===null?(c=d=p,l=h):d=d.next=p,a|=u;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;u=o,o=u.next,u.next=null,s.lastBaseUpdate=u,s.shared.pending=null}}while(!0);if(d===null&&(l=h),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,t=s.shared.interleaved,t!==null){s=t;do a|=s.lane,s=s.next;while(s!==t)}else i===null&&(s.shared.lanes=0);bo|=a,e.lanes=a,e.memoizedState=h}}function tE(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(s!==null){if(n.callback=null,n=r,typeof s!="function")throw Error(et(191,s));s.call(n)}}}var Bu={},Mi=Sa(Bu),vu=Sa(Bu),xu=Sa(Bu);function po(e){if(e===Bu)throw Error(et(174));return e}function by(e,t){switch(Tr(xu,t),Tr(vu,e),Tr(Mi,Bu),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:M_(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=M_(t,e)}Cr(Mi),Tr(Mi,t)}function Ol(){Cr(Mi),Cr(vu),Cr(xu)}function B$(e){po(xu.current);var t=po(Mi.current),r=M_(t,e.type);t!==r&&(Tr(vu,e),Tr(Mi,r))}function My(e){vu.current===e&&(Cr(Mi),Cr(vu))}var zr=Sa(0);function cf(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Km=[];function Ty(){for(var e=0;e<Km.length;e++)Km[e]._workInProgressVersionPrimary=null;Km.length=0}var jh=qi.ReactCurrentDispatcher,Hm=qi.ReactCurrentBatchConfig,xo=0,Br=null,mn=null,bn=null,uf=!1,tu=!1,bu=0,BL=0;function Nn(){throw Error(et(321))}function Ey(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!di(e[r],t[r]))return!1;return!0}function Py(e,t,r,n,s,i){if(xo=i,Br=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,jh.current=e===null||e.memoizedState===null?GL:qL,e=r(n,s),tu){i=0;do{if(tu=!1,bu=0,25<=i)throw Error(et(301));i+=1,bn=mn=null,t.updateQueue=null,jh.current=KL,e=r(n,s)}while(tu)}if(jh.current=df,t=mn!==null&&mn.next!==null,xo=0,bn=mn=Br=null,uf=!1,t)throw Error(et(300));return e}function ky(){var e=bu!==0;return bu=0,e}function vi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bn===null?Br.memoizedState=bn=e:bn=bn.next=e,bn}function Bs(){if(mn===null){var e=Br.alternate;e=e!==null?e.memoizedState:null}else e=mn.next;var t=bn===null?Br.memoizedState:bn.next;if(t!==null)bn=t,mn=e;else{if(e===null)throw Error(et(310));mn=e,e={memoizedState:mn.memoizedState,baseState:mn.baseState,baseQueue:mn.baseQueue,queue:mn.queue,next:null},bn===null?Br.memoizedState=bn=e:bn=bn.next=e}return bn}function Mu(e,t){return typeof t=="function"?t(e):t}function Qm(e){var t=Bs(),r=t.queue;if(r===null)throw Error(et(311));r.lastRenderedReducer=e;var n=mn,s=n.baseQueue,i=r.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}n.baseQueue=s=i,r.pending=null}if(s!==null){i=s.next,n=n.baseState;var o=a=null,l=null,c=i;do{var d=c.lane;if((xo&d)===d)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),n=c.hasEagerState?c.eagerState:e(n,c.action);else{var h={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=h,a=n):l=l.next=h,Br.lanes|=d,bo|=d}c=c.next}while(c!==null&&c!==i);l===null?a=n:l.next=o,di(n,t.memoizedState)||(es=!0),t.memoizedState=n,t.baseState=a,t.baseQueue=l,r.lastRenderedState=n}if(e=r.interleaved,e!==null){s=e;do i=s.lane,Br.lanes|=i,bo|=i,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Xm(e){var t=Bs(),r=t.queue;if(r===null)throw Error(et(311));r.lastRenderedReducer=e;var n=r.dispatch,s=r.pending,i=t.memoizedState;if(s!==null){r.pending=null;var a=s=s.next;do i=e(i,a.action),a=a.next;while(a!==s);di(i,t.memoizedState)||(es=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function U$(){}function V$(e,t){var r=Br,n=Bs(),s=t(),i=!di(n.memoizedState,s);if(i&&(n.memoizedState=s,es=!0),n=n.queue,Sy(q$.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||bn!==null&&bn.memoizedState.tag&1){if(r.flags|=2048,Tu(9,G$.bind(null,r,n,s,t),void 0,null),Tn===null)throw Error(et(349));xo&30||W$(r,t,s)}return s}function W$(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Br.updateQueue,t===null?(t={lastEffect:null,stores:null},Br.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function G$(e,t,r,n){t.value=r,t.getSnapshot=n,K$(t)&&H$(e)}function q$(e,t,r){return r(function(){K$(t)&&H$(e)})}function K$(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!di(e,r)}catch{return!0}}function H$(e){var t=Vi(e,1);t!==null&&li(t,e,1,-1)}function rE(e){var t=vi();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Mu,lastRenderedState:e},t.queue=e,e=e.dispatch=WL.bind(null,Br,e),[t.memoizedState,e]}function Tu(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Br.updateQueue,t===null?(t={lastEffect:null,stores:null},Br.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function Q$(){return Bs().memoizedState}function Oh(e,t,r,n){var s=vi();Br.flags|=e,s.memoizedState=Tu(1|t,r,void 0,n===void 0?null:n)}function Rf(e,t,r,n){var s=Bs();n=n===void 0?null:n;var i=void 0;if(mn!==null){var a=mn.memoizedState;if(i=a.destroy,n!==null&&Ey(n,a.deps)){s.memoizedState=Tu(t,r,i,n);return}}Br.flags|=e,s.memoizedState=Tu(1|t,r,i,n)}function nE(e,t){return Oh(8390656,8,e,t)}function Sy(e,t){return Rf(2048,8,e,t)}function X$(e,t){return Rf(4,2,e,t)}function J$(e,t){return Rf(4,4,e,t)}function Y$(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Z$(e,t,r){return r=r!=null?r.concat([e]):null,Rf(4,4,Y$.bind(null,t,e),r)}function Cy(){}function eI(e,t){var r=Bs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Ey(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function tI(e,t){var r=Bs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Ey(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function rI(e,t,r){return xo&21?(di(r,t)||(r=o$(),Br.lanes|=r,bo|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,es=!0),e.memoizedState=r)}function UL(e,t){var r=ur;ur=r!==0&&4>r?r:4,e(!0);var n=Hm.transition;Hm.transition={};try{e(!1),t()}finally{ur=r,Hm.transition=n}}function nI(){return Bs().memoizedState}function VL(e,t,r){var n=xa(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},sI(e))iI(t,r);else if(r=R$(e,t,r,n),r!==null){var s=Kn();li(r,e,n,s),aI(r,t,n)}}function WL(e,t,r){var n=xa(e),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(sI(e))iI(t,s);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,o=i(a,r);if(s.hasEagerState=!0,s.eagerState=o,di(o,a)){var l=t.interleaved;l===null?(s.next=s,vy(t)):(s.next=l.next,l.next=s),t.interleaved=s;return}}catch{}finally{}r=R$(e,t,s,n),r!==null&&(s=Kn(),li(r,e,n,s),aI(r,t,n))}}function sI(e){var t=e.alternate;return e===Br||t!==null&&t===Br}function iI(e,t){tu=uf=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function aI(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,ay(e,r)}}var df={readContext:zs,useCallback:Nn,useContext:Nn,useEffect:Nn,useImperativeHandle:Nn,useInsertionEffect:Nn,useLayoutEffect:Nn,useMemo:Nn,useReducer:Nn,useRef:Nn,useState:Nn,useDebugValue:Nn,useDeferredValue:Nn,useTransition:Nn,useMutableSource:Nn,useSyncExternalStore:Nn,useId:Nn,unstable_isNewReconciler:!1},GL={readContext:zs,useCallback:function(e,t){return vi().memoizedState=[e,t===void 0?null:t],e},useContext:zs,useEffect:nE,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Oh(4194308,4,Y$.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Oh(4194308,4,e,t)},useInsertionEffect:function(e,t){return Oh(4,2,e,t)},useMemo:function(e,t){var r=vi();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=vi();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=VL.bind(null,Br,e),[n.memoizedState,e]},useRef:function(e){var t=vi();return e={current:e},t.memoizedState=e},useState:rE,useDebugValue:Cy,useDeferredValue:function(e){return vi().memoizedState=e},useTransition:function(){var e=rE(!1),t=e[0];return e=UL.bind(null,e[1]),vi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Br,s=vi();if(jr){if(r===void 0)throw Error(et(407));r=r()}else{if(r=t(),Tn===null)throw Error(et(349));xo&30||W$(n,t,r)}s.memoizedState=r;var i={value:r,getSnapshot:t};return s.queue=i,nE(q$.bind(null,n,i,e),[e]),n.flags|=2048,Tu(9,G$.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=vi(),t=Tn.identifierPrefix;if(jr){var r=Ri,n=Li;r=(n&~(1<<32-oi(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=bu++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=BL++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},qL={readContext:zs,useCallback:eI,useContext:zs,useEffect:Sy,useImperativeHandle:Z$,useInsertionEffect:X$,useLayoutEffect:J$,useMemo:tI,useReducer:Qm,useRef:Q$,useState:function(){return Qm(Mu)},useDebugValue:Cy,useDeferredValue:function(e){var t=Bs();return rI(t,mn.memoizedState,e)},useTransition:function(){var e=Qm(Mu)[0],t=Bs().memoizedState;return[e,t]},useMutableSource:U$,useSyncExternalStore:V$,useId:nI,unstable_isNewReconciler:!1},KL={readContext:zs,useCallback:eI,useContext:zs,useEffect:Sy,useImperativeHandle:Z$,useInsertionEffect:X$,useLayoutEffect:J$,useMemo:tI,useReducer:Xm,useRef:Q$,useState:function(){return Xm(Mu)},useDebugValue:Cy,useDeferredValue:function(e){var t=Bs();return mn===null?t.memoizedState=e:rI(t,mn.memoizedState,e)},useTransition:function(){var e=Xm(Mu)[0],t=Bs().memoizedState;return[e,t]},useMutableSource:U$,useSyncExternalStore:V$,useId:nI,unstable_isNewReconciler:!1};function ei(e,t){if(e&&e.defaultProps){t=Ur({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function W_(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:Ur({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var zf={isMounted:function(e){return(e=e._reactInternals)?$o(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Kn(),s=xa(e),i=zi(n,s);i.payload=t,r!=null&&(i.callback=r),t=wa(e,i,s),t!==null&&(li(t,e,s,n),Ah(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Kn(),s=xa(e),i=zi(n,s);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=wa(e,i,s),t!==null&&(li(t,e,s,n),Ah(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Kn(),n=xa(e),s=zi(r,n);s.tag=2,t!=null&&(s.callback=t),t=wa(e,s,n),t!==null&&(li(t,e,n,r),Ah(t,e,n))}};function sE(e,t,r,n,s,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,a):t.prototype&&t.prototype.isPureReactComponent?!gu(r,n)||!gu(s,i):!0}function oI(e,t,r){var n=!1,s=Ta,i=t.contextType;return typeof i=="object"&&i!==null?i=zs(i):(s=rs(t)?wo:Rn.current,n=t.contextTypes,i=(n=n!=null)?Il(e,s):Ta),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=zf,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=i),t}function iE(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&zf.enqueueReplaceState(t,t.state,null)}function G_(e,t,r,n){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs={},xy(e);var i=t.contextType;typeof i=="object"&&i!==null?s.context=zs(i):(i=rs(t)?wo:Rn.current,s.context=Il(e,i)),s.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(W_(e,t,i,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&zf.enqueueReplaceState(s,s.state,null),lf(e,r,s,n),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function Nl(e,t){try{var r="",n=t;do r+=xF(n),n=n.return;while(n);var s=r}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:s,digest:null}}function Jm(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function q_(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var HL=typeof WeakMap=="function"?WeakMap:Map;function lI(e,t,r){r=zi(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){ff||(ff=!0,r0=n),q_(e,t)},r}function cI(e,t,r){r=zi(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var s=t.value;r.payload=function(){return n(s)},r.callback=function(){q_(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){q_(e,t),typeof n!="function"&&(va===null?va=new Set([this]):va.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),r}function aE(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new HL;var s=new Set;n.set(t,s)}else s=n.get(t),s===void 0&&(s=new Set,n.set(t,s));s.has(r)||(s.add(r),e=lR.bind(null,e,t,r),t.then(e,e))}function oE(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function lE(e,t,r,n,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=zi(-1,1),t.tag=2,wa(r,t,1))),r.lanes|=1),e)}var QL=qi.ReactCurrentOwner,es=!1;function Gn(e,t,r,n){t.child=e===null?L$(t,null,r,n):jl(t,e.child,r,n)}function cE(e,t,r,n,s){r=r.render;var i=t.ref;return Pl(t,s),n=Py(e,t,r,n,i,s),r=ky(),e!==null&&!es?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Wi(e,t,s)):(jr&&r&&py(t),t.flags|=1,Gn(e,t,n,s),t.child)}function uE(e,t,r,n,s){if(e===null){var i=r.type;return typeof i=="function"&&!Fy(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,uI(e,t,i,n,s)):(e=Lh(r.type,null,n,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&s)){var a=i.memoizedProps;if(r=r.compare,r=r!==null?r:gu,r(a,n)&&e.ref===t.ref)return Wi(e,t,s)}return t.flags|=1,e=ba(i,n),e.ref=t.ref,e.return=t,t.child=e}function uI(e,t,r,n,s){if(e!==null){var i=e.memoizedProps;if(gu(i,n)&&e.ref===t.ref)if(es=!1,t.pendingProps=n=i,(e.lanes&s)!==0)e.flags&131072&&(es=!0);else return t.lanes=e.lanes,Wi(e,t,s)}return K_(e,t,r,n,s)}function dI(e,t,r){var n=t.pendingProps,s=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tr(wl,hs),hs|=r;else{if(!(r&1073741824))return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Tr(wl,hs),hs|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,Tr(wl,hs),hs|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,Tr(wl,hs),hs|=n;return Gn(e,t,s,r),t.child}function hI(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function K_(e,t,r,n,s){var i=rs(r)?wo:Rn.current;return i=Il(t,i),Pl(t,s),r=Py(e,t,r,n,i,s),n=ky(),e!==null&&!es?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Wi(e,t,s)):(jr&&n&&py(t),t.flags|=1,Gn(e,t,r,s),t.child)}function dE(e,t,r,n,s){if(rs(r)){var i=!0;rf(t)}else i=!1;if(Pl(t,s),t.stateNode===null)Nh(e,t),oI(t,r,n),G_(t,r,n,s),n=!0;else if(e===null){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=r.contextType;typeof c=="object"&&c!==null?c=zs(c):(c=rs(r)?wo:Rn.current,c=Il(t,c));var d=r.getDerivedStateFromProps,h=typeof d=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==n||l!==c)&&iE(t,a,n,c),ca=!1;var u=t.memoizedState;a.state=u,lf(t,n,a,s),l=t.memoizedState,o!==n||u!==l||ts.current||ca?(typeof d=="function"&&(W_(t,r,d,n),l=t.memoizedState),(o=ca||sE(t,r,o,n,u,l,c))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=c,n=o):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,z$(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:ei(t.type,o),a.props=c,h=t.pendingProps,u=a.context,l=r.contextType,typeof l=="object"&&l!==null?l=zs(l):(l=rs(r)?wo:Rn.current,l=Il(t,l));var p=r.getDerivedStateFromProps;(d=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||u!==l)&&iE(t,a,n,l),ca=!1,u=t.memoizedState,a.state=u,lf(t,n,a,s);var m=t.memoizedState;o!==h||u!==m||ts.current||ca?(typeof p=="function"&&(W_(t,r,p,n),m=t.memoizedState),(c=ca||sE(t,r,c,n,u,m,l)||!1)?(d||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,m,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,m,l)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=m),a.props=n,a.state=m,a.context=l,n=c):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),n=!1)}return H_(e,t,r,n,i,s)}function H_(e,t,r,n,s,i){hI(e,t);var a=(t.flags&128)!==0;if(!n&&!a)return s&&XT(t,r,!1),Wi(e,t,i);n=t.stateNode,QL.current=t;var o=a&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&a?(t.child=jl(t,e.child,null,i),t.child=jl(t,null,o,i)):Gn(e,t,o,i),t.memoizedState=n.state,s&&XT(t,r,!0),t.child}function fI(e){var t=e.stateNode;t.pendingContext?QT(e,t.pendingContext,t.pendingContext!==t.context):t.context&&QT(e,t.context,!1),by(e,t.containerInfo)}function hE(e,t,r,n,s){return Al(),gy(s),t.flags|=256,Gn(e,t,r,n),t.child}var Q_={dehydrated:null,treeContext:null,retryLane:0};function X_(e){return{baseLanes:e,cachePool:null,transitions:null}}function pI(e,t,r){var n=t.pendingProps,s=zr.current,i=!1,a=(t.flags&128)!==0,o;if((o=a)||(o=e!==null&&e.memoizedState===null?!1:(s&2)!==0),o?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),Tr(zr,s&1),e===null)return U_(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=n.children,e=n.fallback,i?(n=t.mode,i=t.child,a={mode:"hidden",children:a},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Vf(a,n,0,null),e=yo(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=X_(r),t.memoizedState=Q_,e):$y(t,a));if(s=e.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return XL(e,t,a,n,o,s,r);if(i){i=n.fallback,a=t.mode,s=e.child,o=s.sibling;var l={mode:"hidden",children:n.children};return!(a&1)&&t.child!==s?(n=t.child,n.childLanes=0,n.pendingProps=l,t.deletions=null):(n=ba(s,l),n.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=ba(o,i):(i=yo(i,a,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,a=e.child.memoizedState,a=a===null?X_(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~r,t.memoizedState=Q_,n}return i=e.child,e=i.sibling,n=ba(i,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function $y(e,t){return t=Vf({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Zd(e,t,r,n){return n!==null&&gy(n),jl(t,e.child,null,r),e=$y(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function XL(e,t,r,n,s,i,a){if(r)return t.flags&256?(t.flags&=-257,n=Jm(Error(et(422))),Zd(e,t,a,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,s=t.mode,n=Vf({mode:"visible",children:n.children},s,0,null),i=yo(i,s,a,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,t.mode&1&&jl(t,e.child,null,a),t.child.memoizedState=X_(a),t.memoizedState=Q_,i);if(!(t.mode&1))return Zd(e,t,a,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var o=n.dgst;return n=o,i=Error(et(419)),n=Jm(i,n,void 0),Zd(e,t,a,n)}if(o=(a&e.childLanes)!==0,es||o){if(n=Tn,n!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Vi(e,s),li(n,e,s,-1))}return Dy(),n=Jm(Error(et(421))),Zd(e,t,a,n)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=cR.bind(null,e),s._reactRetry=t,null):(e=i.treeContext,gs=ya(s.nextSibling),_s=t,jr=!0,si=null,e!==null&&(js[Os++]=Li,js[Os++]=Ri,js[Os++]=vo,Li=e.id,Ri=e.overflow,vo=t),t=$y(t,n.children),t.flags|=4096,t)}function fE(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),V_(e.return,t,r)}function Ym(e,t,r,n,s){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=s)}function mI(e,t,r){var n=t.pendingProps,s=n.revealOrder,i=n.tail;if(Gn(e,t,n.children,r),n=zr.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&fE(e,r,t);else if(e.tag===19)fE(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Tr(zr,n),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&cf(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),Ym(t,!1,s,r,i);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&cf(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}Ym(t,!0,r,null,i);break;case"together":Ym(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Nh(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wi(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),bo|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(et(153));if(t.child!==null){for(e=t.child,r=ba(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=ba(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function JL(e,t,r){switch(t.tag){case 3:fI(t),Al();break;case 5:B$(t);break;case 1:rs(t.type)&&rf(t);break;case 4:by(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;Tr(af,n._currentValue),n._currentValue=s;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Tr(zr,zr.current&1),t.flags|=128,null):r&t.child.childLanes?pI(e,t,r):(Tr(zr,zr.current&1),e=Wi(e,t,r),e!==null?e.sibling:null);Tr(zr,zr.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return mI(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Tr(zr,zr.current),n)break;return null;case 22:case 23:return t.lanes=0,dI(e,t,r)}return Wi(e,t,r)}var gI,J_,_I,yI;gI=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};J_=function(){};_I=function(e,t,r,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,po(Mi.current);var i=null;switch(r){case"input":s=w_(e,s),n=w_(e,n),i=[];break;case"select":s=Ur({},s,{value:void 0}),n=Ur({},n,{value:void 0}),i=[];break;case"textarea":s=b_(e,s),n=b_(e,n),i=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=ef)}T_(r,n);var a;r=null;for(c in s)if(!n.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var o=s[c];for(a in o)o.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(cu.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in n){var l=n[c];if(o=s!=null?s[c]:void 0,n.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(r||(r={}),r[a]=l[a])}else r||(i||(i=[]),i.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(cu.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Sr("scroll",e),i||o===l||(i=[])):(i=i||[]).push(c,l))}r&&(i=i||[]).push("style",r);var c=i;(t.updateQueue=c)&&(t.flags|=4)}};yI=function(e,t,r,n){r!==n&&(t.flags|=4)};function kc(e,t){if(!jr)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Dn(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function YL(e,t,r){var n=t.pendingProps;switch(my(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dn(t),null;case 1:return rs(t.type)&&tf(),Dn(t),null;case 3:return n=t.stateNode,Ol(),Cr(ts),Cr(Rn),Ty(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(Jd(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,si!==null&&(i0(si),si=null))),J_(e,t),Dn(t),null;case 5:My(t);var s=po(xu.current);if(r=t.type,e!==null&&t.stateNode!=null)_I(e,t,r,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(et(166));return Dn(t),null}if(e=po(Mi.current),Jd(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[xi]=t,n[wu]=i,e=(t.mode&1)!==0,r){case"dialog":Sr("cancel",n),Sr("close",n);break;case"iframe":case"object":case"embed":Sr("load",n);break;case"video":case"audio":for(s=0;s<Wc.length;s++)Sr(Wc[s],n);break;case"source":Sr("error",n);break;case"img":case"image":case"link":Sr("error",n),Sr("load",n);break;case"details":Sr("toggle",n);break;case"input":bT(n,i),Sr("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Sr("invalid",n);break;case"textarea":TT(n,i),Sr("invalid",n)}T_(r,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?n.textContent!==o&&(i.suppressHydrationWarning!==!0&&Xd(n.textContent,o,e),s=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&Xd(n.textContent,o,e),s=["children",""+o]):cu.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Sr("scroll",n)}switch(r){case"input":Ud(n),MT(n,i,!0);break;case"textarea":Ud(n),ET(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=ef)}n=s,t.updateQueue=n,n!==null&&(t.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=qC(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=a.createElement(r,{is:n.is}):(e=a.createElement(r),r==="select"&&(a=e,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):e=a.createElementNS(e,r),e[xi]=t,e[wu]=n,gI(e,t,!1,!1),t.stateNode=e;e:{switch(a=E_(r,n),r){case"dialog":Sr("cancel",e),Sr("close",e),s=n;break;case"iframe":case"object":case"embed":Sr("load",e),s=n;break;case"video":case"audio":for(s=0;s<Wc.length;s++)Sr(Wc[s],e);s=n;break;case"source":Sr("error",e),s=n;break;case"img":case"image":case"link":Sr("error",e),Sr("load",e),s=n;break;case"details":Sr("toggle",e),s=n;break;case"input":bT(e,n),s=w_(e,n),Sr("invalid",e);break;case"option":s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=Ur({},n,{value:void 0}),Sr("invalid",e);break;case"textarea":TT(e,n),s=b_(e,n),Sr("invalid",e);break;default:s=n}T_(r,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?QC(e,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&KC(e,l)):i==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&uu(e,l):typeof l=="number"&&uu(e,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(cu.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Sr("scroll",e):l!=null&&ey(e,i,l,a))}switch(r){case"input":Ud(e),MT(e,n,!1);break;case"textarea":Ud(e),ET(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Ma(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?bl(e,!!n.multiple,i,!1):n.defaultValue!=null&&bl(e,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=ef)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Dn(t),null;case 6:if(e&&t.stateNode!=null)yI(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(et(166));if(r=po(xu.current),po(Mi.current),Jd(t)){if(n=t.stateNode,r=t.memoizedProps,n[xi]=t,(i=n.nodeValue!==r)&&(e=_s,e!==null))switch(e.tag){case 3:Xd(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Xd(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[xi]=t,t.stateNode=n}return Dn(t),null;case 13:if(Cr(zr),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(jr&&gs!==null&&t.mode&1&&!(t.flags&128))D$(),Al(),t.flags|=98560,i=!1;else if(i=Jd(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(et(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(et(317));i[xi]=t}else Al(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Dn(t),i=!1}else si!==null&&(i0(si),si=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||zr.current&1?gn===0&&(gn=3):Dy())),t.updateQueue!==null&&(t.flags|=4),Dn(t),null);case 4:return Ol(),J_(e,t),e===null&&_u(t.stateNode.containerInfo),Dn(t),null;case 10:return wy(t.type._context),Dn(t),null;case 17:return rs(t.type)&&tf(),Dn(t),null;case 19:if(Cr(zr),i=t.memoizedState,i===null)return Dn(t),null;if(n=(t.flags&128)!==0,a=i.rendering,a===null)if(n)kc(i,!1);else{if(gn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=cf(e),a!==null){for(t.flags|=128,kc(i,!1),n=a.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Tr(zr,zr.current&1|2),t.child}e=e.sibling}i.tail!==null&&Yr()>Dl&&(t.flags|=128,n=!0,kc(i,!1),t.lanes=4194304)}else{if(!n)if(e=cf(a),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),kc(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!jr)return Dn(t),null}else 2*Yr()-i.renderingStartTime>Dl&&r!==1073741824&&(t.flags|=128,n=!0,kc(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(r=i.last,r!==null?r.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Yr(),t.sibling=null,r=zr.current,Tr(zr,n?r&1|2:r&1),t):(Dn(t),null);case 22:case 23:return Ny(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?hs&1073741824&&(Dn(t),t.subtreeFlags&6&&(t.flags|=8192)):Dn(t),null;case 24:return null;case 25:return null}throw Error(et(156,t.tag))}function ZL(e,t){switch(my(t),t.tag){case 1:return rs(t.type)&&tf(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ol(),Cr(ts),Cr(Rn),Ty(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return My(t),null;case 13:if(Cr(zr),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(et(340));Al()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Cr(zr),null;case 4:return Ol(),null;case 10:return wy(t.type._context),null;case 22:case 23:return Ny(),null;case 24:return null;default:return null}}var eh=!1,Ln=!1,eR=typeof WeakSet=="function"?WeakSet:Set,ft=null;function yl(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){qr(e,t,n)}else r.current=null}function Y_(e,t,r){try{r()}catch(n){qr(e,t,n)}}var pE=!1;function tR(e,t){if(N_=Jh,e=M$(),fy(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var s=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var a=0,o=-1,l=-1,c=0,d=0,h=e,u=null;t:for(;;){for(var p;h!==r||s!==0&&h.nodeType!==3||(o=a+s),h!==i||n!==0&&h.nodeType!==3||(l=a+n),h.nodeType===3&&(a+=h.nodeValue.length),(p=h.firstChild)!==null;)u=h,h=p;for(;;){if(h===e)break t;if(u===r&&++c===s&&(o=a),u===i&&++d===n&&(l=a),(p=h.nextSibling)!==null)break;h=u,u=h.parentNode}h=p}r=o===-1||l===-1?null:{start:o,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(D_={focusedElem:e,selectionRange:r},Jh=!1,ft=t;ft!==null;)if(t=ft,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ft=e;else for(;ft!==null;){t=ft;try{var m=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,P=m.memoizedState,g=t.stateNode,_=g.getSnapshotBeforeUpdate(t.elementType===t.type?y:ei(t.type,y),P);g.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(et(163))}}catch(w){qr(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,ft=e;break}ft=t.return}return m=pE,pE=!1,m}function ru(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&e)===e){var i=s.destroy;s.destroy=void 0,i!==void 0&&Y_(t,r,i)}s=s.next}while(s!==n)}}function Bf(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function Z_(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function wI(e){var t=e.alternate;t!==null&&(e.alternate=null,wI(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[xi],delete t[wu],delete t[R_],delete t[FL],delete t[LL])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function vI(e){return e.tag===5||e.tag===3||e.tag===4}function mE(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||vI(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function e0(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=ef));else if(n!==4&&(e=e.child,e!==null))for(e0(e,t,r),e=e.sibling;e!==null;)e0(e,t,r),e=e.sibling}function t0(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(t0(e,t,r),e=e.sibling;e!==null;)t0(e,t,r),e=e.sibling}var Sn=null,ri=!1;function na(e,t,r){for(r=r.child;r!==null;)xI(e,t,r),r=r.sibling}function xI(e,t,r){if(bi&&typeof bi.onCommitFiberUnmount=="function")try{bi.onCommitFiberUnmount(jf,r)}catch{}switch(r.tag){case 5:Ln||yl(r,t);case 6:var n=Sn,s=ri;Sn=null,na(e,t,r),Sn=n,ri=s,Sn!==null&&(ri?(e=Sn,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Sn.removeChild(r.stateNode));break;case 18:Sn!==null&&(ri?(e=Sn,r=r.stateNode,e.nodeType===8?Gm(e.parentNode,r):e.nodeType===1&&Gm(e,r),pu(e)):Gm(Sn,r.stateNode));break;case 4:n=Sn,s=ri,Sn=r.stateNode.containerInfo,ri=!0,na(e,t,r),Sn=n,ri=s;break;case 0:case 11:case 14:case 15:if(!Ln&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Y_(r,t,a),s=s.next}while(s!==n)}na(e,t,r);break;case 1:if(!Ln&&(yl(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(o){qr(r,t,o)}na(e,t,r);break;case 21:na(e,t,r);break;case 22:r.mode&1?(Ln=(n=Ln)||r.memoizedState!==null,na(e,t,r),Ln=n):na(e,t,r);break;default:na(e,t,r)}}function gE(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new eR),t.forEach(function(n){var s=uR.bind(null,e,n);r.has(n)||(r.add(n),n.then(s,s))})}}function Ks(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var s=r[n];try{var i=e,a=t,o=a;e:for(;o!==null;){switch(o.tag){case 5:Sn=o.stateNode,ri=!1;break e;case 3:Sn=o.stateNode.containerInfo,ri=!0;break e;case 4:Sn=o.stateNode.containerInfo,ri=!0;break e}o=o.return}if(Sn===null)throw Error(et(160));xI(i,a,s),Sn=null,ri=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){qr(s,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)bI(t,e),t=t.sibling}function bI(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ks(t,e),yi(e),n&4){try{ru(3,e,e.return),Bf(3,e)}catch(y){qr(e,e.return,y)}try{ru(5,e,e.return)}catch(y){qr(e,e.return,y)}}break;case 1:Ks(t,e),yi(e),n&512&&r!==null&&yl(r,r.return);break;case 5:if(Ks(t,e),yi(e),n&512&&r!==null&&yl(r,r.return),e.flags&32){var s=e.stateNode;try{uu(s,"")}catch(y){qr(e,e.return,y)}}if(n&4&&(s=e.stateNode,s!=null)){var i=e.memoizedProps,a=r!==null?r.memoizedProps:i,o=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&WC(s,i),E_(o,a);var c=E_(o,i);for(a=0;a<l.length;a+=2){var d=l[a],h=l[a+1];d==="style"?QC(s,h):d==="dangerouslySetInnerHTML"?KC(s,h):d==="children"?uu(s,h):ey(s,d,h,c)}switch(o){case"input":v_(s,i);break;case"textarea":GC(s,i);break;case"select":var u=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?bl(s,!!i.multiple,p,!1):u!==!!i.multiple&&(i.defaultValue!=null?bl(s,!!i.multiple,i.defaultValue,!0):bl(s,!!i.multiple,i.multiple?[]:"",!1))}s[wu]=i}catch(y){qr(e,e.return,y)}}break;case 6:if(Ks(t,e),yi(e),n&4){if(e.stateNode===null)throw Error(et(162));s=e.stateNode,i=e.memoizedProps;try{s.nodeValue=i}catch(y){qr(e,e.return,y)}}break;case 3:if(Ks(t,e),yi(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{pu(t.containerInfo)}catch(y){qr(e,e.return,y)}break;case 4:Ks(t,e),yi(e);break;case 13:Ks(t,e),yi(e),s=e.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(jy=Yr())),n&4&&gE(e);break;case 22:if(d=r!==null&&r.memoizedState!==null,e.mode&1?(Ln=(c=Ln)||d,Ks(t,e),Ln=c):Ks(t,e),yi(e),n&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!d&&e.mode&1)for(ft=e,d=e.child;d!==null;){for(h=ft=d;ft!==null;){switch(u=ft,p=u.child,u.tag){case 0:case 11:case 14:case 15:ru(4,u,u.return);break;case 1:yl(u,u.return);var m=u.stateNode;if(typeof m.componentWillUnmount=="function"){n=u,r=u.return;try{t=n,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(y){qr(n,r,y)}}break;case 5:yl(u,u.return);break;case 22:if(u.memoizedState!==null){yE(h);continue}}p!==null?(p.return=u,ft=p):yE(h)}d=d.sibling}e:for(d=null,h=e;;){if(h.tag===5){if(d===null){d=h;try{s=h.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=HC("display",a))}catch(y){qr(e,e.return,y)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(y){qr(e,e.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ks(t,e),yi(e),n&4&&gE(e);break;case 21:break;default:Ks(t,e),yi(e)}}function yi(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(vI(r)){var n=r;break e}r=r.return}throw Error(et(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(uu(s,""),n.flags&=-33);var i=mE(e);t0(e,i,s);break;case 3:case 4:var a=n.stateNode.containerInfo,o=mE(e);e0(e,o,a);break;default:throw Error(et(161))}}catch(l){qr(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function rR(e,t,r){ft=e,MI(e)}function MI(e,t,r){for(var n=(e.mode&1)!==0;ft!==null;){var s=ft,i=s.child;if(s.tag===22&&n){var a=s.memoizedState!==null||eh;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||Ln;o=eh;var c=Ln;if(eh=a,(Ln=l)&&!c)for(ft=s;ft!==null;)a=ft,l=a.child,a.tag===22&&a.memoizedState!==null?wE(s):l!==null?(l.return=a,ft=l):wE(s);for(;i!==null;)ft=i,MI(i),i=i.sibling;ft=s,eh=o,Ln=c}_E(e)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ft=i):_E(e)}}function _E(e){for(;ft!==null;){var t=ft;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ln||Bf(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Ln)if(r===null)n.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:ei(t.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&tE(t,i,n);break;case 3:var a=t.updateQueue;if(a!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}tE(t,a,r)}break;case 5:var o=t.stateNode;if(r===null&&t.flags&4){r=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var d=c.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&pu(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(et(163))}Ln||t.flags&512&&Z_(t)}catch(u){qr(t,t.return,u)}}if(t===e){ft=null;break}if(r=t.sibling,r!==null){r.return=t.return,ft=r;break}ft=t.return}}function yE(e){for(;ft!==null;){var t=ft;if(t===e){ft=null;break}var r=t.sibling;if(r!==null){r.return=t.return,ft=r;break}ft=t.return}}function wE(e){for(;ft!==null;){var t=ft;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Bf(4,t)}catch(l){qr(t,r,l)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var s=t.return;try{n.componentDidMount()}catch(l){qr(t,s,l)}}var i=t.return;try{Z_(t)}catch(l){qr(t,i,l)}break;case 5:var a=t.return;try{Z_(t)}catch(l){qr(t,a,l)}}}catch(l){qr(t,t.return,l)}if(t===e){ft=null;break}var o=t.sibling;if(o!==null){o.return=t.return,ft=o;break}ft=t.return}}var nR=Math.ceil,hf=qi.ReactCurrentDispatcher,Iy=qi.ReactCurrentOwner,Fs=qi.ReactCurrentBatchConfig,rr=0,Tn=null,cn=null,Cn=0,hs=0,wl=Sa(0),gn=0,Eu=null,bo=0,Uf=0,Ay=0,nu=null,Zn=null,jy=0,Dl=1/0,Oi=null,ff=!1,r0=null,va=null,th=!1,pa=null,pf=0,su=0,n0=null,Dh=-1,Fh=0;function Kn(){return rr&6?Yr():Dh!==-1?Dh:Dh=Yr()}function xa(e){return e.mode&1?rr&2&&Cn!==0?Cn&-Cn:zL.transition!==null?(Fh===0&&(Fh=o$()),Fh):(e=ur,e!==0||(e=window.event,e=e===void 0?16:p$(e.type)),e):1}function li(e,t,r,n){if(50<su)throw su=0,n0=null,Error(et(185));Lu(e,r,n),(!(rr&2)||e!==Tn)&&(e===Tn&&(!(rr&2)&&(Uf|=r),gn===4&&da(e,Cn)),ns(e,n),r===1&&rr===0&&!(t.mode&1)&&(Dl=Yr()+500,Lf&&Ca()))}function ns(e,t){var r=e.callbackNode;zF(e,t);var n=Xh(e,e===Tn?Cn:0);if(n===0)r!==null&&ST(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&ST(r),t===1)e.tag===0?RL(vE.bind(null,e)):j$(vE.bind(null,e)),NL(function(){!(rr&6)&&Ca()}),r=null;else{switch(l$(n)){case 1:r=iy;break;case 4:r=i$;break;case 16:r=Qh;break;case 536870912:r=a$;break;default:r=Qh}r=II(r,TI.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function TI(e,t){if(Dh=-1,Fh=0,rr&6)throw Error(et(327));var r=e.callbackNode;if(kl()&&e.callbackNode!==r)return null;var n=Xh(e,e===Tn?Cn:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=mf(e,n);else{t=n;var s=rr;rr|=2;var i=PI();(Tn!==e||Cn!==t)&&(Oi=null,Dl=Yr()+500,_o(e,t));do try{aR();break}catch(o){EI(e,o)}while(!0);yy(),hf.current=i,rr=s,cn!==null?t=0:(Tn=null,Cn=0,t=gn)}if(t!==0){if(t===2&&(s=$_(e),s!==0&&(n=s,t=s0(e,s))),t===1)throw r=Eu,_o(e,0),da(e,n),ns(e,Yr()),r;if(t===6)da(e,n);else{if(s=e.current.alternate,!(n&30)&&!sR(s)&&(t=mf(e,n),t===2&&(i=$_(e),i!==0&&(n=i,t=s0(e,i))),t===1))throw r=Eu,_o(e,0),da(e,n),ns(e,Yr()),r;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(et(345));case 2:ro(e,Zn,Oi);break;case 3:if(da(e,n),(n&130023424)===n&&(t=jy+500-Yr(),10<t)){if(Xh(e,0)!==0)break;if(s=e.suspendedLanes,(s&n)!==n){Kn(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=L_(ro.bind(null,e,Zn,Oi),t);break}ro(e,Zn,Oi);break;case 4:if(da(e,n),(n&4194240)===n)break;for(t=e.eventTimes,s=-1;0<n;){var a=31-oi(n);i=1<<a,a=t[a],a>s&&(s=a),n&=~i}if(n=s,n=Yr()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*nR(n/1960))-n,10<n){e.timeoutHandle=L_(ro.bind(null,e,Zn,Oi),n);break}ro(e,Zn,Oi);break;case 5:ro(e,Zn,Oi);break;default:throw Error(et(329))}}}return ns(e,Yr()),e.callbackNode===r?TI.bind(null,e):null}function s0(e,t){var r=nu;return e.current.memoizedState.isDehydrated&&(_o(e,t).flags|=256),e=mf(e,t),e!==2&&(t=Zn,Zn=r,t!==null&&i0(t)),e}function i0(e){Zn===null?Zn=e:Zn.push.apply(Zn,e)}function sR(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var s=r[n],i=s.getSnapshot;s=s.value;try{if(!di(i(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function da(e,t){for(t&=~Ay,t&=~Uf,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-oi(t),n=1<<r;e[r]=-1,t&=~n}}function vE(e){if(rr&6)throw Error(et(327));kl();var t=Xh(e,0);if(!(t&1))return ns(e,Yr()),null;var r=mf(e,t);if(e.tag!==0&&r===2){var n=$_(e);n!==0&&(t=n,r=s0(e,n))}if(r===1)throw r=Eu,_o(e,0),da(e,t),ns(e,Yr()),r;if(r===6)throw Error(et(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ro(e,Zn,Oi),ns(e,Yr()),null}function Oy(e,t){var r=rr;rr|=1;try{return e(t)}finally{rr=r,rr===0&&(Dl=Yr()+500,Lf&&Ca())}}function Mo(e){pa!==null&&pa.tag===0&&!(rr&6)&&kl();var t=rr;rr|=1;var r=Fs.transition,n=ur;try{if(Fs.transition=null,ur=1,e)return e()}finally{ur=n,Fs.transition=r,rr=t,!(rr&6)&&Ca()}}function Ny(){hs=wl.current,Cr(wl)}function _o(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,OL(r)),cn!==null)for(r=cn.return;r!==null;){var n=r;switch(my(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&tf();break;case 3:Ol(),Cr(ts),Cr(Rn),Ty();break;case 5:My(n);break;case 4:Ol();break;case 13:Cr(zr);break;case 19:Cr(zr);break;case 10:wy(n.type._context);break;case 22:case 23:Ny()}r=r.return}if(Tn=e,cn=e=ba(e.current,null),Cn=hs=t,gn=0,Eu=null,Ay=Uf=bo=0,Zn=nu=null,fo!==null){for(t=0;t<fo.length;t++)if(r=fo[t],n=r.interleaved,n!==null){r.interleaved=null;var s=n.next,i=r.pending;if(i!==null){var a=i.next;i.next=s,n.next=a}r.pending=n}fo=null}return e}function EI(e,t){do{var r=cn;try{if(yy(),jh.current=df,uf){for(var n=Br.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}uf=!1}if(xo=0,bn=mn=Br=null,tu=!1,bu=0,Iy.current=null,r===null||r.return===null){gn=1,Eu=t,cn=null;break}e:{var i=e,a=r.return,o=r,l=t;if(t=Cn,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,d=o,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var u=d.alternate;u?(d.updateQueue=u.updateQueue,d.memoizedState=u.memoizedState,d.lanes=u.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=oE(a);if(p!==null){p.flags&=-257,lE(p,a,o,i,t),p.mode&1&&aE(i,c,t),t=p,l=c;var m=t.updateQueue;if(m===null){var y=new Set;y.add(l),t.updateQueue=y}else m.add(l);break e}else{if(!(t&1)){aE(i,c,t),Dy();break e}l=Error(et(426))}}else if(jr&&o.mode&1){var P=oE(a);if(P!==null){!(P.flags&65536)&&(P.flags|=256),lE(P,a,o,i,t),gy(Nl(l,o));break e}}i=l=Nl(l,o),gn!==4&&(gn=2),nu===null?nu=[i]:nu.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var g=lI(i,l,t);eE(i,g);break e;case 1:o=l;var _=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof _.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(va===null||!va.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t;var w=cI(i,o,t);eE(i,w);break e}}i=i.return}while(i!==null)}SI(r)}catch(M){t=M,cn===r&&r!==null&&(cn=r=r.return);continue}break}while(!0)}function PI(){var e=hf.current;return hf.current=df,e===null?df:e}function Dy(){(gn===0||gn===3||gn===2)&&(gn=4),Tn===null||!(bo&268435455)&&!(Uf&268435455)||da(Tn,Cn)}function mf(e,t){var r=rr;rr|=2;var n=PI();(Tn!==e||Cn!==t)&&(Oi=null,_o(e,t));do try{iR();break}catch(s){EI(e,s)}while(!0);if(yy(),rr=r,hf.current=n,cn!==null)throw Error(et(261));return Tn=null,Cn=0,gn}function iR(){for(;cn!==null;)kI(cn)}function aR(){for(;cn!==null&&!IF();)kI(cn)}function kI(e){var t=$I(e.alternate,e,hs);e.memoizedProps=e.pendingProps,t===null?SI(e):cn=t,Iy.current=null}function SI(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=ZL(r,t),r!==null){r.flags&=32767,cn=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{gn=6,cn=null;return}}else if(r=YL(r,t,hs),r!==null){cn=r;return}if(t=t.sibling,t!==null){cn=t;return}cn=t=e}while(t!==null);gn===0&&(gn=5)}function ro(e,t,r){var n=ur,s=Fs.transition;try{Fs.transition=null,ur=1,oR(e,t,r,n)}finally{Fs.transition=s,ur=n}return null}function oR(e,t,r,n){do kl();while(pa!==null);if(rr&6)throw Error(et(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(et(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(BF(e,i),e===Tn&&(cn=Tn=null,Cn=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||th||(th=!0,II(Qh,function(){return kl(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=Fs.transition,Fs.transition=null;var a=ur;ur=1;var o=rr;rr|=4,Iy.current=null,tR(e,r),bI(r,e),kL(D_),Jh=!!N_,D_=N_=null,e.current=r,rR(r),AF(),rr=o,ur=a,Fs.transition=i}else e.current=r;if(th&&(th=!1,pa=e,pf=s),i=e.pendingLanes,i===0&&(va=null),NF(r.stateNode),ns(e,Yr()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],n(s.value,{componentStack:s.stack,digest:s.digest});if(ff)throw ff=!1,e=r0,r0=null,e;return pf&1&&e.tag!==0&&kl(),i=e.pendingLanes,i&1?e===n0?su++:(su=0,n0=e):su=0,Ca(),null}function kl(){if(pa!==null){var e=l$(pf),t=Fs.transition,r=ur;try{if(Fs.transition=null,ur=16>e?16:e,pa===null)var n=!1;else{if(e=pa,pa=null,pf=0,rr&6)throw Error(et(331));var s=rr;for(rr|=4,ft=e.current;ft!==null;){var i=ft,a=i.child;if(ft.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(ft=c;ft!==null;){var d=ft;switch(d.tag){case 0:case 11:case 15:ru(8,d,i)}var h=d.child;if(h!==null)h.return=d,ft=h;else for(;ft!==null;){d=ft;var u=d.sibling,p=d.return;if(wI(d),d===c){ft=null;break}if(u!==null){u.return=p,ft=u;break}ft=p}}}var m=i.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var P=y.sibling;y.sibling=null,y=P}while(y!==null)}}ft=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ft=a;else e:for(;ft!==null;){if(i=ft,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ru(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,ft=g;break e}ft=i.return}}var _=e.current;for(ft=_;ft!==null;){a=ft;var b=a.child;if(a.subtreeFlags&2064&&b!==null)b.return=a,ft=b;else e:for(a=_;ft!==null;){if(o=ft,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Bf(9,o)}}catch(M){qr(o,o.return,M)}if(o===a){ft=null;break e}var w=o.sibling;if(w!==null){w.return=o.return,ft=w;break e}ft=o.return}}if(rr=s,Ca(),bi&&typeof bi.onPostCommitFiberRoot=="function")try{bi.onPostCommitFiberRoot(jf,e)}catch{}n=!0}return n}finally{ur=r,Fs.transition=t}}return!1}function xE(e,t,r){t=Nl(r,t),t=lI(e,t,1),e=wa(e,t,1),t=Kn(),e!==null&&(Lu(e,1,t),ns(e,t))}function qr(e,t,r){if(e.tag===3)xE(e,e,r);else for(;t!==null;){if(t.tag===3){xE(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(va===null||!va.has(n))){e=Nl(r,e),e=cI(t,e,1),t=wa(t,e,1),e=Kn(),t!==null&&(Lu(t,1,e),ns(t,e));break}}t=t.return}}function lR(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=Kn(),e.pingedLanes|=e.suspendedLanes&r,Tn===e&&(Cn&r)===r&&(gn===4||gn===3&&(Cn&130023424)===Cn&&500>Yr()-jy?_o(e,0):Ay|=r),ns(e,t)}function CI(e,t){t===0&&(e.mode&1?(t=Gd,Gd<<=1,!(Gd&130023424)&&(Gd=4194304)):t=1);var r=Kn();e=Vi(e,t),e!==null&&(Lu(e,t,r),ns(e,r))}function cR(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),CI(e,r)}function uR(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(et(314))}n!==null&&n.delete(t),CI(e,r)}var $I;$I=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||ts.current)es=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return es=!1,JL(e,t,r);es=!!(e.flags&131072)}else es=!1,jr&&t.flags&1048576&&O$(t,sf,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Nh(e,t),e=t.pendingProps;var s=Il(t,Rn.current);Pl(t,r),s=Py(null,t,n,e,s,r);var i=ky();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,rs(n)?(i=!0,rf(t)):i=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,xy(t),s.updater=zf,t.stateNode=s,s._reactInternals=t,G_(t,n,e,r),t=H_(null,t,n,!0,i,r)):(t.tag=0,jr&&i&&py(t),Gn(null,t,s,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Nh(e,t),e=t.pendingProps,s=n._init,n=s(n._payload),t.type=n,s=t.tag=hR(n),e=ei(n,e),s){case 0:t=K_(null,t,n,e,r);break e;case 1:t=dE(null,t,n,e,r);break e;case 11:t=cE(null,t,n,e,r);break e;case 14:t=uE(null,t,n,ei(n.type,e),r);break e}throw Error(et(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:ei(n,s),K_(e,t,n,s,r);case 1:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:ei(n,s),dE(e,t,n,s,r);case 3:e:{if(fI(t),e===null)throw Error(et(387));n=t.pendingProps,i=t.memoizedState,s=i.element,z$(e,t),lf(t,n,null,r);var a=t.memoizedState;if(n=a.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){s=Nl(Error(et(423)),t),t=hE(e,t,n,r,s);break e}else if(n!==s){s=Nl(Error(et(424)),t),t=hE(e,t,n,r,s);break e}else for(gs=ya(t.stateNode.containerInfo.firstChild),_s=t,jr=!0,si=null,r=L$(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Al(),n===s){t=Wi(e,t,r);break e}Gn(e,t,n,r)}t=t.child}return t;case 5:return B$(t),e===null&&U_(t),n=t.type,s=t.pendingProps,i=e!==null?e.memoizedProps:null,a=s.children,F_(n,s)?a=null:i!==null&&F_(n,i)&&(t.flags|=32),hI(e,t),Gn(e,t,a,r),t.child;case 6:return e===null&&U_(t),null;case 13:return pI(e,t,r);case 4:return by(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=jl(t,null,n,r):Gn(e,t,n,r),t.child;case 11:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:ei(n,s),cE(e,t,n,s,r);case 7:return Gn(e,t,t.pendingProps,r),t.child;case 8:return Gn(e,t,t.pendingProps.children,r),t.child;case 12:return Gn(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,i=t.memoizedProps,a=s.value,Tr(af,n._currentValue),n._currentValue=a,i!==null)if(di(i.value,a)){if(i.children===s.children&&!ts.current){t=Wi(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=zi(-1,r&-r),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var d=c.pending;d===null?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),V_(i.return,r,t),o.lanes|=r;break}l=l.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(et(341));a.lanes|=r,o=a.alternate,o!==null&&(o.lanes|=r),V_(a,r,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Gn(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,Pl(t,r),s=zs(s),n=n(s),t.flags|=1,Gn(e,t,n,r),t.child;case 14:return n=t.type,s=ei(n,t.pendingProps),s=ei(n.type,s),uE(e,t,n,s,r);case 15:return uI(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:ei(n,s),Nh(e,t),t.tag=1,rs(n)?(e=!0,rf(t)):e=!1,Pl(t,r),oI(t,n,s),G_(t,n,s,r),H_(null,t,n,!0,e,r);case 19:return mI(e,t,r);case 22:return dI(e,t,r)}throw Error(et(156,t.tag))};function II(e,t){return s$(e,t)}function dR(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ds(e,t,r,n){return new dR(e,t,r,n)}function Fy(e){return e=e.prototype,!(!e||!e.isReactComponent)}function hR(e){if(typeof e=="function")return Fy(e)?1:0;if(e!=null){if(e=e.$$typeof,e===ry)return 11;if(e===ny)return 14}return 2}function ba(e,t){var r=e.alternate;return r===null?(r=Ds(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Lh(e,t,r,n,s,i){var a=2;if(n=e,typeof e=="function")Fy(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case cl:return yo(r.children,s,i,t);case ty:a=8,s|=8;break;case m_:return e=Ds(12,r,t,s|2),e.elementType=m_,e.lanes=i,e;case g_:return e=Ds(13,r,t,s),e.elementType=g_,e.lanes=i,e;case __:return e=Ds(19,r,t,s),e.elementType=__,e.lanes=i,e;case BC:return Vf(r,s,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case RC:a=10;break e;case zC:a=9;break e;case ry:a=11;break e;case ny:a=14;break e;case la:a=16,n=null;break e}throw Error(et(130,e==null?e:typeof e,""))}return t=Ds(a,r,t,s),t.elementType=e,t.type=n,t.lanes=i,t}function yo(e,t,r,n){return e=Ds(7,e,n,t),e.lanes=r,e}function Vf(e,t,r,n){return e=Ds(22,e,n,t),e.elementType=BC,e.lanes=r,e.stateNode={isHidden:!1},e}function Zm(e,t,r){return e=Ds(6,e,null,t),e.lanes=r,e}function eg(e,t,r){return t=Ds(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function fR(e,t,r,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Om(0),this.expirationTimes=Om(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Om(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Ly(e,t,r,n,s,i,a,o,l){return e=new fR(e,t,r,o,l),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Ds(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},xy(i),e}function pR(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ll,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function AI(e){if(!e)return Ta;e=e._reactInternals;e:{if($o(e)!==e||e.tag!==1)throw Error(et(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(rs(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(et(171))}if(e.tag===1){var r=e.type;if(rs(r))return A$(e,r,t)}return t}function jI(e,t,r,n,s,i,a,o,l){return e=Ly(r,n,!0,e,s,i,a,o,l),e.context=AI(null),r=e.current,n=Kn(),s=xa(r),i=zi(n,s),i.callback=t??null,wa(r,i,s),e.current.lanes=s,Lu(e,s,n),ns(e,n),e}function Wf(e,t,r,n){var s=t.current,i=Kn(),a=xa(s);return r=AI(r),t.context===null?t.context=r:t.pendingContext=r,t=zi(i,a),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=wa(s,t,a),e!==null&&(li(e,s,a,i),Ah(e,s,a)),a}function gf(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function bE(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Ry(e,t){bE(e,t),(e=e.alternate)&&bE(e,t)}function mR(){return null}var OI=typeof reportError=="function"?reportError:function(e){console.error(e)};function zy(e){this._internalRoot=e}Gf.prototype.render=zy.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(et(409));Wf(e,t,null,null)};Gf.prototype.unmount=zy.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Mo(function(){Wf(null,e,null,null)}),t[Ui]=null}};function Gf(e){this._internalRoot=e}Gf.prototype.unstable_scheduleHydration=function(e){if(e){var t=d$();e={blockedOn:null,target:e,priority:t};for(var r=0;r<ua.length&&t!==0&&t<ua[r].priority;r++);ua.splice(r,0,e),r===0&&f$(e)}};function By(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function qf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function ME(){}function gR(e,t,r,n,s){if(s){if(typeof n=="function"){var i=n;n=function(){var c=gf(a);i.call(c)}}var a=jI(t,n,e,0,null,!1,!1,"",ME);return e._reactRootContainer=a,e[Ui]=a.current,_u(e.nodeType===8?e.parentNode:e),Mo(),a}for(;s=e.lastChild;)e.removeChild(s);if(typeof n=="function"){var o=n;n=function(){var c=gf(l);o.call(c)}}var l=Ly(e,0,!1,null,null,!1,!1,"",ME);return e._reactRootContainer=l,e[Ui]=l.current,_u(e.nodeType===8?e.parentNode:e),Mo(function(){Wf(t,l,r,n)}),l}function Kf(e,t,r,n,s){var i=r._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var o=s;s=function(){var l=gf(a);o.call(l)}}Wf(t,a,e,s)}else a=gR(r,t,e,s,n);return gf(a)}c$=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Vc(t.pendingLanes);r!==0&&(ay(t,r|1),ns(t,Yr()),!(rr&6)&&(Dl=Yr()+500,Ca()))}break;case 13:Mo(function(){var n=Vi(e,1);if(n!==null){var s=Kn();li(n,e,1,s)}}),Ry(e,1)}};oy=function(e){if(e.tag===13){var t=Vi(e,134217728);if(t!==null){var r=Kn();li(t,e,134217728,r)}Ry(e,134217728)}};u$=function(e){if(e.tag===13){var t=xa(e),r=Vi(e,t);if(r!==null){var n=Kn();li(r,e,t,n)}Ry(e,t)}};d$=function(){return ur};h$=function(e,t){var r=ur;try{return ur=e,t()}finally{ur=r}};k_=function(e,t,r){switch(t){case"input":if(v_(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var s=Ff(n);if(!s)throw Error(et(90));VC(n),v_(n,s)}}}break;case"textarea":GC(e,r);break;case"select":t=r.value,t!=null&&bl(e,!!r.multiple,t,!1)}};YC=Oy;ZC=Mo;var _R={usingClientEntryPoint:!1,Events:[zu,fl,Ff,XC,JC,Oy]},Sc={findFiberByHostInstance:ho,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yR={bundleType:Sc.bundleType,version:Sc.version,rendererPackageName:Sc.rendererPackageName,rendererConfig:Sc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:qi.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=r$(e),e===null?null:e.stateNode},findFiberByHostInstance:Sc.findFiberByHostInstance||mR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rh.isDisabled&&rh.supportsFiber)try{jf=rh.inject(yR),bi=rh}catch{}}vs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_R;vs.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!By(t))throw Error(et(200));return pR(e,t,null,r)};vs.createRoot=function(e,t){if(!By(e))throw Error(et(299));var r=!1,n="",s=OI;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=Ly(e,1,!1,null,null,r,!1,n,s),e[Ui]=t.current,_u(e.nodeType===8?e.parentNode:e),new zy(t)};vs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(et(188)):(e=Object.keys(e).join(","),Error(et(268,e)));return e=r$(t),e=e===null?null:e.stateNode,e};vs.flushSync=function(e){return Mo(e)};vs.hydrate=function(e,t,r){if(!qf(t))throw Error(et(200));return Kf(null,e,t,!0,r)};vs.hydrateRoot=function(e,t,r){if(!By(e))throw Error(et(405));var n=r!=null&&r.hydratedSources||null,s=!1,i="",a=OI;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),t=jI(t,null,e,1,r??null,s,!1,i,a),e[Ui]=t.current,_u(e),n)for(e=0;e<n.length;e++)r=n[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new Gf(t)};vs.render=function(e,t,r){if(!qf(t))throw Error(et(200));return Kf(null,e,t,!1,r)};vs.unmountComponentAtNode=function(e){if(!qf(e))throw Error(et(40));return e._reactRootContainer?(Mo(function(){Kf(null,null,e,!1,function(){e._reactRootContainer=null,e[Ui]=null})}),!0):!1};vs.unstable_batchedUpdates=Oy;vs.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!qf(r))throw Error(et(200));if(e==null||e._reactInternals===void 0)throw Error(et(38));return Kf(e,t,r,!1,n)};vs.version="18.3.1-next-f1338f8080-20240426";function NI(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(NI)}catch(e){console.error(e)}}NI(),NC.exports=vs;var DI=NC.exports,TE=DI;f_.createRoot=TE.createRoot,f_.hydrateRoot=TE.hydrateRoot;/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wR=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),FI=(...e)=>e.filter((t,r,n)=>!!t&&n.indexOf(t)===r).join(" ");/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var vR={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xR=ke.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:i,iconNode:a,...o},l)=>ke.createElement("svg",{ref:l,...vR,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:FI("lucide",s),...o},[...a.map(([c,d])=>ke.createElement(c,d)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=(e,t)=>{const r=ke.forwardRef(({className:n,...s},i)=>ke.createElement(xR,{ref:i,iconNode:t,className:FI(`lucide-${wR(e)}`,n),...s}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bR=St("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MR=St("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gi=St("Backpack",[["path",{d:"M4 10a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z",key:"wvr1b5"}],["path",{d:"M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2",key:"donm21"}],["path",{d:"M8 21v-5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v5",key:"xk3gvk"}],["path",{d:"M8 10h8",key:"c7uz4u"}],["path",{d:"M8 18h8",key:"1no2b1"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TR=St("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hf=St("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ER=St("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PR=St("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fl=St("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cc=St("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LI=St("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kR=St("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SR=St("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CR=St("CloudDownload",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m8 17 4 4 4-4",key:"1ul180"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RI=St("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $R=St("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zI=St("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IR=St("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AR=St("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jR=St("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BI=St("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OR=St("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NR=St("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iu=St("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uy=St("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=St("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qf=St("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UI=St("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DR=St("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vy=St("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a0=St("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FR=St("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VI=St("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pu=St("Mountain",[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wy=St("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ti=St("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LR=St("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RR=St("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WI=St("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GI=St("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zR=St("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BR=St("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UR=St("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qI=St("Sunrise",[["path",{d:"M12 2v8",key:"1q4o3n"}],["path",{d:"m4.93 10.93 1.41 1.41",key:"2a7f42"}],["path",{d:"M2 18h2",key:"j10viu"}],["path",{d:"M20 18h2",key:"wocana"}],["path",{d:"m19.07 10.93-1.41 1.41",key:"15zs5n"}],["path",{d:"M22 22H2",key:"19qnx5"}],["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M16 18a4 4 0 0 0-8 0",key:"1lzouq"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ku=St("Tent",[["path",{d:"M3.5 21 14 3",key:"1szst5"}],["path",{d:"M20.5 21 10 3",key:"1310c3"}],["path",{d:"M15.5 21 12 15l-3.5 6",key:"1ddtfw"}],["path",{d:"M2 21h20",key:"1nyx9w"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=St("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VR=St("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WR=St("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o0=St("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KI=St("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _f=St("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HI=St("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QI=St("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=St("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),GR=({activeTab:e,onTabChange:t})=>{const r=[{id:"dashboard",label:"Home",icon:f.jsx(Pu,{size:20})},{id:"plan",label:"Plan",icon:f.jsx(a0,{size:20})},{id:"gear",label:"Gear",icon:f.jsx(Gi,{size:20})},{id:"profile",label:"Me",icon:f.jsx(KI,{size:20})}];return f.jsx("div",{className:"fixed bottom-0 left-0 right-0 glass-panel border-t border-white/40 pb-safe pt-2 px-6 pb-4 z-50 rounded-t-3xl shadow-lg",children:f.jsx("div",{className:"flex justify-between items-center max-w-md mx-auto",children:r.map(n=>{const s=e===n.id;return f.jsxs("button",{onClick:()=>t(n.id),className:`flex flex-col items-center justify-center space-y-1 transition-all duration-200 ${s?"text-blue-600 scale-110":"text-gray-500 hover:text-gray-700"}`,children:[f.jsx("div",{className:`${s?"bg-blue-100 rounded-full p-1.5":"p-1.5"}`,children:n.icon}),f.jsx("span",{className:"text-[10px] font-medium",children:n.label})]},n.id)})})})};function qR(e,t){return e[13]=1,e[14]=t>>8,e[15]=t&255,e[16]=t>>8,e[17]=t&255,e}const XI=112,JI=72,YI=89,ZI=115;let tg;function KR(){const e=new Int32Array(256);for(let t=0;t<256;t++){let r=t;for(let n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e}function HR(e){let t=-1;tg||(tg=KR());for(let r=0;r<e.length;r++)t=tg[(t^e[r])&255]^t>>>8;return t^-1}function QR(e){const t=e.length-1;for(let r=t;r>=4;r--)if(e[r-4]===9&&e[r-3]===XI&&e[r-2]===JI&&e[r-1]===YI&&e[r]===ZI)return r-3;return 0}function XR(e,t,r=!1){const n=new Uint8Array(13);t*=39.3701,n[0]=XI,n[1]=JI,n[2]=YI,n[3]=ZI,n[4]=t>>>24,n[5]=t>>>16,n[6]=t>>>8,n[7]=t&255,n[8]=n[4],n[9]=n[5],n[10]=n[6],n[11]=n[7],n[12]=1;const s=HR(n),i=new Uint8Array(4);if(i[0]=s>>>24,i[1]=s>>>16,i[2]=s>>>8,i[3]=s&255,r){const a=QR(e);return e.set(n,a),e.set(i,a+13),e}else{const a=new Uint8Array(4);a[0]=0,a[1]=0,a[2]=0,a[3]=9;const o=new Uint8Array(54);return o.set(e,0),o.set(a,33),o.set(n,37),o.set(i,50),o}}const JR="AAlwSFlz",YR="AAAJcEhZ",ZR="AAAACXBI";function ez(e){let t=e.indexOf(JR);return t===-1&&(t=e.indexOf(YR)),t===-1&&(t=e.indexOf(ZR)),t}const eA="[modern-screenshot]",Ea=typeof window<"u",tz=Ea&&"Worker"in window,rz=Ea&&"atob"in window,nz=Ea&&"btoa"in window;var bC;const Gy=Ea?(bC=window.navigator)==null?void 0:bC.userAgent:"",tA=Gy.includes("Chrome"),yf=Gy.includes("AppleWebKit")&&!tA,qy=Gy.includes("Firefox"),sz=e=>e&&"__CONTEXT__"in e,iz=e=>e.constructor.name==="CSSFontFaceRule",az=e=>e.constructor.name==="CSSImportRule",Ei=e=>e.nodeType===1,Uu=e=>typeof e.className=="object",rA=e=>e.tagName==="image",oz=e=>e.tagName==="use",Su=e=>Ei(e)&&typeof e.style<"u"&&!Uu(e),lz=e=>e.nodeType===8,cz=e=>e.nodeType===3,Ll=e=>e.tagName==="IMG",Xf=e=>e.tagName==="VIDEO",uz=e=>e.tagName==="CANVAS",dz=e=>e.tagName==="TEXTAREA",hz=e=>e.tagName==="INPUT",fz=e=>e.tagName==="STYLE",pz=e=>e.tagName==="SCRIPT",mz=e=>e.tagName==="SELECT",gz=e=>e.tagName==="SLOT",_z=e=>e.tagName==="IFRAME",yz=(...e)=>console.warn(eA,...e);function wz(e){var r;const t=(r=e==null?void 0:e.createElement)==null?void 0:r.call(e,"canvas");return t&&(t.height=t.width=1),!!t&&"toDataURL"in t&&!!t.toDataURL("image/webp").includes("image/webp")}const l0=e=>e.startsWith("data:");function nA(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(Ea&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!Ea)return e;const r=Jf().implementation.createHTMLDocument(),n=r.createElement("base"),s=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(s),t&&(n.href=t),s.href=e,s.href}function Jf(e){return(e&&Ei(e)?e==null?void 0:e.ownerDocument:e)??window.document}const Yf="http://www.w3.org/2000/svg";function vz(e,t,r){const n=Jf(r).createElementNS(Yf,"svg");return n.setAttributeNS(null,"width",e.toString()),n.setAttributeNS(null,"height",t.toString()),n.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),n}function xz(e,t){let r=new XMLSerializer().serializeToString(e);return t&&(r=r.replace(/[\u0000-\u0008\v\f\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(r)}`}function bz(e,t){return new Promise((r,n)=>{const s=new FileReader;s.onload=()=>r(s.result),s.onerror=()=>n(s.error),s.onabort=()=>n(new Error(`Failed read blob to ${t}`)),s.readAsDataURL(e)})}const Mz=e=>bz(e,"dataUrl");function Sl(e,t){const r=Jf(t).createElement("img");return r.decoding="sync",r.loading="eager",r.src=e,r}function Cu(e,t){return new Promise(r=>{const{timeout:n,ownerDocument:s,onError:i,onWarn:a}=t??{},o=typeof e=="string"?Sl(e,Jf(s)):e;let l=null,c=null;function d(){r(o),l&&clearTimeout(l),c==null||c()}if(n&&(l=setTimeout(d,n)),Xf(o)){const h=o.currentSrc||o.src;if(!h)return o.poster?Cu(o.poster,t).then(r):d();if(o.readyState>=2)return d();const u=d,p=m=>{a==null||a("Failed video load",h,m),i==null||i(m),d()};c=()=>{o.removeEventListener("loadeddata",u),o.removeEventListener("error",p)},o.addEventListener("loadeddata",u,{once:!0}),o.addEventListener("error",p,{once:!0})}else{const h=rA(o)?o.href.baseVal:o.currentSrc||o.src;if(!h)return d();const u=async()=>{if(Ll(o)&&"decode"in o)try{await o.decode()}catch(m){a==null||a("Failed to decode image, trying to render anyway",o.dataset.originalSrc||h,m)}d()},p=m=>{a==null||a("Failed image load",o.dataset.originalSrc||h,m),d()};if(Ll(o)&&o.complete)return u();c=()=>{o.removeEventListener("load",u),o.removeEventListener("error",p)},o.addEventListener("load",u,{once:!0}),o.addEventListener("error",p,{once:!0})}})}async function Tz(e,t){Su(e)&&(Ll(e)||Xf(e)?await Cu(e,t):await Promise.all(["img","video"].flatMap(r=>Array.from(e.querySelectorAll(r)).map(n=>Cu(n,t)))))}const sA=function(){let t=0;const r=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${r()}${t}`)}();function iA(e){return e==null?void 0:e.split(",").map(t=>t.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}let EE=0;function Ez(e){const t=`${eA}[#${EE}]`;return EE++,{time:r=>e&&console.time(`${t} ${r}`),timeEnd:r=>e&&console.timeEnd(`${t} ${r}`),warn:(...r)=>e&&yz(...r)}}function Pz(e){return{cache:e?"no-cache":"force-cache"}}async function Zf(e,t){return sz(e)?e:kz(e,{...t,autoDestruct:!0})}async function kz(e,t){var p,m;const{scale:r=1,workerUrl:n,workerNumber:s=1}=t||{},i=!!(t!=null&&t.debug),a=(t==null?void 0:t.features)??!0,o=e.ownerDocument??(Ea?window.document:void 0),l=((p=e.ownerDocument)==null?void 0:p.defaultView)??(Ea?window:void 0),c=new Map,d={width:0,height:0,quality:1,type:"image/png",scale:r,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:i,fetch:{requestInit:Pz((m=t==null?void 0:t.fetch)==null?void 0:m.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1,...t==null?void 0:t.fetch},fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:s,onCloneEachNode:null,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1,...t,__CONTEXT__:!0,log:Ez(i),node:e,ownerDocument:o,ownerWindow:l,dpi:r===1?null:96*r,svgStyleElement:aA(o),svgDefsElement:o==null?void 0:o.createElementNS(Yf,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...Array.from({length:tz&&n&&s?s:0})].map(()=>{try{const y=new Worker(n);return y.onmessage=async P=>{var b,w,M,E;const{url:g,result:_}=P.data;_?(w=(b=c.get(g))==null?void 0:b.resolve)==null||w.call(b,_):(E=(M=c.get(g))==null?void 0:M.reject)==null||E.call(M,new Error(`Error receiving message from worker: ${g}`))},y.onmessageerror=P=>{var _,b;const{url:g}=P.data;(b=(_=c.get(g))==null?void 0:_.reject)==null||b.call(_,new Error(`Error receiving message from worker: ${g}`))},y}catch(y){return d.log.warn("Failed to new Worker",y),null}}).filter(Boolean),fontFamilies:new Map,fontCssTexts:new Map,acceptOfImage:`${[wz(o)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:c,drawImageCount:0,tasks:[],features:a,isEnable:y=>y==="restoreScrollPosition"?typeof a=="boolean"?!1:a[y]??!1:typeof a=="boolean"?a:a[y]??!0,shadowRoots:[]};d.log.time("wait until load"),await Tz(e,{timeout:d.timeout,onWarn:d.log.warn}),d.log.timeEnd("wait until load");const{width:h,height:u}=Sz(e,d);return d.width=h,d.height=u,d}function aA(e){if(!e)return;const t=e.createElement("style"),r=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(r),t}function Sz(e,t){let{width:r,height:n}=t;if(Ei(e)&&(!r||!n)){const s=e.getBoundingClientRect();r=r||s.width||Number(e.getAttribute("width"))||0,n=n||s.height||Number(e.getAttribute("height"))||0}return{width:r,height:n}}async function Cz(e,t){const{log:r,timeout:n,drawImageCount:s,drawImageInterval:i}=t;r.time("image to canvas");const a=await Cu(e,{timeout:n,onWarn:t.log.warn}),{canvas:o,context2d:l}=$z(e.ownerDocument,t),c=()=>{try{l==null||l.drawImage(a,0,0,o.width,o.height)}catch(d){t.log.warn("Failed to drawImage",d)}};if(c(),t.isEnable("fixSvgXmlDecode"))for(let d=0;d<s;d++)await new Promise(h=>{setTimeout(()=>{l==null||l.clearRect(0,0,o.width,o.height),c(),h()},d+i)});return t.drawImageCount=0,r.timeEnd("image to canvas"),o}function $z(e,t){const{width:r,height:n,scale:s,backgroundColor:i,maximumCanvasSize:a}=t,o=e.createElement("canvas");o.width=Math.floor(r*s),o.height=Math.floor(n*s),o.style.width=`${r}px`,o.style.height=`${n}px`,a&&(o.width>a||o.height>a)&&(o.width>a&&o.height>a?o.width>o.height?(o.height*=a/o.width,o.width=a):(o.width*=a/o.height,o.height=a):o.width>a?(o.height*=a/o.width,o.width=a):(o.width*=a/o.height,o.height=a));const l=o.getContext("2d");return l&&i&&(l.fillStyle=i,l.fillRect(0,0,o.width,o.height)),{canvas:o,context2d:l}}function oA(e,t){if(e.ownerDocument)try{const i=e.toDataURL();if(i!=="data:,")return Sl(i,e.ownerDocument)}catch(i){t.log.warn("Failed to clone canvas",i)}const r=e.cloneNode(!1),n=e.getContext("2d"),s=r.getContext("2d");try{return n&&s&&s.putImageData(n.getImageData(0,0,e.width,e.height),0,0),r}catch(i){t.log.warn("Failed to clone canvas",i)}return r}function Iz(e,t){var r;try{if((r=e==null?void 0:e.contentDocument)!=null&&r.body)return Ky(e.contentDocument.body,t)}catch(n){t.log.warn("Failed to clone iframe",n)}return e.cloneNode(!1)}function Az(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}async function jz(e,t){if(e.ownerDocument&&!e.currentSrc&&e.poster)return Sl(e.poster,e.ownerDocument);const r=e.cloneNode(!1);r.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(r.src=e.currentSrc);const n=r.ownerDocument;if(n){let s=!0;if(await Cu(r,{onError:()=>s=!1,onWarn:t.log.warn}),!s)return e.poster?Sl(e.poster,e.ownerDocument):r;r.currentTime=e.currentTime,await new Promise(a=>{r.addEventListener("seeked",a,{once:!0})});const i=n.createElement("canvas");i.width=e.offsetWidth,i.height=e.offsetHeight;try{const a=i.getContext("2d");a&&a.drawImage(r,0,0,i.width,i.height)}catch(a){return t.log.warn("Failed to clone video",a),e.poster?Sl(e.poster,e.ownerDocument):r}return oA(i,t)}return r}function Oz(e,t){return uz(e)?oA(e,t):_z(e)?Iz(e,t):Ll(e)?Az(e):Xf(e)?jz(e,t):e.cloneNode(!1)}function Nz(e){let t=e.sandbox;if(!t){const{ownerDocument:r}=e;try{r&&(t=r.createElement("iframe"),t.id=`__SANDBOX__${sA()}`,t.width="0",t.height="0",t.style.visibility="hidden",t.style.position="fixed",r.body.appendChild(t),t.srcdoc='<!DOCTYPE html><meta charset="UTF-8"><title></title><body>',e.sandbox=t)}catch(n){e.log.warn("Failed to getSandBox",n)}}return t}const Dz=["width","height","-webkit-text-fill-color"],Fz=["stroke","fill"];function lA(e,t,r){const{defaultComputedStyles:n}=r,s=e.nodeName.toLowerCase(),i=Uu(e)&&s!=="svg",a=i?Fz.map(y=>[y,e.getAttribute(y)]).filter(([,y])=>y!==null):[],o=[i&&"svg",s,a.map((y,P)=>`${y}=${P}`).join(","),t].filter(Boolean).join(":");if(n.has(o))return n.get(o);const l=Nz(r),c=l==null?void 0:l.contentWindow;if(!c)return new Map;const d=c==null?void 0:c.document;let h,u;i?(h=d.createElementNS(Yf,"svg"),u=h.ownerDocument.createElementNS(h.namespaceURI,s),a.forEach(([y,P])=>{u.setAttributeNS(null,y,P)}),h.appendChild(u)):h=u=d.createElement(s),u.textContent=" ",d.body.appendChild(h);const p=c.getComputedStyle(u,t),m=new Map;for(let y=p.length,P=0;P<y;P++){const g=p.item(P);Dz.includes(g)||m.set(g,p.getPropertyValue(g))}return d.body.removeChild(h),n.set(o,m),m}function cA(e,t,r){var o;const n=new Map,s=[],i=new Map;if(r)for(const l of r)a(l);else for(let l=e.length,c=0;c<l;c++){const d=e.item(c);a(d)}for(let l=s.length,c=0;c<l;c++)(o=i.get(s[c]))==null||o.forEach((d,h)=>n.set(h,d));function a(l){const c=e.getPropertyValue(l),d=e.getPropertyPriority(l),h=l.lastIndexOf("-"),u=h>-1?l.substring(0,h):void 0;if(u){let p=i.get(u);p||(p=new Map,i.set(u,p)),p.set(l,[c,d])}t.get(l)===c&&!d||(u?s.push(u):n.set(l,[c,d]))}return n}function Lz(e,t,r,n){var h,u,p,m;const{ownerWindow:s,includeStyleProperties:i,currentParentNodeStyle:a}=n,o=t.style,l=s.getComputedStyle(e),c=lA(e,null,n);a==null||a.forEach((y,P)=>{c.delete(P)});const d=cA(l,c,i);d.delete("transition-property"),d.delete("all"),d.delete("d"),d.delete("content"),r&&(d.delete("margin-top"),d.delete("margin-right"),d.delete("margin-bottom"),d.delete("margin-left"),d.delete("margin-block-start"),d.delete("margin-block-end"),d.delete("margin-inline-start"),d.delete("margin-inline-end"),d.set("box-sizing",["border-box",""])),((h=d.get("background-clip"))==null?void 0:h[0])==="text"&&t.classList.add("______background-clip--text"),tA&&(d.has("font-kerning")||d.set("font-kerning",["normal",""]),(((u=d.get("overflow-x"))==null?void 0:u[0])==="hidden"||((p=d.get("overflow-y"))==null?void 0:p[0])==="hidden")&&((m=d.get("text-overflow"))==null?void 0:m[0])==="ellipsis"&&e.scrollWidth===e.clientWidth&&d.set("text-overflow",["clip",""]));for(let y=o.length,P=0;P<y;P++)o.removeProperty(o.item(P));return d.forEach(([y,P],g)=>{o.setProperty(g,y,P)}),d}function Rz(e,t){(dz(e)||hz(e)||mz(e))&&t.setAttribute("value",e.value)}const zz=["::before","::after"],Bz=["::-webkit-scrollbar","::-webkit-scrollbar-button","::-webkit-scrollbar-thumb","::-webkit-scrollbar-track","::-webkit-scrollbar-track-piece","::-webkit-scrollbar-corner","::-webkit-resizer"];function Uz(e,t,r,n,s){const{ownerWindow:i,svgStyleElement:a,svgStyles:o,currentNodeStyle:l}=n;if(!a||!i)return;function c(d){var b;const h=i.getComputedStyle(e,d);let u=h.getPropertyValue("content");if(!u||u==="none")return;s==null||s(u),u=u.replace(/(')|(")|(counter\(.+\))/g,"");const p=[sA()],m=lA(e,d,n);l==null||l.forEach((w,M)=>{m.delete(M)});const y=cA(h,m,n.includeStyleProperties);y.delete("content"),y.delete("-webkit-locale"),((b=y.get("background-clip"))==null?void 0:b[0])==="text"&&t.classList.add("______background-clip--text");const P=[`content: '${u}';`];if(y.forEach(([w,M],E)=>{P.push(`${E}: ${w}${M?" !important":""};`)}),P.length===1)return;try{t.className=[t.className,...p].join(" ")}catch(w){n.log.warn("Failed to copyPseudoClass",w);return}const g=P.join(`
  `);let _=o.get(g);_||(_=[],o.set(g,_)),_.push(`.${p[0]}${d}`)}zz.forEach(c),r&&Bz.forEach(c)}const PE=new Set(["symbol"]);async function kE(e,t,r,n,s){if(Ei(r)&&(fz(r)||pz(r))||n.filter&&!n.filter(r))return;PE.has(t.nodeName)||PE.has(r.nodeName)?n.currentParentNodeStyle=void 0:n.currentParentNodeStyle=n.currentNodeStyle;const i=await Ky(r,n,!1,s);n.isEnable("restoreScrollPosition")&&Vz(e,i),t.appendChild(i)}async function SE(e,t,r,n){var i;let s=e.firstChild;Ei(e)&&e.shadowRoot&&(s=(i=e.shadowRoot)==null?void 0:i.firstChild,r.shadowRoots.push(e.shadowRoot));for(let a=s;a;a=a.nextSibling)if(!lz(a))if(Ei(a)&&gz(a)&&typeof a.assignedNodes=="function"){const o=a.assignedNodes();for(let l=0;l<o.length;l++)await kE(e,t,o[l],r,n)}else await kE(e,t,a,r,n)}function Vz(e,t){if(!Su(e)||!Su(t))return;const{scrollTop:r,scrollLeft:n}=e;if(!r&&!n)return;const{transform:s}=t.style,i=new DOMMatrix(s),{a,b:o,c:l,d:c}=i;i.a=1,i.b=0,i.c=0,i.d=1,i.translateSelf(-n,-r),i.a=a,i.b=o,i.c=l,i.d=c,t.style.transform=i.toString()}function Wz(e,t){const{backgroundColor:r,width:n,height:s,style:i}=t,a=e.style;if(r&&a.setProperty("background-color",r,"important"),n&&a.setProperty("width",`${n}px`,"important"),s&&a.setProperty("height",`${s}px`,"important"),i)for(const o in i)a[o]=i[o]}const Gz=/^[\w-:]+$/;async function Ky(e,t,r=!1,n){var c,d,h,u;const{ownerDocument:s,ownerWindow:i,fontFamilies:a,onCloneEachNode:o}=t;if(s&&cz(e))return n&&/\S/.test(e.data)&&n(e.data),s.createTextNode(e.data);if(s&&i&&Ei(e)&&(Su(e)||Uu(e))){const p=await Oz(e,t);if(t.isEnable("removeAbnormalAttributes")){const b=p.getAttributeNames();for(let w=b.length,M=0;M<w;M++){const E=b[M];Gz.test(E)||p.removeAttribute(E)}}const m=t.currentNodeStyle=Lz(e,p,r,t);r&&Wz(p,t);let y=!1;if(t.isEnable("copyScrollbar")){const b=[(c=m.get("overflow-x"))==null?void 0:c[0],(d=m.get("overflow-y"))==null?void 0:d[0]];y=b.includes("scroll")||(b.includes("auto")||b.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}const P=(h=m.get("text-transform"))==null?void 0:h[0],g=iA((u=m.get("font-family"))==null?void 0:u[0]),_=g?b=>{P==="uppercase"?b=b.toUpperCase():P==="lowercase"?b=b.toLowerCase():P==="capitalize"&&(b=b[0].toUpperCase()+b.substring(1)),g.forEach(w=>{let M=a.get(w);M||a.set(w,M=new Set),b.split("").forEach(E=>M.add(E))})}:void 0;return Uz(e,p,y,t,_),Rz(e,p),Xf(e)||await SE(e,p,t,_),await(o==null?void 0:o(p)),p}const l=e.cloneNode(!1);return await SE(e,l,t),await(o==null?void 0:o(l)),l}function qz(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(t){e.log.warn("Failed to destroyContext",t)}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[],e.shadowRoots=[]}function Kz(e){const{url:t,timeout:r,responseType:n,...s}=e,i=new AbortController,a=r?setTimeout(()=>i.abort(),r):void 0;return fetch(t,{signal:i.signal,...s}).then(o=>{if(!o.ok)throw new Error("Failed fetch, not 2xx response",{cause:o});switch(n){case"arrayBuffer":return o.arrayBuffer();case"dataUrl":return o.blob().then(Mz);case"text":default:return o.text()}}).finally(()=>clearTimeout(a))}function $u(e,t){const{url:r,requestType:n="text",responseType:s="text",imageDom:i}=t;let a=r;const{timeout:o,acceptOfImage:l,requests:c,fetchFn:d,fetch:{requestInit:h,bypassingCache:u,placeholderImage:p},font:m,workers:y,fontFamilies:P}=e;n==="image"&&(yf||qy)&&e.drawImageCount++;let g=c.get(r);if(!g){u&&u instanceof RegExp&&u.test(a)&&(a+=(/\?/.test(a)?"&":"?")+new Date().getTime());const _=n.startsWith("font")&&m&&m.minify,b=new Set;_&&n.split(";")[1].split(",").forEach(T=>{P.has(T)&&P.get(T).forEach(S=>b.add(S))});const w=_&&b.size,M={url:a,timeout:o,responseType:w?"arrayBuffer":s,headers:n==="image"?{accept:l}:void 0,...h};g={type:n,resolve:void 0,reject:void 0,response:null},g.response=(async()=>{if(d&&n==="image"){const E=await d(r);if(E)return E}return!yf&&r.startsWith("http")&&y.length?new Promise((E,T)=>{y[c.size&y.length-1].postMessage({rawUrl:r,...M}),g.resolve=E,g.reject=T}):Kz(M)})().catch(E=>{if(c.delete(r),n==="image"&&p)return e.log.warn("Failed to fetch image base64, trying to use placeholder image",a),typeof p=="string"?p:p(i);throw E}),c.set(r,g)}return g.response}async function uA(e,t,r,n){if(!dA(e))return e;for(const[s,i]of Hz(e,t))try{const a=await $u(r,{url:i,requestType:n?"image":"text",responseType:"dataUrl"});e=e.replace(Qz(s),`$1${a}$3`)}catch(a){r.log.warn("Failed to fetch css data url",s,a)}return e}function dA(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const hA=/url\((['"]?)([^'"]+?)\1\)/g;function Hz(e,t){const r=[];return e.replace(hA,(n,s,i)=>(r.push([i,nA(i,t)]),n)),r.filter(([n])=>!l0(n))}function Qz(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}const Xz=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Jz(e,t){return Xz.map(r=>{const n=e.getPropertyValue(r);return!n||n==="none"?null:((yf||qy)&&t.drawImageCount++,uA(n,null,t,!0).then(s=>{!s||n===s||e.setProperty(r,s,e.getPropertyPriority(r))}))}).filter(Boolean)}function Yz(e,t){if(Ll(e)){const r=e.currentSrc||e.src;if(!l0(r))return[$u(t,{url:r,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(e.srcset="",e.dataset.originalSrc=r,e.src=n||"")})];(yf||qy)&&t.drawImageCount++}else if(Uu(e)&&!l0(e.href.baseVal)){const r=e.href.baseVal;return[$u(t,{url:r,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(e.dataset.originalSrc=r,e.href.baseVal=n||"")})]}return[]}function Zz(e,t){const{ownerDocument:r,svgDefsElement:n}=t,s=e.getAttribute("href")??e.getAttribute("xlink:href");if(!s)return[];const[i,a]=s.split("#");if(a){const o=`#${a}`,l=t.shadowRoots.reduce((c,d)=>c??d.querySelector(`svg ${o}`),r==null?void 0:r.querySelector(`svg ${o}`));if(i&&e.setAttribute("href",o),n!=null&&n.querySelector(o))return[];if(l)return n==null||n.appendChild(l.cloneNode(!0)),[];if(i)return[$u(t,{url:i,responseType:"text"}).then(c=>{n==null||n.insertAdjacentHTML("beforeend",c)})]}return[]}function fA(e,t){const{tasks:r}=t;Ei(e)&&((Ll(e)||rA(e))&&r.push(...Yz(e,t)),oz(e)&&r.push(...Zz(e,t))),Su(e)&&r.push(...Jz(e.style,t)),e.childNodes.forEach(n=>{fA(n,t)})}async function e4(e,t){const{ownerDocument:r,svgStyleElement:n,fontFamilies:s,fontCssTexts:i,tasks:a,font:o}=t;if(!(!r||!n||!s.size))if(o&&o.cssText){const l=$E(o.cssText,t);n.appendChild(r.createTextNode(`${l}
`))}else{const l=Array.from(r.styleSheets).filter(d=>{try{return"cssRules"in d&&!!d.cssRules.length}catch(h){return t.log.warn(`Error while reading CSS rules from ${d.href}`,h),!1}});await Promise.all(l.flatMap(d=>Array.from(d.cssRules).map(async(h,u)=>{if(az(h)){let p=u+1;const m=h.href;let y="";try{y=await $u(t,{url:m,requestType:"text",responseType:"text"})}catch(g){t.log.warn(`Error fetch remote css import from ${m}`,g)}const P=y.replace(hA,(g,_,b)=>g.replace(b,nA(b,m)));for(const g of r4(P))try{d.insertRule(g,g.startsWith("@import")?p+=1:d.cssRules.length)}catch(_){t.log.warn("Error inserting rule from remote css import",{rule:g,error:_})}}}))),l.flatMap(d=>Array.from(d.cssRules)).filter(d=>{var h;return iz(d)&&dA(d.style.getPropertyValue("src"))&&((h=iA(d.style.getPropertyValue("font-family")))==null?void 0:h.some(u=>s.has(u)))}).forEach(d=>{const h=d,u=i.get(h.cssText);u?n.appendChild(r.createTextNode(`${u}
`)):a.push(uA(h.cssText,h.parentStyleSheet?h.parentStyleSheet.href:null,t).then(p=>{p=$E(p,t),i.set(h.cssText,p),n.appendChild(r.createTextNode(`${p}
`))}))})}}const t4=/(\/\*[\s\S]*?\*\/)/g,CE=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function r4(e){if(e==null)return[];const t=[];let r=e.replace(t4,"");for(;;){const i=CE.exec(r);if(!i)break;t.push(i[0])}r=r.replace(CE,"");const n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,s=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let i=n.exec(r);if(i)s.lastIndex=n.lastIndex;else if(i=s.exec(r),i)n.lastIndex=s.lastIndex;else break;t.push(i[0])}return t}const n4=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,s4=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function $E(e,t){const{font:r}=t,n=r?r==null?void 0:r.preferredFormat:void 0;return n?e.replace(s4,s=>{for(;;){const[i,,a]=n4.exec(s)||[];if(!a)return"";if(a===n)return`src: ${i};`}}):e}async function i4(e,t){const r=await Zf(e,t);if(Ei(r.node)&&Uu(r.node))return r.node;const{ownerDocument:n,log:s,tasks:i,svgStyleElement:a,svgDefsElement:o,svgStyles:l,font:c,progress:d,autoDestruct:h,onCloneNode:u,onEmbedNode:p,onCreateForeignObjectSvg:m}=r;s.time("clone node");const y=await Ky(r.node,r,!0);if(a&&n){let w="";l.forEach((M,E)=>{w+=`${M.join(`,
`)} {
  ${E}
}
`}),a.appendChild(n.createTextNode(w))}s.timeEnd("clone node"),await(u==null?void 0:u(y)),c!==!1&&Ei(y)&&(s.time("embed web font"),await e4(y,r),s.timeEnd("embed web font")),s.time("embed node"),fA(y,r);const P=i.length;let g=0;const _=async()=>{for(;;){const w=i.pop();if(!w)break;try{await w}catch(M){r.log.warn("Failed to run task",M)}d==null||d(++g,P)}};d==null||d(g,P),await Promise.all([...Array.from({length:4})].map(_)),s.timeEnd("embed node"),await(p==null?void 0:p(y));const b=a4(y,r);return o&&b.insertBefore(o,b.children[0]),a&&b.insertBefore(a,b.children[0]),h&&qz(r),await(m==null?void 0:m(b)),b}function a4(e,t){const{width:r,height:n}=t,s=vz(r,n,e.ownerDocument),i=s.ownerDocument.createElementNS(s.namespaceURI,"foreignObject");return i.setAttributeNS(null,"x","0%"),i.setAttributeNS(null,"y","0%"),i.setAttributeNS(null,"width","100%"),i.setAttributeNS(null,"height","100%"),i.append(e),s.appendChild(i),s}async function o4(e,t){var a;const r=await Zf(e,t),n=await i4(r),s=xz(n,r.isEnable("removeControlCharacter"));r.autoDestruct||(r.svgStyleElement=aA(r.ownerDocument),r.svgDefsElement=(a=r.ownerDocument)==null?void 0:a.createElementNS(Yf,"defs"),r.svgStyles.clear());const i=Sl(s,n.ownerDocument);return await Cz(i,r)}async function l4(e,t){const r=await Zf(e,t),{log:n,quality:s,type:i,dpi:a}=r,o=await o4(r);n.time("canvas to data url");let l=o.toDataURL(i,s);if(["image/png","image/jpeg"].includes(i)&&a&&rz&&nz){const[c,d]=l.split(",");let h=0,u=!1;if(i==="image/png"){const b=ez(d);b>=0?(h=Math.ceil((b+28)/3)*4,u=!0):h=33/3*4}else i==="image/jpeg"&&(h=18/3*4);const p=d.substring(0,h),m=d.substring(h),y=window.atob(p),P=new Uint8Array(y.length);for(let b=0;b<P.length;b++)P[b]=y.charCodeAt(b);const g=i==="image/png"?XR(P,a,u):qR(P,a),_=window.btoa(String.fromCharCode(...g));l=[c,",",_,m].join("")}return n.timeEnd("canvas to data url"),l}async function c4(e,t){return l4(await Zf(e,{...t,type:"image/png"}))}var fr=(e=>(e.SLEEPING="Sleeping",e.CARRYING="Carrying",e.CLOTHING="Clothing",e.COOKING="Cooking",e.ELECTRONICS="Electronics",e.FOOD="Food",e.TOOLS="Tools",e.LIGHTING="Lighting",e.MISC="Misc",e))(fr||{}),c0=function(e,t){return c0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},c0(e,t)};function Hy(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");c0(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var on=function(){return on=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},on.apply(this,arguments)};function ql(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function pA(e,t,r,n){var s=arguments.length,i=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(s<3?a(i):s>3?a(t,r,i):a(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}function mA(e,t){return function(r,n){t(r,n,e)}}function gA(e,t,r,n,s,i){function a(g){if(g!==void 0&&typeof g!="function")throw new TypeError("Function expected");return g}for(var o=n.kind,l=o==="getter"?"get":o==="setter"?"set":"value",c=!t&&e?n.static?e:e.prototype:null,d=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),h,u=!1,p=r.length-1;p>=0;p--){var m={};for(var y in n)m[y]=y==="access"?{}:n[y];for(var y in n.access)m.access[y]=n.access[y];m.addInitializer=function(g){if(u)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(g||null))};var P=(0,r[p])(o==="accessor"?{get:d.get,set:d.set}:d[l],m);if(o==="accessor"){if(P===void 0)continue;if(P===null||typeof P!="object")throw new TypeError("Object expected");(h=a(P.get))&&(d.get=h),(h=a(P.set))&&(d.set=h),(h=a(P.init))&&s.unshift(h)}else(h=a(P))&&(o==="field"?s.unshift(h):d[l]=h)}c&&Object.defineProperty(c,n.name,d),u=!0}function _A(e,t,r){for(var n=arguments.length>2,s=0;s<t.length;s++)r=n?t[s].call(e,r):t[s].call(e);return n?r:void 0}function yA(e){return typeof e=="symbol"?e:"".concat(e)}function wA(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function vA(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function Mt(e,t,r,n){function s(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function o(d){try{c(n.next(d))}catch(h){a(h)}}function l(d){try{c(n.throw(d))}catch(h){a(h)}}function c(d){d.done?i(d.value):s(d.value).then(o,l)}c((n=n.apply(e,t||[])).next())})}function xA(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(d){return l([c,d])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(r=0)),r;)try{if(n=1,s&&(i=c[0]&2?s.return:c[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,c[1])).done)return i;switch(s=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,s=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){r.label=c[1];break}if(c[0]===6&&r.label<i[1]){r.label=i[1],i=c;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(c);break}i[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(d){c=[6,d],s=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var ep=Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};function bA(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&ep(t,e,r)}function wf(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qy(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,i=[],a;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i}function MA(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Qy(arguments[t]));return e}function TA(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),s=0,t=0;t<r;t++)for(var i=arguments[t],a=0,o=i.length;a<o;a++,s++)n[s]=i[a];return n}function EA(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,i;n<s;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function Rl(e){return this instanceof Rl?(this.v=e,this):new Rl(e)}function PA(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(p){return function(m){return Promise.resolve(m).then(p,h)}}function o(p,m){n[p]&&(s[p]=function(y){return new Promise(function(P,g){i.push([p,y,P,g])>1||l(p,y)})},m&&(s[p]=m(s[p])))}function l(p,m){try{c(n[p](m))}catch(y){u(i[0][3],y)}}function c(p){p.value instanceof Rl?Promise.resolve(p.value.v).then(d,h):u(i[0][2],p)}function d(p){l("next",p)}function h(p){l("throw",p)}function u(p,m){p(m),i.shift(),i.length&&l(i[0][0],i[0][1])}}function kA(e){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,i){t[s]=e[s]?function(a){return(r=!r)?{value:Rl(e[s](a)),done:!1}:i?i(a):a}:i}}function SA(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof wf=="function"?wf(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(a){return new Promise(function(o,l){a=e[i](a),s(o,l,a.done,a.value)})}}function s(i,a,o,l){Promise.resolve(l).then(function(c){i({value:c,done:o})},a)}}function CA(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var u4=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},u0=function(e){return u0=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},u0(e)};function $A(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=u0(e),n=0;n<r.length;n++)r[n]!=="default"&&ep(t,e,r[n]);return u4(t,e),t}function IA(e){return e&&e.__esModule?e:{default:e}}function AA(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function jA(e,t,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r}function OA(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function NA(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(s=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var d4=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function DA(e){function t(i){e.error=e.hasError?new d4(i,e.error,"An error was suppressed during disposal."):i,e.hasError=!0}var r,n=0;function s(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(s);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(i).then(s,function(a){return t(a),s()})}else n|=1}catch(a){t(a)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return s()}function FA(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,s,i,a){return n?t?".jsx":".js":s&&(!i||!a)?r:s+i+"."+a.toLowerCase()+"js"}):e}const h4={__extends:Hy,__assign:on,__rest:ql,__decorate:pA,__param:mA,__esDecorate:gA,__runInitializers:_A,__propKey:yA,__setFunctionName:wA,__metadata:vA,__awaiter:Mt,__generator:xA,__createBinding:ep,__exportStar:bA,__values:wf,__read:Qy,__spread:MA,__spreadArrays:TA,__spreadArray:EA,__await:Rl,__asyncGenerator:PA,__asyncDelegator:kA,__asyncValues:SA,__makeTemplateObject:CA,__importStar:$A,__importDefault:IA,__classPrivateFieldGet:AA,__classPrivateFieldSet:jA,__classPrivateFieldIn:OA,__addDisposableResource:NA,__disposeResources:DA,__rewriteRelativeImportExtension:FA},f4=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:NA,get __assign(){return on},__asyncDelegator:kA,__asyncGenerator:PA,__asyncValues:SA,__await:Rl,__awaiter:Mt,__classPrivateFieldGet:AA,__classPrivateFieldIn:OA,__classPrivateFieldSet:jA,__createBinding:ep,__decorate:pA,__disposeResources:DA,__esDecorate:gA,__exportStar:bA,__extends:Hy,__generator:xA,__importDefault:IA,__importStar:$A,__makeTemplateObject:CA,__metadata:vA,__param:mA,__propKey:yA,__read:Qy,__rest:ql,__rewriteRelativeImportExtension:FA,__runInitializers:_A,__setFunctionName:wA,__spread:MA,__spreadArray:EA,__spreadArrays:TA,__values:wf,default:h4},Symbol.toStringTag,{value:"Module"})),p4=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class Xy extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class m4 extends Xy{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class IE extends Xy{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class AE extends Xy{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var d0;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(d0||(d0={}));class g4{constructor(t,{headers:r={},customFetch:n,region:s=d0.Any}={}){this.url=t,this.headers=r,this.region=s,this.fetch=p4(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Mt(this,arguments,void 0,function*(r,n={}){var s;let i,a;try{const{headers:o,method:l,body:c,signal:d,timeout:h}=n;let u={},{region:p}=n;p||(p=this.region);const m=new URL(`${this.url}/${r}`);p&&p!=="any"&&(u["x-region"]=p,m.searchParams.set("forceFunctionRegion",p));let y;c&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",y=c):typeof c=="string"?(u["Content-Type"]="text/plain",y=c):typeof FormData<"u"&&c instanceof FormData?y=c:(u["Content-Type"]="application/json",y=JSON.stringify(c)):y=c;let P=d;h&&(a=new AbortController,i=setTimeout(()=>a.abort(),h),d?(P=a.signal,d.addEventListener("abort",()=>a.abort())):P=a.signal);const g=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),o),body:y,signal:P}).catch(M=>{throw new m4(M)}),_=g.headers.get("x-relay-error");if(_&&_==="true")throw new IE(g);if(!g.ok)throw new AE(g);let b=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),w;return b==="application/json"?w=yield g.json():b==="application/octet-stream"||b==="application/pdf"?w=yield g.blob():b==="text/event-stream"?w=g:b==="multipart/form-data"?w=yield g.formData():w=yield g.text(),{data:w,error:null,response:g}}catch(o){return{data:null,error:o,response:o instanceof AE||o instanceof IE?o.context:void 0}}finally{i&&clearTimeout(i)}})}}var qn={};const Kl=q3(f4);var nh={},sh={},ih={},ah={},oh={},lh={},jE;function LA(){if(jE)return lh;jE=1,Object.defineProperty(lh,"__esModule",{value:!0});class e extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return lh.default=e,lh}var OE;function RA(){if(OE)return oh;OE=1,Object.defineProperty(oh,"__esModule",{value:!0});const t=Kl.__importDefault(LA());class r{constructor(s){var i,a;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(i=s.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=s.signal,this.isMaybeSingle=(a=s.isMaybeSingle)!==null&&a!==void 0?a:!1,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=new Headers(this.headers),this.headers.set(s,i),this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let o=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var c,d,h,u;let p=null,m=null,y=null,P=l.status,g=l.statusText;if(l.ok){if(this.method!=="HEAD"){const M=await l.text();M===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((c=this.headers.get("Accept"))===null||c===void 0)&&c.includes("application/vnd.pgrst.plan+text"))?m=M:m=JSON.parse(M))}const b=(d=this.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),w=(h=l.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");b&&w&&w.length>1&&(y=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(p={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,y=null,P=406,g="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const b=await l.text();try{p=JSON.parse(b),Array.isArray(p)&&l.status===404&&(m=[],p=null,P=200,g="OK")}catch{l.status===404&&b===""?(P=204,g="No Content"):p={message:b}}if(p&&this.isMaybeSingle&&(!((u=p==null?void 0:p.details)===null||u===void 0)&&u.includes("0 rows"))&&(p=null,P=200,g="OK"),p&&this.shouldThrowOnError)throw new t.default(p)}return{error:p,data:m,count:y,status:P,statusText:g}});return this.shouldThrowOnError||(o=o.catch(l=>{var c,d,h,u,p,m;let y="";const P=l==null?void 0:l.cause;if(P){const g=(c=P==null?void 0:P.message)!==null&&c!==void 0?c:"",_=(d=P==null?void 0:P.code)!==null&&d!==void 0?d:"";y=`${(h=l==null?void 0:l.name)!==null&&h!==void 0?h:"FetchError"}: ${l==null?void 0:l.message}`,y+=`

Caused by: ${(u=P==null?void 0:P.name)!==null&&u!==void 0?u:"Error"}: ${g}`,_&&(y+=` (${_})`),P!=null&&P.stack&&(y+=`
${P.stack}`)}else y=(p=l==null?void 0:l.stack)!==null&&p!==void 0?p:"";return{error:{message:`${(m=l==null?void 0:l.name)!==null&&m!==void 0?m:"FetchError"}: ${l==null?void 0:l.message}`,details:y,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),o.then(s,i)}returns(){return this}overrideTypes(){return this}}return oh.default=r,oh}var NE;function zA(){if(NE)return ah;NE=1,Object.defineProperty(ah,"__esModule",{value:!0});const t=Kl.__importDefault(RA());class r extends t.default{select(s){let i=!1;const a=(s??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:i=!0,nullsFirst:a,foreignTable:o,referencedTable:l=o}={}){const c=l?`${l}.order`:"order",d=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${d?`${d},`:""}${s}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${s}`),this}range(s,i,{foreignTable:a,referencedTable:o=a}={}){const l=typeof o>"u"?"offset":`${o}.offset`,c=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(c,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:i=!1,settings:a=!1,buffers:o=!1,wal:l=!1,format:c="text"}={}){var d;const h=[s?"analyze":null,i?"verbose":null,a?"settings":null,o?"buffers":null,l?"wal":null].filter(Boolean).join("|"),u=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${u}"; options=${h};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return ah.default=r,ah}var DE;function Jy(){if(DE)return ih;DE=1,Object.defineProperty(ih,"__esModule",{value:!0});const t=Kl.__importDefault(zA()),r=new RegExp("[,()]");class n extends t.default{eq(i,a){return this.url.searchParams.append(i,`eq.${a}`),this}neq(i,a){return this.url.searchParams.append(i,`neq.${a}`),this}gt(i,a){return this.url.searchParams.append(i,`gt.${a}`),this}gte(i,a){return this.url.searchParams.append(i,`gte.${a}`),this}lt(i,a){return this.url.searchParams.append(i,`lt.${a}`),this}lte(i,a){return this.url.searchParams.append(i,`lte.${a}`),this}like(i,a){return this.url.searchParams.append(i,`like.${a}`),this}likeAllOf(i,a){return this.url.searchParams.append(i,`like(all).{${a.join(",")}}`),this}likeAnyOf(i,a){return this.url.searchParams.append(i,`like(any).{${a.join(",")}}`),this}ilike(i,a){return this.url.searchParams.append(i,`ilike.${a}`),this}ilikeAllOf(i,a){return this.url.searchParams.append(i,`ilike(all).{${a.join(",")}}`),this}ilikeAnyOf(i,a){return this.url.searchParams.append(i,`ilike(any).{${a.join(",")}}`),this}regexMatch(i,a){return this.url.searchParams.append(i,`match.${a}`),this}regexIMatch(i,a){return this.url.searchParams.append(i,`imatch.${a}`),this}is(i,a){return this.url.searchParams.append(i,`is.${a}`),this}isDistinct(i,a){return this.url.searchParams.append(i,`isdistinct.${a}`),this}in(i,a){const o=Array.from(new Set(a)).map(l=>typeof l=="string"&&r.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(i,`in.(${o})`),this}contains(i,a){return typeof a=="string"?this.url.searchParams.append(i,`cs.${a}`):Array.isArray(a)?this.url.searchParams.append(i,`cs.{${a.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(a)}`),this}containedBy(i,a){return typeof a=="string"?this.url.searchParams.append(i,`cd.${a}`):Array.isArray(a)?this.url.searchParams.append(i,`cd.{${a.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(a)}`),this}rangeGt(i,a){return this.url.searchParams.append(i,`sr.${a}`),this}rangeGte(i,a){return this.url.searchParams.append(i,`nxl.${a}`),this}rangeLt(i,a){return this.url.searchParams.append(i,`sl.${a}`),this}rangeLte(i,a){return this.url.searchParams.append(i,`nxr.${a}`),this}rangeAdjacent(i,a){return this.url.searchParams.append(i,`adj.${a}`),this}overlaps(i,a){return typeof a=="string"?this.url.searchParams.append(i,`ov.${a}`):this.url.searchParams.append(i,`ov.{${a.join(",")}}`),this}textSearch(i,a,{config:o,type:l}={}){let c="";l==="plain"?c="pl":l==="phrase"?c="ph":l==="websearch"&&(c="w");const d=o===void 0?"":`(${o})`;return this.url.searchParams.append(i,`${c}fts${d}.${a}`),this}match(i){return Object.entries(i).forEach(([a,o])=>{this.url.searchParams.append(a,`eq.${o}`)}),this}not(i,a,o){return this.url.searchParams.append(i,`not.${a}.${o}`),this}or(i,{foreignTable:a,referencedTable:o=a}={}){const l=o?`${o}.or`:"or";return this.url.searchParams.append(l,`(${i})`),this}filter(i,a,o){return this.url.searchParams.append(i,`${a}.${o}`),this}}return ih.default=n,ih}var FE;function BA(){if(FE)return sh;FE=1,Object.defineProperty(sh,"__esModule",{value:!0});const t=Kl.__importDefault(Jy());class r{constructor(s,{headers:i={},schema:a,fetch:o}){this.url=s,this.headers=new Headers(i),this.schema=a,this.fetch=o}select(s,i){const{head:a=!1,count:o}=i??{},l=a?"HEAD":"GET";let c=!1;const d=(s??"*").split("").map(h=>/\s/.test(h)&&!c?"":(h==='"'&&(c=!c),h)).join("");return this.url.searchParams.set("select",d),o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:i,defaultToNull:a=!0}={}){var o;const l="POST";if(i&&this.headers.append("Prefer",`count=${i}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const c=s.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(c.length>0){const d=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",d.join(","))}}return new t.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(s,{onConflict:i,ignoreDuplicates:a=!1,count:o,defaultToNull:l=!0}={}){var c;const d="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),o&&this.headers.append("Prefer",`count=${o}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const h=s.reduce((u,p)=>u.concat(Object.keys(p)),[]);if(h.length>0){const u=[...new Set(h)].map(p=>`"${p}"`);this.url.searchParams.set("columns",u.join(","))}}return new t.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(s,{count:i}={}){var a;const o="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new t.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:s}={}){var i;const a="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new t.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return sh.default=r,sh}var LE;function _4(){if(LE)return nh;LE=1,Object.defineProperty(nh,"__esModule",{value:!0});const e=Kl,t=e.__importDefault(BA()),r=e.__importDefault(Jy());class n{constructor(i,{headers:a={},schema:o,fetch:l}={}){this.url=i,this.headers=new Headers(a),this.schemaName=o,this.fetch=l}from(i){if(!i||typeof i!="string"||i.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const a=new URL(`${this.url}/${i}`);return new t.default(a,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new n(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:o=!1,get:l=!1,count:c}={}){var d;let h;const u=new URL(`${this.url}/rpc/${i}`);let p;o||l?(h=o?"HEAD":"GET",Object.entries(a).filter(([y,P])=>P!==void 0).map(([y,P])=>[y,Array.isArray(P)?`{${P.join(",")}}`:`${P}`]).forEach(([y,P])=>{u.searchParams.append(y,P)})):(h="POST",p=a);const m=new Headers(this.headers);return c&&m.set("Prefer",`count=${c}`),new r.default({method:h,url:u,headers:m,schema:this.schemaName,body:p,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}}return nh.default=n,nh}Object.defineProperty(qn,"__esModule",{value:!0});var UA=qn.PostgrestError=YA=qn.PostgrestBuilder=XA=qn.PostgrestTransformBuilder=HA=qn.PostgrestFilterBuilder=qA=qn.PostgrestQueryBuilder=WA=qn.PostgrestClient=void 0;const Hl=Kl,VA=Hl.__importDefault(_4());var WA=qn.PostgrestClient=VA.default;const GA=Hl.__importDefault(BA());var qA=qn.PostgrestQueryBuilder=GA.default;const KA=Hl.__importDefault(Jy());var HA=qn.PostgrestFilterBuilder=KA.default;const QA=Hl.__importDefault(zA());var XA=qn.PostgrestTransformBuilder=QA.default;const JA=Hl.__importDefault(RA());var YA=qn.PostgrestBuilder=JA.default;const ZA=Hl.__importDefault(LA());UA=qn.PostgrestError=ZA.default;var ej=qn.default={PostgrestClient:VA.default,PostgrestQueryBuilder:GA.default,PostgrestFilterBuilder:KA.default,PostgrestTransformBuilder:QA.default,PostgrestBuilder:JA.default,PostgrestError:ZA.default};const y4=G3({__proto__:null,get PostgrestBuilder(){return YA},get PostgrestClient(){return WA},get PostgrestError(){return UA},get PostgrestFilterBuilder(){return HA},get PostgrestQueryBuilder(){return qA},get PostgrestTransformBuilder(){return XA},default:ej},[qn]),{PostgrestClient:w4,PostgrestQueryBuilder:q8,PostgrestFilterBuilder:K8,PostgrestTransformBuilder:H8,PostgrestBuilder:Q8,PostgrestError:X8}=ej||y4;class v4{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const x4="2.84.0",b4=`realtime-js/${x4}`,tj="1.0.0",M4="2.0.0",RE=tj,h0=1e4,T4=1e3,E4=100;var io;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(io||(io={}));var pn;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(pn||(pn={}));var ni;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(ni||(ni={}));var f0;(function(e){e.websocket="websocket"})(f0||(f0={}));var ao;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(ao||(ao={}));class P4{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast"}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,n,s,i;const a=t.topic,o=(r=t.ref)!==null&&r!==void 0?r:"",l=(n=t.join_ref)!==null&&n!==void 0?n:"",c=t.payload.event,d=(i=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&i!==void 0?i:new ArrayBuffer(0),h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+o.length+a.length+c.length,u=new ArrayBuffer(this.HEADER_LENGTH+h);let p=new DataView(u),m=0;p.setUint8(m++,this.KINDS.userBroadcastPush),p.setUint8(m++,l.length),p.setUint8(m++,o.length),p.setUint8(m++,a.length),p.setUint8(m++,c.length),p.setUint8(m++,this.BINARY_ENCODING),Array.from(l,P=>p.setUint8(m++,P.charCodeAt(0))),Array.from(o,P=>p.setUint8(m++,P.charCodeAt(0))),Array.from(a,P=>p.setUint8(m++,P.charCodeAt(0))),Array.from(c,P=>p.setUint8(m++,P.charCodeAt(0)));var y=new Uint8Array(u.byteLength+d.byteLength);return y.set(new Uint8Array(u),0),y.set(new Uint8Array(d),u.byteLength),y.buffer}_encodeJsonUserBroadcastPush(t){var r,n,s,i;const a=t.topic,o=(r=t.ref)!==null&&r!==void 0?r:"",l=(n=t.join_ref)!==null&&n!==void 0?n:"",c=t.payload.event,d=(i=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&i!==void 0?i:{},u=new TextEncoder().encode(JSON.stringify(d)).buffer,p=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+o.length+a.length+c.length,m=new ArrayBuffer(this.HEADER_LENGTH+p);let y=new DataView(m),P=0;y.setUint8(P++,this.KINDS.userBroadcastPush),y.setUint8(P++,l.length),y.setUint8(P++,o.length),y.setUint8(P++,a.length),y.setUint8(P++,c.length),y.setUint8(P++,this.JSON_ENCODING),Array.from(l,_=>y.setUint8(P++,_.charCodeAt(0))),Array.from(o,_=>y.setUint8(P++,_.charCodeAt(0))),Array.from(a,_=>y.setUint8(P++,_.charCodeAt(0))),Array.from(c,_=>y.setUint8(P++,_.charCodeAt(0)));var g=new Uint8Array(m.byteLength+u.byteLength);return g.set(new Uint8Array(m),0),g.set(new Uint8Array(u),m.byteLength),g.buffer}decode(t,r){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return r(n)}if(typeof t=="string"){const n=JSON.parse(t),[s,i,a,o,l]=n;return r({join_ref:s,ref:i,topic:a,event:o,payload:l})}return r({})}_binaryDecode(t){const r=new DataView(t),n=r.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,s)}}_decodeUserBroadcast(t,r,n){const s=r.getUint8(1),i=r.getUint8(2),a=r.getUint8(3),o=r.getUint8(4);let l=this.HEADER_LENGTH+4;const c=n.decode(t.slice(l,l+s));l=l+s;const d=n.decode(t.slice(l,l+i));l=l+i;const h=n.decode(t.slice(l,l+a));l=l+a;const u=t.slice(l,t.byteLength),p=o===this.JSON_ENCODING?JSON.parse(n.decode(u)):u,m={type:this.BROADCAST_EVENT,event:d,payload:p};return a>0&&(m.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}}class rj{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Mr;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Mr||(Mr={}));const zE=(e,t,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((i,a)=>(i[a]=k4(a,e,t,s),i),{}):{}},k4=(e,t,r,n)=>{const s=t.find(o=>o.name===e),i=s==null?void 0:s.type,a=r[e];return i&&!n.includes(i)?nj(i,a):p0(a)},nj=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return I4(t,r)}switch(e){case Mr.bool:return S4(t);case Mr.float4:case Mr.float8:case Mr.int2:case Mr.int4:case Mr.int8:case Mr.numeric:case Mr.oid:return C4(t);case Mr.json:case Mr.jsonb:return $4(t);case Mr.timestamp:return A4(t);case Mr.abstime:case Mr.date:case Mr.daterange:case Mr.int4range:case Mr.int8range:case Mr.money:case Mr.reltime:case Mr.text:case Mr.time:case Mr.timestamptz:case Mr.timetz:case Mr.tsrange:case Mr.tstzrange:return p0(t);default:return p0(t)}},p0=e=>e,S4=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},C4=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},$4=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},I4=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let i;const a=e.slice(1,r);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>nj(t,o))}return e},A4=e=>typeof e=="string"?e.replace(" ","T"):e,sj=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class rg{constructor(t,r,n={},s=h0){this.channel=t,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var BE;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(BE||(BE={}));class au{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=au.syncState(this.state,s,i,a),this.pendingDiffs.forEach(l=>{this.state=au.syncDiff(this.state,l,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=au.syncDiff(this.state,s,i,a),o())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,s){const i=this.cloneDeep(t),a=this.transformState(r),o={},l={};return this.map(i,(c,d)=>{a[c]||(l[c]=d)}),this.map(a,(c,d)=>{const h=i[c];if(h){const u=d.map(P=>P.presence_ref),p=h.map(P=>P.presence_ref),m=d.filter(P=>p.indexOf(P.presence_ref)<0),y=h.filter(P=>u.indexOf(P.presence_ref)<0);m.length>0&&(o[c]=m),y.length>0&&(l[c]=y)}else o[c]=d}),this.syncDiff(i,{joins:o,leaves:l},n,s)}static syncDiff(t,r,n,s){const{joins:i,leaves:a}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(o,l)=>{var c;const d=(c=t[o])!==null&&c!==void 0?c:[];if(t[o]=this.cloneDeep(l),d.length>0){const h=t[o].map(p=>p.presence_ref),u=d.filter(p=>h.indexOf(p.presence_ref)<0);t[o].unshift(...u)}n(o,d,l)}),this.map(a,(o,l)=>{let c=t[o];if(!c)return;const d=l.map(h=>h.presence_ref);c=c.filter(h=>d.indexOf(h.presence_ref)<0),t[o]=c,s(o,c,l),c.length===0&&delete t[o]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const s=t[n];return"metas"in s?r[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):r[n]=s,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var UE;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(UE||(UE={}));var ou;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(ou||(ou={}));var Ni;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Ni||(Ni={}));class Yy{constructor(t,r={config:{}},n){var s,i;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=pn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new rg(this,ni.join,this.params,this.timeout),this.rejoinTimer=new rj(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=pn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=pn.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=pn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=pn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=pn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ni.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new au(this),this.broadcastEndpointURL=sj(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==pn.closed){const{config:{broadcast:a,presence:o,private:l}}=this.params,c=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(p=>p.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[ou.PRESENCE]&&this.bindings[ou.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},u={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(p=>t==null?void 0:t(Ni.CHANNEL_ERROR,p)),this._onClose(()=>t==null?void 0:t(Ni.CLOSED)),this.updateJoinPayload(Object.assign({config:u},h)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:p})=>{var m;if(this.socket.setAuth(),p===void 0){t==null||t(Ni.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,P=(m=y==null?void 0:y.length)!==null&&m!==void 0?m:0,g=[];for(let _=0;_<P;_++){const b=y[_],{filter:{event:w,schema:M,table:E,filter:T}}=b,S=p&&p[_];if(S&&S.event===w&&S.schema===M&&S.table===E&&S.filter===T)g.push(Object.assign(Object.assign({},b),{id:S.id}));else{this.unsubscribe(),this.state=pn.errored,t==null||t(Ni.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,t&&t(Ni.SUBSCRIBED);return}}).receive("error",p=>{this.state=pn.errored,t==null||t(Ni.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Ni.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===pn.joined&&t===ou.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async httpSend(t,r,n={}){var s;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const a={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(o.status===202)return{success:!0};let l=o.statusText;try{const c=await o.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(t,r={}){var n,s;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:a}=t,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,l;const c=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=pn.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ni.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new rg(this,ni.leave,{},t),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=pn.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),a=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(i),a}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new rg(this,t,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>E4){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var s,i;const a=t.toLocaleLowerCase(),{close:o,error:l,leave:c,join:d}=ni;if(n&&[o,l,c,d].indexOf(a)>=0&&n!==this._joinRef())return;let u=this._onMessage(a,r,n);if(r&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var m,y,P;return((m=p.filter)===null||m===void 0?void 0:m.event)==="*"||((P=(y=p.filter)===null||y===void 0?void 0:y.event)===null||P===void 0?void 0:P.toLocaleLowerCase())===a}).map(p=>p.callback(u,n)):(i=this.bindings[a])===null||i===void 0||i.filter(p=>{var m,y,P,g,_,b;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in p){const w=p.id,M=(m=p.filter)===null||m===void 0?void 0:m.event;return w&&((y=r.ids)===null||y===void 0?void 0:y.includes(w))&&(M==="*"||(M==null?void 0:M.toLocaleLowerCase())===((P=r.data)===null||P===void 0?void 0:P.type.toLocaleLowerCase()))}else{const w=(_=(g=p==null?void 0:p.filter)===null||g===void 0?void 0:g.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return w==="*"||w===((b=r==null?void 0:r.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===a}).map(p=>{if(typeof u=="object"&&"ids"in u){const m=u.data,{schema:y,table:P,commit_timestamp:g,type:_,errors:b}=m;u=Object.assign(Object.assign({},{schema:y,table:P,commit_timestamp:g,eventType:_,new:{},old:{},errors:b}),this._getPayloadRecords(m))}p.callback(u,n)})}_isClosed(){return this.state===pn.closed}_isJoined(){return this.state===pn.joined}_isJoining(){return this.state===pn.joining}_isLeaving(){return this.state===pn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const s=t.toLocaleLowerCase(),i={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&Yy.isEqual(s.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(ni.close,{},t)}_onError(t){this._on(ni.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=pn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=zE(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=zE(t.columns,t.old_record)),r}}const ng=()=>{},ch={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},j4=[1e3,2e3,5e3,1e4],O4=1e4,N4=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class D4{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=h0,this.transport=null,this.heartbeatIntervalMs=ch.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ng,this.ref=0,this.reconnectTimer=null,this.vsn=RE,this.logger=ng,this.conn=null,this.sendBuffer=[],this.serializer=new P4,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${f0.websocket}`,this.httpEndpoint=sj(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=v4.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case io.connecting:return ao.Connecting;case io.open:return ao.Open;case io.closing:return ao.Closing;default:return ao.Closed}}isConnected(){return this.connectionState()===ao.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new Yy(`realtime:${t}`,r,this);return this.channels.push(i),i}}push(t){const{topic:r,event:n,payload:s,ref:i}=t,a=()=>{this.encode(t,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${r} ${n} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(T4,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},ch.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:i,ref:a}=r,o=a?`(${a})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${s} ${o}`.trim(),i),this.channels.filter(c=>c._isMember(n)).forEach(c=>c._trigger(s,i,a)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){if(this.conn){if(this.conn.readyState===io.open||this.conn.readyState===io.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(ni.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${t}${n}${s}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([N4],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const s={access_token:r,version:b4};r&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(ni.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${t} callback`,s)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new rj(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ch.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,s,i,a,o,l,c,d,h,u,p;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:h0,this.heartbeatIntervalMs=(s=t==null?void 0:t.heartbeatIntervalMs)!==null&&s!==void 0?s:ch.HEARTBEAT_INTERVAL,this.worker=(i=t==null?void 0:t.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=t==null?void 0:t.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(o=t==null?void 0:t.heartbeatCallback)!==null&&o!==void 0?o:ng,this.vsn=(l=t==null?void 0:t.vsn)!==null&&l!==void 0?l:RE,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t==null?void 0:t.reconnectAfterMs)!==null&&c!==void 0?c:m=>j4[m-1]||O4,this.vsn){case tj:this.encode=(d=t==null?void 0:t.encode)!==null&&d!==void 0?d:(m,y)=>y(JSON.stringify(m)),this.decode=(h=t==null?void 0:t.decode)!==null&&h!==void 0?h:(m,y)=>y(JSON.parse(m));break;case M4:this.encode=(u=t==null?void 0:t.encode)!==null&&u!==void 0?u:this.serializer.encode.bind(this.serializer),this.decode=(p=t==null?void 0:t.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class Zy extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function Rr(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class F4 extends Zy{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class m0 extends Zy{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}const ew=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),L4=()=>Response,g0=e=>{if(Array.isArray(e))return e.map(r=>g0(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[s]=g0(n)}),t},R4=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},sg=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},z4=(e,t,r)=>Mt(void 0,void 0,void 0,function*(){const n=yield L4();e instanceof n&&!(r!=null&&r.noResolveJson)?e.json().then(s=>{const i=e.status||500,a=(s==null?void 0:s.statusCode)||i+"";t(new F4(sg(s),i,a))}).catch(s=>{t(new m0(sg(s),s))}):t(new m0(sg(e),e))}),B4=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?s:(R4(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,t!=null&&t.duplex&&(s.duplex=t.duplex),Object.assign(Object.assign({},s),r))};function Vu(e,t,r,n,s,i){return Mt(this,void 0,void 0,function*(){return new Promise((a,o)=>{e(r,B4(t,n,s,i)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>z4(l,o,n))})})}function Iu(e,t,r,n){return Mt(this,void 0,void 0,function*(){return Vu(e,"GET",t,r,n)})}function ti(e,t,r,n,s){return Mt(this,void 0,void 0,function*(){return Vu(e,"POST",t,n,s,r)})}function _0(e,t,r,n,s){return Mt(this,void 0,void 0,function*(){return Vu(e,"PUT",t,n,s,r)})}function U4(e,t,r,n){return Mt(this,void 0,void 0,function*(){return Vu(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function tw(e,t,r,n,s){return Mt(this,void 0,void 0,function*(){return Vu(e,"DELETE",t,n,s,r)})}class V4{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return Mt(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Rr(t))return{data:null,error:t};throw t}})}}var ij;class W4{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r,this[ij]="BlobDownloadBuilder",this.promise=null}asStream(){return new V4(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.getPromise().then(t,r)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Mt(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Rr(t))return{data:null,error:t};throw t}})}}ij=Symbol.toStringTag;const G4={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},VE={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class q4{constructor(t,r={},n,s){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=n,this.fetch=ew(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,n,s){return Mt(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},VE),s);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",a.cacheControl),l&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(l))):(i=n,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!a.duplex&&(a.duplex="half")),s!=null&&s.headers&&(o=Object.assign(Object.assign({},o),s.headers));const c=this._removeEmptyFolders(r),d=this._getFinalPath(c),h=yield(t=="PUT"?_0:ti)(this.fetch,`${this.url}/object/${d}`,i,Object.assign({headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:c,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}})}upload(t,r,n){return Mt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,s){return Mt(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(t),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",r);try{let l;const c=Object.assign({upsert:VE.upsert},s),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType);const h=yield _0(this.fetch,o.toString(),l,{headers:d});return{data:{path:i,fullPath:h.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Rr(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(t,r){return Mt(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const s=Object.assign({},this.headers);r!=null&&r.upsert&&(s["x-upsert"]="true");const i=yield ti(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new Zy("No token returned by API");return{data:{signedUrl:a.toString(),path:t,token:o},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Rr(n))return{data:null,error:n};throw n}})}update(t,r,n){return Mt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return Mt(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Rr(s))return{data:null,error:s};throw s}})}copy(t,r,n){return Mt(this,void 0,void 0,function*(){try{return{data:{path:(yield ti(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Rr(s))return{data:null,error:s};throw s}})}createSignedUrl(t,r,n){return Mt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),i=yield ti(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const a=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Rr(s))return{data:null,error:s};throw s}})}createSignedUrls(t,r,n){return Mt(this,void 0,void 0,function*(){try{const s=yield ti(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Rr(s))return{data:null,error:s};throw s}})}download(t,r){const s=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),a=i?`?${i}`:"",o=this._getFinalPath(t),l=()=>Iu(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0});return new W4(l,this.shouldThrowOnError)}info(t){return Mt(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield Iu(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:g0(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Rr(n))return{data:null,error:n};throw n}})}exists(t){return Mt(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield U4(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Rr(n)&&n instanceof m0){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),s=[],i=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";i!==""&&s.push(i);const o=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${c}`)}}}remove(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield tw(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Rr(r))return{data:null,error:r};throw r}})}list(t,r,n){return Mt(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},G4),r),{prefix:t||""});return{data:yield ti(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Rr(s))return{data:null,error:s};throw s}})}listV2(t,r){return Mt(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield ti(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Rr(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const aj="2.84.0",oj={"X-Client-Info":`storage-js/${aj}`};class K4{constructor(t,r={},n,s){this.shouldThrowOnError=!1;const i=new URL(t);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},oj),r),this.fetch=ew(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return Mt(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(t);return{data:yield Iu(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Rr(r))return{data:null,error:r};throw r}})}getBucket(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield Iu(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Rr(r))return{data:null,error:r};throw r}})}createBucket(t){return Mt(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield ti(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Rr(s))return{data:null,error:s};throw s}})}updateBucket(t,r){return Mt(this,void 0,void 0,function*(){try{return{data:yield _0(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Rr(n))return{data:null,error:n};throw n}})}emptyBucket(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Rr(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield tw(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Rr(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(t){const r={};return t&&("limit"in t&&(r.limit=String(t.limit)),"offset"in t&&(r.offset=String(t.offset)),t.search&&(r.search=t.search),t.sortColumn&&(r.sortColumn=t.sortColumn),t.sortOrder&&(r.sortOrder=t.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}class H4{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},oj),r),this.fetch=ew(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Rr(r))return{data:null,error:r};throw r}})}listBuckets(t){return Mt(this,void 0,void 0,function*(){try{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const n=r.toString(),s=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`;return{data:yield Iu(this.fetch,s,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Rr(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield tw(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Rr(r))return{data:null,error:r};throw r}})}}const rw={"X-Client-Info":`storage-js/${aj}`,"Content-Type":"application/json"};class lj extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function ps(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class ig extends lj{constructor(t,r,n){super(t),this.name="StorageVectorsApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Q4 extends lj{constructor(t,r){super(t),this.name="StorageVectorsUnknownError",this.originalError=r}}var WE;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(WE||(WE={}));const nw=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),X4=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},GE=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),J4=(e,t,r)=>Mt(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const s=e.status||500,i=e;if(typeof i.json=="function")i.json().then(a=>{const o=(a==null?void 0:a.statusCode)||(a==null?void 0:a.code)||s+"";t(new ig(GE(a),s,o))}).catch(()=>{const a=s+"",o=i.statusText||`HTTP ${s} error`;t(new ig(o,s,a))});else{const a=s+"",o=i.statusText||`HTTP ${s} error`;t(new ig(o,s,a))}}else t(new Q4(GE(e),e))}),Y4=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return n?(X4(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,Object.assign(Object.assign({},s),r)):s};function Z4(e,t,r,n,s,i){return Mt(this,void 0,void 0,function*(){return new Promise((a,o)=>{e(r,Y4(t,n,s,i)).then(l=>{if(!l.ok)throw l;if(n!=null&&n.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>a(l)).catch(l=>J4(l,o,n))})})}function ms(e,t,r,n,s){return Mt(this,void 0,void 0,function*(){return Z4(e,"POST",t,n,s,r)})}class eB{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},rw),r),this.fetch=nw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return Mt(this,void 0,void 0,function*(){try{return{data:(yield ms(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}getIndex(t,r){return Mt(this,void 0,void 0,function*(){try{return{data:yield ms(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ps(n))return{data:null,error:n};throw n}})}listIndexes(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield ms(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}deleteIndex(t,r){return Mt(this,void 0,void 0,function*(){try{return{data:(yield ms(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ps(n))return{data:null,error:n};throw n}})}}class tB{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},rw),r),this.fetch=nw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return Mt(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield ms(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}getVectors(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield ms(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}listVectors(t){return Mt(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield ms(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}queryVectors(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield ms(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}deleteVectors(t){return Mt(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield ms(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}}class rB{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},rw),r),this.fetch=nw(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Mt(this,void 0,void 0,function*(){try{return{data:(yield ms(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}getBucket(t){return Mt(this,void 0,void 0,function*(){try{return{data:yield ms(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}listBuckets(){return Mt(this,arguments,void 0,function*(t={}){try{return{data:yield ms(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Mt(this,void 0,void 0,function*(){try{return{data:(yield ms(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ps(r))return{data:null,error:r};throw r}})}}class nB extends rB{constructor(t,r={}){super(t,r.headers||{},r.fetch)}from(t){return new sB(this.url,this.headers,t,this.fetch)}}class sB extends eB{constructor(t,r,n,s){super(t,r,s),this.vectorBucketName=n}createIndex(t){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Mt(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Mt(this,arguments,void 0,function*(r={}){return t.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Mt(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Mt(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new iB(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class iB extends tB{constructor(t,r,n,s,i){super(t,r,i),this.vectorBucketName=n,this.indexName=s}putVectors(t){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Mt(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Mt(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Mt(this,arguments,void 0,function*(r={}){return t.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Mt(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Mt(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class aB extends K4{constructor(t,r={},n,s){super(t,r,n,s)}from(t){return new q4(this.url,this.headers,t,this.fetch)}get vectors(){return new nB(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new H4(this.url+"/iceberg",this.headers,this.fetch)}}const oB="2.84.0";let Gc="";typeof Deno<"u"?Gc="deno":typeof document<"u"?Gc="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Gc="react-native":Gc="node";const lB={"X-Client-Info":`supabase-js-${Gc}/${oB}`},cB={headers:lB},uB={schema:"public"},dB={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},hB={},fB=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),pB=()=>Headers,mB=(e,t,r)=>{const n=fB(r),s=pB();return async(i,a)=>{var o;const l=(o=await t())!==null&&o!==void 0?o:e;let c=new s(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",e),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(i,Object.assign(Object.assign({},a),{headers:c}))}};function gB(e){return e.endsWith("/")?e:e+"/"}function _B(e,t){var r,n;const{db:s,auth:i,realtime:a,global:o}=e,{db:l,auth:c,realtime:d,global:h}=t,u={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},d),a),storage:{},global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},(r=h==null?void 0:h.headers)!==null&&r!==void 0?r:{}),(n=o==null?void 0:o.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return e.accessToken?u.accessToken=e.accessToken:delete u.accessToken,u}function yB(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(gB(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const cj="2.84.0",sl=30*1e3,y0=3,ag=y0*sl,wB="http://localhost:9999",vB="supabase.auth.token",xB={"X-Client-Info":`gotrue-js/${cj}`},w0="X-Supabase-Api-Version",uj={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},bB=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,MB=10*60*1e3;class Au extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function Tt(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class TB extends Au{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function EB(e){return Tt(e)&&e.name==="AuthApiError"}class oo extends Au{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class $a extends Au{constructor(t,r,n,s){super(t,n,s),this.name=r,this.status=n}}class us extends $a{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function PB(e){return Tt(e)&&e.name==="AuthSessionMissingError"}class Jo extends $a{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class uh extends $a{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class dh extends $a{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function kB(e){return Tt(e)&&e.name==="AuthImplicitGrantRedirectError"}class qE extends $a{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class v0 extends $a{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function og(e){return Tt(e)&&e.name==="AuthRetryableFetchError"}class KE extends $a{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class x0 extends $a{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const vf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),HE=` 	
\r=`.split(""),SB=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<HE.length;t+=1)e[HE[t].charCodeAt(0)]=-2;for(let t=0;t<vf.length;t+=1)e[vf[t].charCodeAt(0)]=t;return e})();function QE(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(vf[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(vf[n]),t.queuedBits-=6}}function dj(e,t,r){const n=SB[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function XE(e){const t=[],r=a=>{t.push(String.fromCodePoint(a))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=a=>{IB(a,n,r)};for(let a=0;a<e.length;a+=1)dj(e.charCodeAt(a),s,i);return t.join("")}function CB(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function $B(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}CB(n,t)}}function IB(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function Cl(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};for(let s=0;s<e.length;s+=1)dj(e.charCodeAt(s),r,n);return new Uint8Array(t)}function AB(e){const t=[];return $B(e,r=>t.push(r)),new Uint8Array(t)}function mo(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};return e.forEach(s=>QE(s,r,n)),QE(null,r,n),t.join("")}function jB(e){return Math.round(Date.now()/1e3)+e}function OB(){return Symbol("auth-callback")}const kn=()=>typeof window<"u"&&typeof document<"u",Qa={tested:!1,writable:!1},hj=()=>{if(!kn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Qa.tested)return Qa.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Qa.tested=!0,Qa.writable=!0}catch{Qa.tested=!0,Qa.writable=!1}return Qa.writable};function NB(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,i)=>{t[i]=s})}catch{}return r.searchParams.forEach((n,s)=>{t[s]=n}),t}const fj=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),DB=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",il=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Xa=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},sa=async(e,t)=>{await e.removeItem(t)};class tp{constructor(){this.promise=new tp.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}tp.promiseConstructor=Promise;function lg(e){const t=e.split(".");if(t.length!==3)throw new x0("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!bB.test(t[n]))throw new x0("JWT not in base64url format");return{header:JSON.parse(XE(t[0])),payload:JSON.parse(XE(t[1])),signature:Cl(t[2]),raw:{header:t[0],payload:t[1]}}}async function FB(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function LB(e,t){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await e(i);if(!t(i,null,a)){n(a);return}}catch(a){if(!t(i,a)){s(a);return}}})()})}function RB(e){return("0"+e.toString(16)).substr(-2)}function zB(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let i=0;i<56;i++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(t),Array.from(t,RB).join("")}async function BB(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function UB(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await BB(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Yo(e,t,r=!1){const n=zB();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await il(e,`${t}-code-verifier`,s);const i=await UB(n);return[i,n===i?"plain":"s256"]}const VB=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function WB(e){const t=e.headers.get(w0);if(!t||!t.match(VB))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function GB(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function qB(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const KB=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Zo(e){if(!KB.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function cg(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function HB(e,t){return new Proxy(e,{get:(r,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,s)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,n,s)}})}function JE(e){return JSON.parse(JSON.stringify(e))}const no=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),QB=[502,503,504];async function YE(e){var t;if(!DB(e))throw new v0(no(e),0);if(QB.includes(e.status))throw new v0(no(e),e.status);let r;try{r=await e.json()}catch(i){throw new oo(no(i),i)}let n;const s=WB(e);if(s&&s.getTime()>=uj["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new KE(no(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new us}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new KE(no(r),e.status,r.weak_password.reasons);throw new TB(no(r),e.status||500,n)}const XB=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function At(e,t,r,n){var s;const i=Object.assign({},n==null?void 0:n.headers);i[w0]||(i[w0]=uj["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const a=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(a.redirect_to=n.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await JB(e,t,r+o,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function JB(e,t,r,n,s,i){const a=XB(t,n,s,i);let o;try{o=await e(r,Object.assign({},a))}catch(l){throw console.error(l),new v0(no(l),0)}if(o.ok||await YE(o),n!=null&&n.noResolveJson)return o;try{return await o.json()}catch(l){await YE(l)}}function Zs(e){var t;let r=null;eU(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=jB(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function ZE(e){const t=Zs(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function ha(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function YB(e){return{data:e,error:null}}function ZB(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i}=e,a=ql(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function e2(e){return e}function eU(e){return e.access_token&&e.refresh_token&&e.expires_in}const ug=["global","local","others"];class tU{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=fj(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=ug[0]){if(ug.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ug.join(", ")}`);try{return await At(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Tt(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await At(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:ha})}catch(n){if(Tt(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=ql(t,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await At(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:ZB,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(Tt(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await At(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:ha})}catch(r){if(Tt(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,s,i,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},d=await At(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:e2});if(d.error)throw d.error;const h=await d.json(),u=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,p=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),P=JSON.parse(m.split(";")[1].split("=")[1]);c[`${P}Page`]=y}),c.total=parseInt(u)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(Tt(c))return{data:{users:[]},error:c};throw c}}async getUserById(t){Zo(t);try{return await At(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:ha})}catch(r){if(Tt(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){Zo(t);try{return await At(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:ha})}catch(n){if(Tt(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){Zo(t);try{return await At(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:ha})}catch(n){if(Tt(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){Zo(t.userId);try{const{data:r,error:n}=await At(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(Tt(r))return{data:null,error:r};throw r}}async _deleteFactor(t){Zo(t.userId),Zo(t.id);try{return{data:await At(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(Tt(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,s,i,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},d=await At(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:e2});if(d.error)throw d.error;const h=await d.json(),u=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,p=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),P=JSON.parse(m.split(";")[1].split("=")[1]);c[`${P}Page`]=y}),c.total=parseInt(u)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(Tt(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(t){try{return await At(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Tt(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await At(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Tt(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await At(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Tt(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await At(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Tt(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await At(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Tt(r))return{data:null,error:r};throw r}}}function t2(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const el={debug:!!(globalThis&&hj()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class pj extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class rU extends pj{}async function nU(e,t,r){el.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),el.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){el.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{el.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw el.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new rU(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(el.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function sU(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function mj(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function iU(e){return parseInt(e,16)}function aU(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function oU(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:l,resources:c,scheme:d,uri:h,version:u}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(u!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${u}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const p=mj(e.address),m=d?`${d}://${n}`:n,y=e.statement?`${e.statement}
`:"",P=`${m} wants you to sign in with your Ethereum account:
${p}

${y}`;let g=`URI: ${h}
Version: ${u}
Chain ID: ${r}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(s&&(g+=`
Expiration Time: ${s.toISOString()}`),o&&(g+=`
Not Before: ${o.toISOString()}`),l&&(g+=`
Request ID: ${l}`),c){let _=`
Resources:`;for(const b of c){if(!b||typeof b!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);_+=`
- ${b}`}g+=_}return`${P}
${g}`}class ln extends Error{constructor({message:t,code:r,cause:n,name:s}){var i;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(i=s??(n instanceof Error?n.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=r}}class xf extends ln{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function lU({error:e,options:t}){var r,n,s;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new ln({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new ln({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new ln({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new ln({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new ln({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new ln({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return i.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new ln({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new ln({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const a=window.location.hostname;if(gj(a)){if(i.rp.id!==a)return new ln({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new ln({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new ln({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new ln({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new ln({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function cU({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new ln({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new ln({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(gj(n)){if(r.rpId!==n)return new ln({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new ln({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new ln({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new ln({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class uU{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const dU=new uU;function hU(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=ql(e,["challenge","user","excludeCredentials"]),i=Cl(t).buffer,a=Object.assign(Object.assign({},r),{id:Cl(r.id).buffer}),o=Object.assign(Object.assign({},s),{challenge:i,user:a});if(n&&n.length>0){o.excludeCredentials=new Array(n.length);for(let l=0;l<n.length;l++){const c=n[l];o.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:Cl(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return o}function fU(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=ql(e,["challenge","allowCredentials"]),s=Cl(t).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let a=0;a<r.length;a++){const o=r[a];i.allowCredentials[a]=Object.assign(Object.assign({},o),{id:Cl(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return i}function pU(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:mo(new Uint8Array(e.response.attestationObject)),clientDataJSON:mo(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function mU(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:mo(new Uint8Array(s.authenticatorData)),clientDataJSON:mo(new Uint8Array(s.clientDataJSON)),signature:mo(new Uint8Array(s.signature)),userHandle:s.userHandle?mo(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function gj(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function r2(){var e,t;return!!(kn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function gU(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new xf("Browser returned unexpected credential type",t)}:{data:null,error:new xf("Empty credential response",t)}}catch(t){return{data:null,error:lU({error:t,options:e})}}}async function _U(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new xf("Browser returned unexpected credential type",t)}:{data:null,error:new xf("Empty credential response",t)}}catch(t){return{data:null,error:cU({error:t,options:e})}}}const yU={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},wU={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function bf(...e){const t=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of e)if(s)for(const i in s){const a=s[i];if(a!==void 0)if(Array.isArray(a))n[i]=a;else if(r(a))n[i]=a;else if(t(a)){const o=n[i];t(o)?n[i]=bf(o,a):n[i]=bf(a)}else n[i]=a}return n}function vU(e,t){return bf(yU,e,t||{})}function xU(e,t){return bf(wU,e,t||{})}class bU{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:s},i){try{const{data:a,error:o}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!a)return{data:null,error:o};const l=s??dU.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:c}=a.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${n}`),c.displayName||(c.displayName=c.name)}switch(a.webauthn.type){case"create":{const c=vU(a.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:d,error:h}=await gU({publicKey:c,signal:l});return d?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:d}},error:null}:{data:null,error:h}}case"request":{const c=xU(a.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:d,error:h}=await _U(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:c,signal:l}));return d?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:d}},error:null}:{data:null,error:h}}}}catch(a){return Tt(a)?{data:null,error:a}:{data:null,error:new oo("Unexpected error in challenge",a)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!r)return{data:null,error:new Au("rpId is required for WebAuthn authentication")};try{if(!r2())return{data:null,error:new oo("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:i});if(!a)return{data:null,error:o};const{webauthn:l}=a;return this._verify({factorId:t,challengeId:a.challengeId,webauthn:{type:l.type,rpId:r,rpOrigins:n,credential_response:l.credential_response}})}catch(a){return Tt(a)?{data:null,error:a}:{data:null,error:new oo("Unexpected error in authenticate",a)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!r)return{data:null,error:new Au("rpId is required for WebAuthn registration")};try{if(!r2())return{data:null,error:new oo("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this._enroll({friendlyName:t});if(!a)return await this.client.mfa.listFactors().then(d=>{var h;return(h=d.data)===null||h===void 0?void 0:h.all.find(u=>u.factor_type==="webauthn"&&u.friendly_name===t&&u.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:o};const{data:l,error:c}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:i});return l?this._verify({factorId:a.id,challengeId:l.challengeId,webauthn:{rpId:r,rpOrigins:n,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(a){return Tt(a)?{data:null,error:a}:{data:null,error:new oo("Unexpected error in register",a)}}}}sU();const MU={url:wB,storageKey:vB,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:xB,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function n2(e,t,r){return await r()}const tl={};class ju{get jwks(){var t,r;return(r=(t=tl[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){tl[this.storageKey]=Object.assign(Object.assign({},tl[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=tl[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){tl[this.storageKey]=Object.assign(Object.assign({},tl[this.storageKey]),{cachedAt:t})}constructor(t){var r,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},MU),t);if(this.storageKey=i.storageKey,this.instanceID=(r=ju.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,ju.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&kn()){const a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new tU({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=fj(i.fetch),this.lock=i.lock||n2,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:kn()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=nU:this.lock=n2,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new bU(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:hj()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=t2(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=t2(this.memoryStorage)),kn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${cj}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},n="none";if(kn()&&(r=NB(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),kn()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(r,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),kB(i)){const l=(t=i.details)===null||t===void 0?void 0:t.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Tt(r)?this._returnResult({error:r}):this._returnResult({error:new oo("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,s;try{const i=await At(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.captchaToken}},xform:Zs}),{data:a,error:o}=i;if(o||!a)return this._returnResult({data:{user:null,session:null},error:o});const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(Tt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(t){var r,n,s;try{let i;if("email"in t){const{email:d,password:h,options:u}=t;let p=null,m=null;this.flowType==="pkce"&&([p,m]=await Yo(this.storage,this.storageKey)),i=await At(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:u==null?void 0:u.emailRedirectTo,body:{email:d,password:h,data:(r=u==null?void 0:u.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:p,code_challenge_method:m},xform:Zs})}else if("phone"in t){const{phone:d,password:h,options:u}=t;i=await At(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(n=u==null?void 0:u.data)!==null&&n!==void 0?n:{},channel:(s=u==null?void 0:u.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:Zs})}else throw new uh("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return this._returnResult({data:{user:null,session:null},error:o});const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(Tt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(t){try{let r;if("email"in t){const{email:i,password:a,options:o}=t;r=await At(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ZE})}else if("phone"in t){const{phone:i,password:a,options:o}=t;r=await At(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ZE})}else throw new uh("You must provide either an email or phone number and a password");const{data:n,error:s}=r;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const i=new Jo;return this._returnResult({data:{user:null,session:null},error:i})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(Tt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,n,s,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,s,i,a,o,l,c,d,h,u;let p,m;if("message"in t)p=t.message,m=t.signature;else{const{chain:y,wallet:P,statement:g,options:_}=t;let b;if(kn())if(typeof P=="object")b=P;else{const A=window;if("ethereum"in A&&typeof A.ethereum=="object"&&"request"in A.ethereum&&typeof A.ethereum.request=="function")b=A.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof P!="object"||!(_!=null&&_.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=P}const w=new URL((r=_==null?void 0:_.url)!==null&&r!==void 0?r:window.location.href),M=await b.request({method:"eth_requestAccounts"}).then(A=>A).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!M||M.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const E=mj(M[0]);let T=(n=_==null?void 0:_.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!T){const A=await b.request({method:"eth_chainId"});T=iU(A)}const S={domain:w.host,address:E,statement:g,uri:w.href,version:"1",chainId:T,nonce:(s=_==null?void 0:_.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(a=(i=_==null?void 0:_.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(o=_==null?void 0:_.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(l=_==null?void 0:_.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=_==null?void 0:_.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(d=_==null?void 0:_.signInWithEthereum)===null||d===void 0?void 0:d.resources};p=oU(S),m=await b.request({method:"personal_sign",params:[aU(p),E]})}try{const{data:y,error:P}=await At(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:m},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(u=t.options)===null||u===void 0?void 0:u.captchaToken}}:null),xform:Zs});if(P)throw P;if(!y||!y.session||!y.user){const g=new Jo;return this._returnResult({data:{user:null,session:null},error:g})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:P})}catch(y){if(Tt(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(t){var r,n,s,i,a,o,l,c,d,h,u,p;let m,y;if("message"in t)m=t.message,y=t.signature;else{const{chain:P,wallet:g,statement:_,options:b}=t;let w;if(kn())if(typeof g=="object")w=g;else{const E=window;if("solana"in E&&typeof E.solana=="object"&&("signIn"in E.solana&&typeof E.solana.signIn=="function"||"signMessage"in E.solana&&typeof E.solana.signMessage=="function"))w=E.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=g}const M=new URL((r=b==null?void 0:b.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in w&&w.signIn){const E=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b==null?void 0:b.signInWithSolana),{version:"1",domain:M.host,uri:M.href}),_?{statement:_}:null));let T;if(Array.isArray(E)&&E[0]&&typeof E[0]=="object")T=E[0];else if(E&&typeof E=="object"&&"signedMessage"in E&&"signature"in E)T=E;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)m=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),y=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${M.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${M.href}`,`Issued At: ${(s=(n=b==null?void 0:b.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=b==null?void 0:b.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((a=b==null?void 0:b.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((o=b==null?void 0:b.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b==null?void 0:b.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b==null?void 0:b.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((h=(d=b==null?void 0:b.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",...b.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const E=await w.signMessage(new TextEncoder().encode(m),"utf8");if(!E||!(E instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=E}}try{const{data:P,error:g}=await At(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:mo(y)},!((u=t.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(p=t.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Zs});if(g)throw g;if(!P||!P.session||!P.user){const _=new Jo;return this._returnResult({data:{user:null,session:null},error:_})}return P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("SIGNED_IN",P.session)),this._returnResult({data:Object.assign({},P),error:g})}catch(P){if(Tt(P))return this._returnResult({data:{user:null,session:null},error:P});throw P}}async _exchangeCodeForSession(t){const r=await Xa(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:i,error:a}=await At(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Zs});if(await sa(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!i||!i.session||!i.user){const o=new Jo;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:a})}catch(i){if(Tt(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(t){try{const{options:r,provider:n,token:s,access_token:i,nonce:a}=t,o=await At(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Zs}),{data:l,error:c}=o;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const d=new Jo;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(r){if(Tt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,n,s,i,a;try{if("email"in t){const{email:o,options:l}=t;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await Yo(this.storage,this.storageKey));const{error:h}=await At(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in t){const{phone:o,options:l}=t,{data:c,error:d}=await At(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d})}throw new uh("You must provide either an email or phone number.")}catch(o){if(Tt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(t){var r,n;try{let s,i;"options"in t&&(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo,i=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:a,error:o}=await At(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Zs});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(Tt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(t){var r,n,s,i,a;try{let o=null,l=null;this.flowType==="pkce"&&([o,l]=await Yo(this.storage,this.storageKey));const c=await At(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=t==null?void 0:t.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:l}),headers:this.headers,xform:YB});return!((i=c.data)===null||i===void 0)&&i.url&&kn()&&!(!((a=t.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(o){if(Tt(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new us;const{error:s}=await At(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(t){if(Tt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:s,options:i}=t,{error:a}=await At(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in t){const{phone:n,type:s,options:i}=t,{data:a,error:o}=await At(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o})}throw new uh("You must provide either an email or phone number and a type")}catch(r){if(Tt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Xa(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<ag:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const a=await Xa(this.userStorage,this.storageKey+"-user");a!=null&&a.user?t.user=a.user:t.user=cg()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};t.user=HB(t.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:s,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await At(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:ha}):await this._useSession(async r=>{var n,s,i;const{data:a,error:o}=r;if(o)throw o;return!(!((n=a.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new us}:await At(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:ha})})}catch(r){if(Tt(r))return PB(r)&&(await this._removeSession(),await sa(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new us;const a=s.session;let o=null,l=null;this.flowType==="pkce"&&t.email!=null&&([o,l]=await Yo(this.storage,this.storageKey));const{data:c,error:d}=await At(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:ha});if(d)throw d;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(n){if(Tt(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new us;const r=Date.now()/1e3;let n=r,s=!0,i=null;const{payload:a}=lg(t.access_token);if(a.exp&&(n=a.exp,s=n<=r),s){const{data:o,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:l}=await this._getUser(t.access_token);if(l)throw l;i={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(r){if(Tt(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:a,error:o}=r;if(o)throw o;t=(n=a.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new us;const{data:s,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(Tt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!kn())throw new dh("No browser detected.");if(t.error||t.error_description||t.error_code)throw new dh(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new qE("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new dh("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new qE("No code detected.");const{data:_,error:b}=await this._exchangeCodeForSession(t.code);if(b)throw b;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=t;if(!i||!o||!a||!c)throw new dh("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(o);let u=d+h;l&&(u=parseInt(l));const p=u-d;p*1e3<=sl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${h}s`);const m=u-h;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,d);const{data:y,error:P}=await this._getUser(i);if(P)throw P;const g={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:u,refresh_token:a,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:t.type},error:null})}catch(n){if(Tt(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Xa(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({error:i});const a=(n=s.session)===null||n===void 0?void 0:n.access_token;if(a){const{error:o}=await this.admin.signOut(a,t);if(o&&!(EB(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return t!=="others"&&(await this._removeSession(),await sa(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=OB(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,s;try{const{data:{session:i},error:a}=r;if(a)throw a;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Yo(this.storage,this.storageKey,!0));try{return await At(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(i){if(Tt(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(Tt(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:s}=await this._useSession(async i=>{var a,o,l,c,d;const{data:h,error:u}=i;if(u)throw u;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(a=t.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await At(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return kn()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:t.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(Tt(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:i}}=r;if(s)throw s;const{options:a,provider:o,token:l,access_token:c,nonce:d}=t,h=await At(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=i==null?void 0:i.access_token)!==null&&n!==void 0?n:void 0,body:{provider:o,id_token:l,access_token:c,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Zs}),{data:u,error:p}=h;return p?this._returnResult({data:{user:null,session:null},error:p}):!u||!u.session||!u.user?this._returnResult({data:{user:null,session:null},error:new Jo}):(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("USER_UPDATED",u.session)),this._returnResult({data:u,error:p}))}catch(s){if(Tt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,s;const{data:i,error:a}=r;if(a)throw a;return await At(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(Tt(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await LB(async s=>(s>0&&await FB(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await At(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Zs})),(s,i)=>{const a=200*Math.pow(2,s);return i&&og(i)&&Date.now()+a-n<sl})}catch(n){if(this._debug(r,"error",n),Tt(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),kn()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Xa(this.storage,this.storageKey);if(s&&this.userStorage){let a=await Xa(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:s.user},await il(this.userStorage,this.storageKey+"-user",a)),s.user=(t=a==null?void 0:a.user)!==null&&t!==void 0?t:cg()}else if(s&&!s.user&&!s.user){const a=await Xa(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(s.user=a.user,await sa(this.storage,this.storageKey+"-user"),await il(this.storage,this.storageKey,s)):s.user=cg()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const i=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<ag;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${ag}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),og(a)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(s.access_token);!o&&(a!=null&&a.user)?(s.user=a.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(n,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new us;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new tp;const{data:i,error:a}=await this._refreshAccessToken(t);if(a)throw a;if(!i.session)throw new us;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={data:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(s,"error",i),Tt(i)){const a={data:null,error:i};return og(i)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(a),a}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,r,n=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,r)}catch(l){i.push(l)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await il(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const i=JE(s);await il(this.storage,this.storageKey,i)}else{const s=JE(r);await il(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await sa(this.storage,this.storageKey),await sa(this.storage,this.storageKey+"-code-verifier"),await sa(this.storage,this.storageKey+"-user"),this.userStorage&&await sa(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&kn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),sl);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-t)/sl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${sl}ms, refresh threshold is ${y0} ticks`),s<=y0&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof pj)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!kn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,a]=await Yo(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(o.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;return i?this._returnResult({data:null,error:i}):await At(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Tt(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,s;const{data:i,error:a}=r;if(a)return this._returnResult({data:null,error:a});const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:l,error:c}=await At(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return c?this._returnResult({data:null,error:c}):(t.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(r){if(Tt(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?pU(t.webauthn.credential_response):mU(t.webauthn.credential_response)})}:{code:t.code}),{data:o,error:l}=await At(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:a,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:l}))})}catch(r){if(Tt(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({data:null,error:i});const a=await At(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(a.error)return a;const{data:o}=a;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:hU(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:fU(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(Tt(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:n},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=lg(n.access_token);let a=null;i.aal&&(a=i.aal);let o=a;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(o="aal2");const c=i.amr||[];return{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:c},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await At(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new us})})}catch(r){if(Tt(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new us});const a=await At(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&kn()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(n){if(Tt(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new us});const a=await At(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&kn()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(n){if(Tt(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await At(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new us})})}catch(t){if(Tt(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await At(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new us})})}catch(r){if(Tt(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(o=>o.kid===t);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(o=>o.kid===t),n&&this.jwks_cached_at+MB>s)return n;const{data:i,error:a}=await At(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,n=i.keys.find(o=>o.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:p,error:m}=await this.getSession();if(m||!p.session)return this._returnResult({data:null,error:m});n=p.session.access_token}const{header:s,payload:i,signature:a,raw:{header:o,payload:l}}=lg(n);r!=null&&r.allowExpired||GB(i.exp);const c=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!c){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:i,header:s,signature:a},error:null}}const d=qB(s.alg),h=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,a,AB(`${o}.${l}`)))throw new x0("Invalid JWT signature");return{data:{claims:i,header:s,signature:a},error:null}}catch(n){if(Tt(n))return this._returnResult({data:null,error:n});throw n}}}ju.nextInstanceID={};const TU=ju;class EU extends TU{constructor(t){super(t)}}class PU{constructor(t,r,n){var s,i,a;this.supabaseUrl=t,this.supabaseKey=r;const o=yB(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const l=`sb-${o.hostname.split(".")[0]}-auth-token`,c={db:uB,realtime:hB,auth:Object.assign(Object.assign({},dB),{storageKey:l}),global:cB},d=_B(n??{},c);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=d.auth)!==null&&a!==void 0?a:{},this.headers,d.global.fetch),this.fetch=mB(r,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.accessToken&&this.accessToken().then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new w4(new URL("rest/v1",o).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new aB(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new g4(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,r;if(this.accessToken)return await this.accessToken();const{data:n}=await this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:i,storageKey:a,flowType:o,lock:l,debug:c,throwOnError:d},h,u){const p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new EU({url:this.authUrl.href,headers:Object.assign(Object.assign({},p),h),storageKey:a,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:i,flowType:o,lock:l,debug:c,throwOnError:d,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new D4(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const kU=(e,t,r)=>new PU(e,t,r);function SU(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}SU()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const CU="tfsvsxrjegvfikimqhcm",$U=`https://${CU}.supabase.co`,IU="sb_publishable_ee95QrAoD9WzceuegHbHPg_TAeaI7sG",qe=kU($U,IU),_j=()=>localStorage.getItem("trek_demo_mode")==="true",sw=()=>_j()?"trek_demo_store_v1":"trek_user_cache_v1";let cr,zn=[],Mn=[],ss=[],yn=[],is=[],pr=[],as=[],ci=[];const iw=()=>{_j()?(cr={id:"demo-user",name:"Adventurer",username:"demo_user_01",email:"demo@trekmaster.ai",avatar:"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&w=200&q=80",isCurrentUser:!0,activePackId:"pack-1",subscription:{plan:"free",isActive:!1}},zn=[{id:"plan-1",ownerId:"demo-user",name:"Yubeng Village Trek",status:"Active",startDate:new Date().toISOString(),days:[],teammates:[cr],isTeamPlan:!1}],Mn=[{id:"day-1",plan_id:"plan-1",day_number:1,start_loc:"Feilai Temple",end_loc:"Xidang",distance_km:12,elevation_gain:400,elevation_loss:100},{id:"day-2",plan_id:"plan-1",day_number:2,start_loc:"Xidang",end_loc:"Upper Yubeng",distance_km:14,elevation_gain:1200,elevation_loss:200},{id:"day-3",plan_id:"plan-1",day_number:3,start_loc:"Upper Yubeng",end_loc:"Ice Lake",distance_km:16,elevation_gain:800,elevation_loss:800}],ss=[{id:"wp-1",day_id:"day-1",type:"start",name:"Feilai Temple",created_at:new Date().toISOString()},{id:"wp-2",day_id:"day-1",type:"stop",name:"Mekong Viewpoint",created_at:new Date(Date.now()+1e3).toISOString()},{id:"wp-3",day_id:"day-1",type:"end",name:"Xidang Hot Springs",created_at:new Date(Date.now()+2e3).toISOString()}],yn=[{id:"g-1",ownerId:"demo-user",name:"Osprey Atmos 65",category:fr.CARRYING,weightGrams:2100,price:2200,brand:"Osprey",imageUrl:"https://images.unsplash.com/photo-1553062407-98eeb64c6a62?auto=format&fit=crop&w=500&q=80",gridCols:2,gridRows:4},{id:"g-2",ownerId:"demo-user",name:"Big Agnes Copper Spur",category:fr.SLEEPING,weightGrams:1400,price:3500,brand:"Big Agnes",imageUrl:"https://images.unsplash.com/photo-1517849845537-4d257902454a?auto=format&fit=crop&w=500&q=80",gridCols:2,gridRows:2},{id:"g-3",ownerId:"demo-user",name:"Jetboil Flash",category:fr.COOKING,weightGrams:371,price:800,brand:"Jetboil",imageUrl:"https://images.unsplash.com/photo-1584992236310-6edddc08acff?auto=format&fit=crop&w=500&q=80",gridCols:1,gridRows:2},{id:"g-4",ownerId:"demo-user",name:"Arc'teryx Beta AR",category:fr.CLOTHING,weightGrams:460,price:4500,brand:"Arc'teryx",imageUrl:"https://images.unsplash.com/photo-1523381210434-271e8be1f52b?auto=format&fit=crop&w=500&q=80",gridCols:1,gridRows:2},{id:"g-5",ownerId:"demo-user",name:"Power Bank 10k",category:fr.ELECTRONICS,weightGrams:200,price:150,brand:"Anker",imageUrl:"https://images.unsplash.com/photo-1525547719571-a2d4ac8945e2?auto=format&fit=crop&w=500&q=80",gridCols:1,gridRows:1},{id:"g-6",ownerId:"demo-user",name:"Dehydrated Meal",category:fr.FOOD,weightGrams:150,price:60,brand:"Mountain House",imageUrl:"https://images.unsplash.com/photo-1506368249639-73a05d6f6488?auto=format&fit=crop&w=500&q=80",isConsumable:!0,consumableValue:100,gridCols:1,gridRows:1},{id:"g-7",ownerId:"demo-user",name:"First Aid Kit",category:fr.MISC,weightGrams:300,price:200,brand:"Adventure Medical",imageUrl:"https://images.unsplash.com/photo-1585338107529-13afc5f02586?auto=format&fit=crop&w=500&q=80",gridCols:1,gridRows:1},{id:"g-8",ownerId:"demo-user",name:"Multi-tool",category:fr.TOOLS,weightGrams:200,price:300,brand:"Leatherman",imageUrl:"https://images.unsplash.com/photo-1581147036324-c17ac41dfa6c?auto=format&fit=crop&w=500&q=80",gridCols:1,gridRows:1},{id:"g-9",ownerId:"demo-user",name:"Headlamp",category:fr.LIGHTING,weightGrams:80,price:120,brand:"Black Diamond",imageUrl:"https://images.unsplash.com/photo-1505624197193-22178267d206?auto=format&fit=crop&w=500&q=80",gridCols:1,gridRows:1}],is=[{id:"pack-1",ownerId:"demo-user",name:"Main Loadout",isDefault:!0,gridCols:6,gridRows:8,gearId:"g-1",items:[],totalWeight:0}],pr=[{id:"pi-1",pack_id:"pack-1",gear_id:"g-2",quantity:1,grid_x:0,grid_y:0},{id:"pi-2",pack_id:"pack-1",gear_id:"g-3",quantity:1,grid_x:2,grid_y:0},{id:"pi-3",pack_id:"pack-1",gear_id:"g-4",quantity:1,grid_x:3,grid_y:0},{id:"pi-4",pack_id:"pack-1",gear_id:"g-5",quantity:1,grid_x:0,grid_y:2},{id:"pi-5",pack_id:"pack-1",gear_id:"g-6",quantity:2,grid_x:1,grid_y:2,consumableValue:100},{id:"pi-6",pack_id:"pack-1",gear_id:"g-8",quantity:1,grid_x:2,grid_y:2},{id:"pi-7",pack_id:"pack-1",gear_id:"g-9",quantity:1,grid_x:3,grid_y:2}],as=[],ci=[{plan_id:"plan-1",pack_id:"pack-1"}]):(cr={id:"",name:"Loading...",avatar:"",isCurrentUser:!0},zn=[],Mn=[],ss=[],yn=[],is=[],pr=[],as=[],ci=[])},Gt=()=>{try{const e={user:cr,plans:zn,days:Mn,waypoints:ss,gearInventory:yn,packs:is,packItems:pr,waypointItems:as,planPacks:ci};localStorage.setItem(sw(),JSON.stringify(e))}catch(e){console.error("Failed to save state",e)}},yj=()=>{try{const e=localStorage.getItem(sw());if(e){const t=JSON.parse(e);t.user&&(cr=t.user),Array.isArray(t.plans)&&(zn=t.plans),Array.isArray(t.days)&&(Mn=t.days),Array.isArray(t.waypoints)&&(ss=t.waypoints),Array.isArray(t.gearInventory)&&(yn=t.gearInventory),Array.isArray(t.packs)&&(is=t.packs),Array.isArray(t.packItems)&&(pr=t.packItems),Array.isArray(t.waypointItems)&&(as=t.waypointItems),Array.isArray(t.planPacks)&&(ci=t.planPacks)}}catch(e){console.error("Failed to load state",e)}};iw();yj();const Kr=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e=="x"?t:t&3|8;return r.toString(16)}),Io=(e,t,r)=>{var s;if((s=cr.subscription)!=null&&s.isActive)return{};const n={INVENTORY:15,PACKS:1,PACK_ITEMS:30,PLANS:1,PLAN_DAYS:5,WAYPOINTS:5};return e==="inventory"&&yn.length>=n.INVENTORY?{error:`Free limit reached (${n.INVENTORY} items). Upgrade to Pro.`}:e==="packs"&&is.length>=n.PACKS?{error:`Free limit reached (${n.PACKS} pack). Upgrade to Pro.`}:e==="plans"&&zn.length>=n.PLANS?{error:`Free limit reached (${n.PLANS} plan). Upgrade to Pro.`}:e==="planDays"&&t&&Mn.filter(a=>a.plan_id===t).length>=n.PLAN_DAYS?{error:`Free limit reached (${n.PLAN_DAYS} days). Upgrade to Pro.`}:e==="waypoints"&&t&&ss.filter(a=>a.day_id===t).length>=n.WAYPOINTS?{error:`Free limit reached (${n.WAYPOINTS} waypoints/day). Upgrade to Pro.`}:e==="packItems"&&t&&!pr.find(a=>a.pack_id===t&&a.gear_id===r)&&pr.filter(o=>o.pack_id===t).length>=n.PACK_ITEMS?{error:`Free pack limit reached (${n.PACK_ITEMS} items). Upgrade to Pro.`}:{}},AU=e=>{cr=e,Gt()},jU=e=>{e.name&&(cr.name=e.name),e.username&&(cr.username=e.username),e.avatarUrl&&(cr.avatar=e.avatarUrl),Gt()},OU=e=>{yn=e,Gt()},NU=e=>{is=e,Gt()},DU=e=>{pr=e,Gt()},FU=e=>{zn=e,Gt()},LU=e=>{Mn=e,Gt()},RU=e=>{ss=e,Gt()},zU=e=>{as=e,Gt()},BU=e=>{ci=e,Gt()},wj=()=>cr,UU=()=>{iw(),yj(),Gt()},VU=()=>{localStorage.removeItem(sw()),iw()},vj=async()=>({user:cr,plans:zn,days:Mn,waypoints:ss,gearInventory:yn,packs:is,packItems:pr,waypointItems:as,planPacks:ci,version:1,timestamp:new Date().toISOString()}),WU=async e=>{if(!e||!e.version)return{error:"Invalid data file"};try{return e.user&&(cr.name=e.user.name||cr.name,cr.subscription=e.user.subscription||cr.subscription,cr.activePackId=e.user.activePackId),zn=e.plans||[],Mn=e.days||[],ss=e.waypoints||[],yn=e.gearInventory||[],is=e.packs||[],pr=e.packItems||[],as=e.waypointItems||[],ci=e.planPacks||[],Gt(),{success:!0}}catch(t){return{error:t.message}}},GU=async e=>{if(e.toLowerCase()==="vip2025"){const t=new Date;return t.setFullYear(t.getFullYear()+1),cr.subscription={plan:"pro_yearly",isActive:!0,expiryDate:t.toISOString()},Gt(),{success:!0,type:"pro_yearly"}}if(e.toLowerCase()==="monthfree"){const t=new Date;return t.setMonth(t.getMonth()+1),cr.subscription={plan:"pro_monthly",isActive:!0,expiryDate:t.toISOString()},Gt(),{success:!0,type:"pro_monthly"}}return{success:!1,message:"Invalid activation code"}},qU=async e=>{const t=new Date;return e==="pro_yearly"?t.setFullYear(t.getFullYear()+1):t.setMonth(t.getMonth()+1),cr.subscription={plan:e,isActive:!0,expiryDate:t.toISOString()},Gt(),{success:!0}},KU=async e=>null,HU=async()=>({error:"Not available in demo"}),QU=async()=>[],XU=async()=>[],JU=async()=>({error:null}),YU=async()=>({error:null}),ZU=async()=>[],e5=async()=>({leaderId:cr.id,isLeader:!0}),t5=async()=>[{...cr,status:"joined",role:"Leader"}],r5=async()=>({error:"Not available in demo"}),n5=async()=>({error:null}),s5=async()=>({error:null}),i5=async()=>[],a5=async()=>({status:"joined",error:null}),o5=async()=>({error:null}),dg=async()=>{const e=zn.find(n=>n.status==="Active")||zn[0];if(!e)return{id:"temp",ownerId:cr.id,name:"New Trek",status:"Planned",startDate:new Date().toISOString(),days:[],teammates:[cr]};const r=Mn.filter(n=>n.plan_id===e.id).sort((n,s)=>n.day_number-s.day_number).map(n=>{const s=ss.filter(i=>i.day_id===n.id).sort((i,a)=>i.type==="start"?-1:a.type==="start"||i.type==="end"?1:a.type==="end"?-1:new Date(i.created_at).getTime()-new Date(a.created_at).getTime());return{id:n.id,day:n.day_number,start:n.start_loc,end:n.end_loc,distanceKm:n.distance_km,elevationGain:n.elevation_gain,elevationLoss:n.elevation_loss,waypoints:s.map(i=>{const a=as.filter(o=>o.waypoint_id===i.id).map(o=>{const l=yn.find(c=>c.id===o.gear_id);return{id:o.id,gearId:o.gear_id,quantity:o.quantity||1,gear:l}});return{id:i.id,dayId:n.id,name:i.name,type:i.type,items:a}})}});return{...e,days:r,teammates:[cr]}},l5=async()=>zn.map(e=>({...e,days:[],teammates:[]})),s2=async(e,t)=>{const r={id:t||Kr(),ownerId:cr.id,name:e,status:"Planned",startDate:new Date().toISOString(),days:[],teammates:[cr],isTeamPlan:!1};return zn.push(r),Mn.push({id:Kr(),plan_id:r.id,day_number:1,distance_km:0,elevation_gain:0,elevation_loss:0,start_loc:"Start",end_loc:"Camp"}),Gt(),{data:r,error:null}},i2=async e=>(zn=zn.filter(t=>t.id!==e),Mn=Mn.filter(t=>t.plan_id!==e),Gt(),{error:null}),a2=async e=>{zn.forEach(t=>t.status=t.id===e?"Active":"Planned"),Gt()},o2=async(e,t)=>{const r=zn.find(n=>n.id===e);return r&&Object.assign(r,t),Gt(),{error:null}},l2=async(e,t)=>{const r=Mn.find(n=>n.id===e);return r&&(t.distanceKm!==void 0&&(r.distance_km=t.distanceKm),t.elevationGain!==void 0&&(r.elevation_gain=t.elevationGain),t.elevationLoss!==void 0&&(r.elevation_loss=t.elevationLoss),t.startLoc!==void 0&&(r.start_loc=t.startLoc),t.endLoc!==void 0&&(r.end_loc=t.endLoc)),Gt(),{error:null}},c2=async(e,t,r)=>(Mn.push({id:r||Kr(),plan_id:e,day_number:t,distance_km:0,elevation_gain:0,elevation_loss:0,start_loc:"Start",end_loc:"Camp"}),Gt(),{error:null}),u2=async e=>{const t=Mn.findIndex(s=>s.id===e);if(t===-1)return{error:null};const r=Mn[t].plan_id;return Mn.splice(t,1),Mn.filter(s=>s.plan_id===r).sort((s,i)=>s.day_number-i.day_number).forEach((s,i)=>s.day_number=i+1),Gt(),{error:null}},d2=async(e,t,r)=>(ss.push({id:r||Kr(),day_id:e,type:"stop",name:t,created_at:new Date().toISOString()}),Gt(),{error:null}),h2=async e=>(ss=ss.filter(t=>t.id!==e),Gt(),{error:null}),f2=async(e,t,r)=>(as.push({id:r||Kr(),waypoint_id:e,gear_id:t,quantity:1}),Gt(),{error:null}),p2=async e=>(as=as.filter(t=>t.id!==e),Gt(),{error:null}),m2=async(e,t,r,n)=>{let s=ss.find(i=>i.day_id===e&&i.type===t);return s||(s={id:Kr(),day_id:e,type:t,name:t==="start"?"Start Location":"Camp Location",created_at:new Date().toISOString()},ss.push(s)),as.push({id:n||Kr(),waypoint_id:s.id,gear_id:r,quantity:1}),Gt(),{error:null}},c5=async()=>yn,u5=async()=>is.map(e=>{const t=yn.find(n=>n.id===e.gearId),r=pr.filter(n=>n.pack_id===e.id).map(n=>({gearId:n.gear_id,quantity:n.quantity,checked:!1,gridX:n.grid_x,gridY:n.grid_y}));return{...e,backpackGear:t,items:r}}),d5=async()=>{const e=is.find(n=>n.id===cr.activePackId)||is[0];if(!e)return{pack:{},items:[]};const t=pr.filter(n=>n.pack_id===e.id).map(n=>{const s=yn.find(i=>i.id===n.gear_id);return s?{...s,quantity:n.quantity,packItemId:n.id,gridX:n.grid_x??0,gridY:n.grid_y??0,consumableValue:n.consumableValue??s.consumableValue}:null}).filter(Boolean),r=yn.find(n=>n.id===e.gearId);return{pack:{...e,backpackGear:r,items:[]},items:t}},g2=async e=>{const t=e.id||Kr();return yn.push({...e,id:t}),Gt(),{...e,id:t}},_2=async e=>{const t=yn.findIndex(r=>r.id===e.id);t!==-1&&(yn[t]=e),Gt()},y2=async e=>(yn=yn.filter(t=>t.id!==e),pr=pr.filter(t=>t.gear_id!==e),as=as.filter(t=>t.gear_id!==e),is.forEach(t=>{t.gearId===e&&(t.gearId=void 0)}),Gt(),{error:null}),w2=async(e,t,r,n,s)=>{const i={id:s||Kr(),ownerId:e,name:t,gridCols:r,gridRows:n,isDefault:!1,items:[],totalWeight:0};return is.push(i),Gt(),i},v2=async(e,t)=>{const r=is.find(n=>n.id===e);r&&Object.assign(r,t),Gt()},x2=async(e,t)=>{cr.activePackId=t,Gt()},b2=async(e,t,r,n)=>{const s=pr.find(i=>i.pack_id===e&&i.gear_id===t);s?(s.quantity+=r,s.quantity<=0&&(pr=pr.filter(i=>i.id!==s.id))):r>0&&pr.push({id:n||Kr(),pack_id:e,gear_id:t,quantity:r,grid_x:0,grid_y:0}),Gt()},M2=async(e,t,r)=>{const n=pr.find(s=>s.id===e);n&&(n.grid_x=t,n.grid_y=r),Gt()},T2=async(e,t)=>{const r=pr.find(n=>n.id===e);r&&(r.consumableValue=t),Gt()},E2=async(e,t,r,n,s,i,a)=>{const o=pr.find(l=>l.id===t);o&&(o.quantity-=n,pr.push({id:a||Kr(),pack_id:e,gear_id:r,quantity:n,grid_x:s,grid_y:i,consumableValue:o.consumableValue}),o.quantity<=0&&(pr=pr.filter(l=>l.id!==t)),Gt())},P2=async(e,t)=>{const r=pr.find(s=>s.id===e),n=pr.find(s=>s.id===t);r&&n&&(n.quantity+=r.quantity,pr=pr.filter(s=>s.id!==e)),Gt()},xj=async e=>ci.filter(t=>t.plan_id===e).map(t=>t.pack_id),k2=async(e,t,r)=>(r?ci.push({plan_id:e,pack_id:t}):ci=ci.filter(n=>!(n.plan_id===e&&n.pack_id===t)),Gt(),{error:null}),h5=async e=>{const t=await xj(e),n=pr.filter(i=>t.includes(i.pack_id)).map(i=>yn.find(a=>a.id===i.gear_id)).filter(Boolean),s=new Map;return n.forEach(i=>s.set(i.id,i)),Array.from(s.values())},Ft=()=>localStorage.getItem("trek_demo_mode")==="true",Pi=e=>{if(!e)return"Unknown error";if(typeof e=="string")return e;if(e.message)return e.message;try{return JSON.stringify(e)}catch{return"Object error"}},Mf=(e,t,r)=>Io(e,t,r),f5={[fr.SLEEPING]:"https://images.unsplash.com/photo-1517849845537-4d257902454a?auto=format&fit=crop&w=500&q=80",[fr.CARRYING]:"https://images.unsplash.com/photo-1553062407-98eeb64c6a62?auto=format&fit=crop&w=500&q=80",[fr.CLOTHING]:"https://images.unsplash.com/photo-1523381210434-271e8be1f52b?auto=format&fit=crop&w=500&q=80",[fr.COOKING]:"https://images.unsplash.com/photo-1584992236310-6edddc08acff?auto=format&fit=crop&w=500&q=80",[fr.ELECTRONICS]:"https://images.unsplash.com/photo-1525547719571-a2d4ac8945e2?auto=format&fit=crop&w=500&q=80",[fr.FOOD]:"https://images.unsplash.com/photo-1506368249639-73a05d6f6488?auto=format&fit=crop&w=500&q=80",[fr.TOOLS]:"https://images.unsplash.com/photo-1581147036324-c17ac41dfa6c?auto=format&fit=crop&w=500&q=80",[fr.LIGHTING]:"https://images.unsplash.com/photo-1505624197193-22178267d206?auto=format&fit=crop&w=500&q=80",[fr.MISC]:"https://images.unsplash.com/photo-1585338107529-13afc5f02586?auto=format&fit=crop&w=500&q=80"},p5=async(e,t)=>{if(Ft())return jU(t),{error:null};const r={};t.name&&(r.full_name=t.name),t.username&&(r.username=t.username),t.avatarUrl&&(r.avatar_url=t.avatarUrl);try{const{error:n}=await qe.from("profiles").update(r).eq("id",e);return n?n.code==="23505"?{error:"Username already taken"}:{error:n.message}:{error:null}}catch(n){return{error:Pi(n)}}},Tf=async()=>{if(Ft())return;const{data:e,error:t}=await qe.auth.getUser();if(t||!e.user){t&&console.warn("Sync failed: Auth invalid",t.message);return}const r=e.user;try{const{data:n}=await qe.from("profiles").select("*").eq("id",r.id).single(),{data:s}=await qe.from("user_subscriptions").select("*").eq("user_id",r.id).maybeSingle();if(n){let l=!1,c="free",d;s&&(l=s.status==="active",s.current_period_end&&(new Date(s.current_period_end)<new Date&&(l=!1),d=s.current_period_end),l&&(c=s.plan_id)),AU({id:n.id,name:n.full_name||"User",username:n.username||"user_"+n.id.substring(0,8),email:n.email,avatar:n.avatar_url,isCurrentUser:!0,activePackId:n.active_pack_id,subscription:{plan:c,expiryDate:d,isActive:l}})}const{data:i}=await qe.from("gear_items").select("*").eq("owner_id",r.id);i&&OU(i.map(Q5));const{data:a}=await qe.from("packs").select("*").eq("owner_id",r.id);if(a){const l=a.map(d=>({id:d.id,ownerId:d.owner_id,name:d.name,isDefault:d.is_default,gridCols:d.grid_cols,gridRows:d.grid_rows,gearId:d.gear_id,items:[],totalWeight:0}));NU(l);const c=a.map(d=>d.id);if(c.length>0){const{data:d}=await qe.from("pack_items").select("*").in("pack_id",c);if(d){const h=d.map(u=>({id:u.id,pack_id:u.pack_id,gear_id:u.gear_id,quantity:u.quantity,checked:u.checked,grid_x:u.grid_x??0,grid_y:u.grid_y??0,consumableValue:u.consumable_value}));DU(h)}}}const{data:o}=await qe.from("trek_plans").select("*").eq("owner_id",r.id);if(o){const l=o.map(d=>({id:d.id,ownerId:d.owner_id,name:d.name,status:d.status,startDate:d.start_date,days:[],teammates:[]}));FU(l);const c=o.map(d=>d.id);if(c.length>0){const{data:d}=await qe.from("plan_days").select("*").in("plan_id",c);d&&LU(d);const h=d?d.map(p=>p.id):[];if(h.length>0){const{data:p}=await qe.from("plan_waypoints").select("*").in("day_id",h);p&&RU(p);const m=p?p.map(y=>y.id):[];if(m.length>0){const{data:y}=await qe.from("waypoint_items").select("*").in("waypoint_id",m);y&&zU(y)}}const{data:u}=await qe.from("plan_packs").select("*").in("plan_id",c);u&&BU(u)}}}catch(n){console.error("Sync failed",n)}},m5=async()=>vj(),g5=async e=>Ft()?WU(e):{error:"Import only available in Demo Mode"},_5=async e=>{if(Ft())return GU(e);try{const{data:t,error:r}=await qe.rpc("redeem_activation_code",{code_input:e.trim()});return r?(console.error("Redemption error:",r),{success:!1,message:"Server error processing code."}):t&&t.success?(await Tf(),{success:!0,type:t.type}):{success:!1,message:(t==null?void 0:t.message)||"Invalid or used code."}}catch{return{success:!1,message:"Network error."}}},y5=async e=>Ft()?qU(e):{success:!1,message:"Online payments coming soon. Please use an Activation Code."},w5=async e=>{if(Ft())return KU();try{const{data:t,error:r}=await qe.from("profiles").select("*").ilike("email",e).limit(1).maybeSingle();return r||!t?null:{id:t.id,name:t.full_name,username:t.username,email:t.email,avatar:t.avatar_url,isCurrentUser:!1}}catch{return null}},v5=async(e,t)=>{if(Ft())return HU();if(e===t)return{error:"Cannot add yourself"};try{const{data:r}=await qe.from("friendships").select("*").or(`and(user_id.eq.${e},friend_id.eq.${t}),and(user_id.eq.${t},friend_id.eq.${e})`).maybeSingle();if(r){if(r.status==="pending")return{error:"Request already pending"};if(r.status==="accepted")return{error:"Already in contacts"}}const{error:n}=await qe.from("friendships").insert({user_id:e,friend_id:t,status:"pending"});return{error:n?Pi(n):null}}catch(r){return{error:Pi(r)}}},x5=async()=>{if(Ft())return QU();try{const{data:{user:e}}=await qe.auth.getUser();if(!e)return[];const{data:t,error:r}=await qe.from("friendships").select("id, user_id, created_at, requester: profiles!friendships_user_id_fkey (id, full_name, username, avatar_url, email)").eq("friend_id",e.id).eq("status","pending");return r?[]:t.map(n=>({friendshipId:n.id,requester:{id:n.requester.id,name:n.requester.full_name,username:n.requester.username,avatar:n.requester.avatar_url,email:n.requester.email},sentAt:n.created_at}))}catch{return[]}},b5=async()=>{if(Ft())return XU();try{const{data:{user:e}}=await qe.auth.getUser();if(!e)return[];const{data:t,error:r}=await qe.from("friendships").select("friend_id, friend: profiles!friendships_friend_id_fkey (id, full_name, username, avatar_url, email)").eq("user_id",e.id).eq("status","pending");return r?[]:t.map(n=>({id:n.friend.id,name:n.friend.full_name,username:n.friend.username,avatar:n.friend.avatar_url,email:n.friend.email,isCurrentUser:!1}))}catch{return[]}},M5=async(e,t)=>{if(Ft())return JU();if(t){const{error:r}=await qe.from("friendships").update({status:"accepted"}).eq("id",e);return{error:r}}else{const{error:r}=await qe.from("friendships").delete().eq("id",e);return{error:r}}},T5=async(e,t)=>{if(Ft())return YU();try{return await qe.from("friendships").delete().eq("user_id",e).eq("friend_id",t),await qe.from("friendships").delete().eq("user_id",t).eq("friend_id",e),{error:null}}catch(r){return{error:Pi(r)}}},E5=async()=>{if(Ft())return ZU();try{const{data:{user:e}}=await qe.auth.getUser();if(!e)return[];const{data:t}=await qe.from("friendships").select("friend_id").eq("user_id",e.id).eq("status","accepted"),{data:r}=await qe.from("friendships").select("user_id").eq("friend_id",e.id).eq("status","accepted"),n=[...(t||[]).map(a=>a.friend_id),...(r||[]).map(a=>a.user_id)],s=Array.from(new Set(n));if(s.length===0)return[];const{data:i}=await qe.from("profiles").select("*").in("id",s);return i?i.map(a=>({id:a.id,name:a.full_name||"Unknown",username:a.username,email:a.email,avatar:a.avatar_url,activePackId:a.active_pack_id,isCurrentUser:!1})):[]}catch{return[]}},P5=async()=>{if(Ft())return e5();const{data:{user:e}}=await qe.auth.getUser();if(!e)throw new Error("Not authenticated");const{data:t}=await qe.from("trek_team").select("leader_id").eq("user_id",e.id).eq("status","joined").neq("leader_id",e.id).limit(1).maybeSingle();return t?{leaderId:t.leader_id,isLeader:!1}:{leaderId:e.id,isLeader:!0}},k5=async e=>{if(Ft())return t5();const{data:{user:t}}=await qe.auth.getUser(),{data:r}=await qe.from("trek_team").select("user_id, status, leader_id").eq("leader_id",e);if(!r||r.length===0)return[];const n=r.map(i=>i.user_id),{data:s}=await qe.from("profiles").select("*").in("id",n);return s?s.map(i=>{const a=r.find(l=>l.user_id===i.id),o=e===i.id;return{id:i.id,name:i.full_name,username:i.username,email:i.email,avatar:i.avatar_url,activePackId:i.active_pack_id,isCurrentUser:(t==null?void 0:t.id)===i.id,status:(a==null?void 0:a.status)||"joined",role:o?"Leader":"Member"}}).sort((i,a)=>i.role==="Leader"?-1:1):[]},S5=async e=>{if(Ft())return r5();const{data:{user:t}}=await qe.auth.getUser();if(!t)return{error:"Not authenticated"};try{const{data:r}=await qe.from("trek_team").select("*").eq("leader_id",t.id).eq("user_id",t.id).maybeSingle();r||await qe.from("trek_team").insert({leader_id:t.id,user_id:t.id,status:"joined"});const{error:n}=await qe.from("trek_team").insert({leader_id:t.id,user_id:e,status:"invited"});return{error:n?Pi(n):null}}catch(r){return{error:Pi(r)}}},C5=async e=>{if(Ft())return n5();const{data:{user:t}}=await qe.auth.getUser();if(!t)return{error:"Not authenticated"};try{const{error:r}=await qe.from("trek_team").delete().eq("leader_id",t.id).eq("user_id",e);if(r)throw r;const{count:n}=await qe.from("trek_team").select("*",{count:"exact",head:!0}).eq("leader_id",t.id);return n!==null&&n<=1&&await qe.from("trek_team").delete().eq("leader_id",t.id),{error:null}}catch(r){return{error:Pi(r)}}},bj=async e=>{if(Ft())return s5();const{data:{user:t}}=await qe.auth.getUser();if(!t)return{error:"Not authenticated"};try{if(t.id===e){const{data:r}=await qe.from("trek_team").select("user_id, status, created_at").eq("leader_id",e).neq("user_id",t.id).eq("status","joined").order("created_at",{ascending:!0}),n=r&&r.length>0?r[0]:null;if(n){const{error:s}=await qe.from("trek_team").update({leader_id:n.user_id}).eq("leader_id",e);if(s)throw s;await qe.from("trek_team").delete().eq("leader_id",n.user_id).eq("user_id",t.id)}else{const{error:s}=await qe.from("trek_team").delete().eq("leader_id",e);if(s)throw s}}else{const{error:r}=await qe.from("trek_team").delete().eq("leader_id",e).eq("user_id",t.id);if(r)throw r}return{error:null}}catch(r){return{error:Pi(r)}}},$5=async()=>{if(Ft())return i5();const{data:{user:e}}=await qe.auth.getUser();if(!e)return[];const{data:t,error:r}=await qe.from("trek_team").select("leader_id, leader: profiles!trek_team_leader_id_fkey (full_name, username)").eq("user_id",e.id).eq("status","invited");return r||!t?[]:t.map(n=>{var s,i;return{leaderId:n.leader_id,leaderName:((s=n.leader)==null?void 0:s.full_name)||((i=n.leader)==null?void 0:i.username)||"Unknown"}})},I5=async(e,t)=>{if(Ft())return a5();const{data:{user:r}}=await qe.auth.getUser();if(!r)return{error:"Auth"};if(!t)return await qe.from("trek_team").delete().eq("leader_id",e).eq("user_id",r.id),{status:"rejected",error:null};const{data:n}=await qe.from("trek_team").select("leader_id").eq("user_id",r.id).eq("status","joined").neq("leader_id",e).maybeSingle();if(n)return{status:"requires_switch_confirmation",currentLeaderId:n.leader_id,error:null};const{error:s}=await qe.from("trek_team").update({status:"joined"}).eq("leader_id",e).eq("user_id",r.id);return{status:"joined",error:s?Pi(s):null}},A5=async(e,t)=>{if(Ft())return o5();const{data:{user:r}}=await qe.auth.getUser();if(!r)return{error:"Auth"};const n=await bj(e);if(n.error)return n;const{error:s}=await qe.from("trek_team").update({status:"joined"}).eq("leader_id",t).eq("user_id",r.id);return{error:s?Pi(s):null}},j5=async(e,t)=>{if(Ft())return o2(e,t);const r={};return t.name&&(r.name=t.name),t.status&&(r.status=t.status),t.startDate&&(r.start_date=t.startDate),o2(e,t),qe.from("trek_plans").update(r).eq("id",e).then(({error:n})=>{n&&console.error("Sync failed updatePlanMetadata",n)}),{error:null}},O5=async(e,t)=>{if(Ft())return l2(e,t);const r={};return t.distanceKm!==void 0&&(r.distance_km=t.distanceKm),t.elevationGain!==void 0&&(r.elevation_gain=t.elevationGain),t.elevationLoss!==void 0&&(r.elevation_loss=t.elevationLoss),t.startLoc!==void 0&&(r.start_loc=t.startLoc),t.endLoc!==void 0&&(r.end_loc=t.endLoc),l2(e,t),qe.from("plan_days").update(r).eq("id",e).then(({error:n})=>{n&&console.error("Sync failed updatePlanDay",n)}),{error:null}},N5=async(e,t)=>{const r=Io("planDays",e);if(r.error)return{error:r.error};if(Ft())return c2(e,t);const n=Kr();return c2(e,t,n),qe.from("plan_days").insert({id:n,plan_id:e,day_number:t,distance_km:0,elevation_gain:0,elevation_loss:0,start_loc:"Start",end_loc:"Camp"}).then(({error:s})=>{s&&console.error("Sync failed addPlanDay",s)}),{error:null}},D5=async e=>Ft()?u2(e):(u2(e),(async()=>{const{data:t}=await qe.from("plan_days").select("plan_id").eq("id",e).single();if(await qe.from("plan_days").delete().eq("id",e),t&&t.plan_id){const{data:r}=await qe.from("plan_days").select("id, day_number").eq("plan_id",t.plan_id).order("day_number");if(r)for(let n=0;n<r.length;n++)r[n].day_number!==n+1&&await qe.from("plan_days").update({day_number:n+1}).eq("id",r[n].id)}})(),{error:null}),F5=async(e,t,r)=>Ft()?k2(e,t,r):(k2(e,t,r),r?qe.from("plan_packs").insert({plan_id:e,pack_id:t}).then(({error:n})=>{n&&console.error("Sync failed togglePlanPack",n)}):qe.from("plan_packs").delete().eq("plan_id",e).eq("pack_id",t).then(({error:n})=>{n&&console.error("Sync failed togglePlanPack",n)}),{error:null}),L5=async e=>xj(e),R5=async e=>h5(e),z5=async(e,t)=>{const r=Io("waypoints",e);if(r.error)return{error:r.error};if(Ft())return d2(e,t);const n=Kr();return d2(e,t,n),qe.from("plan_waypoints").insert({id:n,day_id:e,name:t,type:"stop"}).then(({error:s})=>{s&&console.error("Sync failed addWaypoint",s)}),{error:null}},B5=async e=>Ft()?h2(e):(h2(e),qe.from("plan_waypoints").delete().eq("id",e).then(({error:t})=>{t&&console.error("Sync failed deleteWaypoint",t)}),{error:null}),U5=async(e,t)=>{if(Ft())return f2(e,t);const r=Kr();return f2(e,t,r),qe.from("waypoint_items").insert({id:r,waypoint_id:e,gear_id:t}).then(({error:n})=>{n&&console.error("Sync failed addGearToWaypoint",n)}),{error:null}},V5=async e=>Ft()?p2(e):(p2(e),qe.from("waypoint_items").delete().eq("id",e).then(({error:t})=>{t&&console.error("Sync failed removeGearFromWaypoint",t)}),{error:null}),W5=async(e,t,r)=>{if(Ft())return m2(e,t,r);const{waypoints:n}=await vj();let s=n.find(o=>o.day_id===e&&o.type===t),i=s==null?void 0:s.id;i||(i=Kr());const a=Kr();return m2(e,t,r,a),(async()=>{const{data:o}=await qe.from("plan_waypoints").select("id").eq("day_id",e).eq("type",t).maybeSingle();let l=o==null?void 0:o.id;if(!l){const c=t==="start"?"Start Location":"Camp Location",{data:d}=await qe.from("plan_waypoints").upsert({day_id:e,type:t,name:c},{onConflict:"day_id, type"}).select().single();l=d.id}await qe.from("waypoint_items").insert({id:a,waypoint_id:l,gear_id:r})})(),{error:null}},rp=async()=>{if(Ft())return dg();const e=await dg();return e.id!=="temp"&&e.id!=="demo"?e:(await Tf(),dg())},G5=async()=>l5(),q5=async e=>{const t=Io("plans");if(t.error)return{data:null,error:t.error};if(Ft())return s2(e);const{data:{user:r}}=await qe.auth.getUser();if(!r)return null;const n=Kr();return s2(e,n),qe.from("trek_plans").insert({id:n,owner_id:r.id,name:e,status:"Planned",start_date:new Date().toISOString()}).then(({error:s})=>{s?console.error("Sync failed createTrekPlan",s):(Kr(),qe.from("plan_days").insert([{plan_id:n,day_number:1,distance_km:0,elevation_gain:0,elevation_loss:0}]))}),{data:{id:n},error:null}},K5=async e=>Ft()?i2(e):(i2(e),qe.from("trek_plans").delete().eq("id",e).then(({error:t})=>{t&&console.error("Sync failed deleteTrekPlan",t)}),{error:null}),H5=async e=>{if(Ft())return a2(e);const{data:{user:t}}=await qe.auth.getUser();t&&(a2(e),(async()=>(await qe.from("trek_plans").update({status:"Planned"}).eq("owner_id",t.id),await qe.from("trek_plans").update({status:"Active"}).eq("id",e)))())},Q5=e=>e?{id:e.id,ownerId:e.owner_id,name:e.name,category:e.category,weightGrams:e.weight_grams,price:e.price,imageUrl:e.image_url||f5[e.category],brand:e.brand,isConsumable:e.is_consumable,consumableValue:e.consumable_value??100,description:e.description,gridCols:e.grid_cols||1,gridRows:e.grid_rows||1}:{},Mj=async e=>c5(),Tj=async e=>u5(),X5=async e=>d5(),J5=async(e,t)=>{if(Ft())return x2(e,t);x2(e,t),qe.from("profiles").update({active_pack_id:t}).eq("id",e).then(({error:r})=>{r&&console.error("Sync failed setActivePack",r)})},Y5=async e=>{const t=Io("inventory");if(t.error)return{error:t.error};if(Ft())return g2(e),{error:null};const r={...e,id:e.id||Kr()},n={id:r.id,owner_id:r.ownerId,name:r.name,category:r.category,weight_grams:r.weightGrams,price:r.price,brand:r.brand,image_url:r.imageUrl,is_consumable:r.isConsumable,consumable_value:r.consumableValue,grid_cols:r.gridCols,grid_rows:r.gridRows};return g2(r),qe.from("gear_items").insert(n).then(({error:s})=>{s&&console.error("Sync failed addGearToInventory",s)}),{error:null}},Z5=async e=>{if(Ft())return _2(e);const t={name:e.name,category:e.category,weight_grams:e.weightGrams,price:e.price,brand:e.brand,image_url:e.imageUrl,is_consumable:e.isConsumable,consumable_value:e.consumableValue,grid_cols:e.gridCols,grid_rows:e.gridRows};_2(e),qe.from("gear_items").update(t).eq("id",e.id).then(({error:r})=>{r&&console.error("Sync failed updateGearItem",r)})},eV=async e=>Ft()?y2(e):(y2(e),qe.from("gear_items").delete().eq("id",e).then(({error:t})=>{t&&console.error("Sync failed deleteGearItem",t)}),{error:null}),tV=async(e,t,r,n,s)=>{const i=Io("packs");if(i.error)return{data:null,error:i.error};if(Ft())return{data:await w2(e,t,r,n),error:null};const a=Kr();return w2(e,t,r,n,a),qe.from("packs").insert({id:a,owner_id:e,name:t,grid_cols:r,grid_rows:n}).then(({error:o})=>{o&&console.error("Sync failed createPack",o)}),{data:{id:a,ownerId:e,name:t,gridCols:r,gridRows:n,isDefault:!1,items:[],totalWeight:0},error:null}},rl=async(e,t,r)=>{if(r>0){const s=Io("packItems",e,t);if(s.error)return{error:s.error}}if(Ft())return b2(e,t,r),{error:null};const n=Kr();return b2(e,t,r,n),(async()=>{const{data:s}=await qe.from("pack_items").select("*").eq("pack_id",e).eq("gear_id",t).maybeSingle();if(s){const i=s.quantity+r;i<=0?await qe.from("pack_items").delete().eq("id",s.id):await qe.from("pack_items").update({quantity:i}).eq("id",s.id)}else r>0&&await qe.from("pack_items").insert({id:n,pack_id:e,gear_id:t,quantity:r,grid_x:0,grid_y:0,consumable_value:100})})(),{error:null}},S2=async(e,t)=>{if(Ft())return v2(e,t);const r={};t.name&&(r.name=t.name),t.gridCols&&(r.grid_cols=t.gridCols),t.gridRows&&(r.grid_rows=t.gridRows),t.gearId!==void 0&&(r.gear_id=t.gearId),v2(e,t),qe.from("packs").update(r).eq("id",e).then(({error:n})=>{n&&console.error("Sync failed updatePackDetails",n)})},rV=async(e,t)=>{if(Ft())return T2(e,t);T2(e,t),qe.from("pack_items").update({consumable_value:t}).eq("id",e).then(({error:r})=>{r&&console.error("Sync failed updateConsumableValue",r)})},C2=async(e,t,r)=>{if(Ft())return M2(e,t,r);M2(e,t,r),qe.from("pack_items").update({grid_x:t,grid_y:r}).eq("id",e).then(({error:n})=>{n&&console.error("Sync failed movePackItem",n)})},nV=async(e,t,r,n,s,i)=>{if(Ft())return E2(e,t,r,n,s,i);const a=Kr();E2(e,t,r,n,s,i,a),(async()=>{const{data:o}=await qe.from("pack_items").select("quantity, consumable_value").eq("id",t).single();if(!o)return;const l=o.quantity-n;l>0&&(await qe.from("pack_items").update({quantity:l}).eq("id",t),await qe.from("pack_items").insert({id:a,pack_id:e,gear_id:r,quantity:n,grid_x:s,grid_y:i,consumable_value:o.consumable_value}))})()},sV=async(e,t)=>{if(Ft())return P2(e,t);P2(e,t),(async()=>{const{data:r}=await qe.from("pack_items").select("quantity").eq("id",e).single(),{data:n}=await qe.from("pack_items").select("quantity").eq("id",t).single();r&&n&&(await qe.from("pack_items").update({quantity:n.quantity+r.quantity}).eq("id",t),await qe.from("pack_items").delete().eq("id",e))})()},iV=async(e,t)=>{const{data:r,error:n}=await qe.auth.signInWithPassword({email:e,password:t});return n?{user:null,error:n.message}:r.user?{user:{id:r.user.id,email:r.user.email,name:r.user.user_metadata.full_name||e.split("@")[0],avatar:r.user.user_metadata.avatar_url||"https://picsum.photos/seed/user/200",isCurrentUser:!0},error:null}:{user:null,error:"Unknown error"}},aV=async(e,t,r)=>{const{data:n,error:s}=await qe.auth.signUp({email:e,password:t,options:{data:{full_name:r,avatar_url:`https://picsum.photos/seed/${Math.random()}/200`}}});return s?{user:null,error:s.message}:n.user?{user:{id:n.user.id,email:n.user.email,name:r,avatar:n.user.user_metadata.avatar_url,isCurrentUser:!0},error:null}:{user:null,error:"Signup failed"}},oV=async()=>(localStorage.setItem("trek_demo_mode","true"),UU(),wj()),lV=async()=>{if(localStorage.getItem("trek_demo_mode")){localStorage.removeItem("trek_demo_mode"),VU();return}await qe.auth.signOut(),localStorage.removeItem("trek_user")},aw=async()=>{var e,t;if(localStorage.getItem("trek_demo_mode")==="true")return wj();try{const{data:r,error:n}=await qe.auth.getSession();if(n)return console.warn("Session error, clearing storage:",n.message),await qe.auth.signOut(),null;if((e=r.session)!=null&&e.user){const s=r.session.user,{data:i}=await qe.from("profiles").select("*").eq("id",s.id).single(),{data:a}=await qe.from("user_subscriptions").select("*").eq("user_id",s.id).maybeSingle(),o=(i==null?void 0:i.full_name)||s.user_metadata.full_name||((t=s.email)==null?void 0:t.split("@")[0])||"User",l=(i==null?void 0:i.avatar_url)||s.user_metadata.avatar_url||"https://picsum.photos/seed/user/200",c=i==null?void 0:i.username;let d={plan:"free",isActive:!1,expiryDate:void 0};if(a){let h=a.status==="active";a.current_period_end&&new Date(a.current_period_end)<new Date&&(h=!1),d={plan:h?a.plan_id:"free",isActive:h,expiryDate:a.current_period_end}}return{id:s.id,email:s.email,name:o,username:c,avatar:l,isCurrentUser:!0,activePackId:i==null?void 0:i.active_pack_id,subscription:d}}}catch(r){return console.error("Unexpected error checking session:",r),null}return null},cV=({splitData:e,setSplitData:t,onClose:r,onConfirm:n})=>f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-6",children:f.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-xs p-6 shadow-2xl",children:[f.jsx("h3",{className:"text-lg font-bold mb-4 text-center",children:"Split Stack"}),f.jsxs("p",{className:"text-xs text-gray-500 text-center mb-4",children:["How many ",f.jsx("b",{children:e.item.name})," to move?"]}),f.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl mb-4",children:[f.jsxs("div",{className:"flex justify-between text-xs font-bold mb-2",children:[f.jsx("span",{children:"Quantity:"}),f.jsx("span",{className:"text-blue-600",children:e.moveQty})]}),f.jsx("input",{type:"range",min:"1",max:e.maxQty-1,value:e.moveQty,onChange:s=>t({...e,moveQty:parseInt(s.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"}),f.jsxs("div",{className:"flex justify-between text-[10px] text-gray-400 mt-1",children:[f.jsx("span",{children:"1"}),f.jsx("span",{children:e.maxQty-1})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[f.jsx("button",{onClick:r,className:"bg-gray-100 text-gray-600 py-2 rounded-xl font-bold text-xs",children:"Cancel"}),f.jsx("button",{onClick:n,className:"bg-blue-600 text-white py-2 rounded-xl font-bold text-xs shadow-lg",children:"Confirm"})]})]})}),Ej=(e,t,r=500)=>{const n=ke.useRef(null),s=ke.useRef(!1),i=ke.useRef(!1),a=ke.useRef(!1),o=ke.useRef(!1),l=ke.useCallback(h=>{h.type==="mousedown"&&i.current||(h.type==="touchstart"&&(i.current=!0),a.current=!0,s.current=!1,o.current=!1,n.current=setTimeout(()=>{a.current&&!o.current&&(s.current=!0,e())},r))},[e,r]),c=ke.useCallback(h=>{a.current&&(a.current=!1,n.current&&(clearTimeout(n.current),n.current=null),!s.current&&!o.current&&t())},[t]),d=ke.useCallback(()=>{a.current&&(o.current=!0,n.current&&(clearTimeout(n.current),n.current=null))},[]);return{onMouseDown:l,onMouseUp:c,onMouseLeave:c,onTouchStart:l,onTouchEnd:c,onTouchMove:d}},uV=({col:e,row:t,selectedPackItemId:r,onLongPress:n,onTap:s})=>{const i=Ej(n,s);return f.jsx("div",{...i,className:`border-[0.5px] border-white/20 ${r?"hover:bg-blue-100/30 cursor-pointer active:bg-blue-200/50":""}`})},dV=({item:e,gridCols:t,gridRows:r,selectedPackItemId:n,showName:s,showWeight:i,showPrice:a,onTap:o})=>{const l=Ej(()=>{},()=>o(e.gridX,e.gridY));return f.jsx("div",{...l,className:`absolute transition-all duration-300 p-[1px] ${n===e.packItemId?"z-50 scale-110 opacity-90":"z-10"}`,style:{left:`${e.gridX/t*100}%`,top:`${e.gridY/r*100}%`,width:`${(e.gridCols||1)/t*100}%`,height:`${(e.gridRows||1)/r*100}%`},children:f.jsxs("div",{className:`w-full h-full rounded transition-all duration-200 overflow-hidden relative group flex flex-col
                ${n===e.packItemId?"bg-white/10 border-blue-500 ring-2 ring-blue-200 border":"border-transparent"}
            `,children:[f.jsx("div",{className:"w-full h-full bg-cover bg-center bg-no-repeat",style:{backgroundImage:`url(${e.imageUrl})`},role:"img","aria-label":e.name}),e.isConsumable&&typeof e.consumableValue=="number"&&e.consumableValue<100&&f.jsxs("div",{className:`absolute top-0 left-0 text-[8px] font-bold px-1 h-3 flex items-center justify-center rounded-br z-20 shadow leading-none text-white ${e.consumableValue<=20?"bg-red-500":"bg-black/50 backdrop-blur-sm"}`,children:[e.consumableValue,"%"]}),(s||i||a)&&f.jsxs("div",{className:"export-text-adjust absolute inset-x-0 bottom-0 px-1.5 flex flex-col justify-end pointer-events-none z-20",children:[s&&f.jsx("div",{className:"text-[10px] font-bold text-white whitespace-nowrap leading-[12px] mb-0.5",style:{textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:e.name}),f.jsxs("div",{className:"flex justify-between items-end leading-[10px]",children:[i&&f.jsxs("div",{className:"text-[9px] text-gray-100 font-medium",style:{textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:[e.weightGrams,"g"]}),a&&f.jsxs("div",{className:"text-[9px] text-yellow-300 font-mono font-bold",style:{textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:["",e.price]})]})]}),e.quantity>1&&f.jsx("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-[8px] font-bold px-1 h-3 flex items-center justify-center rounded-bl z-20 shadow leading-none",children:f.jsxs("span",{className:"export-text-shift",children:["x",e.quantity]})}),n===e.packItemId&&f.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center z-30",children:f.jsx(Hf,{className:"text-white w-4 h-4"})})]})})},Pj=({pack:e,items:t,selectedPackItemId:r,showName:n,showWeight:s,showPrice:i,isMyPack:a,onSlotTap:o,onSlotLongPress:l,interactive:c=!0})=>{var p;const d=(e==null?void 0:e.gridCols)||6,h=(e==null?void 0:e.gridRows)||8,u=(p=e==null?void 0:e.backpackGear)==null?void 0:p.imageUrl;return f.jsx("div",{className:"w-full relative",children:f.jsxs("div",{className:"relative w-full border-2 border-white/20 rounded-xl overflow-hidden bg-white/5",style:{aspectRatio:`${d}/${h}`},children:[f.jsx("div",{className:"absolute inset-0 bg-center bg-cover opacity-20 pointer-events-none z-0",style:{backgroundImage:u?`url(${u})`:"none"}}),f.jsxs("div",{className:"relative w-full h-full grid",style:{gridTemplateColumns:`repeat(${d}, 1fr)`,gridTemplateRows:`repeat(${h}, 1fr)`},children:[Array.from({length:d*h}).map((m,y)=>{const P=y%d,g=Math.floor(y/d);return f.jsx(uV,{col:P,row:g,selectedPackItemId:c?r:null,onLongPress:()=>c&&l&&l(P,g),onTap:()=>c&&o&&o(P,g)},y)}),t.map(m=>m.gridX===void 0||m.gridY===void 0?null:f.jsx(dV,{item:m,gridCols:d,gridRows:h,selectedPackItemId:c?r:null,showName:n,showWeight:s,showPrice:i,onTap:(y,P)=>c&&o&&o(y,P)},m.packItemId))]})]})})},kj=ke.forwardRef(({pack:e,items:t,user:r,planName:n,totalWeight:s,totalPrice:i,showName:a,showWeight:o,showPrice:l},c)=>{const d=t.reduce((u,p)=>(u[p.category]||(u[p.category]=[]),u[p.category].push(p),u),{}),h=Object.keys(d);return f.jsxs("div",{ref:c,className:"bg-gradient-to-br from-slate-50 to-blue-100 w-[600px] min-h-[800px] text-slate-800 font-sans relative overflow-hidden rounded-none",style:{transformOrigin:"top left"},children:[f.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white p-6 relative overflow-hidden",children:[f.jsx("div",{className:"absolute -top-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"}),f.jsx("div",{className:"absolute bottom-0 left-0 w-full h-12 bg-gradient-to-t from-slate-50/10 to-transparent"}),f.jsxs("div",{className:"flex justify-between items-start relative z-10",children:[f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("div",{className:"bg-white/20 p-1.5 rounded-lg backdrop-blur-sm",children:f.jsx(Pu,{size:20,className:"text-white"})}),f.jsx("span",{className:"text-xl font-black tracking-tight",children:"PackMate"})]}),f.jsx("h1",{className:"text-3xl font-bold mt-2 mb-1 leading-tight",children:e.name}),f.jsxs("div",{className:"flex items-center gap-2 text-blue-100 text-sm",children:[f.jsx("span",{className:"font-medium",children:n}),f.jsx("span",{children:""}),f.jsx("span",{className:"opacity-80",children:new Date().toLocaleDateString()})]})]}),f.jsx("div",{className:"flex flex-col items-end",children:f.jsxs("div",{className:"flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-full backdrop-blur-md border border-white/20",children:[f.jsx("img",{src:(r==null?void 0:r.avatar)||"https://picsum.photos/200",className:"w-6 h-6 rounded-full border border-white/50",crossOrigin:"anonymous"}),f.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:(r==null?void 0:r.name)||"Adventurer"})]})})]})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-4 px-6 -mt-6 relative z-20",children:[f.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-lg shadow-blue-900/5 flex flex-col items-center justify-center border border-slate-100",children:[f.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 mb-0.5",children:[f.jsx(QI,{size:12}),f.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Total Weight"})]}),f.jsxs("div",{className:"text-xl font-black text-slate-800",children:[(s/1e3).toFixed(2)," ",f.jsx("span",{className:"text-xs font-medium text-slate-400",children:"kg"})]})]}),f.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-lg shadow-blue-900/5 flex flex-col items-center justify-center border border-slate-100",children:[f.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 mb-0.5",children:[f.jsx(iu,{size:12}),f.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Items"})]}),f.jsxs("div",{className:"text-xl font-black text-slate-800",children:[t.reduce((u,p)=>u+p.quantity,0)," ",f.jsx("span",{className:"text-xs font-medium text-slate-400",children:"pcs"})]})]}),f.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-lg shadow-blue-900/5 flex flex-col items-center justify-center border border-slate-100",children:[f.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 mb-0.5",children:[f.jsx(RI,{size:12}),f.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Value"})]}),f.jsxs("div",{className:"text-xl font-black text-slate-800",children:["",i]})]})]}),f.jsxs("div",{className:"p-6 space-y-6",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex items-center gap-2 text-slate-400 uppercase tracking-wider text-xs font-bold pl-1",children:[f.jsx(Gi,{size:14}),f.jsx("span",{children:"Loadout Configuration"})]}),f.jsx("div",{className:" p-2 rounded-2xl border border-slate-200 shadow-sm",children:f.jsx(Pj,{pack:e,items:t,selectedPackItemId:null,showName:a,showWeight:o,showPrice:l,isMyPack:!1,interactive:!1})})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex items-center gap-2 text-slate-400 uppercase tracking-wider text-xs font-bold pl-1",children:[f.jsx(iu,{size:14}),f.jsx("span",{children:"Inventory Breakdown"})]}),e.backpackGear&&f.jsxs("div",{className:"bg-white p-3 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-3",children:[f.jsx("div",{className:"w-12 h-12 bg-slate-50 rounded-xl border border-slate-100 overflow-hidden flex-shrink-0 relative",children:e.backpackGear.imageUrl?f.jsx("img",{src:e.backpackGear.imageUrl,className:"w-full h-full object-cover",crossOrigin:"anonymous"}):f.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-300",children:f.jsx(Gi,{size:20})})}),f.jsxs("div",{className:"min-w-0 flex-1",children:[f.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-0.5",children:"Container"}),a&&f.jsx("div",{className:"text-sm font-bold text-slate-800 truncate",children:e.backpackGear.name}),f.jsxs("div",{className:"text-[10px] text-slate-500 font-medium flex items-center gap-1",children:[o&&f.jsxs("span",{children:[e.backpackGear.weightGrams,"g"]}),o&&l&&f.jsx("span",{className:"text-slate-300",children:"|"}),l&&f.jsxs("span",{children:["",e.backpackGear.price]})]})]})]}),f.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:[h.length===0&&f.jsx("div",{className:"p-4 text-center text-sm text-slate-400",children:"No items packed."}),f.jsx("div",{className:"grid grid-cols-2 divide-x divide-slate-100",children:h.map((u,p)=>f.jsxs("div",{className:`p-4 ${p>1?"border-t border-slate-100":""}`,children:[f.jsxs("h4",{className:"text-xs font-black text-blue-600 uppercase tracking-wide mb-3 flex items-center gap-2",children:[u,f.jsx("span",{className:"bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded-md text-[9px]",children:d[u].length})]}),f.jsx("div",{className:"space-y-3",children:d[u].map((m,y)=>f.jsxs("div",{className:"flex items-start gap-2.5",children:[f.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-50 overflow-hidden flex-shrink-0 border border-gray-100",children:f.jsx("img",{src:m.imageUrl,className:"w-full h-full object-cover",crossOrigin:"anonymous"})}),f.jsxs("div",{className:"flex-1 min-w-0 pt-0.5",children:[a&&f.jsx("div",{className:"text-[11px] font-bold text-slate-700 truncate leading-tight",children:m.name}),f.jsxs("div",{className:"text-[9px] text-slate-400 flex items-center gap-1 mt-0.5",children:[o&&f.jsxs("span",{children:[m.weightGrams,"g"]}),m.quantity>1&&f.jsxs("span",{className:"text-blue-600 font-bold bg-blue-50 px-1 rounded",children:["x",m.quantity]}),l&&f.jsxs("span",{className:"ml-auto font-mono text-slate-300",children:["",m.price]})]})]})]},y))})]},u))})]})]})]}),f.jsxs("div",{className:"bg-slate-100 p-6 mt-4 flex items-center justify-between border-t border-slate-200",children:[f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("div",{className:"bg-blue-600 p-1 rounded",children:f.jsx(Pu,{size:14,className:"text-white"})}),f.jsx("span",{className:"font-black text-slate-800 tracking-tight",children:"PackMate"})]}),f.jsx("p",{className:"text-[10px] text-slate-500 font-medium",children:"Plan Together. Pack Lighter."}),f.jsx("p",{className:"text-[9px] text-slate-400 mt-2",children:"Download on iOS & Android"})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("div",{className:"text-right",children:[f.jsx("p",{className:"text-[10px] font-bold text-slate-600",children:"Scan to View"}),f.jsx("p",{className:"text-[9px] text-slate-400",children:"or get the app"})]}),f.jsx("div",{className:"bg-white p-2 rounded-xl border border-slate-200 shadow-sm",children:f.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[f.jsx("path",{d:"M0 20C0 8.95431 8.95431 0 20 0H80C91.0457 0 100 8.95431 100 20V80C100 91.0457 91.0457 100 80 100H20C8.95431 100 0 91.0457 0 80V20Z",fill:"white"}),f.jsx("rect",{x:"10",y:"10",width:"30",height:"30",rx:"5",fill:"#1e293b"}),f.jsx("rect",{x:"60",y:"10",width:"30",height:"30",rx:"5",fill:"#1e293b"}),f.jsx("rect",{x:"10",y:"60",width:"30",height:"30",rx:"5",fill:"#1e293b"}),f.jsx("rect",{x:"15",y:"15",width:"20",height:"20",rx:"2",fill:"white"}),f.jsx("rect",{x:"65",y:"15",width:"20",height:"20",rx:"2",fill:"white"}),f.jsx("rect",{x:"15",y:"65",width:"20",height:"20",rx:"2",fill:"white"}),f.jsx("rect",{x:"19",y:"19",width:"12",height:"12",rx:"2",fill:"#3b82f6"}),f.jsx("rect",{x:"69",y:"19",width:"12",height:"12",rx:"2",fill:"#3b82f6"}),f.jsx("rect",{x:"19",y:"69",width:"12",height:"12",rx:"2",fill:"#3b82f6"}),f.jsx("circle",{cx:"75",cy:"75",r:"12",fill:"#3b82f6"})]})})]})]})]})});kj.displayName="ShareTemplate";const hV=({items:e,showName:t,showWeight:r,showPrice:n,isMyPack:s,onConsumableChange:i})=>f.jsx("div",{className:"space-y-3",children:e.map(a=>f.jsxs("div",{className:"bg-white/60 rounded-2xl p-3 shadow-sm flex flex-col gap-2",children:[f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 mr-3 overflow-hidden flex-shrink-0 border border-gray-200",children:f.jsx("img",{src:a.imageUrl,className:"w-full h-full object-cover",alt:a.name,crossOrigin:"anonymous"})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex justify-between items-start",children:[t&&f.jsx("h4",{className:"text-sm font-bold text-gray-800 truncate flex-1 mr-2",children:a.name}),f.jsxs("span",{className:`text-xs font-bold text-blue-600 ${t?"":"ml-auto"}`,children:["x",a.quantity]})]}),f.jsxs("div",{className:"flex items-center space-x-2 mt-0.5",children:[f.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-gray-100 text-gray-500 rounded-md",children:a.category}),r&&f.jsxs("span",{className:"text-[10px] text-gray-400",children:[a.weightGrams,"g"]}),n&&f.jsxs("span",{className:"text-[10px] text-gray-400",children:["",a.price]})]})]})]}),a.isConsumable&&f.jsxs("div",{className:"pt-2 border-t border-gray-100/50 flex items-center space-x-3",children:[f.jsx(TR,{size:14,className:`${(a.consumableValue||0)<20?"text-red-500":"text-green-500"}`}),f.jsx("input",{type:"range",min:"0",max:"100",value:a.consumableValue||0,onChange:o=>i&&i(a.packItemId,parseInt(o.target.value)),disabled:!s,className:"w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"}),f.jsxs("span",{className:"text-xs font-mono text-gray-600 w-8 text-right",children:[a.consumableValue,"%"]})]})]},a.packItemId))}),$2=({onNavigate:e})=>{var ue,Ee;const[t,r]=ke.useState(null),[n,s]=ke.useState([]),[i,a]=ke.useState(""),[o,l]=ke.useState(""),[c,d]=ke.useState([]),[h,u]=ke.useState(void 0),[p,m]=ke.useState(!0),[y,P]=ke.useState(!1),[g,_]=ke.useState(!0),[b,w]=ke.useState(!0),[M,E]=ke.useState(!1),[T,S]=ke.useState(null),[A,j]=ke.useState(!1),[U,W]=ke.useState(null),B=ke.useRef(null),[ee,Q]=ke.useState(!1),Z=ke.useRef(new Map);ke.useEffect(()=>{(async()=>{const me=await aw();me&&l(me.id);const ve=await rp();r(ve);const xe=ve.teammates||[];if(s(xe),xe.length>0){const _e=me?xe.find(je=>je.id===me.id):null;a(_e?_e.id:xe[0].id)}else me&&a(me.id)})()},[]),ke.useEffect(()=>{i&&J()},[i]);const J=async()=>{const fe=n.find(xe=>xe.id===i);if((fe==null?void 0:fe.status)==="invited"){u(void 0),d([]);return}P(!0);const{pack:me,items:ve}=await X5();u(me),d(ve),P(!1)},X=(fe,me)=>{d(xe=>xe.map(_e=>_e.packItemId===fe?{..._e,consumableValue:me}:_e)),Z.current.has(fe)&&clearTimeout(Z.current.get(fe));const ve=setTimeout(()=>{rV(fe,me),Z.current.delete(fe)},500);Z.current.set(fe,ve)},ae=async()=>{if(B.current){Q(!0);try{const fe=await c4(B.current,{scale:2}),me=document.createElement("a");me.href=fe,me.download=`PackMate_${(h==null?void 0:h.name)||"Pack"}.png`,me.click()}catch(fe){console.error("Export failed",fe),alert("Failed to generate image.")}finally{Q(!1)}}},le=()=>({cols:(h==null?void 0:h.gridCols)||6,rows:(h==null?void 0:h.gridRows)||8}),ne=async(fe,me)=>{if(!(i===o))return;const xe=c.find(_e=>fe>=_e.gridX&&fe<_e.gridX+(_e.gridCols||1)&&me>=_e.gridY&&me<_e.gridY+(_e.gridRows||1));if(T){if(xe&&xe.packItemId===T){S(null);return}const _e=c.find(Le=>Le.packItemId===T);if(!_e){S(null);return}const{cols:je,rows:we}=le(),Oe=_e.gridCols||1,Me=_e.gridRows||1;if(fe+Oe>je||me+Me>we)return;let We=null;for(const Le of c){if(Le.packItemId===_e.packItemId)continue;const rt=Le.gridCols||1,Ye=Le.gridRows||1,ze=fe<Le.gridX+rt&&fe+Oe>Le.gridX,Ke=me<Le.gridY+Ye&&me+Me>Le.gridY;if(ze&&Ke){We=Le;break}}if(We){if(We.id===_e.id){const Le=c.filter(rt=>rt.packItemId!==_e.packItemId).map(rt=>rt.packItemId===We.packItemId?{...rt,quantity:rt.quantity+_e.quantity}:rt);d(Le),S(null),await sV(_e.packItemId,We.packItemId)}}else{const Le={..._e,gridX:fe,gridY:me};d(rt=>rt.map(Ye=>Ye.packItemId===_e.packItemId?Le:Ye)),S(null),h&&await C2(_e.packItemId,fe,me)}}else xe&&S(xe.packItemId)},L=(fe,me)=>{if(!T||!(i===o))return;const xe=c.find(We=>We.packItemId===T);if(!xe||xe.quantity<=1)return;const{cols:_e,rows:je}=le(),we=xe.gridCols||1,Oe=xe.gridRows||1;if(fe+we>_e||me+Oe>je)return;let Me=!1;for(const We of c){if(We.packItemId===xe.packItemId)continue;const Le=We.gridCols||1,rt=We.gridRows||1;if(fe<We.gridX+Le&&fe+we>We.gridX&&me<We.gridY+rt&&me+Oe>We.gridY){Me=!0;break}}Me||(W({item:xe,targetX:fe,targetY:me,maxQty:xe.quantity,moveQty:1}),j(!0))},F=async()=>{if(!(!U||!h)){if(U.moveQty===U.maxQty){const fe=U.item,me={...fe,gridX:U.targetX,gridY:U.targetY};d(ve=>ve.map(xe=>xe.packItemId===fe.packItemId?me:xe)),await C2(fe.packItemId,U.targetX,U.targetY)}else await nV(h.id,U.item.packItemId,U.item.id,U.moveQty,U.targetX,U.targetY),await J();j(!1),W(null),S(null)}};if(!t)return f.jsx("div",{className:"p-10 text-center text-white",children:"Loading Adventure..."});const G=c.reduce((fe,me)=>fe+me.weightGrams*me.quantity,0),oe=((ue=h==null?void 0:h.backpackGear)==null?void 0:ue.weightGrams)||0,H=G+oe,Te=c.reduce((fe,me)=>fe+me.price*me.quantity,0),Ce=((Ee=h==null?void 0:h.backpackGear)==null?void 0:Ee.price)||0,Be=Te+Ce,$e=i===o,te=n.find(fe=>fe.id===i),O=(te==null?void 0:te.status)==="invited";return f.jsxs("div",{className:"pt-12 pb-28 px-5 space-y-6",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-4xl font-extrabold text-white tracking-tight leading-none drop-shadow-sm",children:t.name}),f.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[f.jsx("span",{className:"bg-blue-600 text-white text-[10px] font-bold px-2.5 py-1 rounded-lg shadow-sm border border-blue-500",children:"NOW"}),f.jsx("span",{className:"text-blue-50 text-xs font-bold tracking-widest uppercase opacity-90",children:t.status})]})]}),f.jsx("div",{className:"flex items-center pl-4",children:n.length>0?f.jsxs("div",{className:"flex -space-x-3",children:[n.slice(0,3).map(fe=>f.jsxs("button",{onClick:()=>a(fe.id),className:`relative w-12 h-12 rounded-full border-2 transition-all duration-300 focus:outline-none
                                ${i===fe.id?"border-green-400 z-20 scale-105":"border-white/60 z-10 hover:z-30 hover:scale-110 opacity-90"}
                            `,children:[f.jsx("img",{src:fe.avatar,className:"w-full h-full rounded-full object-cover",alt:fe.name}),i===fe.id&&f.jsx("div",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-blue-500 rounded-full shadow-sm animate-pulse"})]},fe.id)),f.jsx("button",{onClick:()=>e("friends"),className:"w-12 h-12 rounded-full bg-white/10 border-2 border-white/30 flex items-center justify-center text-white hover:bg-white/20 backdrop-blur-sm z-0 hover:z-30 transition-all",children:f.jsx(_f,{size:18})})]}):f.jsxs("div",{className:"flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-full backdrop-blur-sm border border-white/20",children:[f.jsx("span",{className:"text-xs text-blue-100 font-bold",children:"Solo"}),f.jsx("button",{onClick:()=>e("friends"),className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-white/30",children:f.jsx(_f,{size:14})})]})})]}),f.jsxs("div",{className:"space-y-1 rounded-3xl p-2 -m-2",children:[f.jsxs("div",{className:"flex justify-between items-stretch mb-1 px-2 pt-2",children:[f.jsxs("div",{className:"flex flex-col justify-between gap-0.5 min-w-0 flex-1 pr-2",children:[f.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[f.jsx("h2",{className:"text-2xl font-black text-white drop-shadow-lg leading-none mb-1 truncate",children:(h==null?void 0:h.name)||"Main Loadout"}),!O&&f.jsx("button",{onClick:ae,className:"p-1.5 text-white/70 hover:text-white bg-white/10 hover:bg-white/20 rounded-lg transition-colors backdrop-blur-sm mb-1",children:ee?f.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}):f.jsx(BR,{size:14})})]}),h!=null&&h.backpackGear&&(g||M||b)?f.jsxs("div",{className:"flex items-center gap-2 text-blue-100 text-xs font-medium bg-blue-900/30 px-2 py-1 rounded-lg backdrop-blur-sm border border-white/10 self-start transition-all max-w-full",children:[f.jsx("div",{className:"w-4 h-4 rounded bg-white/20 flex items-center justify-center overflow-hidden flex-shrink-0",children:h.backpackGear.imageUrl?f.jsx("img",{src:h.backpackGear.imageUrl,className:"w-full h-full object-cover",crossOrigin:"anonymous"}):f.jsx(Gi,{size:10})}),g&&f.jsx("span",{className:"truncate",children:f.jsx("div",{className:"text-[10px] font-bold text-white whitespace-nowrap leading-[12px] mb-0.5",style:{textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:h.backpackGear.name})}),g&&b&&f.jsx("span",{className:"opacity-60 flex-shrink-0",children:"|"}),b&&f.jsx("span",{className:"flex-shrink-0",children:f.jsxs("div",{className:"text-[9px] text-gray-100 font-medium",style:{textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:[h.backpackGear.weightGrams,"g"]})}),M&&f.jsxs("span",{className:"flex-shrink-0",children:["                                ",f.jsxs("div",{className:"text-[9px] text-yellow-300 font-mono font-bold",style:{textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:["",h.backpackGear.price]})]})]}):f.jsx(f.Fragment,{}),!(h!=null&&h.backpackGear)&&!O&&f.jsx("div",{className:"text-[10px] text-blue-100 opacity-60 font-medium bg-white/10 px-2 py-0.5 rounded w-fit",children:"No container selected"})]}),!O&&f.jsxs("div",{className:`flex flex-col items-end gap-1 flex-shrink-0 ${b||M?"justify-between":"justify-end"}`,children:[(b||M)&&f.jsxs("div",{className:"text-right text-white drop-shadow-md mb-0.5",children:[b&&f.jsxs("div",{className:"text-2xl font-bold leading-none",children:[(H/1e3).toFixed(2),f.jsx("span",{className:"text-xs font-medium opacity-80",children:"kg"})]}),M&&f.jsxs("div",{className:"text-[10px] font-mono opacity-80",children:["",Be]})]}),f.jsxs("div",{className:"flex items-center gap-0.5 bg-black/20 backdrop-blur-md rounded-lg p-0.5 border border-white/10 transition-all",children:[f.jsx("button",{onClick:()=>_(!g),className:`p-1.5 rounded transition-colors ${g?"bg-white text-blue-600 shadow-sm":"text-white/70 hover:text-white"}`,children:f.jsx(VR,{size:13})}),f.jsx("button",{onClick:()=>w(!b),className:`p-1.5 rounded transition-colors ${b?"bg-white text-blue-600 shadow-sm":"text-white/70 hover:text-white"}`,children:f.jsx(QI,{size:13})}),f.jsx("button",{onClick:()=>E(!M),className:`p-1.5 rounded transition-colors ${M?"bg-white text-blue-600 shadow-sm":"text-white/70 hover:text-white"}`,children:f.jsx(RI,{size:13})}),f.jsx("div",{className:"w-[1px] h-3 bg-white/20 mx-0.5"}),f.jsx("button",{onClick:()=>m(!p),className:"p-1.5 text-white/70 hover:text-white rounded transition-colors",children:p?f.jsx(BI,{size:13}):f.jsx(Uy,{size:13})})]})]})]}),f.jsxs("div",{className:`transition-all duration-300 relative min-h-[400px] ${p&&!O?"":"glass-panel rounded-3xl shadow-md p-4 overflow-hidden"}`,children:[y&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-50 rounded-3xl",children:f.jsx(Ls,{className:"animate-spin text-blue-600",size:32})}),O?f.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-center p-10 opacity-60",children:[f.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:f.jsx(ku,{className:"text-gray-400",size:32})}),f.jsx("h3",{className:"text-gray-700 font-bold text-lg",children:"Waiting for Teammate"}),f.jsxs("p",{className:"text-xs text-gray-500 mt-2 max-w-[200px]",children:[te==null?void 0:te.name," hasn't joined the expedition yet. Their gear will be visible once they accept the invite."]})]}):f.jsxs(f.Fragment,{children:[!p&&f.jsx(hV,{items:c,showName:g,showWeight:b,showPrice:M,isMyPack:$e,onConsumableChange:X}),p&&f.jsxs("div",{className:"w-full relative",children:[f.jsx(Pj,{pack:h,items:c,selectedPackItemId:T,showName:g,showWeight:b,showPrice:M,isMyPack:$e,onSlotTap:ne,onSlotLongPress:L}),f.jsxs("div",{className:"mt-3 space-y-2",children:[T&&$e&&f.jsxs("div",{className:"flex justify-center items-center space-x-4 animate-fade-in",children:[f.jsx("span",{className:"text-xs text-blue-600 font-bold bg-blue-50 px-3 py-1 rounded-full animate-pulse",children:"Item Selected"}),f.jsxs("button",{onClick:()=>S(null),className:"flex items-center space-x-1 text-red-500 bg-white px-3 py-1 rounded-full shadow-sm border border-red-100",children:[f.jsx(SR,{size:14})," ",f.jsx("span",{className:"text-xs font-bold",children:"Cancel Move"})]})]}),$e&&!T&&f.jsx("div",{className:"flex justify-center items-center text-[10px] text-white/80",children:f.jsx("span",{className:"bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full border border-white/20 shadow-sm",children:"Tap to Select  Long Press Target to Split  Merge Same Items"})})]})]})]})]})]}),h&&f.jsx("div",{className:"absolute top-0 left-0 -z-50 overflow-hidden w-0 h-0",children:f.jsx(kj,{ref:B,pack:h,items:c,user:te||null,planName:t.name,totalWeight:H,totalPrice:Be,showName:g,showWeight:b,showPrice:M})}),A&&U&&f.jsx(cV,{splitData:U,setSplitData:W,onClose:()=>{j(!1),S(null)},onConfirm:F})]})},hg=({type:e,name:t,items:r,isLast:n,onNameChange:s,onBlur:i,onDelete:a,onAddGear:o,onRemoveGear:l})=>{const c=e==="start",d=e==="end",h=c?qI:d?ku:Vy,u=c?"text-orange-500":d?"text-indigo-500":"text-blue-500",p=c?"bg-green-500 border-white":d?"bg-red-500 border-white":"bg-blue-400 border-white",m=!!s,y=c?"Start Location":d?"Camp Location":"Stop Name";return f.jsxs("div",{className:`relative pl-4 ml-3 ${n?"pb-6":"border-l-2 "+(c?"border-green-200":"border-blue-100")}`,children:[f.jsx("div",{className:`absolute -left-[9px] top-0 w-4 h-4 rounded-full ${p} border-2 shadow z-10 flex items-center justify-center`}),f.jsxs("div",{className:`bg-white border ${c?"border-green-100":d?"border-red-100":"border-gray-100"} p-3 rounded-xl shadow-sm mb-6`,children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[f.jsx(h,{size:18,className:`${u} flex-shrink-0`}),m?f.jsx("input",{className:"font-bold text-gray-800 text-sm bg-transparent border-b border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none w-full truncate",value:t==="Start"||t==="End"||t==="Camp"?"":t,placeholder:y,onChange:P=>s&&s(P.target.value),onBlur:i}):f.jsx("div",{className:"font-bold text-sm text-gray-800 truncate",children:t})]}),f.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[f.jsxs("button",{onClick:o,className:`px-2 py-1 rounded-lg text-[10px] font-bold flex items-center gap-1 transition-colors ${c?"bg-green-50 text-green-600 hover:bg-green-100":d?"bg-red-50 text-red-600 hover:bg-red-100":"bg-blue-50 text-blue-600 hover:bg-blue-100"}`,children:[f.jsx(Ti,{size:12})," ",f.jsx("span",{className:"hidden sm:inline",children:"Gear"})]}),a&&f.jsx("button",{onClick:a,className:"text-gray-300 hover:text-red-500 p-1 rounded",children:f.jsx(To,{size:14})})]})]}),r&&r.length>0&&f.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:r.map(P=>{var g,_;return f.jsxs("div",{className:"bg-gray-50 pl-1 pr-2 py-1 rounded-lg flex items-center gap-2 border border-gray-100",children:[f.jsx("img",{src:(g=P.gear)==null?void 0:g.imageUrl,className:"w-5 h-5 rounded bg-white object-cover border border-gray-200"}),f.jsx("span",{className:"text-[10px] font-medium text-gray-600 truncate max-w-[100px]",children:(_=P.gear)==null?void 0:_.name}),f.jsx("button",{onClick:()=>l(P.id),className:"text-gray-300 hover:text-red-500",children:f.jsx(Us,{size:12})})]},P.id)})})]})]})},fV=({selectedDay:e,onClose:t,onDeleteDay:r,onLocalUpdate:n,onBlurSave:s,startNode:i,endNode:a,stops:o,onAddWaypoint:l,onDeleteWaypoint:c,onSetGearTarget:d,onRemoveGear:h})=>{const[u,p]=ke.useState(""),[m,y]=ke.useState(!1),P=()=>{u&&(l(u),p(""),y(!1))};return f.jsx("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center  pb-[88px] bg-black/200 backdrop-blur-sm p-0 sm:p-6",children:f.jsxs("div",{className:"bg-gray-50 rounded-3xl sm:rounded-3xl w-full max-w-md max-h-[85vh] flex flex-col shadow-2xl animate-in slide-in-from-bottom-10",children:[f.jsxs("div",{className:"p-5 border-b border-gray-200 bg-white rounded-t-3xl flex justify-between items-center",children:[f.jsxs("div",{children:[f.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["Day ",e.day," Mission"]}),f.jsx("div",{className:"text-xs text-gray-500 font-medium mt-0.5",children:"Edit route and gear"})]}),f.jsxs("div",{className:"flex gap-2",children:[e.id&&f.jsx("button",{onClick:()=>r(e.id),className:"bg-red-50 text-red-500 p-2 rounded-xl hover:bg-red-100",children:f.jsx(To,{size:18})}),f.jsx("button",{onClick:t,className:"bg-gray-100 text-gray-500 p-2 rounded-xl hover:bg-gray-200",children:f.jsx(Us,{size:18})})]})]}),f.jsxs("div",{className:"overflow-y-auto flex-1 p-5 space-y-6",children:[f.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-gray-100",children:[f.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase mb-3",children:"Daily Stats"}),f.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-[10px] font-bold text-gray-500",children:"Distance (km)"}),f.jsx("input",{type:"number",className:"w-full bg-gray-50 border border-gray-200 rounded-lg p-2 font-bold text-gray-800 text-center",value:e.distanceKm,onChange:g=>n("distanceKm",Number(g.target.value)),onBlur:s})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-[10px] font-bold text-gray-500",children:"Gain (m)"}),f.jsx("input",{type:"number",className:"w-full bg-gray-50 border border-gray-200 rounded-lg p-2 font-bold text-gray-800 text-center",value:e.elevationGain,onChange:g=>n("elevationGain",Number(g.target.value)),onBlur:s})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-[10px] font-bold text-gray-500",children:"Loss (m)"}),f.jsx("input",{type:"number",className:"w-full bg-gray-50 border border-gray-200 rounded-lg p-2 font-bold text-gray-800 text-center",value:e.elevationLoss,onChange:g=>n("elevationLoss",Number(g.target.value)),onBlur:s})]})]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsx("div",{className:"flex justify-between items-end",children:f.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase",children:"Timeline"})}),f.jsx(hg,{type:"start",name:e.start,items:(i==null?void 0:i.items)||[],isLast:!1,onNameChange:g=>n("start",g),onBlur:s,onAddGear:()=>d({systemLocation:{dayId:e.id,type:"start"}}),onRemoveGear:h}),o.map(g=>f.jsx(hg,{type:"stop",name:g.name,items:g.items||[],isLast:!1,onDelete:()=>c(g.id),onAddGear:()=>d({waypointId:g.id}),onRemoveGear:h},g.id)),f.jsx("div",{className:"pl-4 ml-3 pb-6 border-l-2 border-dashed border-gray-200",children:m?f.jsxs("div",{className:"flex gap-2 animate-fade-in",children:[f.jsx("input",{autoFocus:!0,className:"flex-1 bg-white border border-blue-300 rounded-xl px-3 py-2 text-sm shadow-sm focus:ring-2 focus:ring-blue-100 outline-none",placeholder:"Stop name...",value:u,onChange:g=>p(g.target.value),onKeyDown:g=>g.key==="Enter"&&P()}),f.jsx("button",{onClick:P,className:"bg-blue-600 text-white rounded-xl px-4 font-bold text-sm shadow-md hover:bg-blue-700",children:"Add"}),f.jsx("button",{onClick:()=>y(!1),className:"bg-gray-200 text-gray-600 rounded-xl px-3 hover:bg-gray-300",children:f.jsx(Us,{size:18})})]}):f.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 text-xs font-bold text-blue-500 bg-blue-50 hover:bg-blue-100 px-4 py-2 rounded-xl border border-blue-100 transition-colors",children:[f.jsx(Ti,{size:14})," Add Stop"]})}),f.jsx(hg,{type:"end",name:e.end,items:(a==null?void 0:a.items)||[],isLast:!0,onNameChange:g=>n("end",g),onBlur:s,onAddGear:()=>d({systemLocation:{dayId:e.id,type:"end"}}),onRemoveGear:h})]})]})]})})},pV=({userPlans:e,onClose:t,onCreatePlan:r,onSwitchPlan:n,onDeletePlan:s})=>{const[i,a]=ke.useState(""),[o,l]=ke.useState(!1),c=async()=>{l(!0),await r(i),a(""),l(!1)};return f.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-6",children:f.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl max-h-[80vh] flex flex-col",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4",children:[f.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"My Plans"}),f.jsx("button",{onClick:t,children:f.jsx(Us,{size:20,className:"text-gray-400"})})]}),f.jsxs("div",{className:"flex gap-2 mb-6",children:[f.jsx("input",{placeholder:"New plan name...",className:"flex-1 bg-gray-50 border border-gray-200 rounded-xl px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-blue-500",value:i,onChange:d=>a(d.target.value)}),f.jsx("button",{onClick:c,disabled:o||!i.trim(),className:"bg-blue-600 text-white px-5 rounded-xl font-bold text-sm shadow-md hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center",children:o?f.jsx(Ls,{className:"animate-spin",size:16}):"Create"})]}),f.jsxs("div",{className:"space-y-3 overflow-y-auto flex-1 pr-1",children:[e.length===0&&f.jsx("div",{className:"text-center text-gray-400 text-sm py-4",children:"No plans yet."}),e.map(d=>f.jsxs("div",{className:`p-4 rounded-2xl border transition-all flex justify-between items-center group ${d.status==="Active"?"bg-blue-50 border-blue-200 ring-1 ring-blue-100":"bg-white border-gray-100 hover:border-gray-300 hover:shadow-md"}`,children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${d.status==="Active"?"bg-blue-500 text-white":"bg-gray-100 text-gray-400"}`,children:f.jsx(Vy,{size:20})}),f.jsxs("div",{children:[f.jsx("h4",{className:"font-bold text-gray-800",children:d.name}),f.jsx("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:d.status==="Active"?f.jsx("span",{className:"text-blue-600 font-bold",children:" Active"}):f.jsx("span",{children:new Date(d.startDate).toLocaleDateString()})})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[d.status!=="Active"&&f.jsx("button",{onClick:()=>n(d.id),className:"text-xs bg-gray-100 hover:bg-blue-100 text-gray-600 hover:text-blue-600 font-bold px-3 py-1.5 rounded-lg transition-colors",children:"Select"}),f.jsx("button",{onClick:()=>s(d.id),className:"text-gray-300 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg transition-colors",children:f.jsx(To,{size:16})})]})]},d.id))]})]})})},mV=({userPacks:e,linkedPackIds:t,onClose:r,onToggleLink:n})=>f.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:f.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4",children:[f.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Linked Backpacks"}),f.jsx("button",{onClick:r,children:f.jsx(Us,{size:20,className:"text-gray-400"})})]}),f.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Select which packs contain the gear you are bringing. This filters your quick-select list."}),f.jsxs("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:[e.length===0&&f.jsx("p",{className:"text-center text-sm text-gray-400 py-4 bg-gray-50 rounded-xl",children:"No packs found. Create one in the Gear tab."}),e.map(s=>{const i=t.includes(s.id);return f.jsxs("div",{onClick:()=>n(s.id),className:`flex items-center justify-between p-4 rounded-2xl border cursor-pointer transition-all ${i?"bg-blue-50 border-blue-300 ring-1 ring-blue-100":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx("div",{className:`p-3 rounded-xl ${i?"bg-blue-500 text-white":"bg-gray-100 text-gray-400"}`,children:f.jsx(Gi,{size:20})}),f.jsxs("div",{children:[f.jsx("div",{className:"text-sm font-bold text-gray-800",children:s.name}),f.jsxs("div",{className:"text-[10px] text-gray-500",children:[s.items.length," items inside"]})]})]}),i&&f.jsx(Fl,{size:20,className:"text-blue-600"})]},s.id)})]})]})}),gV=({linkedGear:e,inventory:t,onClose:r,onAddGear:n,initialTab:s="packed"})=>{const[i,a]=ke.useState(s);return f.jsx("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:f.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl max-h-[70vh] overflow-y-auto flex flex-col",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4",children:[f.jsx("h3",{className:"text-sm font-bold text-gray-800",children:"Select Gear"}),f.jsx("button",{onClick:r,className:"bg-gray-100 p-1.5 rounded-full text-gray-500",children:f.jsx(Us,{size:16})})]}),f.jsxs("div",{className:"flex p-1 bg-gray-100 rounded-xl mb-4",children:[f.jsxs("button",{onClick:()=>a("packed"),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${i==="packed"?"bg-white text-blue-600 shadow-sm":"text-gray-500"}`,children:["Packed (",e.length,")"]}),f.jsxs("button",{onClick:()=>a("all"),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${i==="all"?"bg-white text-blue-600 shadow-sm":"text-gray-500"}`,children:["All Inventory (",t.length,")"]})]}),f.jsxs("div",{className:"grid grid-cols-1 gap-2 overflow-y-auto min-h-0 flex-1",children:[(i==="packed"?e:t).length===0&&f.jsx("div",{className:"text-center py-12 text-xs text-gray-400 bg-gray-50 rounded-xl",children:i==="packed"?"Link packs to see items here.":"Inventory is empty."}),(i==="packed"?e:t).map(o=>f.jsxs("button",{onClick:()=>n(o),className:"flex items-center gap-3 p-2 bg-white hover:bg-blue-50 border border-gray-100 rounded-xl text-left transition-colors group",children:[f.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 overflow-hidden flex-shrink-0 border border-gray-200",children:f.jsx("img",{src:o.imageUrl,className:"w-full h-full object-cover"})}),f.jsxs("div",{className:"min-w-0 flex-1",children:[f.jsx("div",{className:"text-xs font-bold text-gray-800 truncate group-hover:text-blue-700",children:o.name}),f.jsxs("div",{className:"text-[10px] text-gray-500 flex gap-2",children:[f.jsxs("span",{children:[o.weightGrams,"g"]}),f.jsx("span",{className:"text-gray-300",children:"|"}),f.jsx("span",{children:o.category})]})]}),f.jsx(Ti,{size:16,className:"text-gray-300 group-hover:text-blue-500"})]},o.id))]})]})})},ow=({onClose:e,onSuccess:t,isPro:r,currentPlan:n,message:s})=>{const[i,a]=ke.useState("yearly"),[o,l]=ke.useState(""),[c,d]=ke.useState(!1),[h,u]=ke.useState(null),[p,m]=ke.useState(null),y=async()=>{if(!o)return;d(!0),u(null);const _=await _5(o);d(!1),_.success?(u({type:"success",text:`Activated ${_.type==="pro_yearly"?"Yearly":"Monthly"} Pro!`}),l(""),setTimeout(t,1500)):u({type:"error",text:_.message||"Invalid code"})},P=async _=>{if(m(null),Ft()&&!window.confirm(`Confirm upgrade to ${_==="pro_monthly"?"Monthly":"Yearly"} Pro Plan? (Mock Payment)`))return;d(!0);const b=await y5(_);d(!1),b.success?t():m(b.message||"Payment service unavailable")},g=({label:_,free:b,pro:w})=>f.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs py-2 border-b border-gray-100 last:border-0 items-center",children:[f.jsx("span",{className:"text-gray-600 font-medium",children:_}),f.jsx("span",{className:"text-center text-gray-500",children:b}),f.jsx("span",{className:"text-center text-blue-700 font-bold bg-blue-50 rounded py-0.5",children:w})]});return f.jsx("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-0 sm:p-4 pb-[88px] animate-in slide-in-from-bottom-10 sm:slide-in-from-bottom-0",children:f.jsxs("div",{className:"bg-white rounded-3xl sm:rounded-3xl w-full max-w-md max-h-[85vh] overflow-y-auto shadow-2xl",children:[f.jsxs("div",{className:"p-5 bg-gradient-to-br from-slate-900 to-slate-800 text-white rounded-t-3xl relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl pointer-events-none -mr-10 -mt-10"}),f.jsxs("div",{className:"flex justify-between items-start relative z-10",children:[f.jsxs("div",{children:[f.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[f.jsx(zI,{className:"text-yellow-400",fill:"currentColor"})," PackMate Pro"]}),f.jsx("p",{className:"text-slate-300 text-xs mt-1",children:"Unlock your full potential"})]}),f.jsx("button",{onClick:e,className:"bg-white/20 p-2 rounded-full hover:bg-white/30 text-white",children:f.jsx(Us,{size:18})})]})]}),f.jsxs("div",{className:"p-6 space-y-6 pb-8",children:[s&&f.jsxs("div",{className:"bg-red-50 border border-red-100 text-red-800 px-4 py-3 rounded-xl text-sm font-bold text-center flex items-center justify-center gap-2",children:[f.jsx(NR,{size:16})," ",s]}),f.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 border border-gray-100 shadow-inner",children:[f.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[10px] uppercase tracking-wider font-bold text-gray-400 mb-2 pb-2 border-b border-gray-200",children:[f.jsx("span",{children:"Feature"}),f.jsx("span",{className:"text-center",children:"Free"}),f.jsx("span",{className:"text-center text-blue-600",children:"Pro"})]}),f.jsx(g,{label:"Plans",free:"1 Active",pro:"30 Active"}),f.jsx(g,{label:"Duration",free:"Max 5 Days",pro:"Max 100 Days"}),f.jsx(g,{label:"Backpacks",free:"1 Pack",pro:"100 Packs"}),f.jsx(g,{label:"Inventory",free:"15 Items",pro:"3000 Items"}),f.jsx(g,{label:"Items/Pack",free:"30 Items",pro:"1000 Items"}),f.jsx(g,{label:"Waypoints",free:"5 / Day",pro:"100 / Day"}),f.jsx(g,{label:"Cloud Sync",free:"Standard",pro:"Priority"})]}),f.jsx("div",{className:"text-[10px] text-gray-400 text-center px-4",children:"* After expiration: Data is read-only (delete/export only). Data exceeding limits is auto-exported & removed after 90 days."}),f.jsxs("div",{className:"bg-gray-50 p-1 rounded-xl flex relative",children:[f.jsx("button",{onClick:()=>a("monthly"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all z-10 ${i==="monthly"?"text-slate-900 bg-white shadow-sm":"text-gray-500"}`,children:"Monthly"}),f.jsxs("button",{onClick:()=>a("yearly"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all z-10 ${i==="yearly"?"text-slate-900 bg-white shadow-sm":"text-gray-500"}`,children:["Yearly ",f.jsx("span",{className:"text-[9px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded ml-1",children:"-33%"})]})]}),f.jsxs("div",{className:"text-center py-2",children:[f.jsxs("div",{className:"text-4xl font-black text-slate-900 mb-1",children:[i==="monthly"?"6":"48",f.jsxs("span",{className:"text-base font-medium text-gray-400",children:["/",i==="monthly"?"mo":"yr"]})]}),f.jsx("p",{className:"text-xs text-gray-500",children:"Cancel anytime. Secure payment."})]}),p&&f.jsx("div",{className:"text-xs text-center text-orange-600 bg-orange-50 p-2 rounded-lg",children:p}),f.jsx("button",{onClick:()=>P(i==="monthly"?"pro_monthly":"pro_yearly"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200 transition-transform active:scale-95",children:r?"Extend Plan":"Subscribe Now"}),f.jsxs("div",{className:"relative py-2",children:[f.jsx("div",{className:"absolute inset-0 flex items-center",children:f.jsx("div",{className:"w-full border-t border-gray-200"})}),f.jsx("div",{className:"relative flex justify-center",children:f.jsx("span",{className:"bg-white px-2 text-xs text-gray-400 uppercase",children:"Or Redeem Code"})})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{value:o,onChange:_=>l(_.target.value),placeholder:"Enter Activation Code",className:"flex-1 bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-blue-500 uppercase"}),f.jsx("button",{onClick:y,disabled:!o||c,className:"bg-slate-800 text-white font-bold px-6 rounded-xl hover:bg-slate-900 disabled:opacity-50 disabled:cursor-not-allowed",children:c?f.jsx(Ls,{size:18,className:"animate-spin"}):"Apply"})]}),h&&f.jsx("div",{className:`text-center text-xs font-bold p-2 rounded-lg ${h.type==="success"?"bg-green-50 text-green-600":"bg-red-50 text-red-600"}`,children:h.text})]})]})})},_V=({onToggleNavbar:e})=>{const[t,r]=ke.useState(null),[n,s]=ke.useState(null),[i,a]=ke.useState([]),[o,l]=ke.useState(!1),[c,d]=ke.useState(!1),[h,u]=ke.useState([]),[p,m]=ke.useState(!1),[y,P]=ke.useState([]),[g,_]=ke.useState([]),[b,w]=ke.useState(""),[M,E]=ke.useState(""),[T,S]=ke.useState(null),[A,j]=ke.useState([]),[U,W]=ke.useState("packed"),[B,ee]=ke.useState(null),[Q,Z]=ke.useState(!1),[J,X]=ke.useState("");ke.useEffect(()=>{ae()},[]),ke.useEffect(()=>{c&&le()},[c]);const ae=async()=>{const we=await rp();if(r(we),w(we.name),E(we.startDate?we.startDate.split("T")[0]:new Date().toISOString().split("T")[0]),n){const Oe=we.days.find(Me=>Me.id===n.id);Oe&&s(Oe)}if(we.ownerId){const Oe=await Mj(we.ownerId);a(Oe);const Me=await Tj(we.ownerId);if(P(Me),we.id&&we.id!=="local"&&we.id!=="demo"){const We=await L5(we.id);_(We);const Le=await R5(we.id);j(Le),Le.length>0?W("packed"):W("all")}}},le=async()=>{const we=await G5();u(we)},ne=async we=>{if(!we.trim())return;const Oe=await q5(we);if(Oe!=null&&Oe.error){d(!1),X(Oe.error),Z(!0);return}await le()},L=async we=>{if(we===(t==null?void 0:t.id)){alert("Cannot delete active plan. Switch to another plan first.");return}await K5(we),await le()},F=async we=>{await H5(we),d(!1),await ae()},G=async()=>{t&&(await j5(t.id,{name:b,startDate:M}),l(!1),await ae())},oe=(we,Oe)=>{n&&s({...n,[we]:Oe})},H=async()=>{!n||!n.id||(await O5(n.id,{distanceKm:n.distanceKm,elevationGain:n.elevationGain,elevationLoss:n.elevationLoss,startLoc:n.start,endLoc:n.end}),await ae())},Te=async()=>{if(!t)return;const we=Mf("planDays",t.id);if(we.error){X(we.error),Z(!0);return}const Oe=t.days.length>0?t.days[t.days.length-1].day+1:1,Me=await N5(t.id,Oe);if(Me!=null&&Me.error){X(Me.error),Z(!0);return}await ae()},Ce=we=>{ee({title:"Delete Day",message:"Are you sure you want to delete this day? All waypoints and items linked to it will be removed permanently.",onConfirm:async()=>{await D5(we),s(null),await ae()}})},Be=async we=>{if(!t)return;const Oe=g.includes(we);await F5(t.id,we,!Oe),await ae()},$e=async we=>{if(!n||!n.id||!we)return;const Oe=await z5(n.id,we);if(Oe!=null&&Oe.error){X(Oe.error),Z(!0);return}await ae()},te=we=>{ee({title:"Delete Stop",message:"Remove this waypoint?",onConfirm:async()=>{await B5(we),await ae()}})},O=async we=>{T&&(T.waypointId?await U5(T.waypointId,we.id):T.systemLocation&&await W5(T.systemLocation.dayId,T.systemLocation.type,we.id),S(null),await ae())},ue=async we=>{await V5(we),await ae()},Ee=(we,Oe)=>Oe.includes(we)?null:we;if(!t)return f.jsx("div",{className:"p-10 text-center text-white",children:"Loading Plan..."});const fe=t.days.reduce((we,Oe)=>we+Oe.distanceKm,0),me=t.days.reduce((we,Oe)=>we+Oe.elevationGain,0),ve=we=>{var Oe;return(Oe=we.waypoints)==null?void 0:Oe.find(Me=>Me.type==="start")},xe=we=>{var Oe;return(Oe=we.waypoints)==null?void 0:Oe.find(Me=>Me.type==="end")},_e=we=>{var Oe;return((Oe=we.waypoints)==null?void 0:Oe.filter(Me=>Me.type==="stop"||!Me.type))||[]},je=Mf("planDays",t.id);return f.jsxs("div",{className:"pt-12 pb-32 px-4 space-y-6 relative min-h-screen",children:[B&&f.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-6 animate-in fade-in duration-200",children:f.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-2xl max-w-sm w-full transform transition-all scale-100",children:[f.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:B.title}),f.jsx("p",{className:"text-sm text-gray-600 mb-6 leading-relaxed",children:B.message}),f.jsxs("div",{className:"flex gap-3 justify-end",children:[f.jsx("button",{onClick:()=>ee(null),className:"px-5 py-2.5 rounded-xl bg-gray-100 text-gray-600 font-bold text-sm hover:bg-gray-200 transition-colors",children:"Cancel"}),f.jsx("button",{onClick:async()=>{await B.onConfirm(),ee(null)},className:"px-5 py-2.5 rounded-xl bg-red-500 hover:bg-red-600 text-white font-bold text-sm shadow-lg transition-transform active:scale-95",children:"Confirm"})]})]})}),f.jsxs("div",{className:"flex justify-between items-start text-white mb-2",children:[f.jsxs("div",{children:[f.jsx("div",{className:"flex items-center gap-2 opacity-80 mb-1",children:f.jsx("span",{className:"text-xs font-medium tracking-wider uppercase",children:"Expedition Plan"})}),o?f.jsxs("div",{className:"flex gap-2 items-center",children:[f.jsx("input",{value:b,onChange:we=>w(we.target.value),className:"bg-white/20 border border-white/30 rounded-lg px-3 py-1 text-xl font-bold text-white w-full focus:ring-2 focus:ring-blue-400 outline-none",placeholder:"Plan Name"}),f.jsx("button",{onClick:G,className:"bg-green-500 p-2 rounded-lg text-white shadow",children:f.jsx(WI,{size:18})})]}):f.jsxs("div",{onClick:()=>l(!0),className:"flex items-center gap-2 cursor-pointer group",children:[f.jsx("h1",{className:"text-3xl font-bold drop-shadow-md group-hover:opacity-90",children:t.name}),f.jsx(Wy,{size:14,className:"opacity-0 group-hover:opacity-50 transition-opacity"})]}),f.jsxs("div",{className:"text-sm text-blue-100 mt-1 flex items-center gap-2",children:[f.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${t.status==="Active"?"bg-green-500/30 border border-green-400/50":"bg-gray-500/30"}`,children:t.status}),o?f.jsx("input",{type:"date",value:M,onChange:we=>E(we.target.value),className:"bg-white/20 border-none rounded px-2 py-0.5 text-xs text-white"}):f.jsx("span",{className:"opacity-80",children:new Date(t.startDate).toLocaleDateString()})]})]}),f.jsxs("div",{className:"flex flex-col gap-3",children:[f.jsx("button",{onClick:()=>d(!0),className:"bg-white/10 backdrop-blur-md border border-white/20 p-2.5 rounded-xl text-white shadow-lg hover:bg-white/20 transition-all active:scale-95",children:f.jsx(Uy,{size:20})}),f.jsxs("button",{onClick:()=>m(!0),className:"bg-white/10 backdrop-blur-md border border-white/20 p-2.5 rounded-xl text-white shadow-lg hover:bg-white/20 transition-all active:scale-95 relative",children:[f.jsx(Gi,{size:20}),g.length>0&&f.jsxs("span",{className:"absolute top-0 right-0 flex h-3 w-3",children:[f.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),f.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]})]})]})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[f.jsxs("div",{className:"bg-gradient-to-br from-blue-500/20 to-blue-600/20 backdrop-blur-md border border-white/20 rounded-2xl p-3 flex flex-col items-center justify-center shadow-lg relative overflow-hidden group",children:[f.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity",children:f.jsx(jR,{size:40,className:"text-white"})}),f.jsx("div",{className:"text-2xl font-bold text-white drop-shadow-sm",children:fe}),f.jsx("div",{className:"text-[10px] font-bold text-blue-100 uppercase tracking-wide",children:"km Total"})]}),f.jsxs("div",{className:"bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 backdrop-blur-md border border-white/20 rounded-2xl p-3 flex flex-col items-center justify-center shadow-lg relative overflow-hidden group",children:[f.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity",children:f.jsx(Pu,{size:40,className:"text-white"})}),f.jsx("div",{className:"text-2xl font-bold text-white drop-shadow-sm",children:me}),f.jsx("div",{className:"text-[10px] font-bold text-emerald-100 uppercase tracking-wide",children:"m Gain"})]}),f.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-purple-600/20 backdrop-blur-md border border-white/20 rounded-2xl p-3 flex flex-col items-center justify-center shadow-lg relative overflow-hidden group",children:[f.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity",children:f.jsx(ER,{size:40,className:"text-white"})}),f.jsx("div",{className:"text-2xl font-bold text-white drop-shadow-sm",children:t.days.length}),f.jsx("div",{className:"text-[10px] font-bold text-purple-100 uppercase tracking-wide",children:"Days"})]})]}),f.jsxs("div",{className:"relative pl-4",children:[f.jsx("div",{className:"absolute left-[27px] top-6 bottom-0 w-0.5 bg-dashed bg-white/30 border-l-2 border-dashed border-white/30"}),f.jsxs("div",{className:"space-y-8",children:[t.days.map((we,Oe)=>{const Me=ve(we),We=xe(we),Le=_e(we),rt=[{type:"start",name:we.start,items:(Me==null?void 0:Me.items)||[]},...Le.map(Ye=>({type:"stop",name:Ye.name,items:Ye.items||[]})),{type:"end",name:we.end,items:(We==null?void 0:We.items)||[]}];return f.jsxs("div",{className:"relative z-10",children:[f.jsxs("div",{onClick:()=>s(we),className:"flex items-center gap-4 mb-4 cursor-pointer group",children:[f.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-900 border-2 border-blue-400 shadow-lg flex items-center justify-center z-20 group-hover:scale-110 transition-transform",children:f.jsx("span",{className:"text-xs font-bold text-white",children:we.day})}),f.jsxs("div",{className:"bg-white/90 backdrop-blur-sm px-4 py-1.5 rounded-full shadow-sm flex items-center gap-3 group-hover:bg-white transition-colors",children:[f.jsxs("span",{className:"text-xs font-bold text-gray-800 uppercase tracking-wide",children:["Day ",we.day]}),f.jsx("div",{className:"h-3 w-[1px] bg-gray-300"}),f.jsxs("span",{className:"text-[10px] text-gray-500 font-mono",children:[we.distanceKm,"km  ",we.elevationGain,"m"]})]})]}),f.jsx("div",{onClick:()=>s(we),className:"ml-10 bg-white/80 backdrop-blur-md rounded-2xl p-5 shadow-lg border border-white/50 hover:bg-white/90 transition-all cursor-pointer relative overflow-hidden",children:f.jsx("div",{className:"",children:rt.map((Ye,ze)=>{const Ke=Ye.type==="start",yt=Ye.type==="end",Ve=ze===rt.length-1,wt=Ke?qI:yt?ku:Vy,ut=Ke?"text-orange-600 bg-orange-100 border-orange-200":yt?"text-indigo-600 bg-indigo-100 border-indigo-200":"text-blue-600 bg-blue-100 border-blue-200",yr=Ke?["Start","Start Location"]:yt?["End","Camp","Camp Location"]:[],wr=Ee(Ye.name,yr);return f.jsxs("div",{className:"relative pl-10 pb-6 last:pb-0 min-h-[2rem]",children:[!Ve&&f.jsx("div",{className:"absolute left-[11px] top-7 bottom-0 w-0.5 bg-gray-200"}),f.jsx("div",{className:`absolute left-0 top-0 w-6 h-6 rounded-full border flex items-center justify-center z-10 shadow-sm ${ut}`,children:f.jsx(wt,{size:12,strokeWidth:2.5})}),f.jsxs("div",{className:"pt-0.5",children:[wr&&f.jsx("div",{className:"text-sm font-bold text-gray-800 leading-tight mb-1.5",children:wr}),Ye.items&&Ye.items.length>0?f.jsx("div",{className:"flex gap-1.5 flex-wrap",children:Ye.items.map(Hr=>{var Qr;return f.jsx("img",{src:(Qr=Hr.gear)==null?void 0:Qr.imageUrl,className:"w-6 h-6 rounded-md bg-gray-100 object-cover border border-gray-200 shadow-sm"},Hr.id)})}):!wr&&f.jsx("div",{className:"h-1"})]})]},ze)})})})]},we.day)}),f.jsx("div",{className:"relative z-10 ml-10 mt-4",children:f.jsxs("button",{onClick:Te,className:`w-full border-2 border-dashed rounded-2xl p-3 font-bold text-sm transition-all flex items-center justify-center gap-2 ${je.error?"bg-gray-100 border-gray-300 text-gray-400 cursor-not-allowed":"border-white/40 bg-white/10 text-white/80 hover:bg-white/20 hover:border-white/60"}`,children:[je.error?f.jsx(Qf,{size:16}):f.jsx(Ti,{size:16}),"Add Day ",t.days.length+1]})})]})]}),n&&f.jsx(fV,{selectedDay:n,onClose:()=>s(null),onDeleteDay:Ce,onLocalUpdate:oe,onBlurSave:H,startNode:ve(n),endNode:xe(n),stops:_e(n),onAddWaypoint:$e,onDeleteWaypoint:te,onSetGearTarget:S,onRemoveGear:ue}),c&&f.jsx(pV,{userPlans:h,onClose:()=>d(!1),onCreatePlan:ne,onSwitchPlan:F,onDeletePlan:L}),p&&f.jsx(mV,{userPacks:y,linkedPackIds:g,onClose:()=>m(!1),onToggleLink:Be}),T&&f.jsx(gV,{linkedGear:A,inventory:i,onClose:()=>S(null),onAddGear:O,initialTab:U}),Q&&f.jsx(ow,{onClose:()=>{Z(!1),X("")},onSuccess:()=>{Z(!1),ae()},message:J})]})};var I2=!1,lo,b0,M0,Rh,zh,Sj,Bh,T0,E0,P0,Cj,k0,S0,$j,Ij;function Jn(){if(!I2){I2=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),r=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(k0=/\b(iPhone|iP[ao]d)/.exec(e),S0=/\b(iP[ao]d)/.exec(e),P0=/Android/i.exec(e),$j=/FBAN\/\w+;/i.exec(e),Ij=/Mobile/i.exec(e),Cj=!!/Win64/.exec(e),t){lo=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN,lo&&document&&document.documentMode&&(lo=document.documentMode);var n=/(?:Trident\/(\d+.\d+))/.exec(e);Sj=n?parseFloat(n[1])+4:lo,b0=t[2]?parseFloat(t[2]):NaN,M0=t[3]?parseFloat(t[3]):NaN,Rh=t[4]?parseFloat(t[4]):NaN,Rh?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),zh=t&&t[1]?parseFloat(t[1]):NaN):zh=NaN}else lo=b0=M0=zh=Rh=NaN;if(r){if(r[1]){var s=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);Bh=s?parseFloat(s[1].replace("_",".")):!0}else Bh=!1;T0=!!r[2],E0=!!r[3]}else Bh=T0=E0=!1}}var C0={ie:function(){return Jn()||lo},ieCompatibilityMode:function(){return Jn()||Sj>lo},ie64:function(){return C0.ie()&&Cj},firefox:function(){return Jn()||b0},opera:function(){return Jn()||M0},webkit:function(){return Jn()||Rh},safari:function(){return C0.webkit()},chrome:function(){return Jn()||zh},windows:function(){return Jn()||T0},osx:function(){return Jn()||Bh},linux:function(){return Jn()||E0},iphone:function(){return Jn()||k0},mobile:function(){return Jn()||k0||S0||P0||Ij},nativeApp:function(){return Jn()||$j},android:function(){return Jn()||P0},ipad:function(){return Jn()||S0}},yV=C0,wV=!!(typeof window<"u"&&window.document&&window.document.createElement),vV={canUseDOM:wV},xV=vV,Aj=xV,jj;Aj.canUseDOM&&(jj=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function bV(e,t){if(!Aj.canUseDOM||t&&!("addEventListener"in document))return!1;var r="on"+e,n=r in document;if(!n){var s=document.createElement("div");s.setAttribute(r,"return;"),n=typeof s[r]=="function"}return!n&&jj&&e==="wheel"&&(n=document.implementation.hasFeature("Events.wheel","3.0")),n}var MV=bV,TV=yV,EV=MV,A2=10,j2=40,O2=800;function Oj(e){var t=0,r=0,n=0,s=0;return"detail"in e&&(r=e.detail),"wheelDelta"in e&&(r=-e.wheelDelta/120),"wheelDeltaY"in e&&(r=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=r,r=0),n=t*A2,s=r*A2,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(n=e.deltaX),(n||s)&&e.deltaMode&&(e.deltaMode==1?(n*=j2,s*=j2):(n*=O2,s*=O2)),n&&!t&&(t=n<1?-1:1),s&&!r&&(r=s<1?-1:1),{spinX:t,spinY:r,pixelX:n,pixelY:s}}Oj.getEventType=function(){return TV.firefox()?"DOMMouseScroll":EV("wheel")?"wheel":"mousewheel"};var PV=Oj,kV=PV;const SV=MC(kV);function CV(e,t,r,n,s,i){i===void 0&&(i=0);var a=zl(e,t,i),o=a.width,l=a.height,c=Math.min(o,r),d=Math.min(l,n);return c>d*s?{width:d*s,height:d}:{width:c,height:c/s}}function $V(e){return e.width>e.height?e.width/e.naturalWidth:e.height/e.naturalHeight}function $c(e,t,r,n,s){s===void 0&&(s=0);var i=zl(t.width,t.height,s),a=i.width,o=i.height;return{x:N2(e.x,a,r.width,n),y:N2(e.y,o,r.height,n)}}function N2(e,t,r,n){var s=t*n/2-r/2;return np(e,-s,s)}function D2(e,t){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function F2(e,t){return Math.atan2(t.y-e.y,t.x-e.x)*180/Math.PI}function IV(e,t,r,n,s,i,a){i===void 0&&(i=0),a===void 0&&(a=!0);var o=a?AV:jV,l=zl(t.width,t.height,i),c=zl(t.naturalWidth,t.naturalHeight,i),d={x:o(100,((l.width-r.width/s)/2-e.x/s)/l.width*100),y:o(100,((l.height-r.height/s)/2-e.y/s)/l.height*100),width:o(100,r.width/l.width*100/s),height:o(100,r.height/l.height*100/s)},h=Math.round(o(c.width,d.width*c.width/100)),u=Math.round(o(c.height,d.height*c.height/100)),p=c.width>=c.height*n,m=p?{width:Math.round(u*n),height:u}:{width:h,height:Math.round(h/n)},y=on(on({},m),{x:Math.round(o(c.width-m.width,d.x*c.width/100)),y:Math.round(o(c.height-m.height,d.y*c.height/100))});return{croppedAreaPercentages:d,croppedAreaPixels:y}}function AV(e,t){return Math.min(e,Math.max(0,t))}function jV(e,t){return t}function OV(e,t,r,n,s,i){var a=zl(t.width,t.height,r),o=np(n.width/a.width*(100/e.width),s,i),l={x:o*a.width/2-n.width/2-a.width*o*(e.x/100),y:o*a.height/2-n.height/2-a.height*o*(e.y/100)};return{crop:l,zoom:o}}function NV(e,t,r){var n=$V(t);return r.height>r.width?r.height/(e.height*n):r.width/(e.width*n)}function DV(e,t,r,n,s,i){r===void 0&&(r=0);var a=zl(t.naturalWidth,t.naturalHeight,r),o=np(NV(e,t,n),s,i),l=n.height>n.width?n.height/e.height:n.width/e.width,c={x:((a.width-e.width)/2-e.x)*l,y:((a.height-e.height)/2-e.y)*l};return{crop:c,zoom:o}}function L2(e,t){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}function FV(e){return e*Math.PI/180}function zl(e,t,r){var n=FV(r);return{width:Math.abs(Math.cos(n)*e)+Math.abs(Math.sin(n)*t),height:Math.abs(Math.sin(n)*e)+Math.abs(Math.cos(n)*t)}}function np(e,t,r){return Math.min(Math.max(e,t),r)}function hh(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(function(r){return typeof r=="string"&&r.length>0}).join(" ").trim()}var LV=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,RV=1,zV=3,BV=1,UV=function(e){Hy(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.cropperRef=ke.createRef(),r.imageRef=ke.createRef(),r.videoRef=ke.createRef(),r.containerPosition={x:0,y:0},r.containerRef=null,r.styleRef=null,r.containerRect=null,r.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},r.dragStartPosition={x:0,y:0},r.dragStartCrop={x:0,y:0},r.gestureZoomStart=0,r.gestureRotationStart=0,r.isTouching=!1,r.lastPinchDistance=0,r.lastPinchRotation=0,r.rafDragTimeout=null,r.rafPinchTimeout=null,r.wheelTimer=null,r.currentDoc=typeof document<"u"?document:null,r.currentWindow=typeof window<"u"?window:null,r.resizeObserver=null,r.previousCropSize=null,r.isInitialized=!1,r.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},r.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!r.containerRef)){var n=!0;r.resizeObserver=new window.ResizeObserver(function(s){if(n){n=!1;return}r.computeSizes()}),r.resizeObserver.observe(r.containerRef)}},r.preventZoomSafari=function(n){return n.preventDefault()},r.cleanEvents=function(){r.currentDoc&&(r.currentDoc.removeEventListener("mousemove",r.onMouseMove),r.currentDoc.removeEventListener("mouseup",r.onDragStopped),r.currentDoc.removeEventListener("touchmove",r.onTouchMove),r.currentDoc.removeEventListener("touchend",r.onDragStopped),r.currentDoc.removeEventListener("gesturechange",r.onGestureChange),r.currentDoc.removeEventListener("gestureend",r.onGestureEnd),r.currentDoc.removeEventListener("scroll",r.onScroll))},r.clearScrollEvent=function(){r.containerRef&&r.containerRef.removeEventListener("wheel",r.onWheel),r.wheelTimer&&clearTimeout(r.wheelTimer)},r.onMediaLoad=function(){var n=r.computeSizes();n&&(r.previousCropSize=n,r.emitCropData(),r.setInitialCrop(n),r.isInitialized=!0),r.props.onMediaLoaded&&r.props.onMediaLoaded(r.mediaSize)},r.setInitialCrop=function(n){if(r.props.initialCroppedAreaPercentages){var s=OV(r.props.initialCroppedAreaPercentages,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),i=s.crop,a=s.zoom;r.props.onCropChange(i),r.props.onZoomChange&&r.props.onZoomChange(a)}else if(r.props.initialCroppedAreaPixels){var o=DV(r.props.initialCroppedAreaPixels,r.mediaSize,r.props.rotation,n,r.props.minZoom,r.props.maxZoom),i=o.crop,a=o.zoom;r.props.onCropChange(i),r.props.onZoomChange&&r.props.onZoomChange(a)}},r.computeSizes=function(){var n,s,i,a,o,l,c=r.imageRef.current||r.videoRef.current;if(c&&r.containerRef){r.containerRect=r.containerRef.getBoundingClientRect(),r.saveContainerPosition();var d=r.containerRect.width/r.containerRect.height,h=((n=r.imageRef.current)===null||n===void 0?void 0:n.naturalWidth)||((s=r.videoRef.current)===null||s===void 0?void 0:s.videoWidth)||0,u=((i=r.imageRef.current)===null||i===void 0?void 0:i.naturalHeight)||((a=r.videoRef.current)===null||a===void 0?void 0:a.videoHeight)||0,p=c.offsetWidth<h||c.offsetHeight<u,m=h/u,y=void 0;if(p)switch(r.state.mediaObjectFit){default:case"contain":y=d>m?{width:r.containerRect.height*m,height:r.containerRect.height}:{width:r.containerRect.width,height:r.containerRect.width/m};break;case"horizontal-cover":y={width:r.containerRect.width,height:r.containerRect.width/m};break;case"vertical-cover":y={width:r.containerRect.height*m,height:r.containerRect.height};break}else y={width:c.offsetWidth,height:c.offsetHeight};r.mediaSize=on(on({},y),{naturalWidth:h,naturalHeight:u}),r.props.setMediaSize&&r.props.setMediaSize(r.mediaSize);var P=r.props.cropSize?r.props.cropSize:CV(r.mediaSize.width,r.mediaSize.height,r.containerRect.width,r.containerRect.height,r.props.aspect,r.props.rotation);return(((o=r.state.cropSize)===null||o===void 0?void 0:o.height)!==P.height||((l=r.state.cropSize)===null||l===void 0?void 0:l.width)!==P.width)&&r.props.onCropSizeChange&&r.props.onCropSizeChange(P),r.setState({cropSize:P},r.recomputeCropPosition),r.props.setCropSize&&r.props.setCropSize(P),P}},r.saveContainerPosition=function(){if(r.containerRef){var n=r.containerRef.getBoundingClientRect();r.containerPosition={x:n.left,y:n.top}}},r.onMouseDown=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("mousemove",r.onMouseMove),r.currentDoc.addEventListener("mouseup",r.onDragStopped),r.saveContainerPosition(),r.onDragStart(t.getMousePoint(n)))},r.onMouseMove=function(n){return r.onDrag(t.getMousePoint(n))},r.onScroll=function(n){r.currentDoc&&(n.preventDefault(),r.saveContainerPosition())},r.onTouchStart=function(n){r.currentDoc&&(r.isTouching=!0,!(r.props.onTouchRequest&&!r.props.onTouchRequest(n))&&(r.currentDoc.addEventListener("touchmove",r.onTouchMove,{passive:!1}),r.currentDoc.addEventListener("touchend",r.onDragStopped),r.saveContainerPosition(),n.touches.length===2?r.onPinchStart(n):n.touches.length===1&&r.onDragStart(t.getTouchPoint(n.touches[0]))))},r.onTouchMove=function(n){n.preventDefault(),n.touches.length===2?r.onPinchMove(n):n.touches.length===1&&r.onDrag(t.getTouchPoint(n.touches[0]))},r.onGestureStart=function(n){r.currentDoc&&(n.preventDefault(),r.currentDoc.addEventListener("gesturechange",r.onGestureChange),r.currentDoc.addEventListener("gestureend",r.onGestureEnd),r.gestureZoomStart=r.props.zoom,r.gestureRotationStart=r.props.rotation)},r.onGestureChange=function(n){if(n.preventDefault(),!r.isTouching){var s=t.getMousePoint(n),i=r.gestureZoomStart-1+n.scale;if(r.setNewZoom(i,s,{shouldUpdatePosition:!0}),r.props.onRotationChange){var a=r.gestureRotationStart+n.rotation;r.props.onRotationChange(a)}}},r.onGestureEnd=function(n){r.cleanEvents()},r.onDragStart=function(n){var s,i,a=n.x,o=n.y;r.dragStartPosition={x:a,y:o},r.dragStartCrop=on({},r.props.crop),(i=(s=r.props).onInteractionStart)===null||i===void 0||i.call(s)},r.onDrag=function(n){var s=n.x,i=n.y;r.currentWindow&&(r.rafDragTimeout&&r.currentWindow.cancelAnimationFrame(r.rafDragTimeout),r.rafDragTimeout=r.currentWindow.requestAnimationFrame(function(){if(r.state.cropSize&&!(s===void 0||i===void 0)){var a=s-r.dragStartPosition.x,o=i-r.dragStartPosition.y,l={x:r.dragStartCrop.x+a,y:r.dragStartCrop.y+o},c=r.props.restrictPosition?$c(l,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):l;r.props.onCropChange(c)}}))},r.onDragStopped=function(){var n,s;r.isTouching=!1,r.cleanEvents(),r.emitCropData(),(s=(n=r.props).onInteractionEnd)===null||s===void 0||s.call(n)},r.onWheel=function(n){if(r.currentWindow&&!(r.props.onWheelRequest&&!r.props.onWheelRequest(n))){n.preventDefault();var s=t.getMousePoint(n),i=SV(n).pixelY,a=r.props.zoom-i*r.props.zoomSpeed/200;r.setNewZoom(a,s,{shouldUpdatePosition:!0}),r.state.hasWheelJustStarted||r.setState({hasWheelJustStarted:!0},function(){var o,l;return(l=(o=r.props).onInteractionStart)===null||l===void 0?void 0:l.call(o)}),r.wheelTimer&&clearTimeout(r.wheelTimer),r.wheelTimer=r.currentWindow.setTimeout(function(){return r.setState({hasWheelJustStarted:!1},function(){var o,l;return(l=(o=r.props).onInteractionEnd)===null||l===void 0?void 0:l.call(o)})},250)}},r.getPointOnContainer=function(n,s){var i=n.x,a=n.y;if(!r.containerRect)throw new Error("The Cropper is not mounted");return{x:r.containerRect.width/2-(i-s.x),y:r.containerRect.height/2-(a-s.y)}},r.getPointOnMedia=function(n){var s=n.x,i=n.y,a=r.props,o=a.crop,l=a.zoom;return{x:(s+o.x)/l,y:(i+o.y)/l}},r.setNewZoom=function(n,s,i){var a=i===void 0?{}:i,o=a.shouldUpdatePosition,l=o===void 0?!0:o;if(!(!r.state.cropSize||!r.props.onZoomChange)){var c=np(n,r.props.minZoom,r.props.maxZoom);if(l){var d=r.getPointOnContainer(s,r.containerPosition),h=r.getPointOnMedia(d),u={x:h.x*c-d.x,y:h.y*c-d.y},p=r.props.restrictPosition?$c(u,r.mediaSize,r.state.cropSize,c,r.props.rotation):u;r.props.onCropChange(p)}r.props.onZoomChange(c)}},r.getCropData=function(){if(!r.state.cropSize)return null;var n=r.props.restrictPosition?$c(r.props.crop,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):r.props.crop;return IV(n,r.mediaSize,r.state.cropSize,r.getAspect(),r.props.zoom,r.props.rotation,r.props.restrictPosition)},r.emitCropData=function(){var n=r.getCropData();if(n){var s=n.croppedAreaPercentages,i=n.croppedAreaPixels;r.props.onCropComplete&&r.props.onCropComplete(s,i),r.props.onCropAreaChange&&r.props.onCropAreaChange(s,i)}},r.emitCropAreaChange=function(){var n=r.getCropData();if(n){var s=n.croppedAreaPercentages,i=n.croppedAreaPixels;r.props.onCropAreaChange&&r.props.onCropAreaChange(s,i)}},r.recomputeCropPosition=function(){if(r.state.cropSize){var n=r.props.crop;if(r.isInitialized&&r.previousCropSize){var s=Math.abs(r.previousCropSize.width-r.state.cropSize.width)>1e-6||Math.abs(r.previousCropSize.height-r.state.cropSize.height)>1e-6;if(s){var i=r.state.cropSize.width/r.previousCropSize.width,a=r.state.cropSize.height/r.previousCropSize.height;n={x:r.props.crop.x*i,y:r.props.crop.y*a}}}var o=r.props.restrictPosition?$c(n,r.mediaSize,r.state.cropSize,r.props.zoom,r.props.rotation):n;r.previousCropSize=r.state.cropSize,r.props.onCropChange(o),r.emitCropData()}},r.onKeyDown=function(n){var s,i,a=r.props,o=a.crop,l=a.onCropChange,c=a.keyboardStep,d=a.zoom,h=a.rotation,u=c;if(r.state.cropSize){n.shiftKey&&(u*=.2);var p=on({},o);switch(n.key){case"ArrowUp":p.y-=u,n.preventDefault();break;case"ArrowDown":p.y+=u,n.preventDefault();break;case"ArrowLeft":p.x-=u,n.preventDefault();break;case"ArrowRight":p.x+=u,n.preventDefault();break;default:return}r.props.restrictPosition&&(p=$c(p,r.mediaSize,r.state.cropSize,d,h)),n.repeat||(i=(s=r.props).onInteractionStart)===null||i===void 0||i.call(s),l(p)}},r.onKeyUp=function(n){var s,i;switch(n.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":n.preventDefault();break;default:return}r.emitCropData(),(i=(s=r.props).onInteractionEnd)===null||i===void 0||i.call(s)},r}return t.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=LV,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},t.prototype.componentWillUnmount=function(){var r,n;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(r=this.resizeObserver)===null||r===void 0||r.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((n=this.styleRef.parentNode)===null||n===void 0||n.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},t.prototype.componentDidUpdate=function(r){var n,s,i,a,o,l,c,d,h;r.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):r.aspect!==this.props.aspect?this.computeSizes():r.objectFit!==this.props.objectFit?this.computeSizes():r.zoom!==this.props.zoom?this.recomputeCropPosition():((n=r.cropSize)===null||n===void 0?void 0:n.height)!==((s=this.props.cropSize)===null||s===void 0?void 0:s.height)||((i=r.cropSize)===null||i===void 0?void 0:i.width)!==((a=this.props.cropSize)===null||a===void 0?void 0:a.width)?this.computeSizes():(((o=r.crop)===null||o===void 0?void 0:o.x)!==((l=this.props.crop)===null||l===void 0?void 0:l.x)||((c=r.crop)===null||c===void 0?void 0:c.y)!==((d=this.props.crop)===null||d===void 0?void 0:d.y))&&this.emitCropAreaChange(),r.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),r.video!==this.props.video&&((h=this.videoRef.current)===null||h===void 0||h.load());var u=this.getObjectFit();u!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:u},this.computeSizes)},t.prototype.getAspect=function(){var r=this.props,n=r.cropSize,s=r.aspect;return n?n.width/n.height:s},t.prototype.getObjectFit=function(){var r,n,s,i;if(this.props.objectFit==="cover"){var a=this.imageRef.current||this.videoRef.current;if(a&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var o=this.containerRect.width/this.containerRect.height,l=((r=this.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((n=this.videoRef.current)===null||n===void 0?void 0:n.videoWidth)||0,c=((s=this.imageRef.current)===null||s===void 0?void 0:s.naturalHeight)||((i=this.videoRef.current)===null||i===void 0?void 0:i.videoHeight)||0,d=l/c;return d<o?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},t.prototype.onPinchStart=function(r){var n=t.getTouchPoint(r.touches[0]),s=t.getTouchPoint(r.touches[1]);this.lastPinchDistance=D2(n,s),this.lastPinchRotation=F2(n,s),this.onDragStart(L2(n,s))},t.prototype.onPinchMove=function(r){var n=this;if(!(!this.currentDoc||!this.currentWindow)){var s=t.getTouchPoint(r.touches[0]),i=t.getTouchPoint(r.touches[1]),a=L2(s,i);this.onDrag(a),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var o=D2(s,i),l=n.props.zoom*(o/n.lastPinchDistance);n.setNewZoom(l,a,{shouldUpdatePosition:!1}),n.lastPinchDistance=o;var c=F2(s,i),d=n.props.rotation+(c-n.lastPinchRotation);n.props.onRotationChange&&n.props.onRotationChange(d),n.lastPinchRotation=c})}},t.prototype.render=function(){var r=this,n,s=this.props,i=s.image,a=s.video,o=s.mediaProps,l=s.cropperProps,c=s.transform,d=s.crop,h=d.x,u=d.y,p=s.rotation,m=s.zoom,y=s.cropShape,P=s.showGrid,g=s.roundCropAreaPixels,_=s.style,b=_.containerStyle,w=_.cropAreaStyle,M=_.mediaStyle,E=s.classes,T=E.containerClassName,S=E.cropAreaClassName,A=E.mediaClassName,j=(n=this.state.mediaObjectFit)!==null&&n!==void 0?n:this.getObjectFit();return ke.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(W){return r.containerRef=W},"data-testid":"container",style:b,className:hh("reactEasyCrop_Container",T)},i?ke.createElement("img",on({alt:"",className:hh("reactEasyCrop_Image",j==="contain"&&"reactEasyCrop_Contain",j==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",j==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",A)},o,{src:i,ref:this.imageRef,style:on(on({},M),{transform:c||"translate(".concat(h,"px, ").concat(u,"px) rotate(").concat(p,"deg) scale(").concat(m,")")}),onLoad:this.onMediaLoad})):a&&ke.createElement("video",on({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:hh("reactEasyCrop_Video",j==="contain"&&"reactEasyCrop_Contain",j==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",j==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",A)},o,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:on(on({},M),{transform:c||"translate(".concat(h,"px, ").concat(u,"px) rotate(").concat(p,"deg) scale(").concat(m,")")}),controls:!1}),(Array.isArray(a)?a:[{src:a}]).map(function(U){return ke.createElement("source",on({key:U.src},U))})),this.state.cropSize&&ke.createElement("div",on({ref:this.cropperRef,style:on(on({},w),{width:g?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:g?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:hh("reactEasyCrop_CropArea",y==="round"&&"reactEasyCrop_CropAreaRound",P&&"reactEasyCrop_CropAreaGrid",S)},l)))},t.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:zV,minZoom:RV,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:BV},t.getMousePoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},t.getTouchPoint=function(r){return{x:Number(r.clientX),y:Number(r.clientY)}},t}(ke.Component);const Uh=new Map,so=[],VV=(e,t,r)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){const n=Uh.get(e);if(n===void 0)Uh.set(e,{backend:t,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${r}`)}if(r>=0){const s=so.indexOf(e);s!==-1&&so.splice(s,1);for(let i=0;i<so.length;i++)if(Uh.get(so[i]).priority<=r){so.splice(i,0,e);return}so.push(e)}return}throw new TypeError("not a valid backend")},WV=async e=>{const t=Uh.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{const r=!!t.initPromise;try{return r||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(n){return r||(t.error=`${n}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},GV=async e=>{const t=e.executionProviders||[],r=t.map(l=>typeof l=="string"?l:l.name),n=r.length===0?so:r;let s;const i=[],a=new Set;for(const l of n){const c=await WV(l);typeof c=="string"?i.push({name:l,err:c}):(s||(s=c),s===c&&a.add(l))}if(!s)throw new Error(`no available backend found. ERR: ${i.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(const{name:l,err:c}of i)r.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${c}`);const o=t.filter(l=>a.has(typeof l=="string"?l:l.name));return[s,new Proxy(e,{get:(l,c)=>c==="executionProviders"?o:Reflect.get(l,c)})]},qV="1.21.0";let R2="warning";const ui={wasm:{},webgl:{},webgpu:{},versions:{common:qV},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);R2=e}},get logLevel(){return R2}};Object.defineProperty(ui,"logLevel",{enumerable:!0});const KV=ui,HV=(e,t)=>{const r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];const n=r.getContext("2d");if(n!=null){let s,i;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],i=e.dims[3]):(s=e.dims[3],i=e.dims[2]);const a=(t==null?void 0:t.format)!==void 0?t.format:"RGB",o=t==null?void 0:t.norm;let l,c;o===void 0||o.mean===void 0?l=[255,255,255,255]:typeof o.mean=="number"?l=[o.mean,o.mean,o.mean,o.mean]:(l=[o.mean[0],o.mean[1],o.mean[2],0],o.mean[3]!==void 0&&(l[3]=o.mean[3])),o===void 0||o.bias===void 0?c=[0,0,0,0]:typeof o.bias=="number"?c=[o.bias,o.bias,o.bias,o.bias]:(c=[o.bias[0],o.bias[1],o.bias[2],0],o.bias[3]!==void 0&&(c[3]=o.bias[3]));const d=i*s;let h=0,u=d,p=d*2,m=-1;a==="RGBA"?(h=0,u=d,p=d*2,m=d*3):a==="RGB"?(h=0,u=d,p=d*2):a==="RBG"&&(h=0,p=d,u=d*2);for(let y=0;y<i;y++)for(let P=0;P<s;P++){const g=(e.data[h++]-c[0])*l[0],_=(e.data[u++]-c[1])*l[1],b=(e.data[p++]-c[2])*l[2],w=m===-1?255:(e.data[m++]-c[3])*l[3];n.fillStyle="rgba("+g+","+_+","+b+","+w+")",n.fillRect(P,y,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},QV=(e,t)=>{const r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let n;if(r!=null){let s,i,a;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],i=e.dims[1],a=e.dims[3]):(s=e.dims[3],i=e.dims[2],a=e.dims[1]);const o=t!==void 0&&t.format!==void 0?t.format:"RGB",l=t==null?void 0:t.norm;let c,d;l===void 0||l.mean===void 0?c=[255,255,255,255]:typeof l.mean=="number"?c=[l.mean,l.mean,l.mean,l.mean]:(c=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(c[3]=l.mean[3])),l===void 0||l.bias===void 0?d=[0,0,0,0]:typeof l.bias=="number"?d=[l.bias,l.bias,l.bias,l.bias]:(d=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(d[3]=l.bias[3]));const h=i*s;if(t!==void 0&&(t.format!==void 0&&a===4&&t.format!=="RGBA"||a===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const u=4;let p=0,m=1,y=2,P=3,g=0,_=h,b=h*2,w=-1;o==="RGBA"?(g=0,_=h,b=h*2,w=h*3):o==="RGB"?(g=0,_=h,b=h*2):o==="RBG"&&(g=0,b=h,_=h*2),n=r.createImageData(s,i);for(let M=0;M<i*s;p+=u,m+=u,y+=u,P+=u,M++)n.data[p]=(e.data[g++]-d[0])*c[0],n.data[m]=(e.data[_++]-d[1])*c[1],n.data[y]=(e.data[b++]-d[2])*c[2],n.data[P]=w===-1?255:(e.data[w++]-d[3])*c[3]}else throw new Error("Can not access image data");return n},fg=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:r,width:n}=t,s=t.norm??{mean:255,bias:0};let i,a;typeof s.mean=="number"?i=[s.mean,s.mean,s.mean,s.mean]:i=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?a=[s.bias,s.bias,s.bias,s.bias]:a=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];const o=t.format!==void 0?t.format:"RGBA",l=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",c=r*n,d=l==="RGBA"?new Float32Array(c*4):new Float32Array(c*3);let h=4,u=0,p=1,m=2,y=3,P=0,g=c,_=c*2,b=-1;o==="RGB"&&(h=3,u=0,p=1,m=2,y=-1),l==="RGBA"?b=c*3:l==="RBG"?(P=0,_=c,g=c*2):l==="BGR"&&(_=0,g=c,P=c*2);for(let M=0;M<c;M++,u+=h,m+=h,p+=h,y+=h)d[P++]=(e[u]+a[0])/i[0],d[g++]=(e[p]+a[1])/i[1],d[_++]=(e[m]+a[2])/i[2],b!==-1&&y!==-1&&(d[b++]=(e[y]+a[3])/i[3]);return l==="RGBA"?new Ns("float32",d,[1,4,r,n]):new Ns("float32",d,[1,3,r,n])},XV=async(e,t)=>{const r=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,n=typeof ImageData<"u"&&e instanceof ImageData,s=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,i=typeof e=="string";let a,o=t??{};const l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=d=>typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||d instanceof OffscreenCanvas?d.getContext("2d"):null;if(r){const d=l();d.width=e.width,d.height=e.height;const h=c(d);if(h!=null){let u=e.height,p=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(u=t.resizedHeight,p=t.resizedWidth),t!==void 0){if(o=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");o.tensorFormat="RGBA",o.height=u,o.width=p}else o.tensorFormat="RGBA",o.height=u,o.width=p;h.drawImage(e,0,0),a=h.getImageData(0,0,p,u).data}else throw new Error("Can not access image data")}else if(n){let d,h;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(d=t.resizedHeight,h=t.resizedWidth):(d=e.height,h=e.width),t!==void 0&&(o=t),o.format="RGBA",o.height=d,o.width=h,t!==void 0){const u=l();u.width=h,u.height=d;const p=c(u);if(p!=null)p.putImageData(e,0,0),a=p.getImageData(0,0,h,d).data;else throw new Error("Can not access image data")}else a=e.data}else if(s){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");const d=l();d.width=e.width,d.height=e.height;const h=c(d);if(h!=null){const u=e.height,p=e.width;return h.drawImage(e,0,0,p,u),a=h.getImageData(0,0,p,u).data,o.height=u,o.width=p,fg(a,o)}else throw new Error("Can not access image data")}else{if(i)return new Promise((d,h)=>{const u=l(),p=c(u);if(!e||!p)return h();const m=new Image;m.crossOrigin="Anonymous",m.src=e,m.onload=()=>{u.width=m.width,u.height=m.height,p.drawImage(m,0,0,u.width,u.height);const y=p.getImageData(0,0,u.width,u.height);o.height=u.height,o.width=u.width,d(fg(y.data,o))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(a!==void 0)return fg(a,o);throw new Error("Input data provided is not supported - aborted tensor creation")},JV=(e,t)=>{const{width:r,height:n,download:s,dispose:i}=t,a=[1,n,r,4];return new Ns({location:"texture",type:"float32",texture:e,dims:a,download:s,dispose:i})},YV=(e,t)=>{const{dataType:r,dims:n,download:s,dispose:i}=t;return new Ns({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:n,download:s,dispose:i})},ZV=(e,t)=>{const{dataType:r,dims:n,download:s,dispose:i}=t;return new Ns({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:n,download:s,dispose:i})},eW=(e,t,r)=>new Ns({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]}),vl=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Vh=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let z2=!1;const tW=()=>{if(!z2){z2=!0;const e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;e&&(vl.set("int64",BigInt64Array),Vh.set(BigInt64Array,"int64")),t&&(vl.set("uint64",BigUint64Array),Vh.set(BigUint64Array,"uint64")),n?(vl.set("float16",r),Vh.set(r,"float16")):vl.set("float16",Uint16Array)}},rW=e=>{let t=1;for(let r=0;r<e.length;r++){const n=e[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);t*=n}return t},nW=(e,t)=>{switch(e.location){case"cpu":return new Ns(e.type,e.data,t);case"cpu-pinned":return new Ns({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new Ns({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new Ns({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new Ns({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}};let Ns=class{constructor(t,r,n){tW();let s,i;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,s=t.type,i=t.dims,t.location){case"cpu-pinned":{const o=vl.get(s);if(!o)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(t.data instanceof o))throw new TypeError(`buffer should be of type ${o.name}`);this.cpuData=t.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint64"&&s!=="int8"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let o,l;if(typeof t=="string")if(s=t,l=n,t==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");o=r}else{const c=vl.get(t);if(c===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(r)){if(t==="float16"&&c===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${c.name} as data.`);t==="uint64"||t==="int64"?o=c.from(r,BigInt):o=c.from(r)}else if(r instanceof c)o=r;else if(r instanceof Uint8ClampedArray)if(t==="uint8")o=Uint8Array.from(r);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&r instanceof Uint16Array&&c!==Uint16Array)o=new globalThis.Float16Array(r.buffer,r.byteOffset,r.length);else throw new TypeError(`A ${s} tensor's data must be type of ${c}`)}else if(l=r,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const c=typeof t[0];if(c==="string")s="string",o=t;else if(c==="boolean")s="bool",o=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${c}.`)}else if(t instanceof Uint8ClampedArray)s="uint8",o=Uint8Array.from(t);else{const c=Vh.get(t.constructor);if(c===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);s=c,o=t}if(l===void 0)l=[o.length];else if(!Array.isArray(l))throw new TypeError("A tensor's dims must be a number array");i=l,this.cpuData=o,this.dataLocation="cpu"}const a=rW(i);if(this.cpuData&&a!==this.cpuData.length&&!((s==="uint4"||s==="int4")&&Math.ceil(a/2)===this.cpuData.length))throw new Error(`Tensor's size(${a}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=i,this.size=a}static async fromImage(t,r){return XV(t,r)}static fromTexture(t,r){return JV(t,r)}static fromGpuBuffer(t,r){return YV(t,r)}static fromMLTensor(t,r){return ZV(t,r)}static fromPinnedBuffer(t,r,n){return eW(t,r,n)}toDataURL(t){return HV(this,t)}toImageData(t){return QV(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,t&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return nW(this,t)}};const al=Ns,Nj=(e,t)=>{(typeof ui.trace>"u"?!ui.wasm.trace:!ui.trace)||console.timeStamp(`${e}::ORT::${t}`)},Dj=(e,t)=>{var s;const r=((s=new Error().stack)==null?void 0:s.split(/\r\n|\r|\n/g))||[];let n=!1;for(let i=0;i<r.length;i++){if(n&&!r[i].includes("TRACE_FUNC")){let a=`FUNC_${e}::${r[i].trim().split(" ")[1]}`;t&&(a+=`::${t}`),Nj("CPU",a);return}r[i].includes("TRACE_FUNC")&&(n=!0)}},$0=e=>{(typeof ui.trace>"u"?!ui.wasm.trace:!ui.trace)||Dj("BEGIN",e)},I0=e=>{(typeof ui.trace>"u"?!ui.wasm.trace:!ui.trace)||Dj("END",e)};let sW=class Fj{constructor(t){this.handler=t}async run(t,r,n){$0();const s={};let i={};if(typeof t!="object"||t===null||t instanceof al||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if(typeof r=="object"){if(r===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof al)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(r.length===0)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(const c of r){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);s[c]=null}if(typeof n=="object"&&n!==null)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let c=!1;const d=Object.getOwnPropertyNames(r);for(const h of this.outputNames)if(d.indexOf(h)!==-1){const u=r[h];(u===null||u instanceof al)&&(c=!0,a=!1,s[h]=u)}if(c){if(typeof n=="object"&&n!==null)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else i=r}}else if(typeof r<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const c of this.inputNames)if(typeof t[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(a)for(const c of this.outputNames)s[c]=null;const o=await this.handler.run(t,s,i),l={};for(const c in o)if(Object.hasOwnProperty.call(o,c)){const d=o[c];d instanceof al?l[c]=d:l[c]=new al(d.type,d.data,d.dims)}return I0(),l}async release(){return this.handler.dispose()}static async create(t,r,n,s){$0();let i,a={};if(typeof t=="string"){if(i=t,typeof r=="object"&&r!==null)a=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(i=t,typeof r=="object"&&r!==null)a=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){const d=t;let h=0,u=t.byteLength;if(typeof r=="object"&&r!==null)a=r;else if(typeof r=="number"){if(h=r,!Number.isSafeInteger(h))throw new RangeError("'byteOffset' must be an integer.");if(h<0||h>=d.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${d.byteLength}).`);if(u=t.byteLength-h,typeof n=="number"){if(u=n,!Number.isSafeInteger(u))throw new RangeError("'byteLength' must be an integer.");if(u<=0||h+u>d.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${d.byteLength-h}].`);if(typeof s=="object"&&s!==null)a=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");i=new Uint8Array(d,h,u)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const[o,l]=await GV(a),c=await o.createInferenceSessionHandler(i,l);return I0(),new Fj(c)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}};const iW=sW,aW=Object.freeze(Object.defineProperty({__proto__:null,InferenceSession:iW,TRACE:Nj,TRACE_FUNC_BEGIN:$0,TRACE_FUNC_END:I0,Tensor:al,env:KV,registerBackend:VV},Symbol.toStringTag,{value:"Module"}));/*!
 * ONNX Runtime Web v1.22.0-dev.20250409-89f8206ba4
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var lw=Object.defineProperty,oW=Object.getOwnPropertyDescriptor,lW=Object.getOwnPropertyNames,cW=Object.prototype.hasOwnProperty,uW=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),Je=(e,t)=>()=>(e&&(t=e(e=0)),t),Ql=(e,t)=>{for(var r in t)lw(e,r,{get:t[r],enumerable:!0})},dW=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of lW(t))!cW.call(e,s)&&s!==r&&lw(e,s,{get:()=>t[s],enumerable:!(n=oW(t,s))||n.enumerable});return e},Ou=e=>dW(lw({},"__esModule",{value:!0}),e),Ic,ia,go,B2,Lj,Rj=Je(()=>{Ic=new Map,ia=[],go=(e,t,r)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){let n=Ic.get(e);if(n===void 0)Ic.set(e,{backend:t,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${r}`)}if(r>=0){let s=ia.indexOf(e);s!==-1&&ia.splice(s,1);for(let i=0;i<ia.length;i++)if(Ic.get(ia[i]).priority<=r){ia.splice(i,0,e);return}ia.push(e)}return}throw new TypeError("not a valid backend")},B2=async e=>{let t=Ic.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let r=!!t.initPromise;try{return r||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(n){return r||(t.error=`${n}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},Lj=async e=>{let t=e.executionProviders||[],r=t.map(l=>typeof l=="string"?l:l.name),n=r.length===0?ia:r,s,i=[],a=new Set;for(let l of n){let c=await B2(l);typeof c=="string"?i.push({name:l,err:c}):(s||(s=c),s===c&&a.add(l))}if(!s)throw new Error(`no available backend found. ERR: ${i.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(let{name:l,err:c}of i)r.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${c}`);let o=t.filter(l=>a.has(typeof l=="string"?l:l.name));return[s,new Proxy(e,{get:(l,c)=>c==="executionProviders"?o:Reflect.get(l,c)})]}}),hW=Je(()=>{Rj()}),zj,fW=Je(()=>{zj="1.22.0-dev.20250409-89f8206ba4"}),pg,As,Bj=Je(()=>{fW(),pg="warning",As={wasm:{},webgl:{},webgpu:{},versions:{common:zj},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);pg=e}},get logLevel(){return pg}},Object.defineProperty(As,"logLevel",{enumerable:!0})}),_r,pW=Je(()=>{Bj(),_r=As}),Uj,Vj,mW=Je(()=>{Uj=(e,t)=>{let r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];let n=r.getContext("2d");if(n!=null){let s,i;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],i=e.dims[3]):(s=e.dims[3],i=e.dims[2]);let a=(t==null?void 0:t.format)!==void 0?t.format:"RGB",o=t==null?void 0:t.norm,l,c;o===void 0||o.mean===void 0?l=[255,255,255,255]:typeof o.mean=="number"?l=[o.mean,o.mean,o.mean,o.mean]:(l=[o.mean[0],o.mean[1],o.mean[2],0],o.mean[3]!==void 0&&(l[3]=o.mean[3])),o===void 0||o.bias===void 0?c=[0,0,0,0]:typeof o.bias=="number"?c=[o.bias,o.bias,o.bias,o.bias]:(c=[o.bias[0],o.bias[1],o.bias[2],0],o.bias[3]!==void 0&&(c[3]=o.bias[3]));let d=i*s,h=0,u=d,p=d*2,m=-1;a==="RGBA"?(h=0,u=d,p=d*2,m=d*3):a==="RGB"?(h=0,u=d,p=d*2):a==="RBG"&&(h=0,p=d,u=d*2);for(let y=0;y<i;y++)for(let P=0;P<s;P++){let g=(e.data[h++]-c[0])*l[0],_=(e.data[u++]-c[1])*l[1],b=(e.data[p++]-c[2])*l[2],w=m===-1?255:(e.data[m++]-c[3])*l[3];n.fillStyle="rgba("+g+","+_+","+b+","+w+")",n.fillRect(P,y,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Vj=(e,t)=>{let r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(r!=null){let s,i,a;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],i=e.dims[1],a=e.dims[3]):(s=e.dims[3],i=e.dims[2],a=e.dims[1]);let o=t!==void 0&&t.format!==void 0?t.format:"RGB",l=t==null?void 0:t.norm,c,d;l===void 0||l.mean===void 0?c=[255,255,255,255]:typeof l.mean=="number"?c=[l.mean,l.mean,l.mean,l.mean]:(c=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(c[3]=l.mean[3])),l===void 0||l.bias===void 0?d=[0,0,0,0]:typeof l.bias=="number"?d=[l.bias,l.bias,l.bias,l.bias]:(d=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(d[3]=l.bias[3]));let h=i*s;if(t!==void 0&&(t.format!==void 0&&a===4&&t.format!=="RGBA"||a===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let u=4,p=0,m=1,y=2,P=3,g=0,_=h,b=h*2,w=-1;o==="RGBA"?(g=0,_=h,b=h*2,w=h*3):o==="RGB"?(g=0,_=h,b=h*2):o==="RBG"&&(g=0,b=h,_=h*2),n=r.createImageData(s,i);for(let M=0;M<i*s;p+=u,m+=u,y+=u,P+=u,M++)n.data[p]=(e.data[g++]-d[0])*c[0],n.data[m]=(e.data[_++]-d[1])*c[1],n.data[y]=(e.data[b++]-d[2])*c[2],n.data[P]=w===-1?255:(e.data[w++]-d[3])*c[3]}else throw new Error("Can not access image data");return n}}),fh,Wj,Gj,qj,Kj,Hj,gW=Je(()=>{cw(),fh=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:r,width:n}=t,s=t.norm??{mean:255,bias:0},i,a;typeof s.mean=="number"?i=[s.mean,s.mean,s.mean,s.mean]:i=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?a=[s.bias,s.bias,s.bias,s.bias]:a=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];let o=t.format!==void 0?t.format:"RGBA",l=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",c=r*n,d=l==="RGBA"?new Float32Array(c*4):new Float32Array(c*3),h=4,u=0,p=1,m=2,y=3,P=0,g=c,_=c*2,b=-1;o==="RGB"&&(h=3,u=0,p=1,m=2,y=-1),l==="RGBA"?b=c*3:l==="RBG"?(P=0,_=c,g=c*2):l==="BGR"&&(_=0,g=c,P=c*2);for(let w=0;w<c;w++,u+=h,m+=h,p+=h,y+=h)d[P++]=(e[u]+a[0])/i[0],d[g++]=(e[p]+a[1])/i[1],d[_++]=(e[m]+a[2])/i[2],b!==-1&&y!==-1&&(d[b++]=(e[y]+a[3])/i[3]);return l==="RGBA"?new fs("float32",d,[1,4,r,n]):new fs("float32",d,[1,3,r,n])},Wj=async(e,t)=>{let r=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,n=typeof ImageData<"u"&&e instanceof ImageData,s=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,i=typeof e=="string",a,o=t??{},l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=d=>typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||d instanceof OffscreenCanvas?d.getContext("2d"):null;if(r){let d=l();d.width=e.width,d.height=e.height;let h=c(d);if(h!=null){let u=e.height,p=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(u=t.resizedHeight,p=t.resizedWidth),t!==void 0){if(o=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");o.tensorFormat="RGBA",o.height=u,o.width=p}else o.tensorFormat="RGBA",o.height=u,o.width=p;h.drawImage(e,0,0),a=h.getImageData(0,0,p,u).data}else throw new Error("Can not access image data")}else if(n){let d,h;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(d=t.resizedHeight,h=t.resizedWidth):(d=e.height,h=e.width),t!==void 0&&(o=t),o.format="RGBA",o.height=d,o.width=h,t!==void 0){let u=l();u.width=h,u.height=d;let p=c(u);if(p!=null)p.putImageData(e,0,0),a=p.getImageData(0,0,h,d).data;else throw new Error("Can not access image data")}else a=e.data}else if(s){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");let d=l();d.width=e.width,d.height=e.height;let h=c(d);if(h!=null){let u=e.height,p=e.width;return h.drawImage(e,0,0,p,u),a=h.getImageData(0,0,p,u).data,o.height=u,o.width=p,fh(a,o)}else throw new Error("Can not access image data")}else{if(i)return new Promise((d,h)=>{let u=l(),p=c(u);if(!e||!p)return h();let m=new Image;m.crossOrigin="Anonymous",m.src=e,m.onload=()=>{u.width=m.width,u.height=m.height,p.drawImage(m,0,0,u.width,u.height);let y=p.getImageData(0,0,u.width,u.height);o.height=u.height,o.width=u.width,d(fh(y.data,o))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(a!==void 0)return fh(a,o);throw new Error("Input data provided is not supported - aborted tensor creation")},Gj=(e,t)=>{let{width:r,height:n,download:s,dispose:i}=t,a=[1,n,r,4];return new fs({location:"texture",type:"float32",texture:e,dims:a,download:s,dispose:i})},qj=(e,t)=>{let{dataType:r,dims:n,download:s,dispose:i}=t;return new fs({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:n,download:s,dispose:i})},Kj=(e,t)=>{let{dataType:r,dims:n,download:s,dispose:i}=t;return new fs({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:n,download:s,dispose:i})},Hj=(e,t,r)=>new fs({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]})}),co,qc,mg,Qj,_W=Je(()=>{co=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),qc=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),mg=!1,Qj=()=>{if(!mg){mg=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;e&&(co.set("int64",BigInt64Array),qc.set(BigInt64Array,"int64")),t&&(co.set("uint64",BigUint64Array),qc.set(BigUint64Array,"uint64")),n?(co.set("float16",r),qc.set(r,"float16")):co.set("float16",Uint16Array)}}}),Xj,Jj,yW=Je(()=>{cw(),Xj=e=>{let t=1;for(let r=0;r<e.length;r++){let n=e[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);t*=n}return t},Jj=(e,t)=>{switch(e.location){case"cpu":return new fs(e.type,e.data,t);case"cpu-pinned":return new fs({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new fs({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new fs({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new fs({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),fs,cw=Je(()=>{mW(),gW(),_W(),yW(),fs=class{constructor(e,t,r){Qj();let n,s;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,n=e.type,s=e.dims,e.location){case"cpu-pinned":{let a=co.get(n);if(!a)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(e.data instanceof a))throw new TypeError(`buffer should be of type ${a.name}`);this.cpuData=e.data;break}case"texture":{if(n!=="float32")throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint64"&&n!=="int8"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let a,o;if(typeof e=="string")if(n=e,o=r,e==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");a=t}else{let l=co.get(e);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if(e==="float16"&&l===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${l.name} as data.`);e==="uint64"||e==="int64"?a=l.from(t,BigInt):a=l.from(t)}else if(t instanceof l)a=t;else if(t instanceof Uint8ClampedArray)if(e==="uint8")a=Uint8Array.from(t);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&t instanceof Uint16Array&&l!==Uint16Array)a=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw new TypeError(`A ${n} tensor's data must be type of ${l}`)}else if(o=t,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let l=typeof e[0];if(l==="string")n="string",a=e;else if(l==="boolean")n="bool",a=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else if(e instanceof Uint8ClampedArray)n="uint8",a=Uint8Array.from(e);else{let l=qc.get(e.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);n=l,a=e}if(o===void 0)o=[a.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");s=o,this.cpuData=a,this.dataLocation="cpu"}let i=Xj(s);if(this.cpuData&&i!==this.cpuData.length&&!((n==="uint4"||n==="int4")&&Math.ceil(i/2)===this.cpuData.length))throw new Error(`Tensor's size(${i}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=s,this.size=i}static async fromImage(e,t){return Wj(e,t)}static fromTexture(e,t){return Gj(e,t)}static fromGpuBuffer(e,t){return qj(e,t)}static fromMLTensor(e,t){return Kj(e,t)}static fromPinnedBuffer(e,t,r){return Hj(e,t,r)}toDataURL(e){return Uj(this,e)}toImageData(e){return Vj(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Jj(this,e)}}}),ai,Yj=Je(()=>{cw(),ai=fs}),Nu,gg,hi,Rs,Zj=Je(()=>{Bj(),Nu=(e,t)=>{(typeof As.trace>"u"?!As.wasm.trace:!As.trace)||console.timeStamp(`${e}::ORT::${t}`)},gg=(e,t)=>{var s;let r=((s=new Error().stack)==null?void 0:s.split(/\r\n|\r|\n/g))||[],n=!1;for(let i=0;i<r.length;i++){if(n&&!r[i].includes("TRACE_FUNC")){let a=`FUNC_${e}::${r[i].trim().split(" ")[1]}`;t&&(a+=`::${t}`),Nu("CPU",a);return}r[i].includes("TRACE_FUNC")&&(n=!0)}},hi=e=>{(typeof As.trace>"u"?!As.wasm.trace:!As.trace)||gg("BEGIN",e)},Rs=e=>{(typeof As.trace>"u"?!As.wasm.trace:!As.trace)||gg("END",e)}}),eO,wW=Je(()=>{Rj(),Yj(),Zj(),eO=class tO{constructor(t){this.handler=t}async run(t,r,n){hi();let s={},i={};if(typeof t!="object"||t===null||t instanceof ai||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if(typeof r=="object"){if(r===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof ai)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(r.length===0)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let c of r){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);s[c]=null}if(typeof n=="object"&&n!==null)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let c=!1,d=Object.getOwnPropertyNames(r);for(let h of this.outputNames)if(d.indexOf(h)!==-1){let u=r[h];(u===null||u instanceof ai)&&(c=!0,a=!1,s[h]=u)}if(c){if(typeof n=="object"&&n!==null)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else i=r}}else if(typeof r<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of this.inputNames)if(typeof t[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(a)for(let c of this.outputNames)s[c]=null;let o=await this.handler.run(t,s,i),l={};for(let c in o)if(Object.hasOwnProperty.call(o,c)){let d=o[c];d instanceof ai?l[c]=d:l[c]=new ai(d.type,d.data,d.dims)}return Rs(),l}async release(){return this.handler.dispose()}static async create(t,r,n,s){hi();let i,a={};if(typeof t=="string"){if(i=t,typeof r=="object"&&r!==null)a=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(i=t,typeof r=="object"&&r!==null)a=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){let d=t,h=0,u=t.byteLength;if(typeof r=="object"&&r!==null)a=r;else if(typeof r=="number"){if(h=r,!Number.isSafeInteger(h))throw new RangeError("'byteOffset' must be an integer.");if(h<0||h>=d.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${d.byteLength}).`);if(u=t.byteLength-h,typeof n=="number"){if(u=n,!Number.isSafeInteger(u))throw new RangeError("'byteLength' must be an integer.");if(u<=0||h+u>d.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${d.byteLength-h}].`);if(typeof s=="object"&&s!==null)a=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");i=new Uint8Array(d,h,u)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[o,l]=await Lj(a),c=await o.createInferenceSessionHandler(i,l);return Rs(),new tO(c)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),uw,vW=Je(()=>{wW(),uw=eO}),xW=Je(()=>{}),bW=Je(()=>{}),MW=Je(()=>{}),TW=Je(()=>{}),rO={};Ql(rO,{InferenceSession:()=>uw,TRACE:()=>Nu,TRACE_FUNC_BEGIN:()=>hi,TRACE_FUNC_END:()=>Rs,Tensor:()=>ai,env:()=>_r,registerBackend:()=>go});var fi=Je(()=>{hW(),pW(),vW(),Yj(),xW(),bW(),Zj(),MW(),TW()}),dw=Je(()=>{}),nO={};Ql(nO,{default:()=>sO});var _g,yg,sO,EW=Je(()=>{var e;c3(),Ao(),hw(),_g="ort-wasm-proxy-worker",yg=((e=globalThis.self)==null?void 0:e.name)===_g,yg&&(self.onmessage=t=>{let{type:r,in:n}=t.data;try{switch(r){case"init-wasm":fw(n.wasm).then(()=>{Iw(n).then(()=>{postMessage({type:r})},s=>{postMessage({type:r,err:s})})},s=>{postMessage({type:r,err:s})});break;case"init-ep":{let{epName:s,env:i}=n;Aw(i,s).then(()=>{postMessage({type:r})},a=>{postMessage({type:r,err:a})});break}case"copy-from":{let{buffer:s}=n,i=If(s);postMessage({type:r,out:i});break}case"create":{let{model:s,options:i}=n;jw(s,i).then(a=>{postMessage({type:r,out:a})},a=>{postMessage({type:r,err:a})});break}case"release":Ow(n),postMessage({type:r});break;case"run":{let{sessionId:s,inputIndices:i,inputs:a,outputIndices:o,options:l}=n;Nw(s,i,a,o,new Array(o.length).fill(null),l).then(c=>{c.some(d=>d[3]!=="cpu")?postMessage({type:r,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:r,out:c},Fw([...a,...c]))},c=>{postMessage({type:r,err:c})});break}case"end-profiling":Dw(n),postMessage({type:r});break;default:}}catch(s){postMessage({type:r,err:s})}}),sO=yg?null:t=>new Worker(t??ds,{type:"module",name:_g})}),iO={};Ql(iO,{default:()=>aO});var wg,vg,aO,U2,PW=Je(()=>{var e,t;vg=(wg=import.meta.url,async function(r={}){var _c;var n,s,i=r,a=new Promise((v,C)=>{n=v,s=C}),o=typeof window=="object",l=typeof WorkerGlobalScope<"u",c=l&&((_c=self.name)==null?void 0:_c.startsWith("em-pthread"));i.mountExternalData=(v,C)=>{v.startsWith("./")&&(v=v.substring(2)),(i.Eb||(i.Eb=new Map)).set(v,C)},i.unmountExternalData=()=>{delete i.Eb};var d=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,pc:!0}).buffer.constructor;let h=v=>async(...C)=>{var D;try{if(i.Fb)throw Error("Session already started");let z=i.Fb={dc:C[0],errors:[]},K=await v(...C);if(i.Fb!==z)throw Error("Session mismatch");(D=i.Jb)==null||D.flush();let pe=z.errors;if(0<pe.length){let Ne=await Promise.all(pe);if(Ne=Ne.filter(Ge=>Ge),0<Ne.length)throw Error(Ne.join(`
`))}return K}finally{i.Fb=null}};i.jsepInit=(v,C)=>{if(v==="webgpu"){[i.Jb,i.Ub,i.Yb,i.Kb,i.Xb,i.jb,i.Zb,i.ac,i.Vb,i.Wb,i.$b]=C;let D=i.Jb;i.jsepRegisterBuffer=(z,K,pe,Ne)=>D.registerBuffer(z,K,pe,Ne),i.jsepGetBuffer=z=>D.getBuffer(z),i.jsepCreateDownloader=(z,K,pe)=>D.createDownloader(z,K,pe),i.jsepOnCreateSession=z=>{D.onCreateSession(z)},i.jsepOnReleaseSession=z=>{D.onReleaseSession(z)},i.jsepOnRunStart=z=>D.onRunStart(z),i.bc=(z,K)=>{D.upload(z,K)}}else if(v==="webnn"){let D=C[0];[i.nc,i.Nb,i.webnnEnsureTensor,i.Ob,i.webnnDownloadTensor]=C.slice(1),i.webnnReleaseTensorId=i.Nb,i.webnnUploadTensor=i.Ob,i.webnnOnRunStart=z=>D.onRunStart(z),i.webnnOnRunEnd=D.onRunEnd.bind(D),i.webnnRegisterMLContext=(z,K)=>{D.registerMLContext(z,K)},i.webnnOnReleaseSession=z=>{D.onReleaseSession(z)},i.webnnCreateMLTensorDownloader=(z,K)=>D.createMLTensorDownloader(z,K),i.webnnRegisterMLTensor=(z,K,pe,Ne)=>D.registerMLTensor(z,K,pe,Ne),i.webnnCreateMLContext=z=>D.createMLContext(z),i.webnnRegisterMLConstant=(z,K,pe,Ne,Ge,nt)=>D.registerMLConstant(z,K,pe,Ne,Ge,i.Eb,nt),i.webnnRegisterGraphInput=D.registerGraphInput.bind(D),i.webnnIsGraphInput=D.isGraphInput.bind(D),i.webnnCreateTemporaryTensor=D.createTemporaryTensor.bind(D),i.webnnIsInt64Supported=D.isInt64Supported.bind(D)}};let u=()=>{let v=(C,D,z)=>(...K)=>{let pe=kr,Ne=D==null?void 0:D();K=C(...K);let Ge=D==null?void 0:D();return Ne!==Ge&&(C=Ge,z(Ne),D=z=null),kr!=pe?new Promise((nt,dt)=>{wn={resolve:nt,reject:dt}}):K};(()=>{for(let C of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])i[C]=v(i[C],()=>i[C],D=>i[C]=D)})(),h!==void 0&&(i._OrtRun=h(i._OrtRun),i._OrtRunWithBinding=h(i._OrtRunWithBinding)),u=void 0};i.asyncInit=()=>{u==null||u()};var p,m,y=Object.assign({},i),P=(v,C)=>{throw C},g="";(o||l)&&(l?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),wg&&(g=wg),g=g.startsWith("blob:")?"":g.slice(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1),l&&(m=v=>{var C=new XMLHttpRequest;return C.open("GET",v,!1),C.responseType="arraybuffer",C.send(null),new Uint8Array(C.response)}),p=async v=>{if(ne(v))return new Promise((D,z)=>{var K=new XMLHttpRequest;K.open("GET",v,!0),K.responseType="arraybuffer",K.onload=()=>{K.status==200||K.status==0&&K.response?D(K.response):z(K.status)},K.onerror=z,K.send(null)});var C=await fetch(v,{credentials:"same-origin"});if(C.ok)return C.arrayBuffer();throw Error(C.status+" : "+C.url)});var _=console.log.bind(console),b=console.error.bind(console),w=_,M=b;Object.assign(i,y),y=null;var E,T,S,A,j,U,W,B,ee,Q,Z,J,X,ae=i.wasmBinary,le=!1,ne=v=>v.startsWith("file://");function L(){return E.buffer!=A.buffer&&O(),A}function F(){return E.buffer!=A.buffer&&O(),j}function G(){return E.buffer!=A.buffer&&O(),U}function oe(){return E.buffer!=A.buffer&&O(),W}function H(){return E.buffer!=A.buffer&&O(),B}function Te(){return E.buffer!=A.buffer&&O(),ee}function Ce(){return E.buffer!=A.buffer&&O(),Q}function Be(){return E.buffer!=A.buffer&&O(),X}if(c){let v=function(C){try{var D=C.data,z=D.Bb;if(z==="load"){let K=[];self.onmessage=pe=>K.push(pe),self.startWorker=()=>{postMessage({Bb:"loaded"});for(let pe of K)v(pe);self.onmessage=v};for(let pe of D.Rb)i[pe]&&!i[pe].proxy||(i[pe]=(...Ne)=>{postMessage({Bb:"callHandler",Qb:pe,args:Ne})},pe=="print"&&(w=i[pe]),pe=="printErr"&&(M=i[pe]));E=D.kc,O(),$e(D.lc)}else if(z==="run"){Hi(D.Ab),Ua(D.Ab,0,0,1,0,0),Qr(),he(D.Ab),te||(cc(),te=!0);try{Qi(D.fc,D.Hb)}catch(K){if(K!="unwind")throw K}}else D.target!=="setimmediate"&&(z==="checkMailbox"?te&&ge():z&&(M(`worker: received unknown command ${z}`),M(D)))}catch(K){throw uc(),K}};var $e,te=!1;M=function(...C){C=C.join(" "),console.error(C)},self.alert=function(...C){postMessage({Bb:"alert",text:C.join(" "),ic:Zi()})},self.onunhandledrejection=C=>{throw C.reason||C},self.onmessage=v}function O(){var v=E.buffer;i.HEAP8=A=new Int8Array(v),i.HEAP16=U=new Int16Array(v),i.HEAPU8=j=new Uint8Array(v),i.HEAPU16=W=new Uint16Array(v),i.HEAP32=B=new Int32Array(v),i.HEAPU32=ee=new Uint32Array(v),i.HEAPF32=Q=new Float32Array(v),i.HEAPF64=X=new Float64Array(v),i.HEAP64=Z=new BigInt64Array(v),i.HEAPU64=J=new BigUint64Array(v)}function ue(){c?startWorker(i):gt.Ca()}c||(E=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),O());var Ee,fe=0,me=null;function ve(){if(--fe==0&&me){var v=me;me=null,v()}}function xe(v){throw M(v="Aborted("+v+")"),le=!0,v=new WebAssembly.RuntimeError(v+". Build with -sASSERTIONS for more info."),s(v),v}function _e(){return{a:{L:Oe,Aa:we,b:bs,$:Et,A:I,pa:re,X:ce,Z:Se,qa:Re,na:ct,ga:kt,ma:xt,J:jt,Y:ot,V:Wt,oa:ar,W:In,va:Xr,E:gi,Q:Es,O:An,D:Qe,u:lt,r:lr,P:Ci,z:ye,R:N,ja:q,T:De,aa:it,M:tt,F:at,ia:he,sa:$t,t:Ir,Ba:sr,w:vn,o:tn,l:Gr,c:Ps,n:$s,j:Gu,v:qu,p:Ji,f:Ku,s:Hu,m:Qu,e:Xu,k:Ju,i:Yi,g:Yu,d:Zu,da:ed,ea:td,fa:rd,ba:Do,ca:Zl,N:Fo,xa:sp,ua:ec,h:id,C:ad,G:od,ta:sd,x:ld,ra:cd,U:ud,q:nd,y:dd,K:hd,S:tc,za:fd,ya:rc,ka:nc,la:md,_:Ve,B:sc,I:zo,ha:ic,H:ac,a:E,wa:Ke}}}var je={829644:(v,C,D,z,K)=>{if(i===void 0||!i.Eb)return 1;if((v=or(Number(v>>>0))).startsWith("./")&&(v=v.substring(2)),!(v=i.Eb.get(v)))return 2;if(C=Number(C>>>0),D=Number(D>>>0),z=Number(z>>>0),C+D>v.byteLength)return 3;try{let pe=v.subarray(C,C+D);switch(K){case 0:F().set(pe,z>>>0);break;case 1:i.mc?i.mc(z,pe):i.bc(z,pe);break;default:return 4}return 0}catch{return 4}},830468:(v,C,D)=>{i.Ob(v,F().subarray(C>>>0,C+D>>>0))},830532:()=>i.nc(),830574:v=>{i.Nb(v)},830611:()=>{i.Vb()},830642:()=>{i.Wb()},830671:()=>{i.$b()},830696:v=>i.Ub(v),830729:v=>i.Yb(v),830761:(v,C,D)=>{i.Kb(Number(v),Number(C),Number(D),!0)},830824:(v,C,D)=>{i.Kb(Number(v),Number(C),Number(D))},830881:()=>typeof wasmOffsetConverter<"u",830938:v=>{i.jb("Abs",v,void 0)},830989:v=>{i.jb("Neg",v,void 0)},831040:v=>{i.jb("Floor",v,void 0)},831093:v=>{i.jb("Ceil",v,void 0)},831145:v=>{i.jb("Reciprocal",v,void 0)},831203:v=>{i.jb("Sqrt",v,void 0)},831255:v=>{i.jb("Exp",v,void 0)},831306:v=>{i.jb("Erf",v,void 0)},831357:v=>{i.jb("Sigmoid",v,void 0)},831412:(v,C,D)=>{i.jb("HardSigmoid",v,{alpha:C,beta:D})},831491:v=>{i.jb("Log",v,void 0)},831542:v=>{i.jb("Sin",v,void 0)},831593:v=>{i.jb("Cos",v,void 0)},831644:v=>{i.jb("Tan",v,void 0)},831695:v=>{i.jb("Asin",v,void 0)},831747:v=>{i.jb("Acos",v,void 0)},831799:v=>{i.jb("Atan",v,void 0)},831851:v=>{i.jb("Sinh",v,void 0)},831903:v=>{i.jb("Cosh",v,void 0)},831955:v=>{i.jb("Asinh",v,void 0)},832008:v=>{i.jb("Acosh",v,void 0)},832061:v=>{i.jb("Atanh",v,void 0)},832114:v=>{i.jb("Tanh",v,void 0)},832166:v=>{i.jb("Not",v,void 0)},832217:(v,C,D)=>{i.jb("Clip",v,{min:C,max:D})},832286:v=>{i.jb("Clip",v,void 0)},832338:(v,C)=>{i.jb("Elu",v,{alpha:C})},832396:v=>{i.jb("Gelu",v,void 0)},832448:v=>{i.jb("Relu",v,void 0)},832500:(v,C)=>{i.jb("LeakyRelu",v,{alpha:C})},832564:(v,C)=>{i.jb("ThresholdedRelu",v,{alpha:C})},832634:(v,C)=>{i.jb("Cast",v,{to:C})},832692:v=>{i.jb("Add",v,void 0)},832743:v=>{i.jb("Sub",v,void 0)},832794:v=>{i.jb("Mul",v,void 0)},832845:v=>{i.jb("Div",v,void 0)},832896:v=>{i.jb("Pow",v,void 0)},832947:v=>{i.jb("Equal",v,void 0)},833e3:v=>{i.jb("Greater",v,void 0)},833055:v=>{i.jb("GreaterOrEqual",v,void 0)},833117:v=>{i.jb("Less",v,void 0)},833169:v=>{i.jb("LessOrEqual",v,void 0)},833228:(v,C,D,z,K)=>{i.jb("ReduceMean",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},833403:(v,C,D,z,K)=>{i.jb("ReduceMax",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},833577:(v,C,D,z,K)=>{i.jb("ReduceMin",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},833751:(v,C,D,z,K)=>{i.jb("ReduceProd",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},833926:(v,C,D,z,K)=>{i.jb("ReduceSum",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},834100:(v,C,D,z,K)=>{i.jb("ReduceL1",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},834273:(v,C,D,z,K)=>{i.jb("ReduceL2",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},834446:(v,C,D,z,K)=>{i.jb("ReduceLogSum",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},834623:(v,C,D,z,K)=>{i.jb("ReduceSumSquare",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},834803:(v,C,D,z,K)=>{i.jb("ReduceLogSumExp",v,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},834983:v=>{i.jb("Where",v,void 0)},835036:(v,C,D)=>{i.jb("Transpose",v,{perm:C?Array.from(H().subarray(Number(C)>>>0,Number(D)>>>0)):[]})},835160:(v,C,D,z)=>{i.jb("DepthToSpace",v,{blocksize:C,mode:or(D),format:z?"NHWC":"NCHW"})},835293:(v,C,D,z)=>{i.jb("DepthToSpace",v,{blocksize:C,mode:or(D),format:z?"NHWC":"NCHW"})},835426:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt,Kt,er,rn,Ii)=>{i.jb("ConvTranspose",v,{format:nt?"NHWC":"NCHW",autoPad:C,dilations:[D],group:z,kernelShape:[K],pads:[pe,Ne],strides:[Ge],wIsConst:()=>!!L()[dt>>>0],outputPadding:Nt?Array.from(H().subarray(Number(Nt)>>>0,Number(Kt)>>>0)):[],outputShape:er?Array.from(H().subarray(Number(er)>>>0,Number(rn)>>>0)):[],activation:or(Ii)})},835859:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt,Kt,er,rn)=>{i.jb("ConvTranspose",v,{format:Ge?"NHWC":"NCHW",autoPad:C,dilations:Array.from(H().subarray(Number(D)>>>0,2+(Number(D)>>>0)>>>0)),group:z,kernelShape:Array.from(H().subarray(Number(K)>>>0,2+(Number(K)>>>0)>>>0)),pads:Array.from(H().subarray(Number(pe)>>>0,4+(Number(pe)>>>0)>>>0)),strides:Array.from(H().subarray(Number(Ne)>>>0,2+(Number(Ne)>>>0)>>>0)),wIsConst:()=>!!L()[nt>>>0],outputPadding:dt?Array.from(H().subarray(Number(dt)>>>0,Number(Nt)>>>0)):[],outputShape:Kt?Array.from(H().subarray(Number(Kt)>>>0,Number(er)>>>0)):[],activation:or(rn)})},836520:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt,Kt,er,rn,Ii)=>{i.jb("ConvTranspose",v,{format:nt?"NHWC":"NCHW",autoPad:C,dilations:[D],group:z,kernelShape:[K],pads:[pe,Ne],strides:[Ge],wIsConst:()=>!!L()[dt>>>0],outputPadding:Nt?Array.from(H().subarray(Number(Nt)>>>0,Number(Kt)>>>0)):[],outputShape:er?Array.from(H().subarray(Number(er)>>>0,Number(rn)>>>0)):[],activation:or(Ii)})},836953:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt,Kt,er,rn)=>{i.jb("ConvTranspose",v,{format:Ge?"NHWC":"NCHW",autoPad:C,dilations:Array.from(H().subarray(Number(D)>>>0,2+(Number(D)>>>0)>>>0)),group:z,kernelShape:Array.from(H().subarray(Number(K)>>>0,2+(Number(K)>>>0)>>>0)),pads:Array.from(H().subarray(Number(pe)>>>0,4+(Number(pe)>>>0)>>>0)),strides:Array.from(H().subarray(Number(Ne)>>>0,2+(Number(Ne)>>>0)>>>0)),wIsConst:()=>!!L()[nt>>>0],outputPadding:dt?Array.from(H().subarray(Number(dt)>>>0,Number(Nt)>>>0)):[],outputShape:Kt?Array.from(H().subarray(Number(Kt)>>>0,Number(er)>>>0)):[],activation:or(rn)})},837614:(v,C)=>{i.jb("GlobalAveragePool",v,{format:C?"NHWC":"NCHW"})},837705:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt,Kt,er,rn)=>{i.jb("AveragePool",v,{format:rn?"NHWC":"NCHW",auto_pad:C,ceil_mode:D,count_include_pad:z,storage_order:K,dilations:pe?Array.from(H().subarray(Number(pe)>>>0,Number(Ne)>>>0)):[],kernel_shape:Ge?Array.from(H().subarray(Number(Ge)>>>0,Number(nt)>>>0)):[],pads:dt?Array.from(H().subarray(Number(dt)>>>0,Number(Nt)>>>0)):[],strides:Kt?Array.from(H().subarray(Number(Kt)>>>0,Number(er)>>>0)):[]})},838184:(v,C)=>{i.jb("GlobalAveragePool",v,{format:C?"NHWC":"NCHW"})},838275:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt,Kt,er,rn)=>{i.jb("AveragePool",v,{format:rn?"NHWC":"NCHW",auto_pad:C,ceil_mode:D,count_include_pad:z,storage_order:K,dilations:pe?Array.from(H().subarray(Number(pe)>>>0,Number(Ne)>>>0)):[],kernel_shape:Ge?Array.from(H().subarray(Number(Ge)>>>0,Number(nt)>>>0)):[],pads:dt?Array.from(H().subarray(Number(dt)>>>0,Number(Nt)>>>0)):[],strides:Kt?Array.from(H().subarray(Number(Kt)>>>0,Number(er)>>>0)):[]})},838754:(v,C)=>{i.jb("GlobalMaxPool",v,{format:C?"NHWC":"NCHW"})},838841:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt,Kt,er,rn)=>{i.jb("MaxPool",v,{format:rn?"NHWC":"NCHW",auto_pad:C,ceil_mode:D,count_include_pad:z,storage_order:K,dilations:pe?Array.from(H().subarray(Number(pe)>>>0,Number(Ne)>>>0)):[],kernel_shape:Ge?Array.from(H().subarray(Number(Ge)>>>0,Number(nt)>>>0)):[],pads:dt?Array.from(H().subarray(Number(dt)>>>0,Number(Nt)>>>0)):[],strides:Kt?Array.from(H().subarray(Number(Kt)>>>0,Number(er)>>>0)):[]})},839316:(v,C)=>{i.jb("GlobalMaxPool",v,{format:C?"NHWC":"NCHW"})},839403:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt,Kt,er,rn)=>{i.jb("MaxPool",v,{format:rn?"NHWC":"NCHW",auto_pad:C,ceil_mode:D,count_include_pad:z,storage_order:K,dilations:pe?Array.from(H().subarray(Number(pe)>>>0,Number(Ne)>>>0)):[],kernel_shape:Ge?Array.from(H().subarray(Number(Ge)>>>0,Number(nt)>>>0)):[],pads:dt?Array.from(H().subarray(Number(dt)>>>0,Number(Nt)>>>0)):[],strides:Kt?Array.from(H().subarray(Number(Kt)>>>0,Number(er)>>>0)):[]})},839878:(v,C,D,z,K)=>{i.jb("Gemm",v,{alpha:C,beta:D,transA:z,transB:K})},839982:v=>{i.jb("MatMul",v,void 0)},840036:(v,C,D,z)=>{i.jb("ArgMax",v,{keepDims:!!C,selectLastIndex:!!D,axis:z})},840144:(v,C,D,z)=>{i.jb("ArgMin",v,{keepDims:!!C,selectLastIndex:!!D,axis:z})},840252:(v,C)=>{i.jb("Softmax",v,{axis:C})},840315:(v,C)=>{i.jb("Concat",v,{axis:C})},840375:(v,C,D,z,K)=>{i.jb("Split",v,{axis:C,numOutputs:D,splitSizes:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},840531:v=>{i.jb("Expand",v,void 0)},840585:(v,C)=>{i.jb("Gather",v,{axis:Number(C)})},840656:(v,C)=>{i.jb("GatherElements",v,{axis:Number(C)})},840735:(v,C)=>{i.jb("GatherND",v,{batch_dims:Number(C)})},840814:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt)=>{i.jb("Resize",v,{antialias:C,axes:D?Array.from(H().subarray(Number(D)>>>0,Number(z)>>>0)):[],coordinateTransformMode:or(K),cubicCoeffA:pe,excludeOutside:Ne,extrapolationValue:Ge,keepAspectRatioPolicy:or(nt),mode:or(dt),nearestMode:or(Nt)})},841176:(v,C,D,z,K,pe,Ne)=>{i.jb("Slice",v,{starts:C?Array.from(H().subarray(Number(C)>>>0,Number(D)>>>0)):[],ends:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[],axes:pe?Array.from(H().subarray(Number(pe)>>>0,Number(Ne)>>>0)):[]})},841440:v=>{i.jb("Tile",v,void 0)},841492:(v,C,D)=>{i.jb("InstanceNormalization",v,{epsilon:C,format:D?"NHWC":"NCHW"})},841606:(v,C,D)=>{i.jb("InstanceNormalization",v,{epsilon:C,format:D?"NHWC":"NCHW"})},841720:v=>{i.jb("Range",v,void 0)},841773:(v,C)=>{i.jb("Einsum",v,{equation:or(C)})},841854:(v,C,D,z,K)=>{i.jb("Pad",v,{mode:C,value:D,pads:z?Array.from(H().subarray(Number(z)>>>0,Number(K)>>>0)):[]})},841997:(v,C,D,z,K,pe)=>{i.jb("BatchNormalization",v,{epsilon:C,momentum:D,spatial:!!K,trainingMode:!!z,format:pe?"NHWC":"NCHW"})},842166:(v,C,D,z,K,pe)=>{i.jb("BatchNormalization",v,{epsilon:C,momentum:D,spatial:!!K,trainingMode:!!z,format:pe?"NHWC":"NCHW"})},842335:(v,C,D)=>{i.jb("CumSum",v,{exclusive:Number(C),reverse:Number(D)})},842432:(v,C,D)=>{i.jb("DequantizeLinear",v,{axis:C,blockSize:D})},842522:(v,C,D,z,K)=>{i.jb("GridSample",v,{align_corners:C,mode:or(D),padding_mode:or(z),format:K?"NHWC":"NCHW"})},842692:(v,C,D,z,K)=>{i.jb("GridSample",v,{align_corners:C,mode:or(D),padding_mode:or(z),format:K?"NHWC":"NCHW"})},842862:(v,C)=>{i.jb("ScatterND",v,{reduction:or(C)})},842947:(v,C,D,z,K,pe,Ne,Ge,nt)=>{i.jb("Attention",v,{numHeads:C,isUnidirectional:D,maskFilterValue:z,scale:K,doRotary:pe,qkvHiddenSizes:Ne?Array.from(H().subarray(Number(Ge)>>>0,Number(Ge)+Ne>>>0)):[],pastPresentShareBuffer:!!nt})},843219:v=>{i.jb("BiasAdd",v,void 0)},843274:v=>{i.jb("BiasSplitGelu",v,void 0)},843335:v=>{i.jb("FastGelu",v,void 0)},843391:(v,C,D,z,K,pe,Ne,Ge,nt,dt,Nt,Kt,er,rn,Ii,yc)=>{i.jb("Conv",v,{format:Kt?"NHWC":"NCHW",auto_pad:C,dilations:D?Array.from(H().subarray(Number(D)>>>0,Number(z)>>>0)):[],group:K,kernel_shape:pe?Array.from(H().subarray(Number(pe)>>>0,Number(Ne)>>>0)):[],pads:Ge?Array.from(H().subarray(Number(Ge)>>>0,Number(nt)>>>0)):[],strides:dt?Array.from(H().subarray(Number(dt)>>>0,Number(Nt)>>>0)):[],w_is_const:()=>!!L()[Number(er)>>>0],activation:or(rn),activation_params:Ii?Array.from(Ce().subarray(Number(Ii)>>>0,Number(yc)>>>0)):[]})},843975:v=>{i.jb("Gelu",v,void 0)},844027:(v,C,D,z,K,pe,Ne,Ge,nt)=>{i.jb("GroupQueryAttention",v,{numHeads:C,kvNumHeads:D,scale:z,softcap:K,doRotary:pe,rotaryInterleaved:Ne,smoothSoftmax:Ge,localWindowSize:nt})},844244:(v,C,D,z)=>{i.jb("LayerNormalization",v,{axis:C,epsilon:D,simplified:!!z})},844355:(v,C,D,z)=>{i.jb("LayerNormalization",v,{axis:C,epsilon:D,simplified:!!z})},844466:(v,C,D,z,K,pe)=>{i.jb("MatMulNBits",v,{k:C,n:D,accuracyLevel:z,bits:K,blockSize:pe})},844593:(v,C,D,z,K,pe)=>{i.jb("MultiHeadAttention",v,{numHeads:C,isUnidirectional:D,maskFilterValue:z,scale:K,doRotary:pe})},844752:(v,C)=>{i.jb("QuickGelu",v,{alpha:C})},844816:(v,C,D,z,K)=>{i.jb("RotaryEmbedding",v,{interleaved:!!C,numHeads:D,rotaryEmbeddingDim:z,scale:K})},844955:(v,C,D)=>{i.jb("SkipLayerNormalization",v,{epsilon:C,simplified:!!D})},845057:(v,C,D)=>{i.jb("SkipLayerNormalization",v,{epsilon:C,simplified:!!D})},845159:(v,C,D,z)=>{i.jb("GatherBlockQuantized",v,{gatherAxis:C,quantizeAxis:D,blockSize:z})},845280:v=>{i.Zb(v)},845314:(v,C)=>i.ac(Number(v),Number(C),i.Fb.dc,i.Fb.errors)};function we(v,C,D){return Cs(async()=>{await i.Xb(Number(v),Number(C),Number(D))})}function Oe(){return typeof wasmOffsetConverter<"u"}class Me{constructor(C){ie(this,"name","ExitStatus");this.message=`Program terminated with exit(${C})`,this.status=C}}var We=v=>{v.terminate(),v.onmessage=()=>{}},Le=[],rt=v=>{wt.length==0&&(un(),Er(wt[0]));var C=wt.pop();if(!C)return 6;ut.push(C),wr[v.Ab]=C,C.Ab=v.Ab;var D={Bb:"run",fc:v.ec,Hb:v.Hb,Ab:v.Ab};return C.postMessage(D,v.Mb),0},Ye=0,ze=(v,C,...D)=>{for(var z=2*D.length,K=Wo(),pe=Wa(8*z),Ne=pe>>>3,Ge=0;Ge<D.length;Ge++){var nt=D[Ge];typeof nt=="bigint"?(Z[Ne+2*Ge]=1n,Z[Ne+2*Ge+1]=nt):(Z[Ne+2*Ge]=0n,Be()[Ne+2*Ge+1>>>0]=nt)}return v=dc(v,0,z,pe,C),Va(K),v};function Ke(v){if(c)return ze(0,1,v);if(S=v,!(0<Ye)){for(var C of ut)We(C);for(C of wt)We(C);wt=[],ut=[],wr={},le=!0}P(0,new Me(v))}function yt(v){if(c)return ze(1,0,v);Ve(v)}var Ve=v=>{if(S=v,c)throw yt(v),"unwind";Ke(v)},wt=[],ut=[],yr=[],wr={},Hr=v=>{var C=v.Ab;delete wr[C],wt.push(v),ut.splice(ut.indexOf(v),1),v.Ab=0,Bo(C)};function Qr(){yr.forEach(v=>v())}var Er=v=>new Promise(C=>{v.onmessage=K=>{var pe=(K=K.data).Bb;if(K.Gb&&K.Gb!=Zi()){var Ne=wr[K.Gb];Ne?Ne.postMessage(K,K.Mb):M(`Internal error! Worker sent a message "${pe}" to target pthread ${K.Gb}, but that thread no longer exists!`)}else pe==="checkMailbox"?ge():pe==="spawnThread"?rt(K):pe==="cleanupThread"?Hr(wr[K.hc]):pe==="loaded"?(v.loaded=!0,C(v)):pe==="alert"?alert(`Thread ${K.ic}: ${K.text}`):K.target==="setimmediate"?v.postMessage(K):pe==="callHandler"?i[K.Qb](...K.args):pe&&M(`worker sent an unknown command ${pe}`)},v.onerror=K=>{throw M(`worker sent an error! ${K.filename}:${K.lineno}: ${K.message}`),K};var D,z=[];for(D of[])i.propertyIsEnumerable(D)&&z.push(D);v.postMessage({Bb:"load",Rb:z,kc:E,lc:T})});function un(){var v=new Worker((()=>{let C=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new C("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});wt.push(v)}var Hi=v=>{O();var C=Te()[v+52>>>2>>>0];v=Te()[v+56>>>2>>>0],fc(C,C-v),Va(C)},Qi=(v,C)=>{Ye=0,v=pc(v,C),0<Ye?S=v:Uo(v)};class Xi{constructor(C){this.Ib=C-24}}function bs(v,C,D){var z=new Xi(v>>>=0);throw C>>>=0,D>>>=0,Te()[z.Ib+16>>>2>>>0]=0,Te()[z.Ib+4>>>2>>>0]=C,Te()[z.Ib+8>>>2>>>0]=D,v}function ki(v,C,D,z){return c?ze(2,1,v,C,D,z):Et(v,C,D,z)}function Et(v,C,D,z){if(v>>>=0,D>>>=0,z>>>=0,d===void 0)return 6;var K=[];return c&&K.length===0?ki(v,C>>>=0,D,z):(v={ec:D,Ab:v,Hb:z,Mb:K},c?(v.Bb="spawnThread",postMessage(v,K),0):rt(v))}var pi=typeof TextDecoder<"u"?new TextDecoder:void 0,zt=(v,C=0,D=NaN)=>{var z=(C>>>=0)+D;for(D=C;v[D]&&!(D>=z);)++D;if(16<D-C&&v.buffer&&pi)return pi.decode(v.buffer instanceof ArrayBuffer?v.subarray(C,D):v.slice(C,D));for(z="";C<D;){var K=v[C++];if(128&K){var pe=63&v[C++];if((224&K)==192)z+=String.fromCharCode((31&K)<<6|pe);else{var Ne=63&v[C++];65536>(K=(240&K)==224?(15&K)<<12|pe<<6|Ne:(7&K)<<18|pe<<12|Ne<<6|63&v[C++])?z+=String.fromCharCode(K):(K-=65536,z+=String.fromCharCode(55296|K>>10,56320|1023&K))}}else z+=String.fromCharCode(K)}return z},or=(v,C)=>(v>>>=0)?zt(F(),v,C):"";function I(v,C,D){return c?ze(3,1,v,C,D):0}function re(v,C){if(c)return ze(4,1,v,C)}var V=v=>{for(var C=0,D=0;D<v.length;++D){var z=v.charCodeAt(D);127>=z?C++:2047>=z?C+=2:55296<=z&&57343>=z?(C+=4,++D):C+=3}return C},Y=(v,C,D)=>{var z=F();if(C>>>=0,0<D){var K=C;D=C+D-1;for(var pe=0;pe<v.length;++pe){var Ne=v.charCodeAt(pe);if(55296<=Ne&&57343>=Ne&&(Ne=65536+((1023&Ne)<<10)|1023&v.charCodeAt(++pe)),127>=Ne){if(C>=D)break;z[C++>>>0]=Ne}else{if(2047>=Ne){if(C+1>=D)break;z[C++>>>0]=192|Ne>>6}else{if(65535>=Ne){if(C+2>=D)break;z[C++>>>0]=224|Ne>>12}else{if(C+3>=D)break;z[C++>>>0]=240|Ne>>18,z[C++>>>0]=128|Ne>>12&63}z[C++>>>0]=128|Ne>>6&63}z[C++>>>0]=128|63&Ne}}z[C>>>0]=0,v=C-K}else v=0;return v};function ce(v,C){if(c)return ze(5,1,v,C)}function Se(v,C,D){if(c)return ze(6,1,v,C,D)}function Re(v,C,D){return c?ze(7,1,v,C,D):0}function ct(v,C){if(c)return ze(8,1,v,C)}function kt(v,C,D){if(c)return ze(9,1,v,C,D)}function xt(v,C,D,z){if(c)return ze(10,1,v,C,D,z)}function jt(v,C,D,z){if(c)return ze(11,1,v,C,D,z)}function ot(v,C,D,z){if(c)return ze(12,1,v,C,D,z)}function Wt(v){if(c)return ze(13,1,v)}function ar(v,C){if(c)return ze(14,1,v,C)}function In(v,C,D){if(c)return ze(15,1,v,C,D)}var Bn,Nr,Xr=()=>xe(""),Dr=v=>{for(var C="";F()[v>>>0];)C+=Bn[F()[v++>>>0]];return C},Ms={},Ts={};function dn(v,C,D={}){return function(z,K,pe={}){var Ne=K.name;if(!z)throw new Nr(`type "${Ne}" must have a positive integer typeid pointer`);if(Ts.hasOwnProperty(z)){if(pe.Sb)return;throw new Nr(`Cannot register type '${Ne}' twice`)}Ts[z]=K,Ms.hasOwnProperty(z)&&(K=Ms[z],delete Ms[z],K.forEach(Ge=>Ge()))}(v,C,D)}var mi=(v,C,D)=>{switch(C){case 1:return D?z=>L()[z>>>0]:z=>F()[z>>>0];case 2:return D?z=>G()[z>>>1>>>0]:z=>oe()[z>>>1>>>0];case 4:return D?z=>H()[z>>>2>>>0]:z=>Te()[z>>>2>>>0];case 8:return D?z=>Z[z>>>3]:z=>J[z>>>3];default:throw new TypeError(`invalid integer width (${C}): ${v}`)}};function gi(v,C,D){D>>>=0,dn(v>>>=0,{name:C=Dr(C>>>0),fromWireType:z=>z,toWireType:function(z,K){if(typeof K!="bigint"&&typeof K!="number")throw K=K===null?"null":(z=typeof K)=="object"||z==="array"||z==="function"?K.toString():""+K,new TypeError(`Cannot convert "${K}" to ${this.name}`);return typeof K=="number"&&(K=BigInt(K)),K},Cb:Zr,readValueFromPointer:mi(C,D,C.indexOf("u")==-1),Db:null})}var Zr=8;function Es(v,C,D,z){dn(v>>>=0,{name:C=Dr(C>>>0),fromWireType:function(K){return!!K},toWireType:function(K,pe){return pe?D:z},Cb:Zr,readValueFromPointer:function(K){return this.fromWireType(F()[K>>>0])},Db:null})}var Xn=[],En=[];function Ps(v){9<(v>>>=0)&&--En[v+1]==0&&(En[v]=void 0,Xn.push(v))}var Wr=v=>{if(!v)throw new Nr("Cannot use deleted val. handle = "+v);return En[v]},$r=v=>{switch(v){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let C=Xn.pop()||En.length;return En[C]=v,En[C+1]=1,C}};function ks(v){return this.fromWireType(Te()[v>>>2>>>0])}var Si={name:"emscripten::val",fromWireType:v=>{var C=Wr(v);return Ps(v),C},toWireType:(v,C)=>$r(C),Cb:Zr,readValueFromPointer:ks,Db:null};function An(v){return dn(v>>>0,Si)}var He=(v,C)=>{switch(C){case 4:return function(D){return this.fromWireType(Ce()[D>>>2>>>0])};case 8:return function(D){return this.fromWireType(Be()[D>>>3>>>0])};default:throw new TypeError(`invalid float width (${C}): ${v}`)}};function Qe(v,C,D){D>>>=0,dn(v>>>=0,{name:C=Dr(C>>>0),fromWireType:z=>z,toWireType:(z,K)=>K,Cb:Zr,readValueFromPointer:He(C,D),Db:null})}function lt(v,C,D,z,K){if(v>>>=0,D>>>=0,C=Dr(C>>>0),K===-1&&(K=4294967295),K=Ge=>Ge,z===0){var pe=32-8*D;K=Ge=>Ge<<pe>>>pe}var Ne=C.includes("unsigned")?function(Ge,nt){return nt>>>0}:function(Ge,nt){return nt};dn(v,{name:C,fromWireType:K,toWireType:Ne,Cb:Zr,readValueFromPointer:mi(C,D,z!==0),Db:null})}function lr(v,C,D){function z(pe){var Ne=Te()[pe>>>2>>>0];return pe=Te()[pe+4>>>2>>>0],new K(L().buffer,pe,Ne)}var K=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][C];dn(v>>>=0,{name:D=Dr(D>>>0),fromWireType:z,Cb:Zr,readValueFromPointer:z},{Sb:!0})}function Ci(v,C){dn(v>>>=0,{name:C=Dr(C>>>0),fromWireType:function(D){for(var z,K=Te()[D>>>2>>>0],pe=D+4,Ne=pe,Ge=0;Ge<=K;++Ge){var nt=pe+Ge;Ge!=K&&F()[nt>>>0]!=0||(Ne=or(Ne,nt-Ne),z===void 0?z=Ne:(z+="\0",z+=Ne),Ne=nt+1)}return ls(D),z},toWireType:function(D,z){z instanceof ArrayBuffer&&(z=new Uint8Array(z));var K=typeof z=="string";if(!(K||z instanceof Uint8Array||z instanceof Uint8ClampedArray||z instanceof Int8Array))throw new Nr("Cannot pass non-string to std::string");var pe=K?V(z):z.length,Ne=Ba(4+pe+1),Ge=Ne+4;if(Te()[Ne>>>2>>>0]=pe,K)Y(z,Ge,pe+1);else if(K)for(K=0;K<pe;++K){var nt=z.charCodeAt(K);if(255<nt)throw ls(Ne),new Nr("String has UTF-16 code units that do not fit in 8 bits");F()[Ge+K>>>0]=nt}else for(K=0;K<pe;++K)F()[Ge+K>>>0]=z[K];return D!==null&&D.push(ls,Ne),Ne},Cb:Zr,readValueFromPointer:ks,Db(D){ls(D)}})}var Vs=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,os=(v,C)=>{for(var D=v>>1,z=D+C/2;!(D>=z)&&oe()[D>>>0];)++D;if(32<(D<<=1)-v&&Vs)return Vs.decode(F().slice(v,D));for(D="",z=0;!(z>=C/2);++z){var K=G()[v+2*z>>>1>>>0];if(K==0)break;D+=String.fromCharCode(K)}return D},Aa=(v,C,D)=>{if(D??(D=2147483647),2>D)return 0;var z=C;D=(D-=2)<2*v.length?D/2:v.length;for(var K=0;K<D;++K){var pe=v.charCodeAt(K);G()[C>>>1>>>0]=pe,C+=2}return G()[C>>>1>>>0]=0,C-z},ja=v=>2*v.length,Oa=(v,C)=>{for(var D=0,z="";!(D>=C/4);){var K=H()[v+4*D>>>2>>>0];if(K==0)break;++D,65536<=K?(K-=65536,z+=String.fromCharCode(55296|K>>10,56320|1023&K)):z+=String.fromCharCode(K)}return z},Na=(v,C,D)=>{if(C>>>=0,D??(D=2147483647),4>D)return 0;var z=C;D=z+D-4;for(var K=0;K<v.length;++K){var pe=v.charCodeAt(K);if(55296<=pe&&57343>=pe&&(pe=65536+((1023&pe)<<10)|1023&v.charCodeAt(++K)),H()[C>>>2>>>0]=pe,(C+=4)+4>D)break}return H()[C>>>2>>>0]=0,C-z},Da=v=>{for(var C=0,D=0;D<v.length;++D){var z=v.charCodeAt(D);55296<=z&&57343>=z&&++D,C+=4}return C};function ye(v,C,D){if(v>>>=0,C>>>=0,D=Dr(D>>>=0),C===2)var z=os,K=Aa,pe=ja,Ne=Ge=>oe()[Ge>>>1>>>0];else C===4&&(z=Oa,K=Na,pe=Da,Ne=Ge=>Te()[Ge>>>2>>>0]);dn(v,{name:D,fromWireType:Ge=>{for(var nt,dt=Te()[Ge>>>2>>>0],Nt=Ge+4,Kt=0;Kt<=dt;++Kt){var er=Ge+4+Kt*C;Kt!=dt&&Ne(er)!=0||(Nt=z(Nt,er-Nt),nt===void 0?nt=Nt:(nt+="\0",nt+=Nt),Nt=er+C)}return ls(Ge),nt},toWireType:(Ge,nt)=>{if(typeof nt!="string")throw new Nr(`Cannot pass non-string to C++ string type ${D}`);var dt=pe(nt),Nt=Ba(4+dt+C);return Te()[Nt>>>2>>>0]=dt/C,K(nt,Nt+4,dt+C),Ge!==null&&Ge.push(ls,Nt),Nt},Cb:Zr,readValueFromPointer:ks,Db(Ge){ls(Ge)}})}function N(v,C){dn(v>>>=0,{Tb:!0,name:C=Dr(C>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function q(v){Ua(v>>>0,!l,1,!o,131072,!1),Qr()}var se=v=>{if(!le)try{if(v(),!(0<Ye))try{c?Uo(S):Ve(S)}catch(C){C instanceof Me||C=="unwind"||P(0,C)}}catch(C){C instanceof Me||C=="unwind"||P(0,C)}};function he(v){v>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(H(),v>>>2,v).value.then(ge),v+=128,Atomics.store(H(),v>>>2,1))}var ge=()=>{var v=Zi();v&&(he(v),se(Vo))};function De(v,C){(v>>>=0)==C>>>0?setTimeout(ge):c?postMessage({Gb:v,Bb:"checkMailbox"}):(v=wr[v])&&v.postMessage({Bb:"checkMailbox"})}var Xe=[];function it(v,C,D,z,K){for(C>>>=0,z/=2,Xe.length=z,D=K>>>0>>>3,K=0;K<z;K++)Xe[K]=Z[D+2*K]?Z[D+2*K+1]:Be()[D+2*K+1>>>0];return(C?je[C]:_d[v])(...Xe)}var tt=()=>{Ye=0};function at(v){v>>>=0,c?postMessage({Bb:"cleanupThread",hc:v}):Hr(wr[v])}function $t(v){}var qt=(v,C)=>{var D=Ts[v];if(D===void 0)throw v=lc(v),D=Dr(v),ls(v),new Nr(`${C} has unknown type ${D}`);return D},Xt=(v,C,D)=>{var z=[];return v=v.toWireType(z,D),z.length&&(Te()[C>>>2>>>0]=$r(z)),v};function Ir(v,C,D){return C>>>=0,D>>>=0,v=Wr(v>>>0),C=qt(C,"emval::as"),Xt(C,D,v)}function sr(v,C){return C>>>=0,v=Wr(v>>>0),(C=qt(C,"emval::as")).toWireType(null,v)}var Pr=v=>{try{v()}catch(C){xe(C)}},Ar=0,kr=null,Un=0,en=[],Ws={},mr={},Fr=0,wn=null,Ss=[];function Cs(v){return function(C){if(!le){if(Ar===0){var D=!1,z=!1;C((K=0)=>{if(!le&&(Un=K,D=!0,z)){Ar=2,Pr(()=>gc(kr)),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.resume(),K=!1;try{var pe=function(){var nt=H()[kr+8>>>2>>>0];return nt=gt[mr[nt]],--Ye,nt()}()}catch(nt){pe=nt,K=!0}var Ne=!1;if(!kr){var Ge=wn;Ge&&(wn=null,(K?Ge.reject:Ge.resolve)(pe),Ne=!0)}if(K&&!Ne)throw pe}}),z=!0,D||(Ar=1,kr=function(){var K=Ba(65548),pe=K+12;Te()[K>>>2>>>0]=pe,Te()[K+4>>>2>>>0]=pe+65536,pe=en[0];var Ne=Ws[pe];return Ne===void 0&&(Ne=Fr++,Ws[pe]=Ne,mr[Ne]=pe),pe=Ne,H()[K+8>>>2>>>0]=pe,K}(),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.pause(),Pr(()=>Go(kr)))}else Ar===2?(Ar=0,Pr(qo),ls(kr),kr=null,Ss.forEach(se)):xe(`invalid state: ${Ar}`);return Un}}(C=>{v().then(C)})}function vn(v){return v>>>=0,Cs(async()=>{var C=await Wr(v);return $r(C)})}var jn=[];function tn(v,C,D,z){return D>>>=0,z>>>=0,(v=jn[v>>>0])(null,C=Wr(C>>>0),D,z)}var Lr={},vr=v=>{var C=Lr[v];return C===void 0?Dr(v):C};function Gr(v,C,D,z,K){return D>>>=0,z>>>=0,K>>>=0,(v=jn[v>>>0])(C=Wr(C>>>0),C[D=vr(D)],z,K)}var On=()=>typeof globalThis=="object"?globalThis:Function("return this")();function $s(v){return(v>>>=0)==0?$r(On()):(v=vr(v),$r(On()[v]))}var Oo=v=>{var C=jn.length;return jn.push(v),C},Wu=(v,C)=>{for(var D=Array(v),z=0;z<v;++z)D[z]=qt(Te()[C+4*z>>>2>>>0],"parameter "+z);return D},Xl=(v,C)=>Object.defineProperty(C,"name",{value:v});function Gu(v,C,D){var z=(C=Wu(v,C>>>0)).shift();v--;var K=`return function (obj, func, destructorsRef, args) {
`,pe=0,Ne=[];D===0&&Ne.push("obj");for(var Ge=["retType"],nt=[z],dt=0;dt<v;++dt)Ne.push("arg"+dt),Ge.push("argType"+dt),nt.push(C[dt]),K+=`  var arg${dt} = argType${dt}.readValueFromPointer(args${pe?"+"+pe:""});
`,pe+=C[dt].Cb;return K+=`  var rv = ${D===1?"new func":"func.call"}(${Ne.join(", ")});
`,z.Tb||(Ge.push("emval_returnValue"),nt.push(Xt),K+=`  return emval_returnValue(retType, destructorsRef, rv);
`),Ge.push(K+`};
`),v=function(Nt){var Kt=Function;if(!(Kt instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof Kt} which is not a function`);var er=Xl(Kt.name||"unknownFunctionName",function(){});return er.prototype=Kt.prototype,er=new er,(Nt=Kt.apply(er,Nt))instanceof Object?Nt:er}(Ge)(...nt),D=`methodCaller<(${C.map(Nt=>Nt.name).join(", ")}) => ${z.name}>`,Oo(Xl(D,v))}function qu(v){return v=vr(v>>>0),$r(i[v])}function Ji(v,C){return C>>>=0,v=Wr(v>>>0),C=Wr(C),$r(v[C])}function Ku(v){9<(v>>>=0)&&(En[v+1]+=1)}function Hu(){return $r([])}function Qu(v){v=Wr(v>>>0);for(var C=Array(v.length),D=0;D<v.length;D++)C[D]=v[D];return $r(C)}function Xu(v){return $r(vr(v>>>0))}function Ju(){return $r({})}function Yi(v){for(var C=Wr(v>>>=0);C.length;){var D=C.pop();C.pop()(D)}Ps(v)}function Yu(v,C,D){C>>>=0,D>>>=0,v=Wr(v>>>0),C=Wr(C),D=Wr(D),v[C]=D}function Zu(v,C){return C>>>=0,v=(v=qt(v>>>0,"_emval_take_value")).readValueFromPointer(C),$r(v)}function ed(v,C){v=-9007199254740992>v||9007199254740992<v?NaN:Number(v),C>>>=0,v=new Date(1e3*v),H()[C>>>2>>>0]=v.getUTCSeconds(),H()[C+4>>>2>>>0]=v.getUTCMinutes(),H()[C+8>>>2>>>0]=v.getUTCHours(),H()[C+12>>>2>>>0]=v.getUTCDate(),H()[C+16>>>2>>>0]=v.getUTCMonth(),H()[C+20>>>2>>>0]=v.getUTCFullYear()-1900,H()[C+24>>>2>>>0]=v.getUTCDay(),v=(v.getTime()-Date.UTC(v.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,H()[C+28>>>2>>>0]=v}var Jl=v=>v%4==0&&(v%100!=0||v%400==0),Yl=[0,31,60,91,121,152,182,213,244,274,305,335],No=[0,31,59,90,120,151,181,212,243,273,304,334];function td(v,C){v=-9007199254740992>v||9007199254740992<v?NaN:Number(v),C>>>=0,v=new Date(1e3*v),H()[C>>>2>>>0]=v.getSeconds(),H()[C+4>>>2>>>0]=v.getMinutes(),H()[C+8>>>2>>>0]=v.getHours(),H()[C+12>>>2>>>0]=v.getDate(),H()[C+16>>>2>>>0]=v.getMonth(),H()[C+20>>>2>>>0]=v.getFullYear()-1900,H()[C+24>>>2>>>0]=v.getDay();var D=(Jl(v.getFullYear())?Yl:No)[v.getMonth()]+v.getDate()-1|0;H()[C+28>>>2>>>0]=D,H()[C+36>>>2>>>0]=-60*v.getTimezoneOffset(),D=new Date(v.getFullYear(),6,1).getTimezoneOffset();var z=new Date(v.getFullYear(),0,1).getTimezoneOffset();v=0|(D!=z&&v.getTimezoneOffset()==Math.min(z,D)),H()[C+32>>>2>>>0]=v}function rd(v){v>>>=0;var C=new Date(H()[v+20>>>2>>>0]+1900,H()[v+16>>>2>>>0],H()[v+12>>>2>>>0],H()[v+8>>>2>>>0],H()[v+4>>>2>>>0],H()[v>>>2>>>0],0),D=H()[v+32>>>2>>>0],z=C.getTimezoneOffset(),K=new Date(C.getFullYear(),6,1).getTimezoneOffset(),pe=new Date(C.getFullYear(),0,1).getTimezoneOffset(),Ne=Math.min(pe,K);return 0>D?H()[v+32>>>2>>>0]=+(K!=pe&&Ne==z):0<D!=(Ne==z)&&(K=Math.max(pe,K),C.setTime(C.getTime()+6e4*((0<D?Ne:K)-z))),H()[v+24>>>2>>>0]=C.getDay(),D=(Jl(C.getFullYear())?Yl:No)[C.getMonth()]+C.getDate()-1|0,H()[v+28>>>2>>>0]=D,H()[v>>>2>>>0]=C.getSeconds(),H()[v+4>>>2>>>0]=C.getMinutes(),H()[v+8>>>2>>>0]=C.getHours(),H()[v+12>>>2>>>0]=C.getDate(),H()[v+16>>>2>>>0]=C.getMonth(),H()[v+20>>>2>>>0]=C.getYear(),v=C.getTime(),BigInt(isNaN(v)?-1:v/1e3)}function Do(v,C,D,z,K,pe,Ne){return c?ze(16,1,v,C,D,z,K,pe,Ne):-52}function Zl(v,C,D,z,K,pe){if(c)return ze(17,1,v,C,D,z,K,pe)}var $i={},nd=()=>performance.timeOrigin+performance.now();function Fo(v,C){if(c)return ze(18,1,v,C);if($i[v]&&(clearTimeout($i[v].id),delete $i[v]),!C)return 0;var D=setTimeout(()=>{delete $i[v],se(()=>hc(v,performance.timeOrigin+performance.now()))},C);return $i[v]={id:D,qc:C},0}function sp(v,C,D,z){v>>>=0,C>>>=0,D>>>=0,z>>>=0;var K=new Date().getFullYear(),pe=new Date(K,0,1).getTimezoneOffset();K=new Date(K,6,1).getTimezoneOffset();var Ne=Math.max(pe,K);Te()[v>>>2>>>0]=60*Ne,H()[C>>>2>>>0]=+(pe!=K),v=(C=Ge=>{var nt=Math.abs(Ge);return`UTC${0<=Ge?"-":"+"}${String(Math.floor(nt/60)).padStart(2,"0")}${String(nt%60).padStart(2,"0")}`})(pe),C=C(K),K<pe?(Y(v,D,17),Y(C,z,17)):(Y(v,z,17),Y(C,D,17))}var sd=()=>Date.now();function ec(v,C,D){return 0<=v&&3>=v?(v===0?v=Date.now():v=performance.timeOrigin+performance.now(),Z[D>>>0>>>3]=BigInt(Math.round(1e6*v)),0):28}var Fa=[],La=(v,C)=>{Fa.length=0;for(var D;D=F()[v++>>>0];){var z=D!=105;C+=(z&=D!=112)&&C%8?4:0,Fa.push(D==112?Te()[C>>>2>>>0]:D==106?Z[C>>>3]:D==105?H()[C>>>2>>>0]:Be()[C>>>3>>>0]),C+=z?8:4}return Fa};function id(v,C,D){return v>>>=0,C=La(C>>>0,D>>>0),je[v](...C)}function ad(v,C,D){return v>>>=0,C=La(C>>>0,D>>>0),je[v](...C)}var od=()=>{};function ld(v,C){return M(or(v>>>0,C>>>0))}var cd=()=>{throw Ye+=1,"unwind"};function ud(){return 4294901760}var dd=()=>navigator.hardwareConcurrency;function hd(){return xe("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function tc(v){v>>>=0;var C=F().length;if(v<=C||4294901760<v)return!1;for(var D=1;4>=D;D*=2){var z=C*(1+.2/D);z=Math.min(z,v+100663296);e:{z=(Math.min(4294901760,65536*Math.ceil(Math.max(v,z)/65536))-E.buffer.byteLength+65535)/65536|0;try{E.grow(z),O();var K=1;break e}catch{}K=void 0}if(K)return!0}return!1}var Ra=()=>(xe("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),_i={},Lo=v=>{v.forEach(C=>{Ra()})};function fd(){var v=Error().stack.toString().split(`
`);return v[0]=="Error"&&v.shift(),Lo(v),_i.Lb=Ra(),_i.cc=v,_i.Lb}function rc(v,C,D){if(v>>>=0,C>>>=0,_i.Lb==v)var z=_i.cc;else(z=Error().stack.toString().split(`
`))[0]=="Error"&&z.shift(),Lo(z);for(var K=3;z[K]&&Ra()!=v;)++K;for(v=0;v<D&&z[v+K];++v)H()[C+4*v>>>2>>>0]=Ra();return v}var Gs,Ro={},pd=()=>{if(!Gs){var v,C={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(v in Ro)Ro[v]===void 0?delete C[v]:C[v]=Ro[v];var D=[];for(v in C)D.push(`${v}=${C[v]}`);Gs=D}return Gs};function nc(v,C){if(c)return ze(19,1,v,C);v>>>=0,C>>>=0;var D=0;return pd().forEach((z,K)=>{var pe=C+D;for(K=Te()[v+4*K>>>2>>>0]=pe,pe=0;pe<z.length;++pe)L()[K++>>>0]=z.charCodeAt(pe);L()[K>>>0]=0,D+=z.length+1}),0}function md(v,C){if(c)return ze(20,1,v,C);v>>>=0,C>>>=0;var D=pd();Te()[v>>>2>>>0]=D.length;var z=0;return D.forEach(K=>z+=K.length+1),Te()[C>>>2>>>0]=z,0}function sc(v){return c?ze(21,1,v):52}function zo(v,C,D,z){return c?ze(22,1,v,C,D,z):52}function ic(v,C,D,z){return c?ze(23,1,v,C,D,z):70}var gd=[null,[],[]];function ac(v,C,D,z){if(c)return ze(24,1,v,C,D,z);C>>>=0,D>>>=0,z>>>=0;for(var K=0,pe=0;pe<D;pe++){var Ne=Te()[C>>>2>>>0],Ge=Te()[C+4>>>2>>>0];C+=8;for(var nt=0;nt<Ge;nt++){var dt=F()[Ne+nt>>>0],Nt=gd[v];dt===0||dt===10?((v===1?w:M)(zt(Nt)),Nt.length=0):Nt.push(dt)}K+=Ge}return Te()[z>>>2>>>0]=K,0}c||function(){for(var v=i.numThreads-1;v--;)un();Le.unshift(()=>{fe++,function(C){c?C():Promise.all(wt.map(Er)).then(C)}(()=>ve())})}();for(var oc=Array(256),za=0;256>za;++za)oc[za]=String.fromCharCode(za);Bn=oc,Nr=i.BindingError=class extends Error{constructor(v){super(v),this.name="BindingError"}},i.InternalError=class extends Error{constructor(v){super(v),this.name="InternalError"}},En.push(0,1,void 0,1,null,1,!0,1,!1,1),i.count_emval_handles=()=>En.length/2-5-Xn.length;var gt,_d=[Ke,yt,ki,I,re,ce,Se,Re,ct,kt,xt,jt,ot,Wt,ar,In,Do,Zl,Fo,nc,md,sc,zo,ic,ac];(async function(){function v(z,K){return gt=z.exports,gt=function(){var pe=gt,Ne={};for(let[Ge,nt]of Object.entries(pe))Ne[Ge]=typeof nt=="function"?(...dt)=>{en.push(Ge);try{return nt(...dt)}finally{le||(en.pop(),kr&&Ar===1&&en.length===0&&(Ar=0,Ye+=1,Pr(mc),typeof Fibers<"u"&&Fibers.rc()))}}:nt;return Ne}(),gt=function(){var pe=gt,Ne=nt=>dt=>nt(dt)>>>0,Ge=nt=>()=>nt()>>>0;return(pe=Object.assign({},pe)).Da=Ne(pe.Da),pe.fb=Ge(pe.fb),pe.hb=Ne(pe.hb),pe.tb=Ne(pe.tb),pe.ub=Ge(pe.ub),pe.__cxa_get_exception_ptr=Ne(pe.__cxa_get_exception_ptr),pe}(),yr.push(gt.ib),T=K,ve(),gt}fe++;var C=_e();if(i.instantiateWasm)return new Promise(z=>{i.instantiateWasm(C,(K,pe)=>{v(K,pe),z(K.exports)})});if(c)return new Promise(z=>{$e=K=>{var pe=new WebAssembly.Instance(K,_e());z(v(pe,K))}});Ee??(Ee=i.locateFile?i.locateFile?i.locateFile("ort-wasm-simd-threaded.jsep.wasm",g):g+"ort-wasm-simd-threaded.jsep.wasm":new URL("/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href);try{var D=await async function(z){var K=Ee;if(!ae&&typeof WebAssembly.instantiateStreaming=="function"&&!ne(K))try{var pe=fetch(K,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(pe,z)}catch(Ne){M(`wasm streaming compile failed: ${Ne}`),M("falling back to ArrayBuffer instantiation")}return async function(Ne,Ge){try{var nt=await async function(dt){if(!ae)try{var Nt=await p(dt);return new Uint8Array(Nt)}catch{}if(dt==Ee&&ae)dt=new Uint8Array(ae);else{if(!m)throw"both async and sync fetching of the wasm failed";dt=m(dt)}return dt}(Ne);return await WebAssembly.instantiate(nt,Ge)}catch(dt){M(`failed to asynchronously prepare wasm: ${dt}`),xe(dt)}}(K,z)}(C);return v(D.instance,D.module)}catch(z){return s(z),Promise.reject(z)}})();var lc=v=>(lc=gt.Da)(v),cc=()=>(cc=gt.Ea)();i._OrtInit=(v,C)=>(i._OrtInit=gt.Fa)(v,C),i._OrtGetLastError=(v,C)=>(i._OrtGetLastError=gt.Ga)(v,C),i._OrtCreateSessionOptions=(v,C,D,z,K,pe,Ne,Ge,nt,dt)=>(i._OrtCreateSessionOptions=gt.Ha)(v,C,D,z,K,pe,Ne,Ge,nt,dt),i._OrtAppendExecutionProvider=(v,C,D,z,K)=>(i._OrtAppendExecutionProvider=gt.Ia)(v,C,D,z,K),i._OrtAddFreeDimensionOverride=(v,C,D)=>(i._OrtAddFreeDimensionOverride=gt.Ja)(v,C,D),i._OrtAddSessionConfigEntry=(v,C,D)=>(i._OrtAddSessionConfigEntry=gt.Ka)(v,C,D),i._OrtReleaseSessionOptions=v=>(i._OrtReleaseSessionOptions=gt.La)(v),i._OrtCreateSession=(v,C,D)=>(i._OrtCreateSession=gt.Ma)(v,C,D),i._OrtReleaseSession=v=>(i._OrtReleaseSession=gt.Na)(v),i._OrtGetInputOutputCount=(v,C,D)=>(i._OrtGetInputOutputCount=gt.Oa)(v,C,D),i._OrtGetInputOutputMetadata=(v,C,D,z)=>(i._OrtGetInputOutputMetadata=gt.Pa)(v,C,D,z),i._OrtFree=v=>(i._OrtFree=gt.Qa)(v),i._OrtCreateTensor=(v,C,D,z,K,pe)=>(i._OrtCreateTensor=gt.Ra)(v,C,D,z,K,pe),i._OrtGetTensorData=(v,C,D,z,K)=>(i._OrtGetTensorData=gt.Sa)(v,C,D,z,K),i._OrtReleaseTensor=v=>(i._OrtReleaseTensor=gt.Ta)(v),i._OrtCreateRunOptions=(v,C,D,z)=>(i._OrtCreateRunOptions=gt.Ua)(v,C,D,z),i._OrtAddRunConfigEntry=(v,C,D)=>(i._OrtAddRunConfigEntry=gt.Va)(v,C,D),i._OrtReleaseRunOptions=v=>(i._OrtReleaseRunOptions=gt.Wa)(v),i._OrtCreateBinding=v=>(i._OrtCreateBinding=gt.Xa)(v),i._OrtBindInput=(v,C,D)=>(i._OrtBindInput=gt.Ya)(v,C,D),i._OrtBindOutput=(v,C,D,z)=>(i._OrtBindOutput=gt.Za)(v,C,D,z),i._OrtClearBoundOutputs=v=>(i._OrtClearBoundOutputs=gt._a)(v),i._OrtReleaseBinding=v=>(i._OrtReleaseBinding=gt.$a)(v),i._OrtRunWithBinding=(v,C,D,z,K)=>(i._OrtRunWithBinding=gt.ab)(v,C,D,z,K),i._OrtRun=(v,C,D,z,K,pe,Ne,Ge)=>(i._OrtRun=gt.bb)(v,C,D,z,K,pe,Ne,Ge),i._OrtEndProfiling=v=>(i._OrtEndProfiling=gt.cb)(v),i._JsepOutput=(v,C,D)=>(i._JsepOutput=gt.db)(v,C,D),i._JsepGetNodeName=v=>(i._JsepGetNodeName=gt.eb)(v);var Zi=()=>(Zi=gt.fb)(),ls=i._free=v=>(ls=i._free=gt.gb)(v),Ba=i._malloc=v=>(Ba=i._malloc=gt.hb)(v),Ua=(v,C,D,z,K,pe)=>(Ua=gt.kb)(v,C,D,z,K,pe),uc=()=>(uc=gt.lb)(),dc=(v,C,D,z,K)=>(dc=gt.mb)(v,C,D,z,K),Bo=v=>(Bo=gt.nb)(v),Uo=v=>(Uo=gt.ob)(v),hc=(v,C)=>(hc=gt.pb)(v,C),Vo=()=>(Vo=gt.qb)(),fc=(v,C)=>(fc=gt.rb)(v,C),Va=v=>(Va=gt.sb)(v),Wa=v=>(Wa=gt.tb)(v),Wo=()=>(Wo=gt.ub)(),pc=i.dynCall_ii=(v,C)=>(pc=i.dynCall_ii=gt.vb)(v,C),Go=v=>(Go=gt.wb)(v),mc=()=>(mc=gt.xb)(),gc=v=>(gc=gt.yb)(v),qo=()=>(qo=gt.zb)();return i.stackSave=()=>Wo(),i.stackRestore=v=>Va(v),i.stackAlloc=v=>Wa(v),i.setValue=function(v,C,D="i8"){switch(D.endsWith("*")&&(D="*"),D){case"i1":case"i8":L()[v>>>0]=C;break;case"i16":G()[v>>>1>>>0]=C;break;case"i32":H()[v>>>2>>>0]=C;break;case"i64":Z[v>>>3]=BigInt(C);break;case"float":Ce()[v>>>2>>>0]=C;break;case"double":Be()[v>>>3>>>0]=C;break;case"*":Te()[v>>>2>>>0]=C;break;default:xe(`invalid type for setValue: ${D}`)}},i.getValue=function(v,C="i8"){switch(C.endsWith("*")&&(C="*"),C){case"i1":case"i8":return L()[v>>>0];case"i16":return G()[v>>>1>>>0];case"i32":return H()[v>>>2>>>0];case"i64":return Z[v>>>3];case"float":return Ce()[v>>>2>>>0];case"double":return Be()[v>>>3>>>0];case"*":return Te()[v>>>2>>>0];default:xe(`invalid type for getValue: ${C}`)}},i.UTF8ToString=or,i.stringToUTF8=Y,i.lengthBytesUTF8=V,function v(){if(0<fe)me=v;else if(c)n(i),ue();else{for(;0<Le.length;)Le.shift()(i);0<fe?me=v:(i.calledRun=!0,le||(ue(),n(i)))}}(),i.PTR_SIZE=4,a}),aO=vg,U2=(t=(e=globalThis.self)==null?void 0:e.name)==null?void 0:t.startsWith("em-pthread"),U2&&vg()}),xg,A0,V2,ds,oO,ph,W2,G2,bg,q2,Mg,lO,Tg,cO,hw=Je(()=>{dw(),xg=typeof location>"u"?void 0:location.origin,A0=import.meta.url>"file:"&&import.meta.url<"file;",V2=()=>{{if(A0){let e=URL;return new URL(new e("ort.bundle.min.mjs",import.meta.url).href,xg).href}return import.meta.url}},ds=V2(),oO=()=>{if(ds&&!ds.startsWith("blob:"))return ds.substring(0,ds.lastIndexOf("/")+1)},ph=(e,t)=>{try{let r=t??ds;return(r?new URL(e,r):new URL(e)).origin===xg}catch{return!1}},W2=(e,t)=>{let r=t??ds;try{return(r?new URL(e,r):new URL(e)).href}catch{return}},G2=(e,t)=>`${t??"./"}${e}`,bg=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},q2=async e=>(await import(e)).default,Mg=(EW(),Ou(nO)).default,lO=async()=>{if(!ds)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(ph(ds))return[void 0,Mg()];let e=await bg(ds);return[e,Mg(e)]},Tg=(PW(),Ou(iO)).default,cO=async(e,t,r)=>{if(!e&&!t&&Tg&&ds&&ph(ds))return[void 0,Tg];{let n="ort-wasm-simd-threaded.jsep.mjs",s=e??W2(n,t),i=r&&s&&!ph(s,t),a=i?await bg(s):s??G2(n,t);return[i?a:void 0,await q2(a)]}}}),Eg,mh,Ac,Pg,K2,H2,Q2,fw,hr,Ao=Je(()=>{hw(),mh=!1,Ac=!1,Pg=!1,K2=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},H2=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Q2=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},fw=async e=>{if(mh)return Promise.resolve();if(Ac)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Pg)throw new Error("previous call to 'initializeWebAssembly()' failed.");Ac=!0;let t=e.initTimeout,r=e.numThreads;if(e.simd!==!1){if(e.simd==="relaxed"){if(!Q2())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!H2())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let n=K2();r>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=r=1);let s=e.wasmPaths,i=typeof s=="string"?s:void 0,a=s==null?void 0:s.mjs,o=(a==null?void 0:a.href)??a,l=s==null?void 0:s.wasm,c=(l==null?void 0:l.href)??l,d=e.wasmBinary,[h,u]=await cO(o,i,r>1),p=!1,m=[];if(t>0&&m.push(new Promise(y=>{setTimeout(()=>{p=!0,y()},t)})),m.push(new Promise((y,P)=>{let g={numThreads:r};if(d)g.wasmBinary=d;else if(c||i)g.locateFile=_=>c??i+_;else if(o&&o.indexOf("blob:")!==0)g.locateFile=_=>new URL(_,o).href;else if(h){let _=oO();_&&(g.locateFile=b=>_+b)}u(g).then(_=>{Ac=!1,mh=!0,Eg=_,y(),h&&URL.revokeObjectURL(h)},_=>{Ac=!1,Pg=!0,P(_)})})),await Promise.race(m),p)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},hr=()=>{if(mh&&Eg)return Eg;throw new Error("WebAssembly is not initialized yet.")}}),ii,Ef,ir,pw=Je(()=>{Ao(),ii=(e,t)=>{let r=hr(),n=r.lengthBytesUTF8(e)+1,s=r._malloc(n);return r.stringToUTF8(e,s,n),t.push(s),s},Ef=(e,t,r,n)=>{if(typeof e=="object"&&e!==null){if(r.has(e))throw new Error("Circular reference in options");r.add(e)}Object.entries(e).forEach(([s,i])=>{let a=t?t+s:s;if(typeof i=="object")Ef(i,a+".",r,n);else if(typeof i=="string"||typeof i=="number")n(a,i.toString());else if(typeof i=="boolean")n(a,i?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof i}`)})},ir=e=>{let t=hr(),r=t.stackSave();try{let n=t.PTR_SIZE,s=t.stackAlloc(2*n);t._OrtGetLastError(s,s+n);let i=Number(t.getValue(s,n===4?"i32":"i64")),a=t.getValue(s+n,"*"),o=a?t.UTF8ToString(a):"";throw new Error(`${e} ERROR_CODE: ${i}, ERROR_MESSAGE: ${o}`)}finally{t.stackRestore(r)}}}),uO,kW=Je(()=>{Ao(),pw(),uO=e=>{let t=hr(),r=0,n=[],s=e||{};try{if((e==null?void 0:e.logSeverityLevel)===void 0)s.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if((e==null?void 0:e.logVerbosityLevel)===void 0)s.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);(e==null?void 0:e.terminate)===void 0&&(s.terminate=!1);let i=0;return(e==null?void 0:e.tag)!==void 0&&(i=ii(e.tag,n)),r=t._OrtCreateRunOptions(s.logSeverityLevel,s.logVerbosityLevel,!!s.terminate,i),r===0&&ir("Can't create run options."),(e==null?void 0:e.extra)!==void 0&&Ef(e.extra,"",new WeakSet,(a,o)=>{let l=ii(a,n),c=ii(o,n);t._OrtAddRunConfigEntry(r,l,c)!==0&&ir(`Can't set a run config entry: ${a} - ${o}.`)}),[r,n]}catch(i){throw r!==0&&t._OrtReleaseRunOptions(r),n.forEach(a=>t._free(a)),i}}}),X2,J2,Y2,jc,Z2,dO,SW=Je(()=>{Ao(),pw(),X2=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},J2=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},Y2=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(r=>(typeof r=="string"?r:r.name)==="webgpu")&&(e.enableMemPattern=!1)},jc=(e,t,r,n)=>{let s=ii(t,n),i=ii(r,n);hr()._OrtAddSessionConfigEntry(e,s,i)!==0&&ir(`Can't set a session config entry: ${t} - ${r}.`)},Z2=async(e,t,r)=>{for(let n of t){let s=typeof n=="string"?n:n.name,i=[];switch(s){case"webnn":if(s="WEBNN",typeof n!="string"){let d=n==null?void 0:n.deviceType;d&&jc(e,"deviceType",d,r)}break;case"webgpu":if(s="JS",typeof n!="string"){let d=n;if(d!=null&&d.preferredLayout){if(d.preferredLayout!=="NCHW"&&d.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${d.preferredLayout}`);jc(e,"preferredLayout",d.preferredLayout,r)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${s}`)}let a=ii(s,r),o=i.length,l=0,c=0;if(o>0){l=hr()._malloc(o*hr().PTR_SIZE),r.push(l),c=hr()._malloc(o*hr().PTR_SIZE),r.push(c);for(let d=0;d<o;d++)hr().setValue(l+d*hr().PTR_SIZE,i[d][0],"*"),hr().setValue(c+d*hr().PTR_SIZE,i[d][1],"*")}await hr()._OrtAppendExecutionProvider(e,a,l,c,o)!==0&&ir(`Can't append execution provider: ${s}.`)}},dO=async e=>{let t=hr(),r=0,n=[],s=e||{};Y2(s);try{let i=X2(s.graphOptimizationLevel??"all"),a=J2(s.executionMode??"sequential"),o=typeof s.logId=="string"?ii(s.logId,n):0,l=s.logSeverityLevel??2;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log serverity level is not valid: ${l}`);let c=s.logVerbosityLevel??0;if(!Number.isInteger(c)||c<0||c>4)throw new Error(`log verbosity level is not valid: ${c}`);let d=typeof s.optimizedModelFilePath=="string"?ii(s.optimizedModelFilePath,n):0;if(r=t._OrtCreateSessionOptions(i,!!s.enableCpuMemArena,!!s.enableMemPattern,a,!!s.enableProfiling,0,o,l,c,d),r===0&&ir("Can't create session options."),s.executionProviders&&await Z2(r,s.executionProviders,n),s.enableGraphCapture!==void 0){if(typeof s.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${s.enableGraphCapture}`);jc(r,"enableGraphCapture",s.enableGraphCapture.toString(),n)}if(s.freeDimensionOverrides)for(let[h,u]of Object.entries(s.freeDimensionOverrides)){if(typeof h!="string")throw new Error(`free dimension override name must be a string: ${h}`);if(typeof u!="number"||!Number.isInteger(u)||u<0)throw new Error(`free dimension override value must be a non-negative integer: ${u}`);let p=ii(h,n);t._OrtAddFreeDimensionOverride(r,p,u)!==0&&ir(`Can't set a free dimension override: ${h} - ${u}.`)}return s.extra!==void 0&&Ef(s.extra,"",new WeakSet,(h,u)=>{jc(r,h,u,n)}),[r,n]}catch(i){throw r!==0&&t._OrtReleaseSessionOptions(r)!==0&&ir("Can't release session options."),n.forEach(a=>t._free(a)),i}}}),ol,Fi,uo,mw,Pf,gw,_w,j0,Ct=Je(()=>{ol=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},Fi=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},uo=(e,t)=>{let r=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],n=typeof t=="number"?t:t.reduce((s,i)=>s*i,1);return r>0?Math.ceil(n*r):void 0},mw=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},Pf=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},gw=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",_w=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",j0=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),yw,hO=Je(()=>{dw(),yw=async e=>{if(typeof e=="string"){let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let r=t.headers.get("Content-Length"),n=r?parseInt(r,10):0;if(n<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let s=t.body.getReader(),i;try{i=new ArrayBuffer(n)}catch(o){if(o instanceof RangeError){let l=Math.ceil(n/65536);i=new WebAssembly.Memory({initial:l,maximum:l}).buffer}else throw o}let a=0;for(;;){let{done:o,value:l}=await s.read();if(o)break;let c=l.byteLength;new Uint8Array(i,a,c).set(l),a+=c}return new Uint8Array(i,0,n)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),eP,tP,rP,nP,ww,sP,Ht,Ki=Je(()=>{Ct(),eP=["V","I","W","E","F"],tP=(e,t)=>{console.log(`[${eP[e]},${new Date().toISOString()}]${t}`)},ww=(e,t)=>{rP=e,nP=t},sP=(e,t)=>{let r=Pf(e),n=Pf(rP);r>=n&&tP(r,typeof t=="function"?t():t)},Ht=(...e)=>{nP&&sP(...e)}}),iP,Bl,Ae,kf,fO,pO,mO,Lt=Je(()=>{iP=class{static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},Bl=class{static calcShape(e,t,r=!1){let n=e.length,s=t.length;if(n===0)return t;if(s===0)return e;let i=Math.max(e.length,t.length),a=new Array(i);if(r){if(n<2||s<2)return;let o=iP.calcMatMulShape([e[n-2],e[n-1]],[t[s-2],t[s-1]]);if(o===void 0)return;[a[i-2],a[i-1]]=o}for(let o=r?3:1;o<=i;o++){let l=n-o<0?1:e[n-o],c=s-o<0?1:t[s-o];if(l!==c&&l>1&&c>1)return;let d=Math.max(l,c);if(l&&c)a[i-o]=Math.max(l,c);else{if(d>1)return;a[i-o]=0}}return a}static isValidBroadcast(e,t){let r=e.length,n=t.length;if(r>n)return!1;for(let s=1;s<=r;s++)if(e[r-s]!==1&&e[r-s]!==t[n-s])return!1;return!0}},Ae=class Wh{static size(t){return Wh.getSizeFromDimensionRange(t,0,t.length)}static convertShape(t,r=4){let n=t.length;if(n===0)return[];let s=new Array(n),i=n-1;for(;i>=0;){if(t[i]%r===0){s[i]=t[i]/r;break}if(r%t[i]!==0)throw new Error("cannot convert shape");s[i]=1,r/=t[i],i--}for(i--;i>=0;i--)s[i]=t[i];return s}static sizeFromDimension(t,r){if(r<0||r>t.length)throw new Error(`invalid dimension of ${r} for sizeFromDimension as Tensor has ${t.length} dimensions.`);return Wh.getSizeFromDimensionRange(t,r,t.length)}static sizeToDimension(t,r){if(r<0||r>t.length)throw new Error(`invalid dimension of ${r} for sizeToDimension as Tensor has ${t.length} dimensions.`);return Wh.getSizeFromDimensionRange(t,0,r)}static getSizeFromDimensionRange(t,r,n){let s=1;for(let i=r;i<n;i++){if(t[i]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");s*=Number(t[i])}return s}static computeStrides(t){let r=t.length;if(r===0)return[];if(r===1)return[1];let n=new Array(r);n[r-1]=1,n[r-2]=t[r-1];for(let s=r-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}static normalizeAxis(t,r){if(t<-r&&t>=r)throw new Error("unsupported axis for this operation.");return t<0?t+r:t}static normalizeAxes(t,r){return t.map(n=>this.normalizeAxis(n,r??t.length))}static sortBasedOnPerm(t,r){return r?r.map(n=>t[n]):t.slice().reverse()}static padShape(t,r){let n=t.length;return t.map((s,i)=>s+r[i]+r[i+n])}static areEqual(t,r){return t.length!==r.length?!1:t.every((n,s)=>n===r[s])}},kf=class Kc{static adjustPoolAttributes(t,r,n,s,i,a){if(!t&&n.length!==r.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let o=0;o<r.length-2;o++)o>=n.length?n.push(r[o+2]):n[o]=r[o+2];for(let o=0;o<n.length;o++)if(o<s.length){if(s[o]<0)throw new Error("strides should be greater than or equal to 1")}else s.push(1);for(let o=0;o<n.length;o++)if(o<i.length){if(i[o]<0)throw new Error("dilations should be greater than or equal to 1")}else i.push(1);for(let o=0;o<n.length*2;o++)if(o<a.length){if(a[o]<0)throw new Error("pad should be greater than or equal to 1")}else a.push(0);for(let o=0;o<n.length;o++){if(n[o]<=0)throw new Error("kernel shapes need to be greater than 0");if(a[o]>=n[o]||a[o+n.length]>=n[o])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,r,n,s,i,a,o){if(o){if(i.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(r.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(s.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let l=0;l<t.length-2;l++)Kc.adjustPadAndReturnShape(t[l+(a?1:2)],r[l],n[l],s[l],i,l,l+t.length-2,o)}}static computePoolOutputShape(t,r,n,s,i,a,o){if(r.length<=0)throw new Error("input shape must be of size greater than 0");let l=[r[0],r[1]];return Kc.computeShapeHelper(t,r,l,n,s,i,a,o),l}static computeConvOutputShape(t,r,n,s,i,a,o){if(t.length<=0||r.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let l=[t[0],r[0]];return Kc.computeShapeHelper(!1,t,l,n,s,i,a,o),l}static computeShapeHelper(t,r,n,s,i,a,o,l){if(t)for(let c=0;c<r.length-2;c++)n.push(1);else for(let c=0;c<r.length-2;c++)n.push(Kc.adjustPadAndReturnShape(r[c+2],s[c],i[c],a[c],o,c,c+r.length-2,l))}static adjustPadAndReturnShape(t,r,n,s,i,a,o,l){let c=n*(s-1)+1;if(l&&l!=="NOTSET")switch(l){case"VALID":return i[a]=0,i[o]=0,Math.floor((t-c)/r+1);case"SAME_LOWER":case"SAME_UPPER":if(n!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let d=((t+r-1)/r-1)*r+s-t;return i[a]=Math.floor(l==="SAME_LOWER"?(d+1)/2:d/2),i[o]=d-i[a],Math.floor((t+d-s)/r+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((t+i[a]+i[o]-c)/r+1)}},fO=class{static getShapeOfGemmResult(e,t,r,n,s){if(e.length!==2||r.length!==2)throw new Error("shape need to be of size 2");let i,a,o;t?(i=e[1],a=e[0]):(i=e[0],a=e[1]);let l=-1;if(n?(o=r[0],l=1):(o=r[1],l=0),r[l]!==a)throw new Error("dimension mismatch");if(i<=0||o<=0||a<=0)throw new Error("invalid shape specified");if(s&&!Bl.isValidBroadcast(s,[i,o]))throw new Error("gemm: invalid bias shape for broadcast");return[i,o,a]}},pO=-34028234663852886e22,mO=34028234663852886e22}),vw,gO=Je(()=>{Ct(),vw=(e,t)=>new(mw(t))(e)}),O0,kg,aP,Sg,oP,Cg,$g,Ig,lP,_O,CW=Je(()=>{Ki(),O0=(e,t=!0)=>{if(e.byteLength%8!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 8 (BigInt).");let r=e.byteLength/8,n=new BigInt64Array(e.buffer,e.byteOffset,r),s=new Int32Array(r);for(let i=0;i<r;i++){let a=n[i];if(a>2147483647n||a<-2147483648n)throw new Error(`Overflow occurred when converting BigInt to Int32 at index ${i}: ${a}`);s[i]=Number(a)}return t?new Uint8Array(s.buffer):s},kg=(e,t=!0)=>{if(e.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (Int32).");let r=e.byteLength/4,n=new Int32Array(e.buffer,e.byteOffset,r),s=BigInt64Array.from(n,BigInt);return t?new Uint8Array(s.buffer):s},aP=1,Sg=()=>aP++,oP=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),Cg=(e,t)=>{let r=oP.get(e);if(!r)throw new Error("Unsupported data type.");return t.length>0?Math.ceil(t.reduce((n,s)=>n*s)*r/8):0},$g=class{constructor(e){this.shouldConvertInt64toInt32=!1,this.isInt64ToInt32Converted=!1;let{sessionId:t,context:r,tensor:n,dataType:s,shape:i,shouldConvertInt64toInt32:a=!1}=e;this.sessionId=t,this.mlContext=r,this.mlTensor=n,this.dataType=s,this.tensorShape=i,this.shouldConvertInt64toInt32=a}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return Cg(this.dataType,this.tensorShape)}destroy(){Ht("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e,t){if(e){let r=await this.mlContext.readTensor(this.mlTensor),n=kg(new Uint8Array(r));if(t){(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(n);return}else return n.buffer}else return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,t,r){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===r.length&&this.tensorShape.every((n,s)=>n===r[s])}setIsInt64ToInt32Converted(e){this.isInt64ToInt32Converted=e}},Ig=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,r,n){let s=t,i=this.tensorManager.getMLContext(e),a=s==="int64"&&!i.opSupportLimits().input.dataTypes.includes("int64");if(a&&(s="int32",Ht("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: convert dataType from int64 to int32")),this.wrapper){if(this.wrapper.canReuseTensor(i,s,r))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==Cg(s,r))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let o=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,s,r,o,!0,!0,a),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper)if(this.wrapper.shouldConvertInt64toInt32&&(t=O0(e,!0),this.wrapper.setIsInt64ToInt32Converted(!0)),t.byteLength===this.wrapper.byteLength){this.wrapper.write(t);return}else Ht("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){var t,r,n;if(this.activeUpload){let s=(t=this.wrapper)!=null&&t.isInt64ToInt32Converted?kg(this.activeUpload):this.activeUpload;if(e){e instanceof ArrayBuffer?new Uint8Array(e).set(s):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(s);return}else return s.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read((r=this.wrapper)==null?void 0:r.shouldConvertInt64toInt32,e):this.wrapper.read((n=this.wrapper)==null?void 0:n.shouldConvertInt64toInt32)}},lP=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=Sg();return this.tensorTrackersById.set(e,new Ig(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,r,n,s){Ht("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${r}, shape: ${n}, copyOld: ${s}}`);let i=this.tensorTrackersById.get(t);if(!i)throw new Error("Tensor not found.");return i.ensureTensor(e,r,n,s)}upload(e,t){let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");r.upload(t)}async download(e,t){Ht("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t==null?void 0:t.byteLength}}`);let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");return r.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,r,n){let s=this.getMLContext(e),i=Sg(),a=new $g({sessionId:e,context:s,tensor:t,dataType:r,shape:n});return this.tensorTrackersById.set(i,new Ig(this,a)),this.externalTensors.add(a),i}async getCachedTensor(e,t,r,n,s,i,a=!1){let o=this.getMLContext(e);for(let[c,d]of this.freeTensors.entries())if(d.canReuseTensor(o,t,r)){Ht("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, shape: ${r}}`);let h=this.freeTensors.splice(c,1)[0];return h.sessionId=e,h}Ht("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, shape: ${r}}`);let l=await o.createTensor({dataType:t,shape:r,dimensions:r,usage:n,writable:s,readable:i});return new $g({sessionId:e,context:o,tensor:l,dataType:t,shape:r,shouldConvertInt64toInt32:a})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},_O=(...e)=>new lP(...e)}),gh,cP,yO,$W=Je(()=>{Ct(),Ao(),gO(),CW(),Ki(),gh=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),cP=(e,t)=>{if(e===t)return!0;if(e===void 0||t===void 0)return!1;let r=Object.keys(e).sort(),n=Object.keys(t).sort();return r.length===n.length&&r.every((s,i)=>s===n[i]&&e[s]===t[s])},yO=class{constructor(e){this.tensorManager=_O(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,ww(e.logLevel,!!e.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(e){Ht("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){Ht("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let r of t)Ht("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${r}}`),this.tensorManager.releaseTensorId(r);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let r=this.mlContextCache.findIndex(n=>n.gpuDevice===e);if(r!==-1)return this.mlContextCache[r].mlContext;{let n=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:n}),n}}else if(e===void 0){let r=this.mlContextCache.findIndex(n=>n.options===void 0&&n.gpuDevice===void 0);if(r!==-1)return this.mlContextCache[r].mlContext;{let n=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:n}),n}}let t=this.mlContextCache.findIndex(r=>cP(r.options,e));if(t!==-1)return this.mlContextCache[t].mlContext;{let r=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:r}),r}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let r=this.sessionIdsByMLContext.get(t);r||(r=new Set,this.sessionIdsByMLContext.set(t,r)),r.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let r=this.sessionIdsByMLContext.get(t);if(r.delete(e),r.size===0){this.sessionIdsByMLContext.delete(t);let n=this.mlContextCache.findIndex(s=>s.mlContext===t);n!==-1&&this.mlContextCache.splice(n,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){Ht("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,r,n,s){let i=gh.get(r);if(!i)throw new Error(`Unsupported ONNX data type: ${r}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,i,n,s)}async createTemporaryTensor(e,t,r){Ht("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${r}}`);let n=gh.get(t);if(!n)throw new Error(`Unsupported ONNX data type: ${t}`);let s=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,s,n,r,!1);let i=this.temporarySessionTensorIds.get(e);return i?i.push(s):this.temporarySessionTensorIds.set(e,[s]),s}uploadTensor(e,t){if(!hr().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");Ht("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let r=await this.tensorManager.download(e);return vw(r,t)}}registerMLTensor(e,t,r,n){let s=gh.get(r);if(!s)throw new Error(`Unsupported ONNX data type: ${r}`);let i=this.tensorManager.registerTensor(e,t,s,n);return Ht("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${s}, dimensions: ${n}} -> {tensorId: ${i}}`),i}registerMLConstant(e,t,r,n,s,i,a=!1){if(!i)throw new Error("External mounted files are not available.");let o=e;e.startsWith("./")&&(o=e.substring(2));let l=i.get(o);if(!l)throw new Error(`File with name ${o} not found in preloaded files.`);if(t+r>l.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let c=l.slice(t,t+r).buffer,d;switch(s.dataType){case"float32":d=new Float32Array(c);break;case"float16":d=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(c):new Uint16Array(c);break;case"int32":d=new Int32Array(c);break;case"uint32":d=new Uint32Array(c);break;case"int64":a?(d=O0(new Uint8Array(c),!1),s.dataType="int32"):d=new BigInt64Array(c);break;case"uint64":d=new BigUint64Array(c);break;case"int8":d=new Int8Array(c);break;case"int4":case"uint4":case"uint8":d=new Uint8Array(c);break;default:throw new Error(`Unsupported data type: ${s.dataType} in creating WebNN Constant from external data.`)}return Ht("verbose",()=>`[WebNN] registerMLConstant {dataType: ${s.dataType}, shape: ${s.shape}}} ${a?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),n.constant(s,d)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}isGraphInput(e,t){let r=this.sessionGraphInputs.get(e);return r?r.includes(t):!1}isInt64Supported(e){var t;return!!((t=this.mlContextBySessionId.get(e))!=null&&t.opSupportLimits().input.dataTypes.includes("int64"))}flush(){}}}),xw=Je(()=>{}),Ag,_h,yh,uP,dP,jg,N0,hP,wO,IW=Je(()=>{Ki(),xw(),Ag=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),_h=[],yh=e=>Math.ceil(Number(e)/16)*16,uP=e=>{for(let t=0;t<_h.length;t++){let r=_h[t];if(e<=r)return r}return Math.ceil(e/16)*16},dP=1,jg=()=>dP++,N0=async(e,t,r,n)=>{let s=yh(r),i=e.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let a=e.getCommandEncoder();e.endComputePass(),a.copyBufferToBuffer(t,0,i,0,s),e.flush(),await i.mapAsync(GPUMapMode.READ);let o=i.getMappedRange();if(n){let l=n();return l.set(new Uint8Array(o,0,r)),l}else return new Uint8Array(o.slice(0,r))}finally{i.destroy()}},hP=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[t]of Ag)_h.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[]);this.sessionCount=0}upload(e,t){let r=t.buffer,n=t.byteOffset,s=t.byteLength,i=yh(s),a=this.storageCache.get(e);if(!a)throw new Error("gpu data for uploading does not exist");if(Number(a.originalSize)!==s)throw new Error(`inconsistent data size. gpu data size=${a.originalSize}, data size=${s}`);let o=this.backend.device.createBuffer({mappedAtCreation:!0,size:i,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),l=o.getMappedRange();new Uint8Array(l).set(new Uint8Array(r,n,s)),o.unmap();let c=this.backend.device.createCommandEncoder();c.copyBufferToBuffer(o,0,a.gpuData.buffer,0,i),this.backend.device.queue.submit([c.finish()]),o.destroy(),Ht("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${e})`)}memcpy(e,t){let r=this.storageCache.get(e);if(!r)throw new Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(t);if(!n)throw new Error("destination gpu data for memcpy does not exist");if(r.originalSize!==n.originalSize)throw new Error("inconsistent source and destination gpu data size");let s=yh(r.originalSize),i=this.backend.getCommandEncoder();this.backend.endComputePass(),i.copyBufferToBuffer(r.gpuData.buffer,0,n.gpuData.buffer,0,s)}registerExternalBuffer(e,t,r){let n;if(r){if(n=r[0],e===r[1])return Ht("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, buffer is the same, skip.`),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else n=jg();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:e},originalSize:t}),Ht("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, registered.`),n}unregisterExternalBuffer(e){e!==void 0&&(this.storageCache.delete(e),Ht("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`))}create(e,t=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let r=uP(e),n,s=(t&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,i=(t&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(s||i){let o=(s?this.freeBuffers:this.freeUniformBuffers).get(r);o?o.length>0?n=o.pop():n=this.backend.device.createBuffer({size:r,usage:t}):n=this.backend.device.createBuffer({size:r,usage:t})}else n=this.backend.device.createBuffer({size:r,usage:t});let a={id:jg(),type:0,buffer:n};return this.storageCache.set(a.id,{gpuData:a,originalSize:Number(e)}),Ht("verbose",()=>`[WebGPU] GpuDataManager.create(size=${e}) => id=${a.id}`),a}get(e){var t;return(t=this.storageCache.get(e))==null?void 0:t.gpuData}release(e){let t=typeof e=="bigint"?Number(e):e,r=this.storageCache.get(t);if(!r){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return Ht("verbose",()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${r.gpuData.id}`),this.storageCache.delete(t),this.buffersPending.push(r.gpuData.buffer),r.originalSize}async download(e,t){let r=this.storageCache.get(Number(e));if(!r)throw new Error("data does not exist");await N0(this.backend,r.gpuData.buffer,r.originalSize,t)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let e of this.buffersPending){let t=Ag.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let r=this.freeBuffers.get(e.size)||[];t===void 0||r.length>=t?e.destroy():r.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let r=this.freeUniformBuffers.get(e.size)||[];t===void 0||r.length>=t?e.destroy():r.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let t of this.buffersPending)e.push(t);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let t=this.capturedPendingBuffers.get(e);t&&(t.forEach(r=>{r.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,this.sessionCount===0&&(Ht("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(r=>{r.gpuData.buffer.destroy()}),this.storageCache=new Map)}},wO=(...e)=>new hP(...e)}),fP,nr,Vr=Je(()=>{fP=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this.key}},nr=e=>new fP(e)}),Ul,wh,_n,Fn,_t,Or,D0,xl,Pa,mt,Oc,Fe,ht,vO,bw,pP,xO,Rt=Je(()=>{Ct(),Lt(),Ul=64,wh=(e,t)=>{if(t===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return t>1?`vec${t}<f16>`:"f16";case 1:return t>1?`vec${t}<f32>`:"f32";case 6:return t>1?`vec${t}<i32>`:"i32";case 12:return t>1?`vec${t}<u32>`:"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(t!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${e}`)}},_n=(e,t=1)=>{let r=wh(e,t);return typeof r=="string"?r:r[0]},Fn=(e,t=1)=>{let r=wh(e,t);return typeof r=="string"?r:r[1]},_t=(...e)=>{let t=[];return e.forEach(r=>{r.length!==0&&t.push({type:12,data:r},{type:12,data:Ae.computeStrides(r)})}),t},Or=e=>e%4===0?4:e%2===0?2:1,D0=(e="f32",t,r="0")=>!t||t===1?`${e}(${r})`:`vec${t}<${e}>(${r})`,xl=(e,t,r)=>e==="f32"?r:t===1?`f32(${r})`:`vec${t}<f32>(${r})`,Pa=(e,t)=>t===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:t===2?`(${e}.x + ${e}.y)`:t===3?`(${e}.x + ${e}.y + ${e}.z)`:e,mt=(e,t,r,n)=>e.startsWith("uniforms.")&&r>4?typeof t=="string"?n==="f16"?`${e}[(${t}) / 8][(${t}) % 8 / 4][(${t}) % 8 % 4]`:`${e}[(${t}) / 4][(${t}) % 4]`:n==="f16"?`${e}[${Math.floor(t/8)}][${Math.floor(t%8/4)}][${t%8%4}]`:`${e}[${Math.floor(t/4)}][${t%4}]`:r>1?`${e}[${t}]`:e,Oc=(e,t,r,n,s)=>{let i=typeof r=="number",a=i?r:r.length,o=[...new Array(a).keys()],l=a<2?"u32":a<=4?`vec${a}<u32>`:`array<u32, ${a}>`,c=wh(t,s),d=typeof c=="string"?c:c[1],h=typeof c=="string"?c:c[0],u={indices:l,value:d,storage:h,tensor:t},p=ne=>typeof ne=="string"?ne:`${ne}u`,m={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},y=i?"uniforms.":"",P=`${y}${e}_shape`,g=`${y}${e}_strides`,_="";for(let ne=0;ne<a-1;ne++)_+=`
    let dim${ne} = current / ${mt(g,ne,a)};
    let rest${ne} = current % ${mt(g,ne,a)};
    indices[${ne}] = dim${ne};
    current = rest${ne};
    `;_+=`indices[${a-1}] = current;`;let b=a<2?"":`
  fn o2i_${e}(offset: u32) -> ${u.indices} {
    var indices: ${u.indices};
    var current = offset;
    ${_}
    return indices;
  }`,w=ne=>(m.offsetToIndices=!0,a<2?ne:`o2i_${e}(${ne})`),M=[];if(a>=2)for(let ne=a-1;ne>=0;ne--)M.push(`${mt(g,ne,a)} * (indices[${ne}])`);let E=a<2?"":`
  fn i2o_${e}(indices: ${u.indices}) -> u32 {
    return ${M.join("+")};
  }`,T=ne=>(m.indicesToOffset=!0,a<2?ne:`i2o_${e}(${ne})`),S=(...ne)=>a===0?"0u":`${u.indices}(${ne.map(p).join(",")})`,A=(ne,L)=>a<2?`${ne}`:`${mt(ne,L,a)}`,j=(ne,L,F)=>a<2?`${ne}=${F};`:`${mt(ne,L,a)}=${F};`,U={},W=(ne,L)=>{m.broadcastedIndicesToOffset=!0;let F=`${L.name}broadcastedIndicesTo${e}Offset`;if(F in U)return`${F}(${ne})`;let G=[];for(let oe=a-1;oe>=0;oe--){let H=L.indicesGet("outputIndices",oe+L.rank-a);G.push(`${A(g,oe)} * (${H} % ${A(P,oe)})`)}return U[F]=`fn ${F}(outputIndices: ${L.type.indices}) -> u32 {
             return ${G.length>0?G.join("+"):"0u"};
           }`,`${F}(${ne})`},B=(ne,L)=>(()=>{if(u.storage===u.value)return`${e}[${ne}]=${L};`;if(u.storage==="vec2<u32>"&&u.value==="i32")return`${e}[${ne}]=vec2<u32>(u32(${L}), select(0u, 0xFFFFFFFFu, ${L} < 0));`;if(u.storage==="vec2<u32>"&&u.value==="u32")return`${e}[${ne}]=vec2<u32>(u32(${L}), 0u);`;if(u.storage==="u32"&&u.value==="vec4<bool>")return`${e}[${ne}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${L}));`;throw new Error(`not supported combination of storage type ${u.storage} and value type ${u.value} yet`)})(),ee=ne=>(()=>{if(u.storage===u.value)return`${e}[${ne}]`;if(u.storage==="vec2<u32>"&&u.value==="i32")return`i32(${e}[${ne}].x)`;if(u.storage==="vec2<u32>"&&u.value==="u32")return`u32(${e}[${ne}].x)`;if(u.storage==="u32"&&u.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${ne}] & 0xFFu), bool(${e}[${ne}] & 0xFF00u), bool(${e}[${ne}] & 0xFF0000u), bool(${e}[${ne}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${u.storage} and value type ${u.value} yet`)})(),Q=a<2?"":`
  fn get_${e}ByIndices(indices: ${u.indices}) -> ${d} {
    return ${ee(`i2o_${e}(indices)`)};
  }`,Z=a<2?"":(()=>{let ne=o.map(F=>`d${F}: u32`).join(", "),L=o.map(F=>`d${F}`).join(", ");return`
  fn get_${e}(${ne}) -> ${d} {
    return get_${e}ByIndices(${S(L)});
  }`})(),J=(...ne)=>{if(ne.length!==a)throw new Error(`indices length must be ${a}`);let L=ne.map(p).join(",");return a===0?ee("0u"):a===1?ee(L[0]):(m.get=!0,m.getByIndices=!0,m.indicesToOffset=!0,`get_${e}(${L})`)},X=ne=>a<2?ee(ne):(m.getByIndices=!0,m.indicesToOffset=!0,`get_${e}ByIndices(${ne})`),ae=a<2?"":`
  fn set_${e}ByIndices(indices: ${u.indices}, value: ${d}) {
    ${B(`i2o_${e}(indices)`,"value")}
  }`,le=a<2?"":(()=>{let ne=o.map(F=>`d${F}: u32`).join(", "),L=o.map(F=>`d${F}`).join(", ");return`
  fn set_${e}(${ne}, value: ${d}) {
    set_${e}ByIndices(${S(L)}, value);
  }`})();return{impl:()=>{let ne=[],L=!1;return m.offsetToIndices&&(ne.push(b),L=!0),m.indicesToOffset&&(ne.push(E),L=!0),m.broadcastedIndicesToOffset&&(Object.values(U).forEach(F=>ne.push(F)),L=!0),m.set&&(ne.push(le),L=!0),m.setByIndices&&(ne.push(ae),L=!0),m.get&&(ne.push(Z),L=!0),m.getByIndices&&(ne.push(Q),L=!0),!i&&L&&ne.unshift(`const ${P} = ${u.indices}(${r.join(",")});`,`const ${g} = ${u.indices}(${Ae.computeStrides(r).join(",")});`),ne.join(`
`)},type:u,offsetToIndices:w,indicesToOffset:T,broadcastedIndicesToOffset:W,indices:S,indicesGet:A,indicesSet:j,set:(...ne)=>{if(ne.length!==a+1)throw new Error(`indices length must be ${a}`);let L=ne[a];if(typeof L!="string")throw new Error("value must be string");let F=ne.slice(0,a).map(p).join(",");return a===0?B("0u",L):a===1?B(F[0],L):(m.set=!0,m.setByIndices=!0,m.indicesToOffset=!0,`set_${e}(${F}, ${L})`)},setByOffset:B,setByIndices:(ne,L)=>a<2?B(ne,L):(m.setByIndices=!0,m.indicesToOffset=!0,`set_${e}ByIndices(${ne}, ${L});`),get:J,getByOffset:ee,getByIndices:X,usage:n,name:e,strides:g,shape:P,rank:a}},Fe=(e,t,r,n=1)=>Oc(e,t,r,"input",n),ht=(e,t,r,n=1)=>Oc(e,t,r,"output",n),vO=(e,t,r)=>Oc(e,t,r,"atomicOutput",1),bw=(e,t,r,n=1)=>Oc(e,t,r,"internal",n),pP=class{constructor(e,t){this.normalizedDispatchGroup=e,this.limits=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return`if (global_idx >= ${typeof e=="number"?`${e}u`:e}) { return; }`}mainStart(e=Ul){let t=typeof e=="number"?e:e[0],r=typeof e=="number"?1:e[1],n=typeof e=="number"?1:e[2];if(t>this.limits.maxComputeWorkgroupSizeX||r>this.limits.maxComputeWorkgroupSizeY||n>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${t}, ${r}, ${n}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(t*r*n>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${t}, ${r}, ${n}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let s=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,i=s?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,a=s?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${t*r*n}u + local_idx;`;return`@compute @workgroup_size(${t}, ${r}, ${n})
  fn main(${i}) {
    ${a}
  `}appendVariableUniforms(e){e.rank!==0&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,t){if(e.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let r=e.usage==="input"?"read":"read_write",n=e.usage==="atomicOutput"?"atomic<i32>":e.type.storage;return`@group(0) @binding(${t}) var<storage, ${r}> ${e.name}: array<${n}>;`}declareVariables(...e){return e.map(t=>this.declareVariable(t,this.variableIndex++)).join(`
`)}registerInternalVariable(e){if(e.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(...e){return e.forEach(t=>this.registerInternalVariable(t)),this}registerUniform(e,t,r=1){return this.uniforms.push({name:e,type:t,length:r}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let e=[];for(let{name:t,type:r,length:n}of this.uniforms)if(n&&n>4)r==="f16"?e.push(`@align(16) ${t}:array<mat2x4<${r}>, ${Math.ceil(n/8)}>`):e.push(`${t}:array<vec4<${r}>, ${Math.ceil(n/4)}>`);else{let s=n==null||n===1?r:`vec${n}<${r}>`;e.push(`${t}:${s}`)}return`
      struct Uniforms { ${e.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join(`
`)+this.internalVariables.map(e=>e.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let e=t=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(t)];return this.uniforms.map(t=>[e(t.type),t.length??1])}},xO=(e,t)=>new pP(e,t)}),mP,Og,gP,_P,yP,wP,ys,bO,MO,Ia=Je(()=>{Ct(),Lt(),Vr(),Rt(),mP=(e,t)=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.");if(t.length!==0&&t.length!==e[0].dims.length)throw new Error(`perm size ${t.length} does not match input rank ${e[0].dims.length}`)},Og=(e,t)=>t.length!==0?t:[...new Array(e).keys()].reverse(),gP=(e,t)=>Ae.sortBasedOnPerm(e,Og(e.length,t)),_P=(e,t,r,n)=>{let s=`fn perm(i: ${n.type.indices}) -> ${r.type.indices} {
    var a: ${r.type.indices};`;for(let i=0;i<t;++i)s+=`a[${e[i]}]=i[${i}];`;return s+="return a;}"},yP=(e,t)=>{let r=[],n=[];for(let s=0;s<e.length;++s)e[s]!==1&&r.push(e[s]),e[t[s]]!==1&&n.push(t[s]);return{newShape:r,newPerm:n}},wP=(e,t)=>{let r=0;for(let n=0;n<e.length;++n)if(t[e[n]]!==1){if(e[n]<r)return!1;r=e[n]}return!0},ys=(e,t)=>{let r=e.dataType,n=e.dims.length,s=Og(n,t),i=gP(e.dims,s),a=e.dims,o=i,l=n<2||wP(s,e.dims),c;if(l)return c=m=>{let y=Fe("input",r,a,4),P=ht("output",r,o,4);return`
  ${m.registerUniform("output_size","u32").declareVariables(y,P)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let m=Ae.size(i);return{outputs:[{dims:i,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(m/64/4)},programUniforms:[{type:12,data:Math.ceil(m/4)}]}},getShaderSource:c};let{newShape:d,newPerm:h}=yP(e.dims,s),u=Ae.areEqual(h,[2,3,1]),p=Ae.areEqual(h,[3,1,2]);if(d.length===2||u||p){a=u?[d[0],d[1]*d[2]]:p?[d[0]*d[1],d[2]]:d,o=[a[1],a[0]];let m=16;return c=y=>{let P=Fe("a",r,a.length),g=ht("output",r,o.length);return`
  ${y.registerUniform("output_size","u32").declareVariables(P,g)}
  var<workgroup> tile : array<array<${g.type.value}, ${m+1}>, ${m}>;
  ${y.mainStart([m,m,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${m} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${m}u + local_id.x;
    let input_row = workgroup_id_x * ${m}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${P.getByIndices(`${P.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${m}u + local_id.x;
    let output_row = workgroup_id_y * ${m}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${g.setByIndices(`${g.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let y=Ae.size(i);return{outputs:[{dims:i,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(o[1]/m),y:Math.ceil(o[0]/m)},programUniforms:[{type:12,data:y},..._t(a,o)]}},getShaderSource:c}}return c=m=>{let y=Fe("a",r,a.length),P=ht("output",r,o.length);return`
  ${m.registerUniform("output_size","u32").declareVariables(y,P)}

  ${_P(s,n,y,P)}

  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${P.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${P.setByOffset("global_idx",y.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${t}`,inputDependencies:["rank"]},getRunData:()=>{let m=Ae.size(i);return{outputs:[{dims:i,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},..._t(a,o)]}},getShaderSource:c}},bO=(e,t)=>{mP(e.inputs,t.perm),e.compute(ys(e.inputs[0],t.perm))},MO=e=>nr({perm:e.perm})}),vP,xP,bP,MP,TP,EP,PP,kP,SP,CP,Hs,TO,EO,PO,kO,SO,CO,$O,IO,AO,jO,AW=Je(()=>{Ct(),Lt(),Rt(),Mw(),Ia(),vP={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},xP={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},bP={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},MP={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},TP=(e,t)=>{let r=[];for(let n=t-e;n<t;++n)r.push(n);return r},EP=(e,t)=>{let r=[],n=e.length;for(let i=0;i<n;i++)t.indexOf(i)===-1&&r.push(e[i]);let s=t.map(i=>e[i]);return[r,s]},PP=(e,t)=>{let r=e.length+t.length,n=[],s=0;for(let i=0;i<r;i++)t.indexOf(i)===-1?n.push(e[s++]):n.push(1);return n},kP=(e,t)=>{for(let r=0;r<e.length;++r)if(e[e.length-r-1]!==t-1-r)return!1;return!0},SP=(e,t)=>{let r=[];if(!kP(e,t)){for(let n=0;n<t;++n)e.indexOf(n)===-1&&r.push(n);e.forEach(n=>r.push(n))}return r},CP=(e,t,r,n,s,i,a)=>{let o=r[0].dims,l=Ae.size(i),c=Ae.size(a),d=Fe("_A",r[0].dataType,o),h=ht("output",s,i),u=64;l===1&&(u=256);let p=`
          var<workgroup> aBestValues : array<f32, ${u}>;
       `,m=y=>`
        ${y.registerUniform("reduceSize","u32").declareVariables(d,h)}
        ${p}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${y.mainStart(u)}

          let outputIndex = global_idx / ${u};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${bP[n]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${u}) {
           let candidate = f32(${d.getByOffset("offset + k")});
           bestValue = ${vP[n]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${u}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${xP[n]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${h.setByOffset("outputIndex",`${n==="mean"?`${h.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${h.type.storage}(${MP[n]})`}`)};
         }
        }`;return{name:e,shaderCache:{hint:`${t};${u}`,inputDependencies:["type"]},getShaderSource:m,getRunData:()=>({outputs:[{dims:i,dataType:s}],dispatchGroup:{x:l},programUniforms:[{type:12,data:c}]})}},Hs=(e,t,r,n)=>{let s=e.inputs.length===1?r:F0(e.inputs,r),i=s.axes;i.length===0&&!s.noopWithEmptyAxes&&(i=e.inputs[0].dims.map((p,m)=>m));let a=Ae.normalizeAxes(i,e.inputs[0].dims.length),o=a,l=e.inputs[0],c=SP(o,e.inputs[0].dims.length);c.length>0&&(l=e.compute(ys(e.inputs[0],c),{inputs:[0],outputs:[-1]})[0],o=TP(o.length,l.dims.length));let[d,h]=EP(l.dims,o),u=d;s.keepDims&&(u=PP(d,a)),e.compute(CP(t,s.cacheKey,[l],n,e.inputs[0].dataType,u,h),{inputs:[l]})},TO=(e,t)=>{Hs(e,"ReduceMeanShared",t,"mean")},EO=(e,t)=>{Hs(e,"ReduceL1Shared",t,"l1")},PO=(e,t)=>{Hs(e,"ReduceL2Shared",t,"l2")},kO=(e,t)=>{Hs(e,"ReduceLogSumExpShared",t,"logSumExp")},SO=(e,t)=>{Hs(e,"ReduceMaxShared",t,"max")},CO=(e,t)=>{Hs(e,"ReduceMinShared",t,"min")},$O=(e,t)=>{Hs(e,"ReduceProdShared",t,"prod")},IO=(e,t)=>{Hs(e,"ReduceSumShared",t,"sum")},AO=(e,t)=>{Hs(e,"ReduceSumSquareShared",t,"sumSquare")},jO=(e,t)=>{Hs(e,"ReduceLogSumShared",t,"logSum")}}),Qs,$P,Sf,F0,Xs,IP,AP,jP,OP,NP,DP,FP,LP,RP,zP,Js,OO,NO,DO,FO,LO,RO,zO,BO,UO,VO,Mw=Je(()=>{Ct(),Lt(),Vr(),Rt(),AW(),Qs=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},$P=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],Sf=(e,t,r,n,s,i,a=!1,o=!1)=>{let l=[],c=r[0].dims,d=c.length,h=Ae.normalizeAxes(s,d),u=!o&&h.length===0;c.forEach((y,P)=>{u||h.indexOf(P)>=0?a&&l.push(1):l.push(y)});let p=l.length,m=Ae.size(l);return{name:e,shaderCache:t,getShaderSource:y=>{let P=[],g=Fe("_A",r[0].dataType,d),_=ht("output",i,p),b=n(g,_,h),w=b[2];for(let M=0,E=0;M<d;M++)u||h.indexOf(M)>=0?(a&&E++,w=`for(var j${M}: u32 = 0; j${M} < ${c[M]}; j${M}++) {
                  ${b[2].includes("last_index")?`let last_index = j${M};`:""}
                  ${g.indicesSet("input_indices",M,`j${M}`)}
                  ${w}
                }`):(P.push(`${g.indicesSet("input_indices",M,_.indicesGet("output_indices",E))};`),E++);return`

        ${y.registerUniform("output_size","u32").declareVariables(g,_)}

        ${y.mainStart()}
          ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${g.type.indices};
          let output_indices = ${_.offsetToIndices("global_idx")};

          ${P.join(`
`)}
          ${b[0]}       // init ops for reduce max/min
          ${b[1]}
          ${w}
          ${b[3]}
          ${b.length===4?_.setByOffset("global_idx","value"):b.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:l,dataType:i}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},..._t(c,l)]})}},F0=(e,t)=>{let r=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(n=>r.push(Number(n))),nr({axes:r,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},Xs=(e,t,r,n)=>{let s=e.inputs,i=s.length===1?r:F0(s,r);e.compute(Sf(t,{hint:i.cacheKey,inputDependencies:["rank"]},[s[0]],i.noopWithEmptyAxes&&i.axes.length===0?$P:n,i.axes,s[0].dataType,i.keepDims,i.noopWithEmptyAxes),{inputs:[0]})},IP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceLogSum",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${r.getByIndices("input_indices")};`,"value = log(value);"])},AP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceL1",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += abs(${r.getByIndices("input_indices")});`,""])},jP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceL2",t,(r,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${r.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},OP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceLogSumExp",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += exp(${r.getByIndices("input_indices")});`,"value = log(value);"])},NP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceMax",t,(r,n,s)=>{let i=[];for(let a=0;a<r.rank;a++)(s.indexOf(a)>=0||s.length===0)&&i.push(r.indicesSet("input_indices",a,0));return[`${i.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};`,`value = max(value, ${r.getByIndices("input_indices")});`,""]})},DP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceMean",t,(r,n,s)=>{let i=1;for(let a=0;a<r.rank;a++)(s.indexOf(a)>=0||s.length===0)&&(i*=e.inputs[0].dims[a]);return["var sum = f32(0);","",`sum += f32(${r.getByIndices("input_indices")});`,`let value = ${n.type.value}(sum / ${i});`]})},FP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceMin",t,(r,n,s)=>{let i=[];for(let a=0;a<r.rank;a++)(s.indexOf(a)>=0||s.length===0)&&i.push(`input_indices[${a}] = 0;`);return[`${i.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};`,`value = min(value, ${r.getByIndices("input_indices")});`,""]})},LP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceProd",t,(r,n)=>[`var value = ${n.type.storage}(1);`,"",`value *= ${r.getByIndices("input_indices")};`,""])},RP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceSum",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${r.getByIndices("input_indices")};`,""])},zP=(e,t)=>{Qs(e.inputs),Xs(e,"ReduceSumSquare",t,(r,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${r.getByIndices("input_indices")}; value += t * t;`,""])},Js=(e,t,r)=>{if(t.length===0)return r;let n=1,s=1;for(let i=0;i<t.length;i++)t.indexOf(i)===-1?n*=e[i]:s*=e[i];return s<32&&n>1024},OO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?DP(e,t):TO(e,t)},NO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?AP(e,t):EO(e,t)},DO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?jP(e,t):PO(e,t)},FO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?OP(e,t):kO(e,t)},LO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?NP(e,t):SO(e,t)},RO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?FP(e,t):CO(e,t)},zO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?LP(e,t):$O(e,t)},BO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?RP(e,t):IO(e,t)},UO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?zP(e,t):AO(e,t)},VO=(e,t)=>{Js(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?IP(e,t):jO(e,t)}}),Ng,WO,GO,L0,jW=Je(()=>{Ct(),Vr(),Mw(),Ng=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},WO=(e,t)=>{Ng(e.inputs);let r=(n,s,i)=>{let a=[];for(let o=0;o<n.rank;o++)(i.indexOf(o)>=0||i.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?"<=":"<"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};e.compute(Sf("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],r,[t.axis],7,t.keepDims),{inputs:[0]})},GO=(e,t)=>{Ng(e.inputs);let r=(n,s,i)=>{let a=[];for(let o=0;o<n.rank;o++)(i.indexOf(o)>=0||i.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?">=":">"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};e.compute(Sf("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],r,[t.axis],7,t.keepDims),{inputs:[0]})},L0=e=>nr(e)}),BP,vh,UP,VP,WP,Du,GP,qO,Tw=Je(()=>{Ct(),Lt(),xw(),Rt(),BP=(e,t)=>{let r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5];if(a&&o)throw new Error("Attention cannot have both past and attention_bias");if(r.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let l=r.dims[0],c=r.dims[1],d=r.dims[2];if(s.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(n.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(n.dims[0]!==d)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(s.dims[0]!==n.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let h=s.dims[0]/3,u=h,p=u;if(t.qkvHiddenSizes.length>0){if(t.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let b of t.qkvHiddenSizes)if(b%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");h=t.qkvHiddenSizes[0],u=t.qkvHiddenSizes[1],p=t.qkvHiddenSizes[2]}let m=c;if(h!==u)throw new Error("qkv_hidden_sizes first element should be same as the second");if(s.dims[0]!==h+u+p)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let y=0;if(a){if(u!==p)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(a.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(a.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(a.dims[1]!==l)throw new Error('Input "past" second dimension must be batch_size');if(a.dims[2]!==t.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(a.dims[4]!==u/t.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');t.pastPresentShareBuffer||(y=a.dims[3])}let P=m+y,g=-1,_=0;if(i)throw new Error("Mask not supported");if(a)throw new Error("past is not supported");if(o){if(o.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(o.dims[0]!==l||o.dims[1]!==t.numHeads||o.dims[2]!==c||o.dims[3]!==P)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:l,sequenceLength:c,pastSequenceLength:y,kvSequenceLength:m,totalSequenceLength:P,maxSequenceLength:g,inputHiddenSize:d,hiddenSize:h,vHiddenSize:p,headSize:Math.floor(h/t.numHeads),vHeadSize:Math.floor(p/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:_,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},vh=(e,t,r)=>t&&e?`
      let total_sequence_length_input = u32(${t.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${e==null?void 0:e.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${r?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,UP=(e,t,r,n,s,i,a,o)=>{let l=Or(a?1:i),c=64,d=i/l;d<c&&(c=32);let h=Math.ceil(i/l/c),u=[{type:12,data:t},{type:12,data:r},{type:12,data:n},{type:12,data:s},{type:12,data:d},{type:12,data:h}],p=_n(e.dataType,l),m=Fn(1,l),y=["type"];a&&y.push("type"),o&&y.push("type");let P=g=>{let _=ht("x",e.dataType,e.dims,l),b=[_],w=a?Fe("seq_lens",a.dataType,a.dims):void 0;w&&b.push(w);let M=o?Fe("total_sequence_length_input",o.dataType,o.dims):void 0;M&&b.push(M);let E=Fn(e.dataType),T=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${c}>;
  var<workgroup> thread_sum: array<f32, ${c}>;
  ${g.registerUniforms(T).declareVariables(...b)}
  ${g.mainStart([c,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${vh(w,M,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${c}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${a?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${m}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${m}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(l){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${c}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${m}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${m}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(l){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${c}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${_.type.value}(${E}(1.0) / ${E}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${m}(x[offset + i]);
        x[offset + i] = ${_.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${a?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${_.type.value}(${E}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${c};${p};${l}`,inputDependencies:y},getShaderSource:P,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:s,z:t*r},programUniforms:u})}},VP=(e,t,r,n,s,i,a,o,l)=>{let c=a+i.kvSequenceLength,d=[i.batchSize,i.numHeads,i.sequenceLength,c],h=e>1&&n,u=i.kvNumHeads?i.kvNumHeads:i.numHeads,p=h?[i.batchSize,u,c,i.headSize]:void 0,m=i.nReps?i.nReps:1,y=i.scale===0?1/Math.sqrt(i.headSize):i.scale,P=Or(i.headSize),g=i.headSize/P,_=12,b={x:Math.ceil(c/_),y:Math.ceil(i.sequenceLength/_),z:i.batchSize*i.numHeads},w=[{type:12,data:i.sequenceLength},{type:12,data:g},{type:12,data:c},{type:12,data:i.numHeads},{type:12,data:i.headSize},{type:1,data:y},{type:12,data:a},{type:12,data:i.kvSequenceLength},{type:12,data:m}],M=h&&n&&Ae.size(n.dims)>0,E=["type","type"];M&&E.push("type"),s&&E.push("type"),o&&E.push("type"),l&&E.push("type");let T=[{dims:d,dataType:t.dataType,gpuDataType:0}];h&&T.push({dims:p,dataType:t.dataType,gpuDataType:0});let S=A=>{let j=Fe("q",t.dataType,t.dims,P),U=Fe("key",r.dataType,r.dims,P),W=[j,U];if(M){let ae=Fe("past_key",n.dataType,n.dims,P);W.push(ae)}s&&W.push(Fe("attention_bias",s.dataType,s.dims));let B=o?Fe("seq_lens",o.dataType,o.dims):void 0;B&&W.push(B);let ee=l?Fe("total_sequence_length_input",l.dataType,l.dims):void 0;ee&&W.push(ee);let Q=ht("output",t.dataType,d),Z=[Q];h&&Z.push(ht("present_key",t.dataType,p,P));let J=Fn(1,P),X=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${_}u;

  var<workgroup> tileQ: array<${j.type.storage}, ${_*_}>;
  var<workgroup> tileK: array<${j.type.storage}, ${_*_}>;
  ${A.registerUniforms(X).declareVariables(...W,...Z)}
  ${A.mainStart([_,_,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${m===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${m===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${vh(B,ee,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${M&&h?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${h?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${J}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${M&&h?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${h?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${J}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(P){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${P}`)}})()};
        output[outputIdx] = ${Q.type.value} (sum * uniforms.alpha) + ${s?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${P};${s!==void 0};${n!==void 0};${e}`,inputDependencies:E},getRunData:()=>({outputs:T,dispatchGroup:b,programUniforms:w}),getShaderSource:S}},WP=(e,t,r,n,s,i,a=void 0,o=void 0)=>{let l=i+s.kvSequenceLength,c=s.nReps?s.nReps:1,d=s.vHiddenSize*c,h=e>1&&n,u=s.kvNumHeads?s.kvNumHeads:s.numHeads,p=h?[s.batchSize,u,l,s.headSize]:void 0,m=[s.batchSize,s.sequenceLength,d],y=12,P={x:Math.ceil(s.vHeadSize/y),y:Math.ceil(s.sequenceLength/y),z:s.batchSize*s.numHeads},g=[{type:12,data:s.sequenceLength},{type:12,data:l},{type:12,data:s.vHeadSize},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:12,data:d},{type:12,data:i},{type:12,data:s.kvSequenceLength},{type:12,data:c}],_=h&&n&&Ae.size(n.dims)>0,b=["type","type"];_&&b.push("type"),a&&b.push("type"),o&&b.push("type");let w=[{dims:m,dataType:t.dataType,gpuDataType:0}];h&&w.push({dims:p,dataType:t.dataType,gpuDataType:0});let M=E=>{let T=Fe("probs",t.dataType,t.dims),S=Fe("v",r.dataType,r.dims),A=[T,S];_&&A.push(Fe("past_value",n.dataType,n.dims));let j=a?Fe("seq_lens",a.dataType,a.dims):void 0;a&&A.push(j);let U=o?Fe("total_sequence_length_input",o.dataType,o.dims):void 0;o&&A.push(U);let W=[ht("output",t.dataType,m)];h&&W.push(ht("present_value",t.dataType,p));let B=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${y}u;
  var<workgroup> tileQ: array<${T.type.value}, ${y*y}>;
  var<workgroup> tileV: array<${T.type.value}, ${y*y}>;
  ${E.registerUniforms(B).declareVariables(...A,...W)}
  ${E.mainStart([y,y,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${c===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${c===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${vh(j,U,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${_&&h?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${h?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${T.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${_&&h?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${h?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${n!==void 0};${e}`,inputDependencies:b},getRunData:()=>({outputs:w,dispatchGroup:P,programUniforms:g}),getShaderSource:M}},Du=(e,t,r,n,s,i,a,o,l,c,d=void 0,h=void 0)=>{let u=Math.min(e.outputCount,1+(a?1:0)+(o?1:0)),p=u>1?c.pastSequenceLength:0,m=p+c.kvSequenceLength,y=l&&Ae.size(l.dims)>0?l:void 0,P=[t,r];u>1&&a&&Ae.size(a.dims)>0&&P.push(a),y&&P.push(y),d&&P.push(d),h&&P.push(h);let g=e.compute(VP(u,t,r,a,y,c,p,d,h),{inputs:P,outputs:u>1?[-1,1]:[-1]})[0];e.compute(UP(g,c.batchSize,c.numHeads,p,c.sequenceLength,m,d,h),{inputs:d&&h?[g,d,h]:[g],outputs:[]});let _=[g,n];u>1&&o&&Ae.size(o.dims)>0&&_.push(o),d&&_.push(d),h&&_.push(h),e.compute(WP(u,g,n,o,c,p,d,h),{inputs:_,outputs:u>1?[0,2]:[0]})},GP=(e,t)=>{let r=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],n=t.sequenceLength,s=t.inputHiddenSize,i=t.headSize,a=12,o={x:Math.ceil(t.headSize/a),y:Math.ceil(t.sequenceLength/a),z:t.batchSize*t.numHeads},l=[e.inputs[0],e.inputs[1],e.inputs[2]],c=[{type:12,data:n},{type:12,data:s},{type:12,data:i},{type:12,data:t.numHeads},{type:12,data:t.headSize},{type:12,data:t.hiddenSize},{type:12,data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}],d=h=>{let u=ht("output_q",l[0].dataType,r),p=ht("output_k",l[0].dataType,r),m=ht("output_v",l[0].dataType,r),y=Fe("input",l[0].dataType,l[0].dims),P=Fe("weight",l[1].dataType,l[1].dims),g=Fe("bias",l[2].dataType,l[2].dims),_=y.type.storage,b=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${a}u;
  var<workgroup> tileInput: array<${_}, ${a*a}>;
  var<workgroup> tileWeightQ: array<${_}, ${a*a}>;
  var<workgroup> tileWeightK: array<${_}, ${a*a}>;
  var<workgroup> tileWeightV: array<${_}, ${a*a}>;
  ${h.registerUniforms(b).declareVariables(y,P,g,u,p,m)}
  ${h.mainStart([a,a,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${_}(0);
    var valueK = ${_}(0);
    var valueV = ${_}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:o,programUniforms:c}),getShaderSource:d},{inputs:l,outputs:[-1,-1,-1]})},qO=(e,t)=>{let r=BP(e.inputs,t),[n,s,i]=GP(e,r);return Du(e,n,s,i,e.inputs[4],void 0,void 0,void 0,e.inputs[5],r)}}),qP,KP,HP,KO,OW=Je(()=>{fi(),Ct(),Lt(),Vr(),Rt(),qP=(e,t)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let r=(n,s,i)=>{let a=s.length;if(a!==n.length)throw new Error(`${i}: num dimensions != ${a}`);s.forEach((o,l)=>{if(o!==n[l])throw new Error(`${i}: dim[${l}] do not match`)})};if(e[0].dims.length>1){let n=t.format==="NHWC"?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);r(e[1].dims,n,"Invalid input scale"),r(e[2].dims,n,"Invalid input B"),r(e[3].dims,n,"Invalid input mean"),r(e[4].dims,n,"Invalid input var")}else r(e[1].dims,[1],"Invalid input scale"),r(e[2].dims,[1],"Invalid input B"),r(e[3].dims,[1],"Invalid input mean"),r(e[4].dims,[1],"Invalid input var")},KP=(e,t)=>{let{epsilon:r,spatial:n,format:s}=t,i=e[0].dims,a=n?Or(i[i.length-1]):1,o=s==="NHWC"&&i.length>1?a:1,l=Ae.size(i)/a,c=n,d=c?i.length:i,h=Fe("x",e[0].dataType,e[0].dims,a),u=Fe("scale",e[1].dataType,e[1].dims,o),p=Fe("bias",e[2].dataType,e[2].dims,o),m=Fe("inputMean",e[3].dataType,e[3].dims,o),y=Fe("inputVar",e[4].dataType,e[4].dims,o),P=ht("y",e[0].dataType,d,a),g=()=>{let b="";if(n)b=`let cOffset = ${i.length===1?"0u":s==="NHWC"?`outputIndices[${i.length-1}] / ${a}`:"outputIndices[1]"};`;else if(s==="NCHW")b=`
            ${P.indicesSet("outputIndices","0","0")}
            let cOffset = ${P.indicesToOffset("outputIndices")};`;else{b=`var cIndices = ${u.type.indices}(0);
                       cIndices[0] = outputIndices[${i.length-1}];`;for(let w=1;w<u.rank;w++)b+=`cIndices[${w}] = outputIndices[${w}];`;b+=`let cOffset = ${u.indicesToOffset("cIndices")};`}return b},_=b=>`
  const epsilon = ${r};
  ${b.registerUniform("outputSize","u32").declareVariables(h,u,p,m,y,P)}
  ${b.mainStart()}
  ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${P.offsetToIndices(`global_idx * ${a}`)};
    ${g()}
    let scale = ${u.getByOffset("cOffset")};
    let bias = ${p.getByOffset("cOffset")};
    let inputMean = ${m.getByOffset("cOffset")};
    let inputVar = ${y.getByOffset("cOffset")};
    let x = ${h.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${P.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${t.epsilon}_${t.format}_${n}_${a}`,inputDependencies:c?["rank","type","type","type","type"]:void 0},getShaderSource:_,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c?[{type:12,data:l},..._t(i)]:[{type:12,data:l}]})}},HP=e=>nr(e),KO=(e,t)=>{let{inputs:r,outputCount:n}=e,s=HP({...t,outputCount:n});if(_r.webgpu.validateInputContent&&qP(r,s),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(KP(r,s))}}),QP,XP,HO,NW=Je(()=>{Lt(),Rt(),QP=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},XP=e=>{let t=e[0].dims,r=e[0].dims[2],n=Ae.size(t)/4,s=e[0].dataType,i=Fe("input",s,t,4),a=Fe("bias",s,[r],4),o=Fe("residual",s,t,4),l=ht("output",s,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)}}),getShaderSource:c=>`
  const channels = ${r}u / 4;
  ${c.declareVariables(i,a,o,l)}

  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes(n)}
    let value = ${i.getByOffset("global_idx")}
      + ${a.getByOffset("global_idx % channels")} + ${o.getByOffset("global_idx")};
    ${l.setByOffset("global_idx","value")}
  }`}},HO=e=>{QP(e.inputs),e.compute(XP(e.inputs))}}),JP,Zt,QO,XO,JO,YO,ZO,eN,tN,rN,nN,YP,sN,iN,aN,oN,Hc,lN,Gh,cN,uN,dN,hN,fN,pN,mN,gN,_N,yN,wN,vN,xN,bN,MN,TN,Dg,EN,R0,z0,PN,kN,SN,ZP,ek,CN,Ew=Je(()=>{Ct(),Lt(),Vr(),Rt(),JP=(e,t,r,n,s,i,a)=>{let o=Math.ceil(t/4),l="";typeof s=="string"?l=`${s}(a)`:l=s("a");let c=Fe("inputData",r,[o],4),d=ht("outputData",n,[o],4),h=[{name:"vec_size",type:"u32"}];return a&&h.push(...a),`
      ${e.registerUniforms(h).declareVariables(c,d)}

  ${i??""}

  ${e.mainStart()}
    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${c.getByOffset("global_idx")};
    ${d.setByOffset("global_idx",l)}
  }`},Zt=(e,t,r,n,s,i=e.dataType,a,o)=>{let l=[{type:12,data:Math.ceil(Ae.size(e.dims)/4)}];return a&&l.push(...a),{name:t,shaderCache:{hint:s,inputDependencies:["type"]},getShaderSource:c=>JP(c,Ae.size(e.dims),e.dataType,i,r,n,o),getRunData:c=>({outputs:[{dims:e.dims,dataType:i}],dispatchGroup:{x:Math.ceil(Ae.size(c[0].dims)/64/4)},programUniforms:l})}},QO=e=>{e.compute(Zt(e.inputs[0],"Abs","abs"))},XO=e=>{e.compute(Zt(e.inputs[0],"Acos","acos"))},JO=e=>{e.compute(Zt(e.inputs[0],"Acosh","acosh"))},YO=e=>{e.compute(Zt(e.inputs[0],"Asin","asin"))},ZO=e=>{e.compute(Zt(e.inputs[0],"Asinh","asinh"))},eN=e=>{e.compute(Zt(e.inputs[0],"Atan","atan"))},tN=e=>{e.compute(Zt(e.inputs[0],"Atanh","atanh"))},rN=e=>nr(e),nN=(e,t)=>{let r;switch(t.to){case 10:r="vec4<f16>";break;case 1:r="vec4<f32>";break;case 12:r="vec4<u32>";break;case 6:r="vec4<i32>";break;case 9:r="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${t.to}`)}e.compute(Zt(e.inputs[0],"Cast",r,void 0,t.cacheKey,t.to))},YP=e=>{let t,r,n=e.length>=2&&e[1].data!==0,s=e.length>=3&&e[2].data!==0;switch(e[0].dataType){case 1:t=n?e[1].getFloat32Array()[0]:-34028234663852886e22,r=s?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:t=n?e[1].getUint16Array()[0]:64511,r=s?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return nr({min:t,max:r})},sN=(e,t)=>{let r=t||YP(e.inputs),n=Fn(e.inputs[0].dataType);e.compute(Zt(e.inputs[0],"Clip",s=>`clamp(${s}, vec4<${n}>(uniforms.min), vec4<${n}>(uniforms.max))`,void 0,r.cacheKey,void 0,[{type:e.inputs[0].dataType,data:r.min},{type:e.inputs[0].dataType,data:r.max}],[{name:"min",type:n},{name:"max",type:n}]),{inputs:[0]})},iN=e=>{e.compute(Zt(e.inputs[0],"Ceil","ceil"))},aN=e=>{e.compute(Zt(e.inputs[0],"Cos","cos"))},oN=e=>{e.compute(Zt(e.inputs[0],"Cosh","cosh"))},Hc=e=>nr(e),lN=(e,t)=>{let r=Fn(e.inputs[0].dataType);e.compute(Zt(e.inputs[0],"Elu",n=>`elu_vf32(${n})`,`
  const elu_alpha_ = ${r}(${t.alpha});

  fn elu_f32(a: ${r}) -> ${r} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${r}>) -> vec4<${r}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,t.cacheKey))},Gh=(e="f32")=>`
const r0: ${e} = 0.3275911;
const r1: ${e} = 0.254829592;
const r2: ${e} = -0.284496736;
const r3: ${e} = 1.421413741;
const r4: ${e} = -1.453152027;
const r5: ${e} = 1.061405429;

fn erf_vf32(v: vec4<${e}>) -> vec4<${e}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,cN=e=>{let t=Fn(e.inputs[0].dataType);e.compute(Zt(e.inputs[0],"Erf",r=>`erf_vf32(${r})`,Gh(t)))},uN=e=>{e.compute(Zt(e.inputs[0],"Exp","exp"))},dN=e=>{e.compute(Zt(e.inputs[0],"Floor","floor"))},hN=e=>{let t=Fn(e.inputs[0].dataType);e.compute(Zt(e.inputs[0],"Gelu",r=>`0.5 * ${r} * (1.0 + erf_vf32(${r} * 0.7071067811865475))`,Gh(t)))},fN=(e,t)=>{let r=Fn(e.inputs[0].dataType);e.compute(Zt(e.inputs[0],"LeakyRelu",n=>`select(leaky_relu_alpha_ * ${n}, ${n}, ${n} >= vec4<${r}>(0.0))`,`const leaky_relu_alpha_ = ${r}(${t.alpha});`,t.cacheKey))},pN=e=>{e.compute(Zt(e.inputs[0],"Not",t=>`!${t}`))},mN=e=>{e.compute(Zt(e.inputs[0],"Neg",t=>`-${t}`))},gN=e=>{e.compute(Zt(e.inputs[0],"Reciprocal",t=>`1.0/${t}`))},_N=e=>{let t=Fn(e.inputs[0].dataType);e.compute(Zt(e.inputs[0],"Relu",r=>`select(vec4<${t}>(0.0), ${r}, ${r} > vec4<${t}>(0.0))`))},yN=e=>{e.compute(Zt(e.inputs[0],"Sigmoid",t=>`(1.0 / (1.0 + exp(-${t})))`))},wN=e=>nr(e),vN=(e,t)=>{let r=Fn(e.inputs[0].dataType);e.compute(Zt(e.inputs[0],"HardSigmoid",n=>`max(vec4<${r}>(0.0), min(vec4<${r}>(1.0), ${t.alpha} * ${n} + vec4<${r}>(${t.beta})))`,void 0,t.cacheKey))},xN=e=>{e.compute(Zt(e.inputs[0],"Sin","sin"))},bN=e=>{e.compute(Zt(e.inputs[0],"Sinh","sinh"))},MN=e=>{e.compute(Zt(e.inputs[0],"Sqrt","sqrt"))},TN=e=>{e.compute(Zt(e.inputs[0],"Tan","tan"))},Dg=e=>`sign(${e}) * (1 - exp(-2 * abs(${e}))) / (1 + exp(-2 * abs(${e})))`,EN=e=>{e.compute(Zt(e.inputs[0],"Tanh",Dg))},R0=(e="f32")=>`
const fast_gelu_a: ${e} = 0.5;
const fast_gelu_b: ${e} = 0.7978845608028654;
const fast_gelu_c: ${e} = 0.035677408136300125;

fn tanh_v(v: vec4<${e}>) -> vec4<${e}> {
  return ${Dg("v")};
}
`,z0=e=>`(fast_gelu_a + fast_gelu_a * tanh_v(${e} * (fast_gelu_c * ${e} * ${e} + fast_gelu_b))) * ${e}`,PN=e=>{let t=Fn(e.inputs[0].dataType);e.compute(Zt(e.inputs[0],"FastGelu",z0,R0(t),void 0,e.inputs[0].dataType))},kN=(e,t)=>{let r=Fn(e.inputs[0].dataType);return e.compute(Zt(e.inputs[0],"ThresholdedRelu",n=>`select(vec4<${r}>(0.0), ${n}, ${n} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${r}>(${t.alpha});`,t.cacheKey)),0},SN=e=>{e.compute(Zt(e.inputs[0],"Log","log"))},ZP=(e,t)=>`
const alpha = vec4<${e}>(${t});
const one = ${e}(1.0);
const zero = ${e}(0.0);

fn quick_gelu_impl(x: vec4<${e}>) -> vec4<${e}> {
  let v = x *alpha;
  var x1 : vec4<${e}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,ek=e=>`quick_gelu_impl(${e})`,CN=(e,t)=>{let r=Fn(e.inputs[0].dataType);e.compute(Zt(e.inputs[0],"QuickGelu",ek,ZP(r,t.alpha),t.cacheKey,e.inputs[0].dataType))}}),tk,rk,$N,DW=Je(()=>{Lt(),Rt(),Ew(),tk=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},rk=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let r=Fe("input",e[0].dataType,e[0].dims,4),n=Fe("bias",e[0].dataType,[e[0].dims[2]],4),s=ht("output",e[0].dataType,t,4),i=Ae.size(t)/4,a=_n(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)}}),getShaderSource:o=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${e[0].dims[2]/4/2}u;

  ${o.declareVariables(r,n,s)}

  ${Gh(a)}

  ${o.mainStart()}
    ${o.guardAgainstOutOfBoundsWorkgroupSizes(i)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${s.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},$N=e=>{tk(e.inputs),e.compute(rk(e.inputs))}}),nk,sk,Ys,IN,AN,jN,ON,NN,DN,FN,LN,RN,zN,FW=Je(()=>{Ct(),Lt(),Rt(),nk=(e,t,r,n,s,i,a,o,l,c,d,h)=>{let u,p;typeof o=="string"?u=p=(_,b)=>`${o}((${_}),(${b}))`:typeof o=="function"?u=p=o:(u=o.scalar,p=o.vector);let m=ht("outputData",d,n.length,4),y=Fe("aData",l,t.length,4),P=Fe("bData",c,r.length,4),g;if(s)if(i){let _=Ae.size(t)===1,b=Ae.size(r)===1,w=t.length>0&&t[t.length-1]%4===0,M=r.length>0&&r[r.length-1]%4===0;_||b?g=m.setByOffset("global_idx",p(_?`${y.type.value}(${y.getByOffset("0")}.x)`:y.getByOffset("global_idx"),b?`${P.type.value}(${P.getByOffset("0")}.x)`:P.getByOffset("global_idx"))):g=`
            let outputIndices = ${m.offsetToIndices("global_idx * 4u")};
            let offsetA = ${y.broadcastedIndicesToOffset("outputIndices",m)};
            let offsetB = ${P.broadcastedIndicesToOffset("outputIndices",m)};
            ${m.setByOffset("global_idx",p(a||w?y.getByOffset("offsetA / 4u"):`${y.type.value}(${y.getByOffset("offsetA / 4u")}[offsetA % 4u])`,a||M?P.getByOffset("offsetB / 4u"):`${P.type.value}(${P.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else g=m.setByOffset("global_idx",p(y.getByOffset("global_idx"),P.getByOffset("global_idx")));else{if(!i)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let _=(b,w,M="")=>{let E=`aData[indexA${w}][componentA${w}]`,T=`bData[indexB${w}][componentB${w}]`;return`
            let outputIndices${w} = ${m.offsetToIndices(`global_idx * 4u + ${w}u`)};
            let offsetA${w} = ${y.broadcastedIndicesToOffset(`outputIndices${w}`,m)};
            let offsetB${w} = ${P.broadcastedIndicesToOffset(`outputIndices${w}`,m)};
            let indexA${w} = offsetA${w} / 4u;
            let indexB${w} = offsetB${w} / 4u;
            let componentA${w} = offsetA${w} % 4u;
            let componentB${w} = offsetB${w} % 4u;
            ${b}[${w}] = ${M}(${u(E,T)});
          `};d===9?g=`
            var data = vec4<u32>(0);
            ${_("data",0,"u32")}
            ${_("data",1,"u32")}
            ${_("data",2,"u32")}
            ${_("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:g=`
            ${_("outputData[global_idx]",0)}
            ${_("outputData[global_idx]",1)}
            ${_("outputData[global_idx]",2)}
            ${_("outputData[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(y,P,m)}

        ${h??""}

        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${g}
      }`},sk=(e,t,r,n,s,i,a=r.dataType)=>{let o=r.dims.map(y=>Number(y)??1),l=n.dims.map(y=>Number(y)??1),c=!Ae.areEqual(o,l),d=o,h=Ae.size(o),u=!1,p=!1,m=[c];if(c){let y=Bl.calcShape(o,l,!1);if(!y)throw new Error("Can't perform binary op on the given tensors");d=y.slice(),h=Ae.size(d);let P=Ae.size(o)===1,g=Ae.size(l)===1,_=o.length>0&&o[o.length-1]%4===0,b=l.length>0&&l[l.length-1]%4===0;m.push(P),m.push(g),m.push(_),m.push(b);let w=1;for(let M=1;M<d.length;M++){let E=o[o.length-M],T=l[l.length-M];if(E===T)w*=E;else break}w%4===0?(p=!0,u=!0):(P||g||_||b)&&(u=!0)}else u=!0;return m.push(u),{name:e,shaderCache:{hint:t+m.map(y=>y.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:y=>nk(y,o,l,d,u,c,p,s,r.dataType,n.dataType,a,i),getRunData:()=>({outputs:[{dims:d,dataType:a}],dispatchGroup:{x:Math.ceil(h/64/4)},programUniforms:[{type:12,data:Math.ceil(Ae.size(d)/4)},..._t(o,l,d)]})}},Ys=(e,t,r,n,s,i)=>{e.compute(sk(t,s??"",e.inputs[0],e.inputs[1],r,n,i))},IN=e=>{Ys(e,"Add",(t,r)=>`${t}+${r}`)},AN=e=>{Ys(e,"Div",(t,r)=>`${t}/${r}`)},jN=e=>{Ys(e,"Equal",{scalar:(t,r)=>`u32(${t}==${r})`,vector:(t,r)=>`vec4<u32>(${t}==${r})`},void 0,void 0,9)},ON=e=>{Ys(e,"Mul",(t,r)=>`${t}*${r}`)},NN=e=>{let t=Fe("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;Ys(e,"Pow",{scalar:(r,n)=>`pow_custom(${r},${n})`,vector:(r,n)=>`pow_vector_custom(${r},${n})`},`
    fn pow_custom(a : ${t}, b : ${t}) -> ${t} {
      if (b == ${t}(0.0)) {
        return ${t}(1.0);
      } else if (a < ${t}(0.0) && f32(b) != floor(f32(b))) {
        return ${t}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${t}(1.0), round(f32(abs(b) % ${t}(2.0))) != 1.0) * ${t}(${t==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${t}>, b : vec4<${t}>) -> vec4<${t}> {
      // TODO: implement vectorized pow
      return vec4<${t}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},DN=e=>{Ys(e,"Sub",(t,r)=>`${t}-${r}`)},FN=e=>{Ys(e,"Greater",{scalar:(t,r)=>`u32(${t}>${r})`,vector:(t,r)=>`vec4<u32>(${t}>${r})`},void 0,void 0,9)},LN=e=>{Ys(e,"Less",{scalar:(t,r)=>`u32(${t}<${r})`,vector:(t,r)=>`vec4<u32>(${t}<${r})`},void 0,void 0,9)},RN=e=>{Ys(e,"GreaterOrEqual",{scalar:(t,r)=>`u32(${t}>=${r})`,vector:(t,r)=>`vec4<u32>(${t}>=${r})`},void 0,void 0,9)},zN=e=>{Ys(e,"LessOrEqual",{scalar:(t,r)=>`u32(${t}<=${r})`,vector:(t,r)=>`vec4<u32>(${t}<=${r})`},void 0,void 0,9)}}),ik,ak,ok,lk,BN,UN,LW=Je(()=>{Ct(),Lt(),Vr(),Rt(),ik=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");let r=0,n=e[r],s=n.dataType,i=n.dims.length;e.forEach((a,o)=>{if(o!==r){if(a.dataType!==s)throw new Error("input tensors should be one type");if(a.dims.length!==i)throw new Error("input tensors should have the same shape");a.dims.forEach((l,c)=>{if(c!==t&&l!==n.dims[c])throw new Error("non concat dimensions must match")})}})},ak=(e,t)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${e}u>(${t});
    for (var i: u32 = 0u; i < ${e}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${e}u;
  }`,ok=(e,t)=>{let r=e.length,n=[];for(let s=0;s<r;++s){let i=t.setByOffset("global_idx",e[s].getByIndices("indices"));r===1?n.push(i):s===0?n.push(`if (inputIndex == ${s}u) { ${i} }`):s===r-1?n.push(`else { ${i} }`):n.push(`else if (inputIndex == ${s}) { ${i} }`)}return n.join(`
`)},lk=(e,t,r,n)=>{let s=Ae.size(r),i=new Array(e.length),a=new Array(e.length),o=0,l=[],c=[],d=[{type:12,data:s}];for(let y=0;y<e.length;++y)o+=e[y].dims[t],i[y]=o,c.push(e[y].dims.length),a[y]=Fe(`input${y}`,n,c[y]),l.push("rank"),d.push({type:12,data:i[y]});for(let y=0;y<e.length;++y)d.push(..._t(e[y].dims));d.push(..._t(r));let h=ht("output",n,r.length),u=h.indicesGet("indices",t),p=Array.from(Array(i.length).keys()).map(y=>`uniforms.sizeInConcatAxis${y}`).join(","),m=y=>`

  ${(()=>{y.registerUniform("outputSize","u32");for(let P=0;P<e.length;P++)y.registerUniform(`sizeInConcatAxis${P}`,"u32");return y.declareVariables(...a,h)})()}

  ${ak(i.length,p)}

  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${h.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${u});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${i.length}u>(${p});
      ${u} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${ok(a,h)}
  }`;return{name:"Concat",shaderCache:{hint:`${t}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:r,dataType:n}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:d}),getShaderSource:m}},BN=(e,t)=>{let r=e.inputs,n=r[0].dims,s=Ae.normalizeAxis(t.axis,n.length);ik(r,s);let i=n.slice();i[s]=r.reduce((o,l)=>o+(l.dims.length>s?l.dims[s]:0),0);let a=r.filter(o=>Ae.size(o.dims)>0);e.compute(lk(a,s,i,r[0].dataType),{inputs:a})},UN=e=>nr({axis:e.axis})}),Eo,Po,ko,Pw,jo=Je(()=>{Ct(),Lt(),Eo=(e,t,r="f32")=>{switch(e.activation){case"Relu":return`value = max(value, ${t}(0.0));`;case"Sigmoid":return`value = (${t}(1.0) / (${t}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${t}(${r}(uniforms.clip_min)), ${t}(${r}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${t}(0.0), min(${t}(1.0), ${r}(uniforms.alpha) * value + ${r}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${r}(uniforms.alpha) * value, value, value >= ${t}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${e.activation}`)}},Po=(e,t)=>{e.activation==="Clip"?t.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):e.activation==="HardSigmoid"?t.push({type:1,data:e.alpha},{type:1,data:e.beta}):e.activation==="LeakyRelu"&&t.push({type:1,data:e.alpha})},ko=(e,t)=>{e.activation==="Clip"?t.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):e.activation==="HardSigmoid"?t.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):e.activation==="LeakyRelu"&&t.push({name:"alpha",type:"f32"})},Pw=e=>{let t=(e==null?void 0:e.activation)||"";if(t==="HardSigmoid"){let[r,n]=(e==null?void 0:e.activation_params)||[.2,.5];return{activation:t,alpha:r,beta:n}}else if(t==="Clip"){let[r,n]=(e==null?void 0:e.activation_params)||[pO,mO];return{activation:t,clipMax:n,clipMin:r}}else if(t==="LeakyRelu"){let[r]=(e==null?void 0:e.activation_params)||[.01];return{activation:t,alpha:r}}return{activation:t}}}),xn,VN,kw=Je(()=>{xn=(e,t)=>{switch(e){case 1:return t;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${e}-component is not supported.`)}},VN=e=>`
      ${e?"value = value + getBiasByOutputCoords(coords);":""}
      `}),WN,RW=Je(()=>{WN=e=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));
}
`}),lu,Sw,Cw=Je(()=>{Ct(),Lt(),Rt(),jo(),lu=(e,t,r,n,s)=>{let i=n-r;return`
      ${Array.from({length:r}).map((a,o)=>`
      if (${mt(t.shape,o,t.rank)} != 1) {
        ${t.indicesSet(e,o,mt(s,o+i,n))}
      } else {
        ${t.indicesSet(e,o,0)}
      }`).join("")}
`},Sw=(e,t,r,n,s=!1,i)=>{let a=e[0].dims,o=e[1].dims,l=a[a.length-2],c=o[o.length-1],d=a[a.length-1],h=Or(c),u=Or(d),p=Or(l),m=Ae.size(r)/h/p,y=e.length>2,P=n?n.slice(0,-2):r.slice(0,-2),g=[Ae.size(P),l,c],_=[{type:12,data:m},{type:12,data:l},{type:12,data:c},{type:12,data:d}];Po(t,_),_.push(..._t(P,a,o)),y&&_.push(..._t(e[2].dims)),_.push(..._t(g));let b=w=>{let M=bw("batch_dims",e[0].dataType,P.length),E=Fe("a",e[0].dataType,a.length,u),T=Fe("b",e[1].dataType,o.length,h),S=ht("output",e[0].dataType,g.length,h),A=_n(S.type.tensor),j=Eo(t,S.type.value,A),U=[E,T],W="";if(y){let Q=s?h:1;U.push(Fe("bias",e[2].dataType,e[2].dims.length,Q)),W=`${s?`value += bias[col / ${Q}];`:`value += ${S.type.value}(bias[row + i]);`}`}let B=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];ko(t,B);let ee=()=>{let Q=`var a_data: ${E.type.value};`;for(let Z=0;Z<u;Z++)Q+=`
              let b_data${Z} = b[(b_offset + (k + ${Z}) * uniforms.N + col) / ${h}];`;for(let Z=0;Z<p;Z++){Q+=`a_data = a[(a_offset + (row + ${Z}) * uniforms.K + k) / ${u}];`;for(let J=0;J<u;J++)Q+=`
            values[${Z}] = fma(${T.type.value}(a_data${u===1?"":`[${J}]`}), b_data${J}, values[${Z}]);
`}return Q};return`
  ${w.registerUniforms(B).registerInternalVariables(M).declareVariables(...U,S)}
  ${w.mainStart()}
    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${h})) * ${h};
    var index1 = global_idx / (uniforms.N / ${h});
    let stride1 = uniforms.M / ${p};
    let row = (index1 % stride1) * ${p};
    let batch = index1 / stride1;

    ${r.length===2?"":`let batch_indices = ${M.offsetToIndices("batch")};`}

    var a_indices: ${E.type.indices};
    ${lu("a_indices",E,E.rank-2,M.rank,"batch_indices")}
    ${E.indicesSet("a_indices",E.rank-2,0)}
    ${E.indicesSet("a_indices",E.rank-1,0)}
    let a_offset = ${E.indicesToOffset("a_indices")};

    var b_indices: ${T.type.indices};
    ${lu("b_indices",T,T.rank-2,M.rank,"batch_indices")}
    ${T.indicesSet("b_indices",T.rank-2,0)}
    ${T.indicesSet("b_indices",T.rank-1,0)}
    let b_offset = ${T.indicesToOffset("b_indices")};
    var values: array<${S.type.value}, ${p}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${u}) {
      ${ee()}
    }
    for (var i = 0u; i < ${p}u; i++) {
      var value = values[i];
      ${W}
      ${j}
      let cur_indices = ${S.type.indices}(batch, row + i, col);
      let offset = ${S.indicesToOffset("cur_indices")};
      ${S.setByOffset(`offset / ${h}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${t.activation};${h};${u};${p};${s}`,inputDependencies:y?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:i?i(r):r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:_}),getShaderSource:b}}}),ck,uk,B0,Fg,dk,U0,hk,Cf,$w=Je(()=>{Ct(),Lt(),Rt(),jo(),Cw(),kw(),ck=(e,t)=>e?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${t?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${t?", batchIndices":""});
        `,uk=(e,t)=>e?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${t===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,B0=(e,t,r="f32",n,s=!1,i=32,a=!1,o=32)=>{let l=t[1]*e[1],c=t[0]*e[0],d=s?l:i,h=s?i:l,u=d/t[0],p=i/t[1];if(!((s&&u===4&&e[1]===4||!s&&(u===3||u===4))&&d%t[0]===0&&i%t[1]===0&&e[0]===4))throw new Error(`If transposeA ${s} is true, innerElementSize ${u} and workPerThread[1] ${e[1]} must be 4.
      Otherwise, innerElementSize ${u} must be 3 or 4.
  tileAWidth ${d} must be divisible by workgroupSize[0]${t[0]}. tileInner ${i} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${e[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${u}<${r}>, ${d/u}>, ${h}>;
var<workgroup> mm_Bsub: array<array<vec4<${r}>, ${c/e[0]}>, ${i}>;

const rowPerThread = ${e[1]};
const colPerThread = ${e[0]};
const innerElementSize = ${u};
const tileInner = ${i};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${a?"0":"i32(globalId.z)"};
  ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${l};

  let num_tiles = ${a?`${Math.ceil(o/i)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

  var acc: array<vec4<${r}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${p};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${ck(s,n)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${p}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${n?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${u===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${uk(s,u)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Fg=(e,t)=>e?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${t?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${t?", batchIndices":""});
            `,dk=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",U0=(e,t,r="f32",n,s=!1,i=32,a=!1,o=32,l=!1)=>{let c=e[1]*t[1],d=e[0]*t[0],h=s?c:i,u=s?i:c;if(!(u%t[1]===0&&h%t[0]===0&&i%t[1]===0))throw new Error(`tileAHight ${u} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${h} must be divisible by workgroupSize[0]${t[0]}, tileInner ${i} must be divisible by workgroupSize[1]${t[1]}`);let p=u/t[1],m=h/t[0],y=i/t[1],P=l?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${c};
    let globalColStart = i32(workgroupId.x) * ${d};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${u}; inputRow = inputRow + ${t[1]}) {
        for (var inputCol = localCol; inputCol < ${h}; inputCol = inputCol + ${t[0]}) {
          ${Fg(s,n)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${i}; inputRow = inputRow + ${t[1]}) {
            for (var inputCol = localCol; inputCol < ${d}; inputCol = inputCol + ${t[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${n?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${r}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${s?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${t[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${t[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${c};

let tileRowA = i32(localId.y) * ${p};
let tileColA = i32(localId.x) * ${m};
let tileRowB = i32(localId.y) * ${y};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${p}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${m}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Fg(s,n)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${y}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${n?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${r}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${dk(s)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${r}, ${h}>, ${u}>;
  var<workgroup> mm_Bsub : array<array<${r}, ${d}>, ${i}>;
  const rowPerThread = ${e[1]};
  const colPerThread = ${e[0]};
  const tileInner = ${i};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${a?"0":"i32(globalId.z)"};
    ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${a?`${Math.ceil(o/i)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

    var acc : array<array<${r}, colPerThread>, rowPerThread>;
    ${P}
  }
`},hk=(e,t,r,n,s=!1)=>{let[i,a,o,l]=n,c=_n(n[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${i.type.indices}) -> ${xn(e,c)} {
      var value = ${xn(e,c)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${a.type.indices};
        ${lu("aIndices",a,a.rank-2,i.rank,"batchIndices")}
        ${a.indicesSet("aIndices",a.rank-2,"u32(row)")}
        ${a.indicesSet("aIndices",a.rank-1,"u32(colIn)")}
        value = ${a.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${i.type.indices}) -> ${xn(e,c)} {
      var value = ${xn(e,c)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${o.type.indices};
        ${lu("bIndices",o,o.rank-2,i.rank,"batchIndices")}
        ${o.indicesSet("bIndices",o.rank-2,"u32(row)")}
        ${o.indicesSet("bIndices",o.rank-1,"u32(colIn)")}
        value = ${o.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${xn(e,c)}) {
      let col = colIn * ${e};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${t?`value = value + ${s?"bias[colIn]":`${xn(e,c)}(bias[row])`};`:""}
        ${r}
        ${l.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Cf=(e,t,r,n,s=!1,i)=>{let a=e[0].dims,o=e[1].dims,l=a.slice(0,-2),c=o.slice(0,-2),d=n?n.slice(0,-2):r.slice(0,-2),h=Ae.size(d),u=a[a.length-2],p=a[a.length-1],m=o[o.length-1],y=p%4===0&&m%4===0,P=u<=8?[4,1,1]:[4,4,1],g=[8,8,1],_=[Math.ceil(m/g[0]/P[0]),Math.ceil(u/g[1]/P[1]),Math.ceil(h/g[2]/P[2])],b=y?4:1,w=[...l,u,p/b],M=w.length,E=[...c,p,m/b],T=E.length,S=[h,u,m/b],A=[{type:6,data:u},{type:6,data:m},{type:6,data:p}];Po(t,A),A.push(..._t(d,w,E));let j=["rank","rank"],U=e.length>2;U&&(A.push(..._t(e[2].dims)),j.push("rank")),A.push(..._t(S));let W=B=>{let ee=d.length,Q=bw("batchDims",e[0].dataType,ee,1),Z=_n(e[0].dataType),J=Fe("a",e[0].dataType,M,b),X=Fe("b",e[1].dataType,T,b),ae=ht("result",e[0].dataType,S.length,b),le=[J,X];if(U){let oe=s?b:1;le.push(Fe("bias",e[2].dataType,e[2].dims.length,oe))}let ne=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];ko(t,ne);let L=_n(ae.type.tensor),F=Eo(t,ae.type.value,L),G=hk(b,U,F,[Q,J,X,ae],s);return`
  ${B.registerUniforms(ne).registerInternalVariables(Q).declareVariables(...le,ae)}
  ${G}
  ${y?B0(P,g,Z,Q):U0(P,g,Z,Q)}
                   `};return{name:"MatMul",shaderCache:{hint:`${P};${t.activation};${y};${s}`,inputDependencies:j},getRunData:()=>({outputs:[{dims:i?i(r):r,dataType:e[0].dataType}],dispatchGroup:{x:_[0],y:_[1],z:_[2]},programUniforms:A}),getShaderSource:W}}}),fk,GN,zW=Je(()=>{Ct(),Ki(),Rt(),jo(),kw(),RW(),$w(),fk=(e,t,r,n,s=!1,i,a=4,o=4,l=4,c="f32")=>{let d=A=>{switch(A){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${c}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${A} is not supported.`)}},h=A=>{switch(A){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${A} is not supported.`)}},u=e?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,p=e?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,m=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",y=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",P=e?"row":"col",g=e?"col":"row",_=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${P} / outWidth;
    let outCol = ${P} % outWidth;

    let WRow = ${g} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${g} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${g} % inChannels;
    var resData = ${xn(a,c)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${m} && xCol >= 0 && xCol < ${y}) {
      ${u}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${d(a)}
    }
    return resData;`,b=e?t&&n?`
    let col = colIn * ${a};
    ${_}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${_}
    }
    return ${xn(a,c)}(0.0);`:n&&r?`
    let col = colIn * ${a};
    ${_}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${_}
    }
    return ${xn(a,c)}(0.0);`,w=e?n&&r?h(o):`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${h(o)}
    }
    return ${xn(o,c)}(0.0);`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${h(o)}
    }
    return ${xn(o,c)}(0.0);`,M=xn(l,c),E=xn(e?a:o,c),T=xn(e?o:a,c),S=Eo(i,M,c);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${E} {
      ${e?b:w}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${T} {
      ${e?w:b}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${M}) {
      let col = colIn * ${l};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${p}
      ${VN(s)}
      ${S}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},GN=(e,t,r,n,s,i,a,o,l)=>{let c=t.format==="NHWC",d=c?e[0].dims[3]:e[0].dims[1],h=r[0],u=c?r[2]:r[3],p=c?r[1]:r[2],m=c?r[3]:r[1],y=c&&(d%4===0||d%3===0)&&m%4===0,P=c?m:u*p,g=c?u*p:m,_=[8,8,1],b=n<=8?[4,1,1]:[4,4,1],w=[Math.ceil(P/_[0]/b[0]),Math.ceil(g/_[1]/b[1]),Math.ceil(h/_[2]/b[2])];Ht("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${w}`);let M=y?c&&d%4!==0?3:4:1,E=_[1]*b[1],T=_[0]*b[0],S=Math.max(_[0]*M,_[1]),A=n%E===0,j=s%T===0,U=i%S===0,W=y?[M,4,4]:[1,1,1],B=[{type:6,data:n},{type:6,data:s},{type:6,data:i},{type:6,data:[t.pads[0],t.pads[1]]},{type:6,data:t.strides},{type:6,data:t.dilations}];Po(t,B),B.push(..._t(e[0].dims,e[1].dims));let ee=["rank","rank"];a&&(B.push(..._t(e[2].dims)),ee.push("rank")),B.push(..._t(r));let Q=Z=>{let J=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];ko(t,J);let X=y?4:1,ae=_n(e[0].dataType),le=`
      fn setOutputAtIndex(flatIndex : i32, value : ${y?`vec4<${ae}>`:ae}) {
        result[flatIndex] = ${y?`vec4<${ae}>`:ae}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${y?`vec4<${ae}>`:ae}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${y?"/ 4":""}, value);
      }`,ne=Fe("x",e[0].dataType,e[0].dims.length,M===3?1:M),L=Fe("w",e[1].dataType,e[1].dims.length,X),F=[ne,L],G=ht("result",e[0].dataType,r.length,X);if(a){let oe=Fe("bias",e[2].dataType,e[2].dims.length,X);F.push(oe),le+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${y?`vec4<${ae}>`:ae} {
          return bias[coords.${c?"w":"y"}${y?"/ 4":""}];
        }`}return`
        ${WN("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Z.registerUniforms(J).declareVariables(...F,G)}
        ${le}
        ${fk(c,A,j,U,a,t,W[0],W[1],W[2],ae)}
        ${y?B0(b,_,ae,void 0,!c,S):U0(b,_,ae,void 0,!c,S,!1,void 0,o)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${t.cacheKey};${M};${y};${A};${j};${U};${E};${T};${S}`,inputDependencies:ee},getRunData:()=>({outputs:[{dims:l?l(r):r,dataType:e[0].dataType}],dispatchGroup:{x:w[0],y:w[1],z:w[2]},programUniforms:B}),getShaderSource:Q}}}),pk,Lg,Nc,mk,Rg,gk,qN,KN,BW=Je(()=>{Ct(),Ki(),Lt(),Rt(),jo(),kw(),pk=e=>{let t=1;for(let r=0;r<e.length;r++)t*=e[r];return t},Lg=e=>typeof e=="number"?[e,e,e]:e,Nc=(e,t)=>t<=1?e:e+(e-1)*(t-1),mk=(e,t,r,n=1)=>{let s=Nc(t,n);return Math.floor((e[0]*(r-1)-r+s)/2)},Rg=(e,t,r,n,s)=>{s==null&&(s=mk(e,t[0],n[0]));let i=[0,0,0,r];for(let a=0;a<3;a++)e[a]+2*s>=t[a]&&(i[a]=Math.trunc((e[a]-t[a]+2*s)/n[a]+1));return i},gk=(e,t,r,n,s,i,a,o,l,c)=>{let d,h,u,p;if(e==="VALID"&&(e=0),typeof e=="number"){d={top:e,bottom:e,left:e,right:e,front:e,back:e};let m=Rg([t,r,n,1],[o,l,c],1,[s,i,a],e);h=m[0],u=m[1],p=m[2]}else if(Array.isArray(e)){if(!e.every((y,P,g)=>y===g[0]))throw Error(`Unsupported padding parameter: ${e}`);d={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let m=Rg([t,r,n,1],[o,l,c],1,[s,i,a],e[0]);h=m[0],u=m[1],p=m[2]}else if(e==="SAME_UPPER"){h=Math.ceil(t/s),u=Math.ceil(r/i),p=Math.ceil(n/a);let m=(h-1)*s+o-t,y=(u-1)*i+l-r,P=(p-1)*a+c-n,g=Math.floor(m/2),_=m-g,b=Math.floor(y/2),w=y-b,M=Math.floor(P/2),E=P-M;d={top:b,bottom:w,left:M,right:E,front:g,back:_}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:d,outDepth:h,outHeight:u,outWidth:p}},qN=(e,t,r,n,s,i=!1,a="channelsLast")=>{let o,l,c,d,h;if(a==="channelsLast")[o,l,c,d,h]=e;else if(a==="channelsFirst")[o,h,l,c,d]=e;else throw new Error(`Unknown dataFormat ${a}`);let[u,,p,m,y]=t,[P,g,_]=Lg(r),[b,w,M]=Lg(n),E=Nc(p,b),T=Nc(m,w),S=Nc(y,M),{padInfo:A,outDepth:j,outHeight:U,outWidth:W}=gk(s,l,c,d,P,g,_,E,T,S),B=i?u*h:u,ee=[0,0,0,0,0];return a==="channelsFirst"?ee=[o,B,j,U,W]:a==="channelsLast"&&(ee=[o,j,U,W,B]),{batchSize:o,dataFormat:a,inDepth:l,inHeight:c,inWidth:d,inChannels:h,outDepth:j,outHeight:U,outWidth:W,outChannels:B,padInfo:A,strideDepth:P,strideHeight:g,strideWidth:_,filterDepth:p,filterHeight:m,filterWidth:y,effectiveFilterDepth:E,effectiveFilterHeight:T,effectiveFilterWidth:S,dilationDepth:b,dilationHeight:w,dilationWidth:M,inShape:e,outShape:ee,filterShape:t}},KN=(e,t,r,n,s,i)=>{let a=i==="channelsLast";a?e[0].dims[3]:e[0].dims[1];let o=[64,1,1],l={x:r.map((P,g)=>g)},c=[Math.ceil(pk(l.x.map(P=>r[P]))/o[0]),1,1];Ht("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${c}`);let d=1,h=Ae.size(r),u=[{type:12,data:h},{type:12,data:n},{type:12,data:s},{type:12,data:t.strides},{type:12,data:t.dilations}];Po(t,u),u.push(..._t(e[0].dims,e[1].dims));let p=["rank","rank"],m=e.length===3;m&&(u.push(..._t(e[2].dims)),p.push("rank")),u.push(..._t(r));let y=P=>{let g=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:n.length},{name:"pads",type:"u32",length:s.length},{name:"strides",type:"u32",length:t.strides.length},{name:"dilations",type:"u32",length:t.dilations.length}];ko(t,g);let _=1,b=_n(e[0].dataType),w=Fe("x",e[0].dataType,e[0].dims.length,d),M=Fe("W",e[1].dataType,e[1].dims.length,_),E=[w,M],T=ht("result",e[0].dataType,r.length,_),S="";if(m){let U=Fe("bias",e[2].dataType,e[2].dims.length,_);E.push(U),S+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${b} {
          return bias[${a?mt("coords",4,5):mt("coords",1,5)}];
        }`}let A=xn(d,b),j=Eo(t,A,b);return`
            ${S}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${w.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${M.getByIndices("aIndices")};
            }
          ${P.registerUniforms(g).declareVariables(...E,T)}
          ${P.mainStart()}
          ${P.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${T.offsetToIndices("global_idx")};
              let batch = ${mt("coords",0,w.rank)};
              let d2 = ${a?mt("coords",w.rank-1,w.rank):mt("coords",1,w.rank)};
              let xFRCCorner = vec3<u32>(${a?mt("coords",1,w.rank):mt("coords",2,w.rank)},
              ${a?mt("coords",2,w.rank):mt("coords",3,w.rank)},
              ${a?mt("coords",3,w.rank):mt("coords",4,w.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${a?mt("uniforms.x_shape",1,w.rank):mt("uniforms.x_shape",2,w.rank)};
              let xShapeZ = ${a?mt("uniforms.x_shape",2,w.rank):mt("uniforms.x_shape",3,w.rank)};
              let xShapeW = ${a?mt("uniforms.x_shape",3,w.rank):mt("uniforms.x_shape",4,w.rank)};
              let xShapeU = ${a?mt("uniforms.x_shape",4,w.rank):mt("uniforms.x_shape",1,w.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${a?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${a?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${a?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${a?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${m?"value = value + getBiasByOutputCoords(coords)":""};
              ${j}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${t.cacheKey};${a};${d};${m}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:c[0],y:c[1],z:c[2]},programUniforms:u}),getShaderSource:y}}}),HN,QN,UW=Je(()=>{Ct(),Lt(),Rt(),jo(),HN=(e,t,r,n)=>{let s=e.length>2,i=s?"value += b[output_channel];":"",a=e[0].dims,o=e[1].dims,l=t.format==="NHWC",c=l?r[3]:r[1],d=c/t.group,h=l&&d>=4?Or(c):1,u=Ae.size(r)/h,p=[{type:12,data:u},{type:12,data:t.dilations},{type:12,data:[t.strides[0],t.strides[1]]},{type:12,data:[t.pads[0],t.pads[1]]},{type:12,data:d}];Po(t,p),p.push(..._t(a,[o[0],o[1],o[2],o[3]/h]));let m=s?["rank","rank","rank"]:["rank","rank"];p.push(..._t([r[0],r[1],r[2],r[3]/h]));let y=P=>{let g=ht("output",e[0].dataType,r.length,h),_=_n(g.type.tensor),b=Eo(t,g.type.value,_),w=Fe("x",e[0].dataType,a.length),M=Fe("w",e[1].dataType,o.length,h),E=[w,M];s&&E.push(Fe("b",e[2].dataType,e[2].dims,h));let T=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:t.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];ko(t,T);let S=l?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${w.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${M.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${w.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${M.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${P.registerUniforms(T).declareVariables(...E,g)}

  ${P.mainStart()}
    ${P.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${g.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${l?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${l?1:2}], outputIndices[${l?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${h} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${l?2:1}];

    var value: ${g.type.value} = ${g.type.value}(0);
    ${S}
    ${i}
    ${b}
    ${g.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${t.cacheKey}_${h}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:n?n(r):r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:p}),getShaderSource:y}},QN=(e,t,r,n)=>{let s=e.length>2,i=Or(r[3]),a=Or(r[2]),o=Ae.size(r)/i/a,l=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/i],c=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/i],d=[r[0],r[1],r[2],r[3]/i],h=[{type:12,data:o},{type:6,data:[t.strides[0],t.strides[1]]},{type:6,data:[t.pads[0],t.pads[1]]}];Po(t,h),h.push(..._t(l,c,d));let u=(a-1)*t.strides[1]+c[1],p=m=>{let y=ht("output",e[0].dataType,d.length,i),P=_n(y.type.tensor),g=Eo(t,y.type.value,P),_=Fe("x",e[0].dataType,l.length,i),b=Fe("w",e[1].dataType,c.length,i),w=[_,b];s&&w.push(Fe("b",e[2].dataType,e[2].dims,i));let M=s?"value += b[output_channel];":"",E=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return ko(t,E),`
  ${m.registerUniforms(E).declareVariables(...w,y)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${a}u;
    let col = (index1 % width1) * ${a}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${_.type.value}, ${u}>;
    var values: array<${y.type.value}, ${a}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${c[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${u}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${_.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${_.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${c[1]}; w_width++) {
          let w_val = ${b.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${a}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${a}u; i++) {
      var value = values[i];
      ${M}
      ${g}
      ${y.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${t.cacheKey};${i};${a};${u};${c[0]};${c[1]}`,inputDependencies:s?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n?n(r):r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:h}),getShaderSource:p}}}),_k,xh,yk,bh,V0,zg,wk,vk,W0,VW=Je(()=>{Lt(),zW(),BW(),$w(),UW(),jo(),Cw(),Ia(),_k=(e,t,r,n,s,i)=>{let a=e[0],o=e.slice(i?1:2,i?3:4),l=o.length,c=t[0],d=t.slice(2).map((u,p)=>u+(u-1)*(r[p]-1)),h=o.map((u,p)=>u+n[p]+n[p+l]).map((u,p)=>Math.floor((u-d[p]+s[p])/s[p]));return h.splice(0,0,a),h.splice(i?3:1,0,c),h},xh=[2,3,1,0],yk=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let r=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[1]*t.group;if(r!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let s=e[0].dims.length-2;if(t.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(t.strides.length!==s)throw new Error(`strides should be ${s}D`);if(t.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},bh=(e,t)=>{let r=e.kernelShape.slice();r.length<t[1].dims.length-2&&r.push(...Array(t[1].dims.length-2-r.length).fill(0));for(let i=2;i<t[1].dims.length;++i)r[i-2]===0&&(r[i-2]=t[1].dims[i]);let n=e.pads.slice();kf.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,r,n,e.format==="NHWC",e.autoPad);let s=Object.assign({},e);return Object.assign(s,{kernelShape:r,pads:n}),s},V0=e=>{let t=Pw(e),r=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],s=e.dilations,i=e.group,a=e.kernel_shape,o=e.pads,l=e.strides,c=e.w_is_const();return{autoPad:n,format:r,dilations:s,group:i,kernelShape:a,pads:o,strides:l,wIsConst:c,...t,cacheKey:`${e.format};${t.activation};`}},zg=(e,t,r,n)=>{let s=r.format==="NHWC",i=_k(t[0].dims,t[1].dims,r.dilations,r.pads,r.strides,s);if(r.group!==1){let E=[t[0]];if(s){let T=e.kernelCustomData.wT??e.compute(ys(t[1],xh),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=T),E.push(T)}else E.push(t[1]);t.length===3&&E.push(t[2]),!e.adapterInfo.isArchitecture("ampere")&&s&&t[1].dims[0]===r.group&&t[1].dims[1]===1&&r.dilations[0]===1&&r.dilations[1]===1?e.compute(QN(E,r,i,n),{inputs:E}):e.compute(HN(E,r,i,n),{inputs:E});return}let a=t.length===3,o=t[0].dims[s?1:2],l=t[0].dims[s?2:3],c=t[0].dims[s?3:1],d=t[1].dims[2],h=t[1].dims[3],u=i[s?1:2],p=i[s?2:3],m=i[s?3:1],y=s&&d===o&&h===l&&r.pads[0]===0&&r.pads[1]===0;if(y||d===1&&h===1&&r.dilations[0]===1&&r.dilations[1]===1&&r.strides[0]===1&&r.strides[1]===1&&r.pads[0]===0&&r.pads[1]===0){let E=i[0],T,S,A,j=[];if(s){let B=e.kernelCustomData.wT??e.compute(ys(t[1],xh),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];if(r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=B),y){let ee=o*l*c;T=t[0].reshape([1,E,ee]),S=B.reshape([1,ee,m]),A=[1,E,m]}else T=t[0].reshape([E,o*l,c]),S=B.reshape([1,c,m]),A=[E,u*p,m];j.push(T),j.push(S)}else T=t[0].reshape([E,c,o*l]),S=t[1].reshape([1,m,c]),A=[E,m,u*p],j.push(S),j.push(T);a&&j.push(t[2]);let U=A[2],W=j[0].dims[j[0].dims.length-1];U<8&&W<8?e.compute(Sw(j,r,i,A,s,n),{inputs:j}):e.compute(Cf(j,r,i,A,s,n),{inputs:j});return}let P=!0,g=e.kernelCustomData.wT??e.compute(ys(t[1],xh),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=g);let _=[t[0],g];a&&_.push(t[2]);let b=s?u*p:m,w=s?m:u*p,M=d*h*c;e.compute(GN(_,r,i,b,w,M,a,P,n),{inputs:_})},wk=(e,t)=>{let r=t.format==="NHWC",n=[e.inputs[0].reshape(r?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let s=[0,t.pads[0],0,t.pads[1]],i=[1].concat(t.strides),a=[1].concat(t.dilations),o=[1].concat(t.kernelShape),l=bh({...t,pads:s,strides:i,dilations:a,kernelShape:o},n);zg(e,n,l,c=>r?[c[0],c[2],c[3]]:[c[0],c[1],c[3]])},vk=(e,t,r)=>{let n=r.format==="NHWC"?"channelsLast":"channelsFirst",s=bh(r,t),i=r.autoPad==="NOTSET"?r.pads:r.autoPad,a=qN(t[0].dims,t[1].dims,r.strides,r.dilations,i,!1,n);e.compute(KN(t,s,a.outShape,[a.filterDepth,a.filterHeight,a.filterWidth],[a.padInfo.front,a.padInfo.top,a.padInfo.left],n))},W0=(e,t)=>{if(yk(e.inputs,t),e.inputs[0].dims.length===3)wk(e,t);else if(e.inputs[0].dims.length===5)vk(e,e.inputs,t);else{let r=bh(t,e.inputs);zg(e,e.inputs,r)}}}),XN,WW=Je(()=>{Ct(),Ki(),Lt(),Rt(),XN=(e,t,r)=>{let n=e.length>2,s=t.outputShape,i=t.format==="NHWC",a=t.group,o=e[1].dims,l=o[2]/a,c=o[3],d=i?Or(l):1,h=i&&c===1&&l>=4,u=h?Math.floor(l/4)*4:Math.floor(l/d)*d,p=l-u,m=i?Or(c):1,y=i?c===1?d:m:1,P=Ae.size(s)/m,g=[Math.ceil(P/64),1,1];Ht("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${g}`);let _=["rank","rank"],b=[t.strides[0],t.strides[1]],w=[t.kernelShape[i?1:2],t.kernelShape[i?2:3]],M=[t.dilations[0],t.dilations[1]],E=[w[0]+(t.dilations[0]<=1?0:(t.kernelShape[i?1:2]-1)*(t.dilations[0]-1)),w[1]+(t.dilations[1]<=1?0:(t.kernelShape[i?2:3]-1)*(t.dilations[1]-1))],T=[E[0]-1-Math.floor((t.pads[0]+t.pads[2])/2),E[1]-1-Math.floor((t.pads[1]+t.pads[3])/2)],S=[{type:12,data:P},{type:12,data:b},{type:12,data:w},{type:12,data:M},{type:12,data:E},{type:6,data:T},{type:12,data:u},{type:12,data:l},{type:12,data:c},..._t(e[0].dims,e[1].dims)];n&&(S.push(..._t(e[2].dims)),_.push("rank")),S.push(..._t(s));let A=j=>{let U=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:b.length},{name:"filter_dims",type:"u32",length:w.length},{name:"dilations",type:"u32",length:w.length},{name:"effective_filter_dims",type:"u32",length:E.length},{name:"pads",type:"i32",length:T.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],W=_n(e[0].dataType),B=i?1:2,ee=i?2:3,Q=i?3:1,Z=Fe("W",e[1].dataType,e[1].dims.length,y),J=Fe("Dy",e[0].dataType,e[0].dims.length,d),X=[J,Z];n&&X.push(Fe("bias",e[2].dataType,[s[Q]].length,m));let ae=ht("result",e[0].dataType,s.length,m),le=()=>{let F="";if(h)d===4?F+=`
        let xValue = ${J.getByOffset("x_offset")};
        let wValue = ${Z.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:d===2?F+=`
          dotProd = dotProd + dot(vec4<${W}>(${J.getByOffset("x_offset")}, ${J.getByOffset("x_offset + 1u")}), vec4<${W}>(${Z.getByOffset("w_offset")}, ${Z.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:d===1&&(F+=`
          dotProd = dotProd + dot(vec4<${W}>(${J.getByOffset("x_offset")}, ${J.getByOffset("x_offset + 1u")}, ${J.getByOffset("x_offset + 2u")}, ${J.getByOffset("x_offset + 3u")}), vec4<${W}>(${Z.getByOffset("w_offset")}, ${Z.getByOffset("w_offset + 1u")}, ${Z.getByOffset("w_offset + 2u")}, ${Z.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(F+=`
                  let xValue = ${i?J.getByOffset(`${J.indicesToOffset(`${J.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${d}`):J.get("batch","inputChannel","idyR","idyC")};
        `,d===1)F+=`
          let w_offset = ${Z.indicesToOffset(`${Z.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${Z.getByOffset(`w_offset / ${y}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let G=0;G<d;G++)F+=`
            let wValue${G} = ${Z.getByOffset(`${Z.indicesToOffset(`${Z.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${G}, wOutChannel)`)} / ${y}`)};
            dotProd = dotProd + xValue[${G}] * wValue${G};`;return F},ne=()=>{if(p===0)return"";if(!h)throw new Error(`packInputAs4 ${h} is not true.`);let F="";if(d===1){F+="dotProd = dotProd";for(let G=0;G<p;G++)F+=`
            + ${J.getByOffset(`x_offset + ${G}`)} * ${Z.getByOffset(`w_offset + ${G}`)}`;F+=";"}else if(d===2){if(p!==2)throw new Error(`Invalid inputChannelsRemainder ${p}.`);F+=`
          let xValue = ${J.getByOffset("x_offset")};
          let wValue = ${Z.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return F},L=`
            let outputIndices = ${ae.offsetToIndices(`global_idx * ${m}`)};
            let batch = ${ae.indicesGet("outputIndices",0)};
            let d1 = ${ae.indicesGet("outputIndices",Q)};
            let r = ${ae.indicesGet("outputIndices",B)};
            let c = ${ae.indicesGet("outputIndices",ee)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${ae.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${W}(dyRCorner) + ${W}(wR)) / ${W}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${W}(uniforms.Dy_shape[${B}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${W}(dyCCorner) + ${W}(wC)) / ${W}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${W}(uniforms.Dy_shape[${ee}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${h?`
                var x_offset = ${J.indicesToOffset(`${J.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${d};
                var w_offset = ${Z.indicesToOffset(`${Z.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${y};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${h?4:d}) {
                  ${le()}
                  inputChannel = inputChannel + ${h?4:d};
                }
                ${ne()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${n?` + bias[d1 / ${m}]`:""};
            ${ae.setByOffset("global_idx","value")};
          `;return`
    ${j.registerUniforms(U).declareVariables(...X,ae)}
      ${j.mainStart()}
      ${j.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${L}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${t.cacheKey};${d}${y}${m}${h}${p}`,inputDependencies:_},getRunData:()=>({dispatchGroup:{x:g[0],y:g[1],z:g[2]},outputs:[{dims:r?r(s):s,dataType:e[0].dataType}],programUniforms:S}),getShaderSource:A}}}),xk,bk,Mk,Bg,JN,Tk,Ug,Ek,YN,GW=Je(()=>{WW(),jo(),Ia(),xk=(e,t,r,n,s,i)=>(e-1)*t+r+(n-1)*s+1-i,bk=(e,t,r,n,s)=>{let i=Math.floor(e/2);t==="SAME_UPPER"?(r[n]=i,r[s]=e-i):t==="SAME_LOWER"&&(r[n]=e-i,r[s]=i)},Mk=(e,t,r,n,s,i,a,o,l,c)=>{let d=e.length-2,h=c.length===0;l.length<d&&l.push(...Array(d-l.length).fill(0));let u=e[0],p=t[o?3:1]*s;for(let m=0,y=e.length-d-(o?1:0);m<d;++m,++y){let P=e[y],g=h?P*a[m]:c[m],_=xk(P,a[m],i[m],t[y],r[m],g);bk(_,n,i,m,m+d),h&&c.push(a[m]*(P-1)+l[m]+(t[y]-1)*r[m]+1-i[m]-i[m+d])}c.splice(0,0,u),c.splice(o?3:1,0,p)},Bg=(e,t)=>{let r=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((h,u)=>h*u,1)===0){r.length=0;for(let h=2;h<t[1].dims.length;++h)r.push(t[1].dims[h])}let n=e.format==="NHWC";r.splice(0,0,t[1].dims[0]),r.splice(n?3:1,0,t[1].dims[1]);let s=e.pads.slice(),i=e.outputShape.slice(),a=e.outputPadding.slice(),o=t[0].dims,l=e.dilations.slice();if(l.reduce((h,u)=>h+u,0)===0){let h=t[0].dims.length-2;l=new Array(h).fill(1)}let c=e.strides.slice();if(c.reduce((h,u)=>h+u,0)===0){let h=t[0].dims.length-2;c=new Array(h).fill(1)}Mk(o,r,l,e.autoPad,e.group,s,c,n,a,i);let d=Object.assign({},e);return Object.assign(d,{kernelShape:r,pads:s,outputPadding:a,outputShape:i,dilations:l,strides:c}),d},JN=e=>{let t=Pw(e),r=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],s=e.dilations,i=e.group,a=e.kernelShape,o=e.pads,l=e.strides,c=e.wIsConst(),d=e.outputPadding,h=e.outputShape;return{autoPad:n,format:r,dilations:s,group:i,kernelShape:a,outputPadding:d,outputShape:h,pads:o,strides:l,wIsConst:c,...t,cacheKey:`${e.format};${t.activation};`}},Tk=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let r=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[0];if(r!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let s=e[1].dims[1]*t.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==s))throw new Error("invalid bias");let i=e[0].dims.length-2;if(t.dilations.reduce((a,o)=>a+o,0)>0&&t.dilations.length!==i)throw new Error(`dilations should be ${i}D`);if(t.strides.reduce((a,o)=>a+o,0)>0&&t.strides.length!==i)throw new Error(`strides should be ${i}D`);if(t.pads.reduce((a,o)=>a+o,0)>0&&t.pads.length!==i*2)throw new Error(`pads should be ${i*2}D`);if(t.outputPadding.length!==i&&t.outputPadding.length!==0)throw new Error(`output_padding should be ${i}D`);if(t.kernelShape.reduce((a,o)=>a+o,0)>0&&t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(t.outputShape.length!==0&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},Ug=(e,t,r,n)=>{let s=e.kernelCustomData.wT??e.compute(ys(t[1],[2,3,0,1]),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=s);let i=[t[0],s];t.length===3&&i.push(t[2]),e.compute(XN(i,r,n),{inputs:i})},Ek=(e,t)=>{let r=t.format==="NHWC",n=[e.inputs[0].reshape(r?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let s=t.kernelShape;(s.length===0||s[0]===0)&&(s=[e.inputs[1].dims[2]]);let i=t.dilations;(i.length===0||i[0]===0)&&(i=[1]);let a=t.strides;(a.length===0||a[0]===0)&&(a=[1]);let o=t.pads;o.length===0&&(o=[0,0]),o=[0,o[0],0,o[1]],a=[1].concat(a),i=[1].concat(i),s=[1].concat(s);let l=t.outputPadding;l=[0].concat(l);let c=Bg({...t,pads:o,strides:a,dilations:i,kernelShape:s,outputPadding:l},n);Ug(e,n,c,d=>r?[d[0],d[2],d[3]]:[d[0],d[1],d[3]])},YN=(e,t)=>{if(Tk(e.inputs,t),e.inputs[0].dims.length===3)Ek(e,t);else{let r=Bg(t,e.inputs);Ug(e,e.inputs,r)}}}),Pk,ZN,eD,qW=Je(()=>{Ct(),Lt(),Vr(),Rt(),Pk=(e,t,r,n)=>{let s=Ae.size(t),i=t.length,a=Fe("input",e,i),o=ht("output",e,i),l=r.dataType===6?r.getInt32Array()[0]:Number(r.getBigInt64Array()[0]),c=Ae.normalizeAxis(l,i),d=h=>{let u=` i32(${a.indicesGet("inputIndices","uniforms.axis")}) `,p=mt("uniforms.input_shape","uniforms.axis",i),m=n.reverse?u+(n.exclusive?" + 1":""):"0",y=n.reverse?p:u+(n.exclusive?"":" + 1");return`
                ${h.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(a,o)}
                ${h.mainStart()}
                  ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${o.offsetToIndices("global_idx")};
                  var sum = ${o.type.value}(0);
                  let first : i32 = ${m};
                  let last : i32 = ${y};
                  for (var i : i32 = first; i < last; i++) {
                    ${a.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${a.getByIndices("inputIndices")};
                  }
                  ${o.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},{type:12,data:c},..._t(t,t)]}),getShaderSource:d}},ZN=(e,t)=>{let r=e.inputs[0].dims,n=e.inputs[0].dataType,s=e.inputs[1];e.compute(Pk(n,r,s,t),{inputs:[0]})},eD=e=>{let t=e.exclusive===1,r=e.reverse===1;return nr({exclusive:t,reverse:r})}}),kk,Sk,Ck,tD,rD,KW=Je(()=>{Ct(),Lt(),Vr(),Rt(),kk=e=>{if(!e||e.length!==1)throw new Error("DepthToSpace requires 1 input.");if(e[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},Sk=(e,t,r,n)=>{let s=[];s.push(`fn perm(i: ${n.type.indices}) -> ${r.type.indices} {
    var a: ${r.type.indices};`);for(let i=0;i<t;++i)s.push(r.indicesSet("a",e[i],`i[${i}]`));return s.push("return a;}"),s.join(`
`)},Ck=(e,t)=>{let r,n,s,i,a,o,l=t.format==="NHWC",c=t.blocksize,d=t.mode==="DCR";l?([r,n,s,i]=e.dims,a=d?[r,n,s,c,c,i/c**2]:[r,n,s,i/c**2,c,c],o=d?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([r,n,s,i]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],a=d?[r,c,c,i/c**2,n,s]:[r,i/c**2,c,c,n,s],o=d?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let h=e.reshape(a),u=h.dims.length,p=e.dataType,m=Fe("a",p,u),y=ht("output",p,u),P=g=>`
  ${g.registerUniform("output_size","u32").declareVariables(m,y)}

  ${Sk(o,u,m,y)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${y.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${y.setByOffset("global_idx",m.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${e.dims};${t.blocksize};${t.mode}`,inputDependencies:["rank"]},getRunData:g=>{let _=l?[r,n*c,s*c,i/c**2]:[r,i/c**2,n*c,s*c],b=Ae.size(_),w=h.dims,M=Ae.sortBasedOnPerm(w,o);return{outputs:[{dims:_,dataType:g[0].dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:[{type:12,data:b},..._t(w,M)]}},getShaderSource:P}},tD=(e,t)=>{kk(e.inputs),e.compute(Ck(e.inputs[0],t))},rD=e=>nr({blocksize:e.blocksize,mode:e.mode,format:e.format})}),Mh,Dc,Vg,$k,Ik,Ak,jk,Wg,Ok,nD,sD,HW=Je(()=>{Ct(),Lt(),Vr(),Rt(),Mh="[a-zA-Z]|\\.\\.\\.",Dc="("+Mh+")+",Vg="^"+Dc+"$",$k="("+Dc+",)*"+Dc,Ik="^"+$k+"$",Ak=class{constructor(e=-1){this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,t){let r=this.symbolToIndices.get(e);r===void 0?r=[t]:r.push(t),this.symbolToIndices.set(e,r)}},jk=class{constructor(e,t){var s;this.equation=t,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[r,n]=t.includes("->")?t.split("->",2):[t,""];if(!r.match(RegExp(Ik)))throw new Error("Invalid LHS term");if(r.split(",").forEach((i,a)=>{let o=e[a].dims.slice();if(!i.match(RegExp(Vg)))throw new Error("Invalid LHS term");let l=this.processTerm(i,!0,o,a);this.lhs.push(l)}),n==="")n+=[...this.symbolToInfo.entries()].filter(([i,a])=>a.count===1||i==="...").map(([i])=>i).join("");else if(!n.match(RegExp(Dc)))throw new Error("Invalid RHS");(s=n.match(RegExp(Mh,"g")))==null||s.forEach(i=>{if(i==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let a=this.symbolToInfo.get(i);if(a===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(a.dimValue)}}),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(e,t,r){let n=this.symbolToInfo.get(e);if(n!==void 0){if(n.dimValue!==t&&n.count!==1)throw new Error("Dimension mismatch");n.count++,n.inputIndices.push(r)}else n={count:1,dimValue:t,inputIndices:[r]};this.symbolToInfo.set(e,n)}processTerm(e,t,r,n=-1){let s=r.length,i=!1,a=[],o=0;if(!e.match(RegExp(Vg))&&!t&&e!=="")throw new Error("Invalid LHS term");let l=e.match(RegExp(Mh,"g")),c=new Ak(n);return l==null||l.forEach((d,h)=>{if(d==="..."){if(i)throw new Error("Only one ellipsis is allowed per input term");i=!0;let u=s-l.length+1;if(u<0)throw new Error("Ellipsis out of bounds");if(a=r.slice(o,o+u),this.hasEllipsis){if(this.ellipsisDims.length!==a.length||this.ellipsisDims.toString()!==a.toString())throw new Error("Ellipsis dimensions mismatch")}else if(t)this.hasEllipsis=!0,this.ellipsisDims=a;else throw new Error("Ellipsis must be specified in the LHS");for(let p=0;p<a.length;p++){let m=String.fromCharCode(48+p);c.addSymbol(m,h+p),this.addSymbol(m,r[o++],n)}}else c.addSymbol(d,h+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(d,r[o++],n)}),c}},Wg=e=>e+"_max",Ok=(e,t,r,n)=>{let s=e.map(c=>c.length).map((c,d)=>Fe(`input${d}`,t,c)),i=Ae.size(n),a=ht("output",t,n.length),o=[...r.symbolToInfo.keys()].filter(c=>!r.rhs.symbolToIndices.has(c)),l=c=>{let d=[],h="var prod = 1.0;",u="var sum = 0.0;",p="sum += prod;",m=[],y=[],P=[],g=[],_=r.symbolToInfo.size===r.rhs.symbolToIndices.size;r.symbolToInfo.forEach((w,M)=>{var E;if(r.rhs.symbolToIndices.has(M)){let T=(E=r.rhs.symbolToIndices.get(M))==null?void 0:E[0];T!==void 0&&r.lhs.forEach((S,A)=>{if(w.inputIndices.includes(A)){let j=S.symbolToIndices.get(M);if(j===void 0)throw new Error("Invalid symbol error");j.forEach(U=>{d.push(`${s[A].indicesSet(`input${A}Indices`,U,a.indicesGet("outputIndices",T))}`)})}})}else r.lhs.forEach((T,S)=>{if(w.inputIndices.includes(S)){let A=T.symbolToIndices.get(M);if(A===void 0)throw new Error("Invalid symbol error");A.forEach(j=>{m.push(`${s[S].indicesSet(`input${S}Indices`,j,`${M}`)}`)}),g.push(`prod *= ${s[S].getByIndices(`input${S}Indices`)};`)}}),y.push(`for(var ${M}: u32 = 0; ${M} < uniforms.${Wg(M)}; ${M}++) {`),P.push("}")});let b=_?[...d,`let sum = ${s.map((w,M)=>w.getByIndices(`input${M}Indices`)).join(" * ")};`]:[...d,u,...y,...m,h,...g,p,...P];return`
            ${c.registerUniforms(o.map(w=>({name:`${Wg(w)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...s,a)}

            ${c.mainStart()}
            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${a.offsetToIndices("global_idx")};
            ${s.map((w,M)=>`var input${M}Indices: ${s[M].type.indices};`).join(`
`)}
            ${b.join(`
`)};
            ${a.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:r.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let c=o.filter(h=>r.symbolToInfo.has(h)).map(h=>{var u;return{type:12,data:((u=r.symbolToInfo.get(h))==null?void 0:u.dimValue)||0}});c.push({type:12,data:i});let d=e.map((h,u)=>[..._t(h)]).reduce((h,u)=>h.concat(u),c);return d.push(..._t(n)),{outputs:[{dims:n,dataType:t}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:d}},getShaderSource:l}},nD=(e,t)=>{let r=new jk(e.inputs,t.equation),n=r.outputDims,s=e.inputs.map((i,a)=>i.dims);e.compute(Ok(s,e.inputs[0].dataType,r,n))},sD=e=>{let t=e.equation.replace(/\s+/g,"");return nr({equation:t})}}),Nk,Gg,Dk,Fk,iD,QW=Je(()=>{Ct(),Lt(),Rt(),Nk=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let t=e[0].dims,r=Array.from(e[1].getBigInt64Array(),Number),n=r.length<t.length?0:r.length-t.length,s=t.length<r.length?0:t.length-r.length;for(;n<r.length&&s<t.length;++n,++s)if(r[n]!==t[s]&&r[n]!==1&&t[s]!==1)throw new Error("Expand requires shape to be broadcastable to input")},Gg=(e,t)=>{let r=e.length-t.length,n=[];for(let s=0;s<r;++s)n.push(e[s]);for(let s=0;s<t.length;++s)n.push(t[s]===1?e[s+r]:t[s]);return n},Dk=(e,t)=>e.length>t.length?Gg(e,t):Gg(t,e),Fk=e=>{let t=e[0].dims,r=Array.from(e[1].getBigInt64Array(),Number),n=Dk(t,r),s=e[0].dataType,i=s===9||Ae.size(t)===1,a=s===9||t.length>0&&t[t.length-1]%4===0?4:1,o=i||n.length>0&&n[n.length-1]%4===0?4:1,l=Math.ceil(Ae.size(n)/o),c=h=>{let u=Fe("input",s,t.length,a),p=ht("output",s,n.length,o),m;if(s===9){let y=(P,g,_="")=>`
          let outputIndices${g} = ${p.offsetToIndices(`outputOffset + ${g}u`)};
          let offset${g} = ${u.broadcastedIndicesToOffset(`outputIndices${g}`,p)};
          let index${g} = offset${g} / 4u;
          let component${g} = offset${g} % 4u;
          ${P}[${g}] = ${_}(${u.getByOffset(`index${g}`)}[component${g}]);
        `;m=`
        let outputOffset = global_idx * ${o};
        var data = vec4<u32>(0);
        ${y("data",0,"u32")}
        ${y("data",1,"u32")}
        ${y("data",2,"u32")}
        ${y("data",3,"u32")}
        ${p.setByOffset("global_idx","data")}
      }`}else m=`
        let outputIndices = ${p.offsetToIndices(`global_idx * ${o}`)};
        let inputOffset = ${u.broadcastedIndicesToOffset("outputIndices",p)};
        let data = ${p.type.value}(${u.getByOffset(`inputOffset / ${a}`)});
        ${p.setByOffset("global_idx","data")}
      }`;return`
    ${h.registerUniform("vec_size","u32").declareVariables(u,p)}
    ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${m}`},d=[{type:12,data:l},..._t(t,n)];return{name:"Expand",shaderCache:{hint:`${n.length};${a}${o}`,inputDependencies:["rank"]},getShaderSource:c,getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:d})}},iD=e=>{Nk(e.inputs),e.compute(Fk(e.inputs),{inputs:[0]})}}),Lk,aD,XW=Je(()=>{Ct(),Lt(),Rt(),Ew(),Lk=e=>{let t=e[0].dataType,r=Ae.size(e[0].dims),n=Ae.size(e[1].dims),s=n%4===0,i=a=>{let o=Fe("x",t,[1],4),l=Fe("bias",t,[1],4),c=ht("y",t,[1],4),d=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],h=p=>`
      let bias${p}_offset: u32 = (global_idx * 4 + ${p}) % uniforms.bias_size;
      let bias${p} = ${l.getByOffset(`bias${p}_offset / 4`)}[bias${p}_offset % 4];`,u=s?`
      let bias = ${l.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${h(0)}${h(1)}${h(2)}${h(3)}
      let bias = ${o.type.value}(bias0, bias1, bias2, bias3);`;return`${a.registerUniforms(d).declareVariables(o,l,c)}

    ${R0(Fn(t))}

    ${a.mainStart(Ul)}
      ${a.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${o.getByOffset("global_idx")};
      ${u}
      let x_in = x + bias;
      ${c.setByOffset("global_idx",z0("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${s}`,inputDependencies:["type","type"]},getShaderSource:i,getRunData:a=>({outputs:[{dims:a[0].dims,dataType:a[0].dataType}],programUniforms:[{type:12,data:Math.ceil(r/4)},{type:12,data:n}],dispatchGroup:{x:Math.ceil(r/Ul/4)}})}},aD=e=>{e.inputs.length<2||Ae.size(e.inputs[1].dims)===0?PN(e):e.compute(Lk(e.inputs))}}),Rk,zk,oD,lD,JW=Je(()=>{Ct(),Lt(),Vr(),Rt(),Rk=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},zk=(e,t)=>{let r=e[0].dims,n=e[1].dims,s=r.length,i=Ae.normalizeAxis(t.axis,s),a=r.slice(0);a.splice(i,1,...n);let o=r[i],l=e[0].dataType===9?4:1,c=Math.ceil(Ae.size(a)/l),d=[{type:12,data:c},{type:6,data:o},{type:12,data:i},..._t(e[0].dims,e[1].dims,a)],h=u=>{let p=Fe("data",e[0].dataType,e[0].dims.length,l),m=Fe("inputIndices",e[1].dataType,e[1].dims.length),y=ht("output",e[0].dataType,a.length,l),P=_=>{let b=n.length,w=`var indicesIndices${_}  = ${m.type.indices}(0);`;for(let M=0;M<b;M++)w+=`${b>1?`indicesIndices${_}[${M}]`:`indicesIndices${_}`} = ${a.length>1?`outputIndices${_}[uniforms.axis + ${M}]`:`outputIndices${_}`};`;w+=`
          var idx${_} = ${m.getByIndices(`indicesIndices${_}`)};
          if (idx${_} < 0) {
            idx${_} = idx${_} + uniforms.axisDimLimit;
          }
          var dataIndices${_} : ${p.type.indices};
        `;for(let M=0,E=0;M<s;M++)M===i?(w+=`${s>1?`dataIndices${_}[${M}]`:`dataIndices${_}`} = u32(idx${_});`,E+=b):(w+=`${s>1?`dataIndices${_}[${M}]`:`dataIndices${_}`} = ${a.length>1?`outputIndices${_}[${E}]`:`outputIndices${_}`};`,E++);return w},g;if(e[0].dataType===9){let _=(b,w,M="")=>`
          let outputIndices${w} = ${y.offsetToIndices(`outputOffset + ${w}u`)};
          ${P(w)};
          let offset${w} = ${p.indicesToOffset(`dataIndices${w}`)};
          let index${w} = offset${w} / 4u;
          let component${w} = offset${w} % 4u;
          ${b}[${w}] = ${M}(${p.getByOffset(`index${w}`)}[component${w}]);
        `;g=`
        let outputOffset = global_idx * ${l};
        var value = vec4<u32>(0);
        ${_("value",0,"u32")}
        ${_("value",1,"u32")}
        ${_("value",2,"u32")}
        ${_("value",3,"u32")}
        ${y.setByOffset("global_idx","value")}
      `}else g=`
      let outputIndices = ${y.offsetToIndices("global_idx")};
      ${P("")};
      let value = ${p.getByIndices("dataIndices")};
      ${y.setByOffset("global_idx","value")};
      `;return`
      ${u.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(p,m,y)}
      ${u.mainStart()}
        ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${g}
      }`};return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:d}),getShaderSource:h}},oD=e=>nr({axis:e.axis}),lD=(e,t)=>{let r=e.inputs;Rk(r),e.compute(zk(e.inputs,t))}}),Bk,cD,uD,YW=Je(()=>{Ct(),Lt(),Rt(),Bk=(e,t,r,n,s,i,a,o,l)=>{let c=[{type:12,data:i},{type:12,data:n},{type:12,data:s},{type:12,data:r},{type:12,data:a},{type:12,data:o},{type:12,data:l}],d=[i];c.push(..._t(t.dims,d));let h=u=>{let p=Fe("indices_data",t.dataType,t.dims.length),m=ht("input_slice_offsets_data",12,1,1),y=[p,m],P=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:s.length},{name:"sizes_from_slice_dims_data",type:"u32",length:r.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${u.registerUniforms(P).declareVariables(...y)}
  ${u.mainStart()}
    ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${s.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${r.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return e.compute({name:"computeSliceOffsets",shaderCache:{hint:`${s.length}_${r.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:d,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:c}),getShaderSource:h},{inputs:[t],outputs:[-1]})[0]},cD=(e,t)=>{let r=e.inputs,n=r[0].dims,s=r[0].dataType,i=r[1].dims,a=i[i.length-1],o=Ae.sizeToDimension(i,i.length-1),l=Ae.sizeFromDimension(n,t.batchDims+a),c=Ae.sizeToDimension(n,t.batchDims),d=Ae.sizeFromDimension(n,t.batchDims),h=o/c,u=new Array(a),p=l;for(let w=0;w<a;++w)u[a-1-w]=p,p*=n[t.batchDims+a-1-w];let m=Bk(e,r[1],u,t.batchDims,n,o,h,d,a),y=t.batchDims+a;if(y>n.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let P=i.slice(0,-1).concat(n.slice(y)),g=Ae.size(P),_=[{type:12,data:g},{type:12,data:l},..._t(r[0].dims,m.dims,P)],b=w=>{let M=Fe("data",r[0].dataType,r[0].dims.length),E=Fe("slice_offsets",12,m.dims.length),T=ht("output",r[0].dataType,P.length);return`
          ${w.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(M,E,T)}
            ${w.mainStart()}
            ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};e.compute({name:"GatherND",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:P,dataType:s}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:_}),getShaderSource:b},{inputs:[r[0],m]})},uD=e=>({batchDims:e.batch_dims,cacheKey:""})}),Uk,Vk,dD,hD,ZW=Je(()=>{Ct(),Lt(),Vr(),Rt(),Uk=(e,t)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let r=Ae.normalizeAxis(t.quantizeAxis,e[0].dims.length),n=t.blockSize,s=e[0],i=e[2],a=e.length===4?e[3]:void 0;if(i.dims.length!==s.dims.length||!s.dims.map((o,l)=>l===r?Math.ceil(o/n)===i.dims[l]:o===i.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(a){if(a.dataType!==s.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(a.dims.length!==i.dims.length||!a.dims.map((o,l)=>o===i.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},Vk=(e,t)=>{let r=e[0].dims,n=e[1].dims,s=r.length,i=Ae.normalizeAxis(t.gatherAxis,s),a=Ae.normalizeAxis(t.quantizeAxis,s),o=r.slice(0);o.splice(i,1,...n);let l=Ae.size(o),c=e[2].dataType,d=e[0].dataType===22,h=[{type:12,data:l},{type:12,data:a},{type:12,data:i},{type:12,data:t.blockSize},..._t(...e.map((p,m)=>p.dims),o)],u=p=>{let m=Fe("data",e[0].dataType,e[0].dims.length),y=Fe("inputIndices",e[1].dataType,e[1].dims.length),P=Fe("scales",e[2].dataType,e[2].dims.length),g=e.length>3?Fe("zeroPoint",e[3].dataType,e[3].dims.length):void 0,_=ht("output",c,o.length),b=[m,y,P];g&&b.push(g);let w=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${p.registerUniforms(w).declareVariables(...b,_)}
        ${p.mainStart()}
        let output_indices = ${_.offsetToIndices("global_idx")};
        var indices_indices = ${y.type.indices}(0);
        ${n.length>1?`
          for (var i: u32 = 0; i < ${n.length}; i++) {
            let index = ${_.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${y.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${_.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${m.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${_.indicesGet("output_indices","i")};
          ${m.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${y.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${r[i]};
        }
        ${m.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${o.length}; i++) {
          let index = ${_.indicesGet("output_indices",`i + ${n.length} - 1`)};
          ${m.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${m.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${m.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${d?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${P.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${P.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${P.getByIndices("scale_indices")};
        ${g?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${g.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${g.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${d?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${Fn(c)}(quantized_data - zero_point) * scale;
        ${_.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${t.cacheKey};${e.filter((p,m)=>m!==1).map(p=>p.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:e.length},(p,m)=>"rank")},getRunData:()=>({outputs:[{dims:o,dataType:c}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:h}),getShaderSource:u}},dD=(e,t)=>{let r=e.inputs;Uk(r,t),e.compute(Vk(e.inputs,t))},hD=e=>nr({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),Wk,Gk,fD,pD,e8=Je(()=>{Ct(),Lt(),Vr(),Rt(),Wk=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},Gk=(e,t)=>{let r=e[0].dims,n=e[0].dataType,s=r.length,i=e[1].dims,a=e[1].dataType,o=Ae.normalizeAxis(t.axis,s),l=r[o],c=i.slice(0),d=Ae.size(c),h=Fe("input",n,s),u=Fe("indicesInput",a,i.length),p=ht("output",n,c.length),m=[{type:12,data:d},{type:6,data:l},{type:12,data:o}];return m.push(..._t(r,i,c)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:c,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:m}),getShaderSource:y=>`
      ${y.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(h,u,p)}
      ${y.mainStart()}
      ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${p.offsetToIndices("global_idx")};

      var idx = ${u.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${h.type.indices}(outputIndices);
      ${h.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${h.getByIndices("inputIndices")};

      ${p.setByOffset("global_idx","value")};
  }`}},fD=e=>nr({axis:e.axis}),pD=(e,t)=>{let r=e.inputs;Wk(r),e.compute(Gk(e.inputs,t))}}),qk,Kk,mD,gD,t8=Je(()=>{Ct(),Lt(),Rt(),qk=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},Kk=(e,t)=>{let r=e[0].dims.slice(),n=e[1].dims.slice(),[s,i,a]=fO.getShapeOfGemmResult(r,t.transA,n,t.transB,e.length===3?e[2].dims:void 0),o=[s,i];if(!o)throw new Error("Can't use gemm on the given tensors");let l=16,c=Math.ceil(i/l),d=Math.ceil(s/l),h=!0,u=Ae.size(o),p=[{type:12,data:h?c:u},{type:12,data:s},{type:12,data:i},{type:12,data:a},{type:1,data:t.alpha},{type:1,data:t.beta}],m=["type","type"];e.length===3&&(p.push(..._t(e[2].dims)),m.push("rank")),p.push(..._t(o));let y=g=>{let _="";t.transA&&t.transB?_="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":t.transA&&!t.transB?_="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!t.transA&&t.transB?_="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!t.transA&&!t.transB&&(_="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let b=t.alpha===1?"":"value *= uniforms.alpha;",w=Fe("a",e[0].dataType,e[0].dims),M=Fe("b",e[1].dataType,e[1].dims),E=w.type.value,T=null,S=[w,M];e.length===3&&(T=Fe("c",e[2].dataType,e[2].dims.length),S.push(T));let A=ht("output",e[0].dataType,o.length);S.push(A);let j=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${g.registerUniforms(j).declareVariables(...S)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${E}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${_}
    }

    ${b}
    ${T!=null?`let cOffset = ${T.broadcastedIndicesToOffset("vec2(m, n)",A)}; value += ${E}(uniforms.beta) * ${T.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},P=g=>{let _=Fe("a",e[0].dataType,e[0].dims),b=Fe("b",e[1].dataType,e[1].dims),w=null,M=[_,b];e.length===3&&(w=Fe("c",e[2].dataType,e[2].dims.length),M.push(w));let E=ht("output",e[0].dataType,o.length);M.push(E);let T=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],S="",A="";t.transA&&t.transB?(A=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${b.type.value}(0);
      }
      `,S="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):t.transA&&!t.transB?(A=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${b.type.value}(0);
      }
      `,S="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!t.transA&&t.transB?(A=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${b.type.value}(0);
      }
      `,S="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!t.transA&&!t.transB&&(A=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${b.type.value}(0);
      }
      `,S="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let j=t.alpha===1?"":"value *= uniforms.alpha;";return`
  ${g.registerUniforms(T).declareVariables(...M)}
  var<workgroup> tile_a: array<array<${_.type.storage}, ${l}>, ${l}>;
  var<workgroup> tile_b: array<array<${b.type.storage}, ${l}>, ${l}>;
  ${g.mainStart([l,l,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${l};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${l};
    let num_tiles = (uniforms.K - 1) / ${l} + 1;
    var k_start = 0u;
    var value = ${E.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${A}
      k_start = k_start + ${l};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${l}; k++) {
        ${S}
      }
      workgroupBarrier();
    }

    ${j}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${w!=null?`let cOffset = ${w.broadcastedIndicesToOffset("vec2(m, n)",E)}; value += ${E.type.value}(uniforms.beta) * ${w.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return h?{name:"GemmShared",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:c*d},programUniforms:p}),getShaderSource:P}:{name:"Gemm",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:p}),getShaderSource:y}},mD=e=>{let t=e.transA,r=e.transB,n=e.alpha,s=e.beta;return{transA:t,transB:r,alpha:n,beta:s,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},gD=(e,t)=>{qk(e.inputs),e.compute(Kk(e.inputs,t))}}),wi,Ai,Ja,Ya,Hk,Qk,Xk,Jk,Yk,Zk,eS,tS,_D,yD,r8=Je(()=>{Ct(),Lt(),Vr(),Rt(),[wi,Ai,Ja,Ya]=[0,1,2,3],Hk=e=>{if(e[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${e[0].dims.length-2}`);if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},Qk=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,Xk=e=>`
  fn gs_bicubic_interpolate(p: mat4x4<${e}>, x: f32, y: f32) -> ${e} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${e}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,Jk=e=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${e.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,Yk=e=>`
  ${e.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,Zk=(e,t,r)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${t} {
     var pixel = ${t}(0);
     var indices = vec4<u32>(0);
     indices[${wi}] = batch;
     indices[${Ai}] = channel;`+(()=>{switch(r.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Ja}] = u32(r);
            indices[${Ya}] = u32(c);
          } else {
            return ${t}(0);
          }
        `;case"border":return`
          indices[${Ja}] = u32(clamp(r, 0, H - 1));
          indices[${Ya}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Ja}] = gs_reflect(r, border[1], border[3]);
          indices[${Ya}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${r.paddingMode} is not supported`)}})()+`
    return ${e.getByIndices("indices")};
  }
`,eS=(e,t,r)=>(()=>{switch(r.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${wi}], indices[${Ai}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${wi}], indices[${Ai}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${wi}], indices[${Ai}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${wi}], indices[${Ai}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${wi}], indices[${Ai}], border);

          let dx2 = ${t}(f32(x2) - x);
          let dx1 = ${t}(x - f32(x1));
          let dy2 = ${t}(f32(y2) - y);
          let dy1 = ${t}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${t}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${wi}], indices[${Ai}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${r.mode} is not supported`)}})()+`${e.setByOffset("global_idx","result")}`,tS=(e,t)=>{let r=Fe("x",e[0].dataType,e[0].dims.length),n=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],s=Fe("grid",e[1].dataType,n.length,2),i=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];t.format==="NHWC"&&(i=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[wi,Ai,Ja,Ya]=[0,3,1,2]);let a=ht("output",e[0].dataType,i.length),o=r.type.value,l=Ae.size(i),c=[{type:12,data:l},..._t(e[0].dims,n,i)],d=h=>`
  ${h.registerUniform("output_size","u32").declareVariables(r,s,a)}
  ${Qk}
  ${Xk(o)}
  ${Jk(t)}
  ${Yk(t)}
  ${Zk(r,o,t)}

  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Ja}]);
      let W_in = i32(uniforms.x_shape[${Ya}]);

      ${t.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${a.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${wi}], indices[${Ja}], indices[${Ya}]);
      let nxy = ${s.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${eS(a,o,t)}
  }`;return{name:"GridSample",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:["type","type"]},getRunData:h=>{let u=Ae.size(i);return{outputs:[{dims:i,dataType:h[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}},getShaderSource:d}},_D=(e,t)=>{Hk(e.inputs),e.compute(tS(e.inputs,t))},yD=e=>nr({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),Wn,rS,wD,qg,nS,Qc,vD,xD=Je(()=>{Ct(),Lt(),Vr(),xw(),Tw(),Rt(),Ia(),Wn=(e,t)=>e.length>t&&e[t].dims.length>0?e[t]:void 0,rS=(e,t)=>{let r=e[0],n=Wn(e,1),s=Wn(e,2),i=Wn(e,3),a=Wn(e,4),o=Wn(e,5),l=Wn(e,6),c=Wn(e,7);if(r.dims.length!==3&&r.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let d=r.dims[0],h=r.dims[1],u=r.dims.length===3?r.dims[2]:t.numHeads*r.dims[4],p=h,m=0,y=0,P=Math.floor(u/t.numHeads);if(l&&c&&Ae.size(l.dims)&&Ae.size(c.dims)){if(l.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(l.dims[0]!==d||l.dims[1]!==t.numHeads||l.dims[3]!==P)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(c.dims[0]!==d||c.dims[1]!==t.numHeads||c.dims[3]!==P)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[2]!==c.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(c.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');m=l.dims[2],y=l.dims[2]}else if(l&&Ae.size(l.dims)||c&&Ae.size(c.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let g;if(n&&Ae.size(n.dims)>0){if(r.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(r.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(n.dims[2]!==r.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');g=2,p=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==P)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');g=5,p=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==P)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');g=0,p=n.dims[2]}}else{if(r.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(r.dims[2]!==t.numHeads||r.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');g=3}if(i&&Ae.size(i.dims)>0){if(i.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(n&&n.dims.length===5&&n.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let _=m+p,b=0;if(a&&Ae.size(a.dims)>0){b=8;let T=a.dims;throw T.length===1?T[0]===d?b=1:T[0]===3*d+2&&(b=3):T.length===2&&T[0]===d&&T[1]===_&&(b=5),b===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let w=!1,M=u;if(s&&Ae.size(s.dims)>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(r.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(p!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');M=s.dims[2]}else{if(p!==s.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');M=s.dims[1]*s.dims[3],w=!0}}let E=!1;if(a&&Ae.size(a.dims)>0)throw new Error("Key padding mask is not supported");if(o&&Ae.size(o.dims)>0){if(o.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(o.dims[0]!==d||o.dims[1]!==t.numHeads||o.dims[2]!==h||o.dims[3]!==_)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:d,sequenceLength:h,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:_,maxSequenceLength:y,inputHiddenSize:0,hiddenSize:u,vHiddenSize:M,headSize:P,vHeadSize:Math.floor(M/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:b,scale:t.scale,broadcastResPosBias:E,passPastInKv:w,qkvFormat:g}},wD=e=>nr({...e}),qg=nr({perm:[0,2,1,3]}),nS=(e,t,r,n,s,i,a)=>{let o=[n,s,i],l=Ae.size(o),c=[{type:12,data:l},{type:12,data:a},{type:12,data:i}],d=h=>{let u=ht("qkv_with_bias",t.dataType,o),p=Fe("qkv",t.dataType,o),m=Fe("bias",r.dataType,o),y=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${h.registerUniforms(y).declareVariables(p,m,u)}
  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c}),getShaderSource:d},{inputs:[t,r],outputs:[-1]})[0]},Qc=(e,t,r,n,s,i,a,o)=>{let l=i;if(a&&Ae.size(a.dims)>0){if(n===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return l=nS(e,i,a,t,n,r*s,o),l=l.reshape([t,n,r,s]),r===1||n===1?l:e.compute(ys(l,qg.perm),{inputs:[l],outputs:[-1]})[0]}else return i.dims.length===3&&(l=i.reshape([t,n,r,s])),r===1||n===1?l:e.compute(ys(l,qg.perm),{inputs:[l],outputs:[-1]})[0]},vD=(e,t)=>{let r=rS(e.inputs,t),n=e.inputs[0],s=Wn(e.inputs,1),i=Wn(e.inputs,2),a=Wn(e.inputs,3),o=Wn(e.inputs,4),l=Wn(e.inputs,5),c=Wn(e.inputs,6),d=Wn(e.inputs,7);if(n.dims.length===5)throw new Error("Packed QKV is not implemented");if((s==null?void 0:s.dims.length)===5)throw new Error("Packed KV is not implemented");let h=s&&i&&s.dims.length===4&&i.dims.length===4,u=Qc(e,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,n,a,0);if(h)return Du(e,u,s,i,o,void 0,c,d,l,r);if(!s||!i)throw new Error("key and value must be provided");let p=Qc(e,r.batchSize,r.numHeads,r.kvSequenceLength,r.headSize,s,a,r.hiddenSize),m=Qc(e,r.batchSize,r.numHeads,r.kvSequenceLength,r.vHeadSize,i,a,2*r.hiddenSize);Du(e,u,p,m,o,void 0,c,d,l,r)}}),sS,iS,aS,oS,G0,bD,MD,TD=Je(()=>{Ct(),Lt(),Vr(),Rt(),sS=e=>{if(!e||e.length<1)throw new Error("too few inputs")},iS=(e,t)=>{let r=[],n=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(s=>r.push(Number(s))),n=r.length),nr({numOutputs:n,axis:t.axis,splitSizes:r})},aS=e=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {
    if (index < ${mt("uniforms.size_in_split_axis","i",e)}) {
        return i;
    }
    }
    return ${e}u;
}`,oS=e=>{let t=e.length,r=[];for(let n=0;n<t;++n){let s=e[n].setByIndices("indices","input[global_idx]");t===1?r.push(s):n===0?r.push(`if (output_number == ${n}u) { ${s} }`):n===t-1?r.push(`else { ${s} }`):r.push(`else if (output_number == ${n}) { ${s} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {
        ${r.join(`
`)}
      }`},G0=(e,t)=>{let r=e[0].dims,n=Ae.size(r),s=e[0].dataType,i=Ae.normalizeAxis(t.axis,r.length),a=new Array(t.numOutputs),o=Fe("input",s,r.length),l=new Array(t.numOutputs),c=[],d=[],h=0,u=[{type:12,data:n}];for(let m=0;m<t.numOutputs;m++){h+=t.splitSizes[m],l[m]=h;let y=r.slice();y[i]=t.splitSizes[m],d.push(y),a[m]=ht(`output${m}`,s,y.length),c.push({dims:d[m],dataType:e[0].dataType})}u.push({type:12,data:l},..._t(r,...d));let p=m=>`
  ${m.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",l.length).declareVariables(o,...a)}
  ${aS(l.length)}
  ${oS(a)}

  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${o.offsetToIndices("global_idx")};
    var index = ${o.indicesGet("indices",i)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${mt("uniforms.size_in_split_axis","output_number - 1u",l.length)};
      ${o.indicesSet("indices",i,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:p,getRunData:()=>({outputs:c,dispatchGroup:{x:Math.ceil(n/64)},programUniforms:u})}},bD=(e,t)=>{sS(e.inputs);let r=e.inputs.length===1?t:iS(e.inputs,t);e.compute(G0(e.inputs,r),{inputs:[0]})},MD=e=>{let t=e.axis,r=e.splitSizes,n=e.numOutputs<0?r.length:e.numOutputs;if(n!==r.length)throw new Error("numOutputs and splitSizes lengh must be equal");return nr({axis:t,numOutputs:n,splitSizes:r})}}),lS,$f,ED,PD=Je(()=>{Ct(),Lt(),Vr(),Rt(),lS=(e,t)=>{let[r,n,s,i]=e,{numHeads:a,rotaryEmbeddingDim:o}=t;if(r.dims.length!==3&&r.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${r.dims.length}`);if(!Ae.areEqual(n.dims,[])&&!Ae.areEqual(n.dims,[1])&&n.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${n.dims.length}`);if(s.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(i.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${i.dims.length}`);if(!Ae.areEqual(s.dims,i.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(o>0&&a===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let l=r.dims[0],c=r.dims[r.dims.length-2],d=s.dims[0],h=Ae.sizeFromDimension(r.dims,1)/c,u=o===0?s.dims[1]*2:h/a;if(o>u)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(n.dims.length===2){if(l!==n.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${n.dims[0]}`);if(c!==n.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${n.dims[1]}`)}if(u/2!==s.dims[1]&&o/2!==s.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${s.dims[1]}`);if(c>d)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},$f=(e,t)=>{let{interleaved:r,numHeads:n,rotaryEmbeddingDim:s,scale:i}=t,a=e[0].dims[0],o=Ae.sizeFromDimension(e[0].dims,1),l=e[0].dims[e[0].dims.length-2],c=o/l,d=e[2].dims[1],h=s===0?d*2:c/n,u=new Array(a,l,c/h,h-d),p=Ae.computeStrides(u),m=[{type:1,data:i},{type:12,data:u},{type:12,data:p},...e[0].dims.length===3?new Array({type:12,data:[o,c,h,1]}):[],...e[0].dims.length===4?new Array({type:12,data:[o,h,l*h,1]}):[],..._t(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)],y=P=>{let g=Fe("input",e[0].dataType,e[0].dims.length),_=Fe("position_ids",e[1].dataType,e[1].dims.length),b=Fe("cos_cache",e[2].dataType,e[2].dims.length),w=Fe("sin_cache",e[3].dataType,e[3].dims.length),M=ht("output",e[0].dataType,e[0].dims.length);return P.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:u.length},{name:"global_strides",type:"u32",length:p.length},{name:"input_output_strides",type:"u32",length:p.length}]),`
        ${P.declareVariables(g,_,b,w,M)}

        ${P.mainStart(Ul)}
          let half_rotary_emb_dim = uniforms.${b.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${P.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${_.broadcastedIndicesToOffset("bsnh.xy",ht("",_.type.tensor,2))};
            let position_id =
                u32(${_.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${r});
            let j = i + select(half_rotary_emb_dim, 1, ${r});
            let re = ${g.getByOffset("i")} * ${b.get("position_id","bsnh[3]")} -
                ${g.getByOffset("j")} * ${w.get("position_id","bsnh[3]")};
            ${M.setByOffset("i","re")}
            let im = ${g.getByOffset("i")} * ${w.get("position_id","bsnh[3]")} +
                ${g.getByOffset("j")} * ${b.get("position_id","bsnh[3]")};
            ${M.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${M.setByOffset("k",g.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:nr({interleaved:r}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:y,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Ae.size(u)/Ul)},programUniforms:m})}},ED=(e,t)=>{lS(e.inputs,t),e.compute($f(e.inputs,t))}}),cS,uS,Kg,dS,kD,n8=Je(()=>{Vr(),Ct(),Tw(),xD(),TD(),Ia(),PD(),Rt(),cS=(e,t)=>{if(t.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let r=e[0],n=e[1],s=e[2],i=e[3],a=e[4];if(t.doRotary!==0&&e.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(t.localWindowSize!==-1)throw new Error("Local attention is not supported");if(t.softcap!==0)throw new Error("Softcap is not supported");if(t.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(t.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(r.dims.length!==3&&r.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let o=!1,l=r.dims[0],c=r.dims[1],d=r.dims.length===3?o?r.dims[2]/3:r.dims[2]:t.numHeads*r.dims[4],h=c,u=0,p=!n||n.dims.length===0,m=Math.floor(p?d/(t.numHeads+2*t.kvNumHeads):d/t.numHeads);p&&(d=m*t.numHeads);let y=i&&i.dims.length!==0,P=a&&a.dims.length!==0;if(y&&i.dims.length===4&&i.dims[0]===l&&i.dims[1]!==t.kvNumHeads&&i.dims[2]===t.kvNumHeads&&i.dims[3]===m)throw new Error("BSNH pastKey/pastValue is not supported");if(y&&P){if(i.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(a.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');u=i.dims[2]}else if(y||P)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let g=1;if(n&&n.dims.length>0){if(r.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(r.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(r.dims[2]%n.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');h=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==m)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');h=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==m)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');h=n.dims[2]}}else{if(r.dims.length!==3&&r.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(r.dims.length===5&&(r.dims[2]!==t.numHeads||r.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');g=3}let _=0,b=!1,w=t.kvNumHeads?m*t.kvNumHeads:d;if(s&&s.dims.length>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(r.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(h!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');w=s.dims[2]}else{if(h!==s.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');w=s.dims[1]*s.dims[3],b=!0}}let M=e.length>4?e[5]:void 0;if(M&&M.dims.length!==1&&M.dims[0]!==l)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:l,sequenceLength:c,pastSequenceLength:u,kvSequenceLength:h,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:d,vHiddenSize:w,headSize:m,vHeadSize:Math.floor(w/t.kvNumHeads),numHeads:t.numHeads,kvNumHeads:t.kvNumHeads,nReps:t.numHeads/t.kvNumHeads,pastPresentShareBuffer:!1,maskType:_,scale:t.scale,broadcastResPosBias:!1,passPastInKv:b,qkvFormat:g}},uS=nr({perm:[0,2,1,3]}),Kg=(e,t,r)=>{let n=t,s=r.kvNumHeads;return t.dims.length===3&&r.kvSequenceLength!==0&&(n=t.reshape([r.batchSize,r.kvSequenceLength,s,r.headSize]),n=e.compute(ys(n,uS.perm),{inputs:[n],outputs:[-1]})[0]),n},dS=(e,t,r,n)=>{let s=7,i=["type","type"],a=[e*t],o=e*t,l=[{type:12,data:o},{type:12,data:t},{type:12,data:e}],c=d=>{let h=Fe("seq_lens",r.dataType,r.dims),u=Fe("total_seq_lens",n.dataType,n.dims),p=ht("pos_ids",s,a),m=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${d.registerUniforms(m).declareVariables(h,u,p)}
  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${u.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${h.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${p.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${p.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${p.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${e};${t}`,inputDependencies:i},getRunData:()=>({outputs:[{dims:a,dataType:s}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:l}),getShaderSource:c}},kD=(e,t)=>{var w;let r=cS(e.inputs,t);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((w=e.inputs[1])==null?void 0:w.dims.length)===5)throw new Error("Packed KV is not implemented");let n=e.inputs[0],s=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,i=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,a=e.inputs[3]&&e.inputs[3].dims.length!==0?e.inputs[3]:void 0,o=e.inputs[4]&&e.inputs[4].dims.length!==0?e.inputs[4]:void 0,l=e.inputs.length>4?e.inputs[5]:void 0,c=e.inputs.length>5?e.inputs[6]:void 0,d=r.kvNumHeads?r.kvNumHeads:r.numHeads,h=nr({axis:2,numOutputs:3,splitSizes:[r.numHeads*r.headSize,d*r.headSize,d*r.headSize]}),[u,p,m]=!s&&!i?e.compute(G0([n],h),{inputs:[n],outputs:[-1,-1,-1]}):[n,s,i],y,P;if(t.doRotary){let M=e.compute(dS(r.batchSize,r.sequenceLength,l,c),{inputs:[l,c],outputs:[-1]})[0],E=e.inputs[7],T=e.inputs[8],S=nr({interleaved:t.rotaryInterleaved!==0,numHeads:r.numHeads,rotaryEmbeddingDim:0,scale:t.scale}),A=[u,M,E,T],j=[-1];y=e.compute($f(A,S),{inputs:A,outputs:j})[0],A.splice(0,1,p);let U=nr({interleaved:t.rotaryInterleaved!==0,numHeads:r.kvNumHeads,rotaryEmbeddingDim:0,scale:t.scale});P=e.compute($f(A,U),{inputs:A,outputs:j})[0]}let g=Qc(e,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,t.doRotary?y:u,void 0,0),_=Kg(e,t.doRotary?P:p,r),b=Kg(e,m,r);Du(e,g,_,b,void 0,void 0,a,o,void 0,r,l,c)}}),Hg,hS,fS,SD,s8=Je(()=>{Ct(),Lt(),Ia(),Rt(),Hg=(e,t,r,n,s,i,a,o)=>{let l=Or(i),c=l===1?"f32":`vec${l}f`,d=l===1?"vec2f":`mat2x${l}f`,h=s*a,u=64;h===1&&(u=256);let p=[s,a,i/l],m=[s,a,2],y=["rank","type","type"],P=[];P.push(..._t(p,m));let g=_=>{let b=Fe("x",t.dataType,3,l),w=Fe("scale",r.dataType,r.dims),M=Fe("bias",n.dataType,n.dims),E=ht("output",1,3,2),T=[b,w,M,E];return`
  var<workgroup> workgroup_shared : array<${d}, ${u}>;
  const workgroup_size = ${u}u;
  ${_.declareVariables(...T)}
  ${_.mainStart(u)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${c}(0);
    var squared_sum = ${c}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${c}(${b.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${d}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Pa("workgroup_shared[0][0]",l)} / f32(hight * ${l});
      let squared_sum_final = ${Pa("workgroup_shared[0][1]",l)} / f32(hight * ${l});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${o}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${l};${o};${u}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:m,dataType:1}],dispatchGroup:{x:h},programUniforms:P}),getShaderSource:g},{inputs:[t,r,n],outputs:[-1]})[0]},hS=(e,t,r)=>{let n=t[0].dims,s=n,i=2,a=n[0],o=n[1],l=Ae.sizeFromDimension(n,i),c=Or(l),d=Ae.size(s)/c,h=Hg(e,t[0],t[1],t[2],a,l,o,r.epsilon),u=[a,o,l/c],p=[a,o],m=["type","none"],y=P=>{let g=Fe("x",t[0].dataType,u.length,c),_=Fe("scale_shift",1,p.length,2),b=ht("output",t[0].dataType,u.length,c),w=[g,_,b];return`
  ${P.registerUniform("output_size","u32").declareVariables(...w)}
  ${P.mainStart()}
  ${P.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${b.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${_.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${g.getByOffset("global_idx")} * ${b.type.value}(scale_shift.x) + ${b.type.value}(scale_shift.y);
      ${b.setByOffset("global_idx","value")};
  }`};e.compute({name:"InstanceNormalization",shaderCache:{hint:`${c}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:[{type:12,data:d},..._t(u,p,u)]}),getShaderSource:y},{inputs:[t[0],h]})},fS=(e,t,r)=>{let n=t[0].dims,s=n,i=n[0],a=n[n.length-1],o=Ae.sizeFromDimension(n,1)/a,l=Or(a),c=Ae.size(s)/l,d=[{type:12,data:o},{type:12,data:Math.floor(a/l)}],h=["type","type"],u=!1,p=[0,n.length-1];for(let g=0;g<n.length-2;g++)u=u||n[g+1]!==1,p.push(g+1);u=u&&n[n.length-1]!==1;let m=u?e.compute(ys(e.inputs[0],p),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:n.length},(g,_)=>n[p[_]])),y=Hg(e,m,t[1],t[2],i,o,a,r.epsilon),P=g=>{let _=_n(t[0].dataType),b=l===1?"vec2f":`mat${l}x2f`,w=T=>{let S=T===0?"x":"y",A=l===1?"f32":`vec${l}f`;switch(l){case 1:return`${_}(${A}(scale.${S}))`;case 2:return`vec2<${_}>(${A}(scale[0].${S}, scale[1].${S}))`;case 4:return`vec4<${_}>(${A}(scale[0].${S}, scale[1].${S}, scale[2].${S}, scale[3].${S}))`;default:throw new Error(`Not supported compoents ${l}`)}},M=Fe("input",t[0].dataType,t[0].dims,l),E=ht("output",t[0].dataType,s,l);return`
  @group(0) @binding(0) var<storage, read> input : array<${M.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${b}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${E.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${g.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${w(0)}, ${w(1)});
  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${l}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:d}),getShaderSource:P},{inputs:[t[0],y]})},SD=(e,t)=>{t.format==="NHWC"?fS(e,e.inputs,t):hS(e,e.inputs,t)}}),pS,mS,CD,i8=Je(()=>{Ct(),Lt(),Rt(),pS=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},mS=(e,t,r)=>{let n=t.simplified,s=e[0].dims,i=e[1],a=!n&&e[2],o=s,l=Ae.normalizeAxis(t.axis,s.length),c=Ae.sizeToDimension(s,l),d=Ae.sizeFromDimension(s,l),h=Ae.size(i.dims),u=a?Ae.size(a.dims):0;if(h!==d||a&&u!==d)throw new Error(`Size of X.shape()[axis:] == ${d}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${h} and bias size of ${u}`);let p=[];for(let M=0;M<s.length;++M)M<l?p.push(s[M]):p.push(1);let m=Or(d),y=["type","type"],P=[{type:12,data:c},{type:1,data:d},{type:12,data:Math.floor(d/m)},{type:1,data:t.epsilon}];a&&y.push("type");let g=r>1,_=r>2,b=M=>{let E=_n(e[0].dataType),T=[Fe("x",e[0].dataType,e[0].dims,m),Fe("scale",i.dataType,i.dims,m)];a&&T.push(Fe("bias",a.dataType,a.dims,m)),T.push(ht("output",e[0].dataType,o,m)),g&&T.push(ht("mean_data_output",1,p)),_&&T.push(ht("inv_std_output",1,p));let S=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${M.registerUniforms(S).declareVariables(...T)}
  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${D0("f32",m)};
    var mean_square_vector = ${D0("f32",m)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${xl(E,m,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Pa("mean_vector",m)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Pa("mean_square_vector",m)} / uniforms.norm_size ${n?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${xl(E,m,"x[j + offset]")};
      let f32scale = ${xl(E,m,"scale[j]")};
      output[j + offset] = ${T[0].type.value}((f32input ${n?"":"- mean"}) * inv_std_dev * f32scale
        ${a?`+ ${xl(E,m,"bias[j]")}`:""}
      );
    }

    ${g?"mean_data_output[global_idx] = mean":""};
    ${_?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},w=[{dims:o,dataType:e[0].dataType}];return g&&w.push({dims:p,dataType:1}),_&&w.push({dims:p,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${m};${r};${n}`,inputDependencies:y},getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(c/64)},programUniforms:P}),getShaderSource:b}},CD=(e,t)=>{pS(e.inputs),e.compute(mS(e.inputs,t,e.outputCount))}}),gS,$D,a8=Je(()=>{Lt(),Cw(),$w(),gS=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},$D=e=>{gS(e.inputs);let t=Bl.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can't use matmul on the given tensors");let r=t[t.length-1],n=e.inputs[0].dims[e.inputs[0].dims.length-1];if(r<8&&n<8)e.compute(Sw(e.inputs,{activation:""},t));else{let s=t[t.length-2],i=Ae.size(e.inputs[0].dims.slice(0,-2)),a=Ae.size(e.inputs[1].dims.slice(0,-2));if(i!==1&&s===1&&a===1){let o=e.inputs[0].reshape([1,i,n]),l=e.inputs[1].reshape([1,n,r]),c=[1,i,r],d=[o,l];e.compute(Cf(d,{activation:""},t,c),{inputs:d})}else e.compute(Cf(e.inputs,{activation:""},t))}}}),_S,yS,wS,ID,AD,o8=Je(()=>{Ct(),Lt(),Vr(),Rt(),_S=(e,t)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let r=e[0],n=r.dims.length;if(r.dims[n-1]!==t.k)throw new Error("The last dim of input shape does not match the k value");let s=Math.floor((t.k+t.blockSize-1)/t.blockSize),i=t.blockSize/8*t.bits,a=e[1];if(!Ae.areEqual(a.dims,[t.n,s,i]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let o=e[2].dims;if(Ae.size(o)!==t.n*s)throw new Error("scales input size error.");if(e.length===4){let l=e[3].dims,c=t.bits>4?t.n*s:t.n*Math.floor((s+1)/2);if(Ae.size(l)!==c)throw new Error("zeroPoints input size error.")}},yS=(e,t)=>{let r=e[0].dims,n=r.length,s=r[n-2],i=t.k,a=t.n,o=r.slice(0,n-2),l=Ae.size(o),c=e[1].dims[2]/4,d=e[0].dataType,h=Or(t.k),u=Or(c),p=Or(a),m=o.concat([s,a]),y=s>1&&a/p%2===0?2:1,P=Ae.size(m)/p/y,g=64,_=[],b=[l,s,i/h],w=Ae.convertShape(e[1].dims).slice();w.splice(-1,1,c/u),_.push(..._t(b)),_.push(..._t(w)),_.push(..._t(e[2].dims)),e.length===4&&_.push(..._t(Ae.convertShape(e[3].dims)));let M=[l,s,a/p];_.push(..._t(M));let E=T=>{let S=b.length,A=Fe("a",e[0].dataType,S,h),j=Fe("b",12,w.length,u),U=Fe("scales",e[2].dataType,e[2].dims.length),W=[A,j,U],B=e.length===4?Fe("zero_points",12,e[3].dims.length):void 0;B&&W.push(B);let ee=M.length,Q=ht("output",e[0].dataType,ee,p),Z=_n(e[0].dataType),J=(()=>{switch(h){case 1:return`array<${Z}, 8>`;case 2:return`mat4x2<${Z}>`;case 4:return`mat2x4<${Z}>`;default:throw new Error(`${h}-component is not supported.`)}})(),X=()=>{let ne=`
          // reuse a data
            var input_offset = ${A.indicesToOffset(`${A.type.indices}(batch, row, word_offset)`)};
            var a_data: ${J};
            for (var j: u32 = 0; j < ${8/h}; j++) {
              a_data[j] = ${A.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let L=0;L<p*y;L++)ne+=`
            b_value = ${u===1?`b${L}_data`:`b${L}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${J}(${Array.from({length:4},(F,G)=>`${Z}(b_value_lower[${G}]), ${Z}(b_value_upper[${G}])`).join(", ")});
            b_dequantized_values = ${h===1?`${J}(${Array.from({length:8},(F,G)=>`(b_quantized_values[${G}] - ${B?`zero_point${L}`:"zero_point"}) * scale${L}`).join(", ")});`:`(b_quantized_values - ${J}(${Array(8).fill(`${B?`zero_point${L}`:"zero_point"}`).join(",")})) * scale${L};`};
            workgroup_shared[local_id.x * ${y} + ${Math.floor(L/p)}]${p>1?`[${L%p}]`:""} += ${Array.from({length:8/h},(F,G)=>`${h===1?`a_data[${G}] * b_dequantized_values[${G}]`:`dot(a_data[${G}], b_dequantized_values[${G}])`}`).join(" + ")};
          `;return ne},ae=()=>{let ne=`
            var col_index = col * ${p};
            ${B?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Z}(8);`}
            `;for(let L=0;L<p*y;L++)ne+=`
            let scale${L} = ${U.getByOffset("col_index * nBlocksPerCol + block")};
            ${B?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${B.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${L} = ${Z}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return ne},le=()=>{let ne=`col_index = col * ${p};`;for(let L=0;L<p*y;L++)ne+=`
            let b${L}_data = ${j.getByIndices(`${j.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return ne+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${J};
            var b_dequantized_values: ${J};`,ne};return`
        var<workgroup> workgroup_shared: array<${Q.type.value}, ${y*g}>;
        ${T.declareVariables(...W,Q)}
        ${T.mainStart([g,1,1])}
          let output_indices = ${Q.offsetToIndices(`(global_idx / ${g}) * ${y}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${g}) {
            //process one block
            var word_offset: u32 = block * ${t.blockSize/h};
            ${ae()}
            for (var word: u32 = 0; word < ${c}; word += ${u}) {
              ${le()}
              for (var i: u32 = 0; i < ${u}; i++) {
                ${X()}
                word_offset += ${8/h};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${y}) {
            var output_value: ${Q.type.value} = ${Q.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${g}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${y};
            }
            ${Q.setByIndices(`${Q.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${t.blockSize};${t.bits};${h};${u};${p};${y};${g}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:m,dataType:d}],dispatchGroup:{x:P},programUniforms:_}),getShaderSource:E}},wS=(e,t)=>{let r=e[0].dims,n=r.length,s=r[n-2],i=t.k,a=t.n,o=r.slice(0,n-2),l=Ae.size(o),c=e[1].dims[2]/4,d=e[0].dataType,h=Or(t.k),u=Or(c),p=o.concat([s,a]),m=128,y=a%8===0?8:a%4===0?4:1,P=m/y,g=P*u*8,_=g/h,b=g/t.blockSize,w=Ae.size(p)/y,M=[],E=[l,s,i/h],T=Ae.convertShape(e[1].dims).slice();T.splice(-1,1,c/u),M.push(..._t(E)),M.push(..._t(T)),M.push(..._t(e[2].dims)),e.length===4&&M.push(..._t(Ae.convertShape(e[3].dims)));let S=[l,s,a];M.push(..._t(S));let A=j=>{let U=E.length,W=Fe("a",e[0].dataType,U,h),B=Fe("b",12,T.length,u),ee=Fe("scales",e[2].dataType,e[2].dims.length),Q=[W,B,ee],Z=e.length===4?Fe("zero_points",12,e[3].dims.length):void 0;Z&&Q.push(Z);let J=S.length,X=ht("output",e[0].dataType,J),ae=_n(e[0].dataType),le=()=>{switch(h){case 1:return`
          let a_data0 = vec4<${ae}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${ae}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${ae}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${ae}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${h}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${W.type.value}, ${_}>;
        var<workgroup> inter_results: array<array<${X.type.value}, ${P}>, ${y}>;
        ${j.declareVariables(...Q,X)}
        ${j.mainStart([P,y,1])}
          let output_indices = ${X.offsetToIndices(`workgroup_index * ${y}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${b} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${_};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${_}; a_offset += ${m})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${W.getByIndices(`${W.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${W.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${b} + local_id.x;
            ${Z?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Z.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${ae}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ae}(8);`}
            let scale = ${ee.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${B.getByIndices(`${B.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${t.blockSize/h};
            for (var i: u32 = 0; i < ${u}; i++) {
              ${le()}
              let b_value = ${u===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${ae}>(${Array.from({length:4},(ne,L)=>`${ae}(b_value_lower[${L}]), ${ae}(b_value_upper[${L}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${ae}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(ne,L)=>`${`dot(a_data${L}, b_dequantized_values[${L}])`}`).join(" + ")};
              word_offset += ${8/h};
            }
            workgroupBarrier();
          }

          if (local_idx < ${y}) {
            var output_value: ${X.type.value} = ${X.type.value}(0);
            for (var b = 0u; b < ${P}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${X.setByIndices(`${X.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${t.blockSize};${h};${u};${P};${y}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:p,dataType:d}],dispatchGroup:{x:w},programUniforms:M}),getShaderSource:A}},ID=(e,t)=>{_S(e.inputs,t),t.blockSize===32&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(wS(e.inputs,t)):e.compute(yS(e.inputs,t))},AD=e=>nr(e)}),vS,xS,bS,MS,TS,ES,PS,kS,jD,l8=Je(()=>{Ct(),Lt(),Rt(),vS=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1&&e[0].dataType!==10)throw new Error("Input type must be float or float16.");if(e.length>=2){let t=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(t=e[3].dims[0]*2===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},xS=(e,t,r)=>{let n="";for(let s=t-1;s>=0;--s)n+=`
            k = i32(${e.indicesGet("indices",s)}) - ${mt("uniforms.pads",s,r)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${mt("uniforms.x_shape",s,t)})) {
              break;
            }
            offset += k * i32(${mt("uniforms.x_strides",s,t)});
        `;return`
          value = ${e.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${n}
            value = x[offset];
          }
      `},bS=(e,t,r)=>{let n="";for(let s=t-1;s>=0;--s)n+=`
                k = i32(${e.indicesGet("indices",s)}) - ${mt("uniforms.pads",s,r)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${mt("uniforms.x_shape",s,t)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${mt("uniforms.x_shape",s,t)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${mt("uniforms.x_strides",s,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},MS=(e,t,r)=>{let n="";for(let s=t-1;s>=0;--s)n+=`
                k = i32(${e.indicesGet("indices",s)}) - ${mt("uniforms.pads",s,r)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${mt("uniforms.x_shape",s,t)})) {
                  k = i32(${mt("uniforms.x_shape",s,t)}) - 1;
                }
                offset += k * i32(${mt("uniforms.x_strides",s,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},TS=(e,t,r)=>{let n="";for(let s=t-1;s>=0;--s)n+=`
                k = i32(${e.indicesGet("indices",s)}) - ${mt("uniforms.pads",s,r)};
                if (k < 0)  {
                  k += i32(${mt("uniforms.x_shape",s,t)}]);
                }
                if (k >= i32(${mt("uniforms.x_shape",s,t)})) {
                  k -= i32(${mt("uniforms.x_shape",s,t)});
                }
                offset += k * i32(${mt("uniforms.x_strides",s,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},ES=(e,t,r)=>{switch(r.mode){case 0:return xS(e,t,r.pads.length);case 1:return bS(e,t,r.pads.length);case 2:return MS(e,t,r.pads.length);case 3:return TS(e,t,r.pads.length);default:throw new Error("Invalid mode")}},PS=(e,t)=>{let r=Ae.padShape(e[0].dims.slice(),t.pads),n=e[0].dims,s=Ae.size(r),i=[{type:12,data:s},{type:6,data:t.pads}],a=e.length>=3&&e[2].data;t.mode===0&&i.push({type:a?e[2].dataType:1,data:t.value}),i.push(..._t(e[0].dims,r));let o=["rank"],l=c=>{let d=ht("output",e[0].dataType,r.length),h=Fe("x",e[0].dataType,n.length),u=h.type.value,p=ES(d,n.length,t),m=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return t.mode===0&&m.push({name:"constant_value",type:a?u:"f32"}),`
            ${c.registerUniforms(m).declareVariables(h,d)}
            ${c.mainStart()}
            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${d.offsetToIndices("global_idx")};

            var value = ${u}(0);
            ${p}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${t.mode}${a}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Ae.size(r)/64)},programUniforms:i}),getShaderSource:l}},kS=(e,t)=>{if(e.length>1){let r=e[1].getBigInt64Array(),n=e.length>=3&&e[2].data?e[2].dataType===10?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,s=e[0].dims.length,i=new Int32Array(2*s).fill(0);if(e.length>=4){let o=e[3].getBigInt64Array();for(let l=0;l<o.length;l++)i[Number(o[l])]=Number(r[l]),i[Number(o[l])+s]=Number(r[l+o.length])}else r.forEach((o,l)=>i[Number(l)]=Number(o));let a=[];return i.forEach(o=>a.push(o)),{mode:t.mode,value:n,pads:a}}else return t},jD=(e,t)=>{vS(e.inputs);let r=kS(e.inputs,t);e.compute(PS(e.inputs,r),{inputs:[0]})}}),Fc,Qg,Xg,Jg,Yg,SS,CS,Zg,e_,OD,ND,t_,DD,FD,r_,LD,RD,zD,BD,c8=Je(()=>{fi(),Ct(),Lt(),Rt(),Fc=e=>{if(_r.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},Qg=(e,t,r)=>{let n=t.format==="NHWC",s=e.dims.slice();n&&s.splice(1,0,s.pop());let i=Object.hasOwnProperty.call(t,"dilations"),a=t.kernelShape.slice(),o=t.strides.slice(),l=i?t.dilations.slice():[],c=t.pads.slice();kf.adjustPoolAttributes(r,s,a,o,l,c);let d=kf.computePoolOutputShape(r,s,o,l,a,c,t.autoPad),h=Object.assign({},t);i?Object.assign(h,{kernelShape:a,strides:o,pads:c,dilations:l,cacheKey:t.cacheKey}):Object.assign(h,{kernelShape:a,strides:o,pads:c,cacheKey:t.cacheKey});let u=d.slice();return u.push(u.splice(1,1)[0]),[h,n?u:d]},Xg=(e,t)=>{let r=t.format==="NHWC",n=Ae.size(e),s=Ae.size(t.kernelShape),i=[{type:12,data:n},{type:12,data:s}],a=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let o=t.kernelShape[t.kernelShape.length-1],l=t.strides[t.strides.length-1],c=t.pads[t.pads.length/2-1],d=t.pads[t.pads.length-1],h=!!(c+d);i.push({type:12,data:o},{type:12,data:l},{type:12,data:c},{type:12,data:d}),a.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let u=!1;if(t.kernelShape.length===2){let p=t.kernelShape[t.kernelShape.length-2],m=t.strides[t.strides.length-2],y=t.pads[t.pads.length/2-2],P=t.pads[t.pads.length-2];u=!!(y+P),i.push({type:12,data:p},{type:12,data:m},{type:12,data:y},{type:12,data:P}),a.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[i,a,!0,h,u]}else{if(r)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let o=Ae.computeStrides(t.kernelShape);i.push({type:12,data:o},{type:12,data:t.pads},{type:12,data:t.strides}),a.push({name:"kernelStrides",type:"u32",length:o.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let l=t.pads.reduce((c,d)=>c+d);return[i,a,!!l,!1,!1]}},Jg=(e,t,r,n,s,i,a,o,l,c,d,h)=>{let u=s.format==="NHWC",p=t.type.value,m=ht("output",t.type.tensor,n);if(s.kernelShape.length<=2){let y="",P="",g="",_=r-(u?2:1);if(d?y=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_}] = indices[${_}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${_}] < 0 || xIndices[${_}]
                      >= uniforms.x_shape[${_}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${i}
                }`:y=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_}] = indices[${_}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${i}
                }`,s.kernelShape.length===2){let b=r-(u?3:2);h?P=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${b}] = indices[${b}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${b}] < 0 || xIndices[${b}] >= uniforms.x_shape[${b}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:P=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${b}] = indices[${b}] * uniforms.sh - uniforms.phStart + j;
                `,g=`
              }
            `}return`
            ${e.registerUniforms(l).declareVariables(t,m)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${m.offsetToIndices("global_idx")};
              var xIndices = ${m.offsetToIndices("global_idx")};

              var value = ${p}(${o});
              var pad = 0;
              ${P}
              ${y}
              ${g}
              ${a}

              output[global_idx] = value;
            }`}else{if(u)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let y=s.kernelShape.length,P=s.pads.length,g="";return c?g=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${t.indicesToOffset("xIndices")}];
                ${i}
              }`:g=`
              }
              let x_val = x[${t.indicesToOffset("xIndices")}];
              ${i}
            `,`
            ${e.registerUniforms(l).declareVariables(t,m)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${m.offsetToIndices("global_idx")};
              var xIndices = ${m.offsetToIndices("global_idx")};

              var offsets: array<u32, ${y}>;

              var value = ${p}(${o});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${y-1}u; j++) {
                  offsets[j] = offset / ${mt("uniforms.kernelStrides","j",y)};
                  offset -= offsets[j] * ${mt("uniforms.kernelStrides","j",y)};
                }
                offsets[${y-1}] = offset;

                isPad = false;
                for (var j = ${r-y}u; j < ${r}u; j++) {
                  xIndices[j] = indices[j] * ${mt("uniforms.strides",`j - ${r-y}u`,y)}
                    + offsets[j - ${r-y}u] - ${mt("uniforms.pads","j - 2u",P)};
                  ${g}
              }
              ${a}

              output[global_idx] = value;
            }`}},Yg=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,SS=e=>`${Yg(e)};${e.countIncludePad}`,CS=e=>`${Yg(e)};${e.storageOrder};${e.dilations}`,Zg=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),e_=(e,t,r,n)=>{let[s,i]=Qg(t,n,r),a=Fe("x",t.dataType,t.dims.length),o=a.type.value,l="value += x_val;",c="";s.countIncludePad?c+=`value /= ${o}(uniforms.kernelSize);`:c+=`value /= ${o}(i32(uniforms.kernelSize) - pad);`;let[d,h,u,p,m]=Xg(i,s);d.push(..._t(t.dims,i));let y=["rank"];return{name:e,shaderCache:{hint:`${n.cacheKey};${u};${p};${m}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:i,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Ae.size(i)/64)},programUniforms:d}),getShaderSource:P=>Jg(P,a,t.dims.length,i.length,s,l,c,0,h,u,p,m)}},OD=e=>{let t=e.count_include_pad!==0,r=Zg(e);if(r.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let n={countIncludePad:t,...r,cacheKey:""};return{...n,cacheKey:SS(n)}},ND=(e,t)=>{Fc(e.inputs),e.compute(e_("AveragePool",e.inputs[0],!1,t))},t_={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},DD=e=>{let t=e.format;return{format:t,...t_,cacheKey:t}},FD=(e,t)=>{Fc(e.inputs),e.compute(e_("GlobalAveragePool",e.inputs[0],!0,t))},r_=(e,t,r,n)=>{let[s,i]=Qg(t,n,r),a=`
      value = max(x_val, value);
    `,o="",l=Fe("x",t.dataType,t.dims.length),c=["rank"],[d,h,u,p,m]=Xg(i,s);return d.push(..._t(t.dims,i)),{name:e,shaderCache:{hint:`${n.cacheKey};${u};${p};${m}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:i,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Ae.size(i)/64)},programUniforms:d}),getShaderSource:y=>Jg(y,l,t.dims.length,i.length,s,a,o,t.dataType===10?-65504:-1e5,h,u,p,m)}},LD=(e,t)=>{Fc(e.inputs),e.compute(r_("MaxPool",e.inputs[0],!1,t))},RD=e=>{let t=e.storage_order,r=e.dilations,n=Zg(e);if(t!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let s={storageOrder:t,dilations:r,...n,cacheKey:""};return{...s,cacheKey:CS(s)}},zD=e=>{let t=e.format;return{format:t,...t_,cacheKey:t}},BD=(e,t)=>{Fc(e.inputs),e.compute(r_("GlobalMaxPool",e.inputs[0],!0,t))}}),$S,IS,UD,VD,u8=Je(()=>{Ct(),Lt(),Vr(),Rt(),$S=(e,t)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(e.length===3&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[0].dataType===6&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(e[1].dims.length!==0&&e[1].dims.length!==1&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((r,n)=>r===e[2].dims[n]).reduce((r,n)=>r&&n,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(t.blockSize>0){if(e[1].dims.length===0||e[1].dims.length===1&&e[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((s,i)=>i===t.axis||s===e[0].dims[i]).reduce((s,i)=>s&&i,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let r=e[0].dims[t.axis],n=e[1].dims[t.axis];if(t.blockSize<Math.ceil(r/n)||t.blockSize>Math.ceil(r/(n-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},IS=(e,t)=>{let r=Ae.normalizeAxis(t.axis,e[0].dims.length),n=e[0].dataType,s=n===3,i=e[0].dims,a=e[1].dataType,o=Ae.size(i),l=n===3||n===2,c=l?[Math.ceil(Ae.size(e[0].dims)/4)]:e[0].dims,d=e[1].dims,h=e.length>2?e[2]:void 0,u=h?l?[Math.ceil(Ae.size(h.dims)/4)]:h.dims:void 0,p=d.length===0||d.length===1&&d[0]===1,m=p===!1&&d.length===1,y=Or(o),P=p&&(!l||y===4),g=P?y:1,_=P&&!l?y:1,b=Fe("input",l?12:n,c.length,_),w=Fe("scale",a,d.length),M=h?Fe("zero_point",l?12:n,u.length):void 0,E=ht("output",a,i.length,g),T=[b,w];M&&T.push(M);let S=[c,d];h&&S.push(u);let A=[{type:12,data:o/g},{type:12,data:r},{type:12,data:t.blockSize},..._t(...S,i)],j=U=>{let W=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${U.registerUniforms(W).declareVariables(...T,E)}
      ${U.mainStart()}
          ${U.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${E.offsetToIndices("global_idx")};

          // Set input x
          ${l?`
            let input = ${b.getByOffset("global_idx / 4")};
            let x_vec = ${s?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${g===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${b.getByOffset("global_idx")};`};

          // Set scale input
          ${p?`let scale_value= ${w.getByOffset("0")}`:m?`
            let scale_index = ${E.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${w.getByOffset("scale_index")};`:`
            var scale_indices: ${w.type.indices} = output_indices;
            let index = ${w.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${w.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${w.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${M?p?l?`
                let zero_point_input = ${M.getByOffset("0")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${M.getByOffset("0")}`:m?l?`
                let zero_point_index = ${E.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${M.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${E.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${M.getByOffset("zero_point_index")};`:l?`
                let zero_point_offset = ${w.indicesToOffset("scale_indices")};
                let zero_point_input = ${M.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${M.getByIndices("scale_indices")};`:`let zero_point_value = ${l?s?"i32":"u32":b.type.value}(0);`};
      // Compute and write output
      ${E.setByOffset("global_idx",`${E.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:t.cacheKey,inputDependencies:M?["rank","rank","rank"]:["rank","rank"]},getShaderSource:j,getRunData:()=>({outputs:[{dims:i,dataType:a}],dispatchGroup:{x:Math.ceil(o/g/64),y:1,z:1},programUniforms:A})}},UD=(e,t)=>{$S(e.inputs,t),e.compute(IS(e.inputs,t))},VD=e=>nr({axis:e.axis,blockSize:e.blockSize})}),AS,jS,WD,d8=Je(()=>{fi(),Ct(),Rt(),AS=(e,t,r)=>{let n=e===t,s=e<t&&r<0,i=e>t&&r>0;if(n||s||i)throw new Error("Range these inputs' contents are invalid.")},jS=(e,t,r,n)=>{let s=Math.abs(Math.ceil((t-e)/r)),i=[s],a=s,o=[{type:12,data:a},{type:n,data:e},{type:n,data:r},..._t(i)],l=c=>{let d=ht("output",n,i.length),h=d.type.value,u=[{name:"outputSize",type:"u32"},{name:"start",type:h},{name:"delta",type:h}];return`
        ${c.registerUniforms(u).declareVariables(d)}
        ${c.mainStart()}
        ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${h}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${n}`},getShaderSource:l,getRunData:()=>({outputs:[{dims:i,dataType:n}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:o})}},WD=e=>{let t=0,r=0,n=0;e.inputs[0].dataType===6?(t=e.inputs[0].getInt32Array()[0],r=e.inputs[1].getInt32Array()[0],n=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(t=e.inputs[0].getFloat32Array()[0],r=e.inputs[1].getFloat32Array()[0],n=e.inputs[2].getFloat32Array()[0]),_r.webgpu.validateInputContent&&AS(t,r,n),e.compute(jS(t,r,n,e.inputs[0].dataType),{inputs:[]})}}),OS,n_,s_,NS,GD,qD,h8=Je(()=>{Ct(),Lt(),Vr(),Rt(),OS=(e,t,r,n)=>{if(e!=="none"&&n!=="i32"&&n!=="u32"&&n!=="f32")throw new Error(`Input ${n} is not supported with reduction ${e}.`);let s=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,i=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${t}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(e){case"none":return`${t}=${r};`;case"add":return n==="i32"||n==="u32"?`atomicAdd(&${t}, bitcast<${n}>(${r}));`:`
              ${s}bitcast<${n}>(oldValue) + (${r})${i}`;case"max":return n==="i32"||n==="u32"?`atomicMax(&${t}, bitcast<${n}>(${r}));`:`
                ${s}max(bitcast<f32>(oldValue), (${r}))${i}`;case"min":return n==="i32"||n==="u32"?`atomicMin(&${t}, bitcast<${n}>(${r}));`:`${s}min(bitcast<${n}>(oldValue), (${r}))${i}`;case"mul":return`${s}(bitcast<${n}>(oldValue) * (${r}))${i}`;default:throw new Error(`Reduction ${e} is not supported.`)}},n_=(e,t)=>`${e===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[${t?"i - indices_start":"i"}];
    let dim_value = uniforms.output_shape[${t?"i - indices_start":"i"} + uniforms.last_index_dimension];`}
    
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));`,s_=(e,t,r)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {
        let value = updates[uniforms.num_updates_elements * ${r?"global_idx":"idx"} + i];
        ${OS(e.reduction,"output[data_offset + i]","value",t)}
      }`,NS=(e,t)=>{let r=e[0].dims,n=e[1].dims,s=r,i=1,a=Math.ceil(Ae.size(n)/i),o=n[n.length-1],l=Ae.sizeFromDimension(r,o),c=Ae.sizeFromDimension(n,0)/o,d=[{type:12,data:a},{type:12,data:o},{type:12,data:l},..._t(e[1].dims,e[2].dims,s)],h=u=>{let p=Fe("indices",e[1].dataType,e[1].dims.length),m=Fe("updates",e[2].dataType,e[2].dims.length,i),y=t.reduction!=="none"&&t.reduction!==""?vO("output",e[0].dataType,s.length):ht("output",e[0].dataType,s.length,i);return`
      ${u.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(p,m,y)}
      ${u.mainStart()}
        ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${t.reduction==="none"}) {
    for (var i = 0; i < ${c}; i = i + 1) {
      for (var j = i + 1; j < ${c}; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  if (${t.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    // Process each index-update pair individually when duplicates exist
    for (var idx = 0u; idx < ${c}u; idx++) {
      var data_offset = 0u;
      for (var i = 0u; i < uniforms.last_index_dimension; i++) {
        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);
        ${n_(r.length,!1)}
      }
      ${s_(t,y.type.value,!1)}
    }
    return;
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  var indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${n_(r.length,!0)}
  }
  ${s_(t,y.type.value,!0)}
  }`};return{name:"ScatterND",shaderCache:{hint:`${t.cacheKey}_${t.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:d}),getShaderSource:h}},GD=e=>nr({reduction:e.reduction}),qD=(e,t)=>{e.compute(NS(e.inputs,t),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),DS,FS,LS,i_,RS,zS,BS,US,VS,WS,GS,qS,a_,KS,HS,QS,XS,JS,KD,HD,f8=Je(()=>{Ct(),Lt(),Vr(),Rt(),DS=(e,t)=>{if(e.every(r=>r>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(t.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(t.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},FS=(e,t,r)=>{t.every(s=>s>=0&&s<r||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let n=new Array(r).fill(1);return t.forEach((s,i)=>n[s]=e[i]),n},LS=(e,t,r,n,s,i)=>{let[a,o,l]=r>10?[1,2,3]:[-1,e.length>1?1:-1,-1],c=e[0].dims.length;if(a>0&&e.length>a&&e[a].dims.length>0)e[a].getFloat32Array().forEach(d=>i.push(d));else if(t.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(o>0&&e.length>o&&e[o].dims.length===1&&e[o].dims[0]>0){if(e[o].getFloat32Array().forEach(d=>n.push(d)),n.length!==0&&n.length!==c&&r>=18&&n.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");DS(n,t),t.axes.length>0&&FS(n,t.axes,c).forEach((d,h)=>n[h]=d)}if(l>0&&e.length>l&&e[l].dims.length===1&&e[l].dims[0]>0&&(e[l].getBigInt64Array().forEach(d=>s.push(Number(d))),s.length!==0&&s.length!==c&&r>=18&&s.length!==t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(n.length!==0&&n.length!==t.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(s.length!==0&&s.length!==t.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof n<"u"&&typeof s<"u"&&n.length>0&&s.length>c)throw new Error("Resize requires only of scales or sizes to be specified")},i_=(e,t,r,n)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${e}) * (${t});
  let whole = ${n}(big / (${r}));
  let fract = ${n}(big % (${r})) / ${n}(${r});
  return whole + fract;
`,RS=(e,t)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${t} { `+(()=>{switch(e){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${t}(xResized) / ${t}(xScale);
          } else {
            ${i_("xResized","lengthOriginal","lengthResized",t)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${t}(xResized) + 0.5) / ${t}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${t}(xResized) + 0.5) / ${t}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${i_("xResized","lengthOriginal - 1","lengthResized - 1",t)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${t}(roiStart) * ${t}(lengthOriginal - 1) +
                        (${t}(xResized) * ${t}(roiEnd - roiStart) * ${t}(lengthOriginal - 1)) /
                        ${t}(lengthResized - 1);
                  } else {
                    return 0.5 * ${t}(roiStart + roiEnd) * ${t}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${t}xScale * ${t}(lengthResized);
                  const adjustment = ${t}(lengthResized) / outputWidth;
                  const center = ${t}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;case"half_pixel":return`return ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",zS=(e,t,r)=>`fn getNearestPixelFromOriginal(xOriginal: ${r}, isDownSample: bool) -> ${r} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",BS=(e,t,r)=>{let n=new Array(r).fill(0).concat(new Array(r).fill(1)),s=e.length===0?n:e.slice();return t.length>0?(t.forEach((i,a)=>{n[i]=s[a],n[a+r]=s[t.length+a]}),n):s},US=(e,t,r,n)=>{let s=[];if(r.length>0)if(n.length>0){if(e.forEach(i=>s.push(i)),Math.max(...n)>e.length)throw new Error("axes is out of bound");n.forEach((i,a)=>s[i]=r[a])}else r.forEach(i=>s.push(i));else{if(t.length===0)throw new Error("Resize requires either scales or sizes.");s=e.map((i,a)=>Math.round(i*t[a]))}return s},VS=(e,t,r)=>{let n=(()=>{switch(r.keepAspectRatioPolicy){case"not_larger":return r.axes.length>0?Math.min(...r.axes.map(i=>t[i]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return r.axes.length>0?Math.max(...r.axes.map(i=>t[i]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${r.keepAspectRatioPolicy} is not supported`)}})();t.fill(1,0,t.length);let s=e.slice();return r.axes.length>0?(r.axes.forEach(i=>t[i]=n),r.axes.forEach(i=>s[i]=Math.round(e[i]*t[i]))):(t.fill(n,0,t.length),s.forEach((i,a)=>s[a]=Math.round(i*t[a]))),s},WS=(e,t,r,n,s)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${r.length}> {
      var original_indices: array<${e.type.value}, ${r.length}>;
      for (var i:u32 = 0; i < ${r.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var scale = ${mt("uniforms.scales","i",n)};
        var roi_low = ${mt("uniforms.roi","i",s)};
        var roi_hi = ${mt("uniforms.roi",`i + ${t.length}`,s)};
        if (scale == 1.0) {
          original_indices[i] = ${e.type.value}(output_index);
        } else {
          var input_shape_i = ${mt("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${mt("uniforms.output_shape","i",r.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,GS=(e,t,r,n,s,i,a)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
      var input_indices: ${e.type.indices};
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${mt("uniforms.scales","i",s)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${mt("uniforms.roi","i",i)};
          var roi_hi = ${mt("uniforms.roi",`i + ${r.length}`,i)};
          var input_shape_i = ${mt("uniforms.input_shape","i",r.length)};
          var output_shape_i = ${mt("uniforms.output_shape","i",n.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${a} || (original_idx >= 0 && original_idx < ${t.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${t.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${e.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,qS=(e,t)=>`
    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var input_index = ${e.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${mt("uniforms.input_shape","i",t.length)}) {
          return false;
        }
      }
      return true;
    }`,a_=(e,t,r,n)=>e.rank>n?`
    ${e.indicesSet("input_indices",t,"channel")};
    ${e.indicesSet("input_indices",r,"batch")};
`:"",KS=(e,t,r,n,s)=>{let[i,a,o,l]=r.length===2?[-1,0,1,-1]:[0,2,3,1],c=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${c} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",a,`max(0, min(row, ${r[a]} - 1))`)};
      ${e.indicesSet("input_indices",o,`max(0, min(col, ${r[o]} - 1))`)};
      ${a_(e,l,i,2)}
      return ${e.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${t.type.indices}) -> ${c} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${c} = originalIndices[${a}];
      var col:${c} = originalIndices[${o}];
      ${n?`if (row < 0 || row > (${r[a]} - 1) || col < 0 || col > (${r[o]} - 1)) {
        return ${s};
      }`:""};
      row = max(0, min(row, ${r[a]} - 1));
      col = max(0, min(col, ${r[o]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${r.length>2?`u32(originalIndices[${l}])`:"0"};
      var batch: u32 =  ${r.length>2?`u32(originalIndices[${i}])`:"0"};
      var x11: ${c} = getInputValue(batch, channel, row1, col1);
      var x12: ${c} = getInputValue(batch, channel, row1, col2);
      var x21: ${c} = getInputValue(batch, channel, row2, col1);
      var x22: ${c} = getInputValue(batch, channel, row2, col2);
      var dx1: ${c} = abs(row - ${c}(row1));
      var dx2: ${c} = abs(${c}(row2) - row);
      var dy1: ${c} = abs(col - ${c}(col1));
      var dy2: ${c} = abs(${c}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},HS=(e,t,r,n,s,i,a,o,l,c)=>{let d=r.length===2,[h,u]=d?[0,1]:[2,3],p=e.type.value,m=y=>{let P=y===h?"row":"col";return`
      fn ${P}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${t.type.indices}) -> ${p} {
        var output_index = ${t.indicesGet("output_indices",y)};
        var originalIdx: ${p} = getOriginalCoordinateFromResizedCoordinate(output_index, ${s[y]},
        ${n[y]}, ${r[y]}, ${i[y]}, ${i[y]} + ${r.length});
        var fractOriginalIdx: ${p} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${o} && (originalIdx < 0 || originalIdx > (${r[y]} - 1))) {
          return ${l};
        }
        var data: array<${p}, 4> = array<${p}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${P}: ${p} = originalIdx + ${p}(i);
          if (${P} < 0 || ${P} >= ${r[y]}) {
            ${c?`coefs[i + 1] = 0.0;
                        continue;`:o?`return ${l};`:`${P} = max(0, min(${P}, ${r[y]} - 1));`};
          }
        var input_indices_copy: ${e.type.indices} = input_indices;
          ${e.indicesSet("input_indices_copy",y,`u32(${P})`)};
          data[i + 1] = ${y===h?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${m(h)};
    ${m(u)};
  fn getCubicInterpolationCoefs(s: ${p}) -> array<${p}, 4> {
    var absS = abs(s);
    var coeffs: array<${p}, 4> = array<${p}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${p} = 1.0 - absS;
    var twoMinusAbsS: ${p} = 2.0 - absS;
    var onePlusAbsS: ${p} = 1.0 + absS;
    coeffs[0] = ((${a} * onePlusAbsS - 5 * ${a}) * onePlusAbsS + 8 * ${a}) * onePlusAbsS - 4 * ${a};
    coeffs[1] = ((${a} + 2) * absS - (${a} + 3)) * absS * absS + 1;
    coeffs[2] = ((${a} + 2) * oneMinusAbsS - (${a} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${a} * twoMinusAbsS - 5 * ${a}) * twoMinusAbsS + 8 * ${a}) * twoMinusAbsS - 4 * ${a};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${p}, 4>, coefs: array<${p}, 4>) -> ${p} {
    var coefsSum: ${p} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${t.type.indices}) -> ${p} {
    var input_indices: ${e.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},QS=(e,t,r,n,s)=>{let[i,a,o,l,c]=r.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],d=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${d} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",a,`max(0, min(depth, ${r[a]} - 1))`)};
      ${e.indicesSet("input_indices",o,`max(0, min(height, ${r[o]} - 1))`)};
      ${e.indicesSet("input_indices",l,`max(0, min(width, ${r[l]} - 1))`)};
      ${a_(e,c,i,3)}
      return ${e.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${t.type.indices}) -> ${d} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${d} = originalIndices[${a}];
      var height:${d} = originalIndices[${o}];
      var width:${d} = originalIndices[${l}];
      ${n?`if (depth < 0 || depth > (${r[a]} - 1) || height < 0 || height > (${r[o]} - 1) || width < 0 || (width > ${r[l]} - 1)) {
      return ${s};
        }`:""};

    depth = max(0, min(depth, ${r[a]} - 1));
      height = max(0, min(height, ${r[o]} - 1));
      width = max(0, min(width, ${r[l]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${r.length>3?`u32(originalIndices[${c}])`:"0"};
      var batch: u32 =  ${r.length>3?`u32(originalIndices[${i}])`:"0"};

      var x111: ${d} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${d} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${d} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${d} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${d} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${d} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${d} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${d} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${d} = abs(depth - ${d}(depth1));
      var dx2: ${d} = abs(${d}(depth2) - depth);
      var dy1: ${d} = abs(height - ${d}(height1));
      var dy2: ${d} = abs(${d}(height2) - height);
      var dz1: ${d} = abs(width - ${d}(width1));
      var dz2: ${d} = abs(${d}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},XS=(e,t,r,n,s,i)=>{let a=e.dims,o=BS(i,t.axes,a.length),l=US(a,n,s,t.axes),c=n.slice();n.length===0&&(c=a.map((_,b)=>_===0?1:l[b]/_),t.keepAspectRatioPolicy!=="stretch"&&(l=VS(a,c,t)));let d=ht("output",e.dataType,l.length),h=Fe("input",e.dataType,a.length),u=Ae.size(l),p=a.length===l.length&&a.every((_,b)=>_===l[b]),m=t.coordinateTransformMode==="tf_crop_and_resize",y=t.extrapolationValue,P=h.type.value,g=_=>`
      ${p?"":`
      ${RS(t.coordinateTransformMode,P)};
      ${(()=>{switch(t.mode){case"nearest":return`
              ${qS(h,a)};
              ${zS(t.nearestMode,r,P)};
              ${GS(h,d,a,l,c.length,o.length,m)};
              `;case"linear":return`
              ${WS(d,a,l,c.length,o.length)};
              ${(()=>{if(a.length===2||a.length===4)return`${KS(h,d,a,m,y)}`;if(a.length===3||a.length===5)return`${QS(h,d,a,m,y)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(a.length===2||a.length===4)return`${HS(h,d,a,l,c,o,t.cubicCoeffA,m,t.extrapolationValue,t.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${_.registerUniform("output_size","u32").registerUniform("scales","f32",c.length).registerUniform("roi","f32",o.length).declareVariables(h,d)}
      ${_.mainStart()}
        ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${p?"output[global_idx] = input[global_idx];":`
        let output_indices = ${d.offsetToIndices("global_idx")};
        var input_indices: ${h.type.indices};
        ${(()=>{switch(t.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${h.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${t.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${a.length===2||a.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${t.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${t.cacheKey}|${r}|${c.length>0?t.mode==="cubic"?c:c.length:""}|${s.length>0?s:""}|${o.length>0?o:""}|${p}|${t.mode==="nearest"?a.length:a}`,inputDependencies:["rank"]},getShaderSource:g,getRunData:()=>({outputs:[{dims:l,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:[{type:12,data:u},{type:1,data:c},{type:1,data:o},..._t(a,l)]})}},JS=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},KD=(e,t)=>{let r=[],n=[],s=[],i=JS(e);if(t.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");LS(e.inputs,t,i,r,n,s),e.compute(XS(e.inputs[0],t,i,r,n,s),{inputs:[0]})},HD=e=>{let t=e.antialias,r=e.axes,n=e.coordinateTransformMode,s=e.cubicCoeffA,i=e.excludeOutside!==0,a=e.extrapolationValue,o=e.keepAspectRatioPolicy,l=e.mode,c=e.nearestMode===""?"simple":e.nearestMode;return nr({antialias:t,axes:r,coordinateTransformMode:n,cubicCoeffA:s,excludeOutside:i,extrapolationValue:a,keepAspectRatioPolicy:o,mode:l,nearestMode:c})}}),YS,ZS,QD,p8=Je(()=>{Ct(),Lt(),Rt(),YS=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],r=e[1],n=e[2];if(t.dataType!==r.dataType||t.dataType!==n.dataType)throw new Error("All inputs must have the same data type");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Input must be 2D or 3D");if(r.dims.length!==3&&r.dims.length!==2)throw new Error("Skip must be 2D or 3D");let s=t.dims[t.dims.length-1],i=t.dims[t.dims.length-2];if(r.dims[r.dims.length-1]!==s)throw new Error("Skip must have the same hidden size as input");if(r.dims[r.dims.length-2]!==i)throw new Error("Skip must have the same sequence length as input");if(n.dims.length!==1)throw new Error("Gamma must be 1D");if(n.dims[n.dims.length-1]!==s)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let a=e[3];if(a.dims.length!==1)throw new Error("Beta must be 1D");if(a.dims[a.dims.length-1]!==s)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let a=e[4];if(a.dims.length!==1)throw new Error("Bias must be 1D");if(a.dims[a.dims.length-1]!==s)throw new Error("Bias must have the same hidden size as input")}},ZS=(e,t,r,n)=>{let s=t.simplified,i=e[0].dims,a=Ae.size(i),o=i,l=a,c=i.slice(-1)[0],d=n?i.slice(0,-1).concat(1):[],h=!s&&e.length>3,u=e.length>4,p=n&&r>1,m=n&&r>2,y=r>3,P=64,g=Or(c),_=[{type:12,data:l},{type:12,data:g},{type:12,data:c},{type:1,data:t.epsilon}],b=M=>{let E=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],T=[Fe("x",e[0].dataType,e[0].dims,g),Fe("skip",e[1].dataType,e[1].dims,g),Fe("gamma",e[2].dataType,e[2].dims,g)];h&&T.push(Fe("beta",e[3].dataType,e[3].dims,g)),u&&T.push(Fe("bias",e[4].dataType,e[4].dims,g)),T.push(ht("output",e[0].dataType,o,g)),p&&T.push(ht("mean_output",1,d)),m&&T.push(ht("inv_std_output",1,d)),y&&T.push(ht("input_skip_bias_sum",e[0].dataType,o,g));let S=_n(e[0].dataType),A=_n(1,g);return`

      ${M.registerUniforms(E).declareVariables(...T)}
      var<workgroup> sum_shared : array<${A}, ${P}>;
      var<workgroup> sum_squared_shared : array<${A}, ${P}>;

      ${M.mainStart([P,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${P};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${P};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${P-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${u?"bias[offset1d + i]":S+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${y?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${xl(S,g,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${P};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Pa("sum",g)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Pa("square_sum",g)} / f32(uniforms.hidden_size) ${s?"":"- mean * mean"} + uniforms.epsilon);
        ${p?"mean_output[global_idx] = mean;":""}
        ${m?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${s?"":`- ${S}(mean)`}) *
            ${S}(inv_std_dev) * gamma[offset1d + i]
            ${h?"+ beta[offset1d + i]":""};
        }
      }`},w=[{dims:o,dataType:e[0].dataType}];return r>1&&w.push({dims:d,dataType:1}),r>2&&w.push({dims:d,dataType:1}),r>3&&w.push({dims:i,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${g};${p};${m};${y}`,inputDependencies:e.map((M,E)=>"type")},getShaderSource:b,getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(l/c)},programUniforms:_})}},QD=(e,t)=>{YS(e.inputs);let r=[0];e.outputCount>1&&r.push(-3),e.outputCount>2&&r.push(-3),e.outputCount>3&&r.push(3),e.compute(ZS(e.inputs,t,e.outputCount,!1),{outputs:r})}}),eC,Lc,tC,o_,rC,nC,XD,JD,m8=Je(()=>{Ct(),Lt(),Vr(),Rt(),eC=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(t.axes.length!==0){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((r,n)=>{if(e[n+1].dataType!==6&&e[n+1].dataType!==7)throw new Error(`Input ${n} must be an array of int32 or int64`)})},Lc=(e,t)=>{let r=[];if(e.length>t)if(e[t].dataType===7)e[t].getBigInt64Array().forEach(n=>r.push(Number(n)));else if(e[t].dataType===6)e[t].getInt32Array().forEach(n=>r.push(Number(n)));else throw new Error(`Input ${t} must be an array of int32 or int64`);return r},tC=(e,t)=>{if(e.length>1){let r=Lc(e,1),n=Lc(e,2),s=Lc(e,3);return s.length===0&&(s=[...Array(e[0].dims.length).keys()]),nr({starts:r,ends:n,axes:s})}else return t},o_=(e,t,r,n,s)=>{let i=e;return e<0&&(i+=r[n[t]]),s[t]<0?Math.max(0,Math.min(i,r[n[t]]-1)):Math.max(0,Math.min(i,r[n[t]]))},rC=(e,t,r)=>`fn calculateInputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
          var input_indices: ${e.type.indices};
          var carry = 0u;
          for (var i = ${r.length}; i >= 0; i--) {
            let input_shape_i = ${mt("uniforms.input_shape","i",r.length)};
            let steps_i = ${mt("uniforms.steps","i",r.length)};
            let signs_i = ${mt("uniforms.signs","i",r.length)};
            let starts_i = ${mt("uniforms.starts","i",r.length)};
            var output_index = ${t.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${e.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,nC=(e,t)=>{let r=e[0].dims,n=Ae.size(r),s=t.axes.length>0?Ae.normalizeAxes(t.axes,r.length):[...Array(r.length).keys()],i=Lc(e,4);i.forEach(g=>g!==0||(()=>{throw new Error("step cannot be 0")})),i.length===0&&(i=Array(s.length).fill(1));let a=t.starts.map((g,_)=>o_(g,_,r,s,i)),o=t.ends.map((g,_)=>o_(g,_,r,s,i));if(s.length!==a.length||s.length!==o.length)throw new Error("start, ends and axes should have the same number of elements");if(s.length!==r.length)for(let g=0;g<r.length;++g)s.includes(g)||(a.splice(g,0,0),o.splice(g,0,r[g]),i.splice(g,0,1));let l=i.map(g=>Math.sign(g));i.forEach((g,_,b)=>{if(g<0){let w=(o[_]-a[_])/g,M=a[_],E=M+w*i[_];a[_]=E,o[_]=M,b[_]=-g}});let c=r.slice(0);s.forEach((g,_)=>{c[g]=Math.ceil((o[g]-a[g])/i[g])});let d={dims:c,dataType:e[0].dataType},h=ht("output",e[0].dataType,c.length),u=Fe("input",e[0].dataType,e[0].dims.length),p=Ae.size(c),m=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:a.length},{name:"signs",type:"i32",length:l.length},{name:"steps",type:"u32",length:i.length}],y=[{type:12,data:p},{type:12,data:a},{type:6,data:l},{type:12,data:i},..._t(e[0].dims,c)],P=g=>`
      ${g.registerUniforms(m).declareVariables(u,h)}
        ${rC(u,h,r)}
        ${g.mainStart()}
          ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${h.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${h.setByOffset("global_idx",u.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${l.length}_${a.length}_${i.length}`,inputDependencies:["rank"]},getShaderSource:P,getRunData:()=>({outputs:[d],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:y})}},XD=(e,t)=>{eC(e.inputs,t);let r=tC(e.inputs,t);e.compute(nC(e.inputs,r),{inputs:[0]})},JD=e=>{let t=e.starts,r=e.ends,n=e.axes;return nr({starts:t,ends:r,axes:n})}}),sC,iC,YD,ZD,g8=Je(()=>{Ct(),Lt(),Vr(),Ia(),Rt(),sC=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},iC=(e,t)=>{let r=e.inputs[0],n=r.dims,s=Ae.size(n),i=n.length,a=Ae.normalizeAxis(t.axis,i),o=a<n.length-1,l,c=[];o?(c=Array.from({length:i},(T,S)=>S),c[a]=i-1,c[i-1]=a,l=e.compute(ys(r,c),{inputs:[r],outputs:[-1]})[0]):l=r;let d=l.dims,h=d[i-1],u=s/h,p=Or(h),m=h/p,y=64;u===1&&(y=256);let P=(T,S)=>S===4?`max(max(${T}.x, ${T}.y), max(${T}.z, ${T}.w))`:S===2?`max(${T}.x, ${T}.y)`:S===3?`max(max(${T}.x, ${T}.y), ${T}.z)`:T,g=Fe("x",l.dataType,l.dims,p),_=ht("result",l.dataType,l.dims,p),b=g.type.value,w=_n(l.dataType)==="f32"?`var threadMax = ${b}(-3.402823e+38f);`:`var threadMax = ${b}(-65504.0h);`,M=T=>`
      var<workgroup> rowMaxShared : ${b};
      var<workgroup> rowSumShared : ${b};
      var<workgroup> threadShared : array<${b}, ${y}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${b} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${b}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${T.registerUniform("packedCols","i32").declareVariables(g,_)}
      ${T.mainStart(y)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${y};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${w}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${b}(${P("threadShared[0]",p)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${b}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${b}(${Pa("threadShared[0]",p)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,E=e.compute({name:"Softmax",shaderCache:{hint:`${p};${y}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:d,dataType:l.dataType}],dispatchGroup:{x:u},programUniforms:[{type:6,data:m}]}),getShaderSource:M},{inputs:[l],outputs:[o?-1:0]})[0];o&&e.compute(ys(E,c),{inputs:[E]})},YD=(e,t)=>{sC(e.inputs),iC(e,t)},ZD=e=>nr({axis:e.axis})}),l_,aC,oC,lC,e3,_8=Je(()=>{Ct(),Lt(),Rt(),l_=e=>Array.from(e.getBigInt64Array(),Number),aC=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==10&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(l_(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},oC=(e,t)=>{let r=[];for(let n=0;n<e.length;++n)r.push(e[n]*t[n]);return r},lC=(e,t)=>{let r=e[0].dims,n=t??l_(e[1]),s=oC(r,n),i=Ae.size(s),a=e[0].dataType,o=Fe("input",a,r.length),l=ht("output",a,s.length),c=d=>`
      const inputShape = ${o.indices(...r)};
      ${d.registerUniform("output_size","u32").declareVariables(o,l)}
      ${d.mainStart()}
      ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${l.offsetToIndices("global_idx")};
      var input_indices: ${o.type.indices};
      for (var i = 0; i < ${r.length}; i++) {
        let input_dim_i = ${o.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${l.indicesGet("output_indices","i")}  % input_dim_i;

        ${o.indicesSet("input_indices","i","input_dim_value")}
      }
      ${l.setByOffset("global_idx",o.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:12,data:i},..._t(e[0].dims,s)]}),getShaderSource:c}},e3=e=>{aC(e.inputs),e.compute(lC(e.inputs),{inputs:[0]})}}),cC,uC,t3,y8=Je(()=>{Ct(),Lt(),Rt(),cC=(e,t,r,n,s)=>{let i=ht("output_data",s,r.length,4),a=Fe("a_data",t[1].dataType,t[1].dims.length,4),o=Fe("b_data",t[2].dataType,t[2].dims.length,4),l=Fe("c_data",t[0].dataType,t[0].dims.length,4),c,d=(h,u,p)=>`select(${u}, ${h}, ${p})`;if(!n)c=i.setByOffset("global_idx",d(a.getByOffset("global_idx"),o.getByOffset("global_idx"),l.getByOffset("global_idx")));else{let h=(u,p,m="")=>{let y=`a_data[index_a${p}][component_a${p}]`,P=`b_data[index_b${p}][component_b${p}]`,g=`bool(c_data[index_c${p}] & (0xffu << (component_c${p} * 8)))`;return`
            let output_indices${p} = ${i.offsetToIndices(`global_idx * 4u + ${p}u`)};
            let offset_a${p} = ${a.broadcastedIndicesToOffset(`output_indices${p}`,i)};
            let offset_b${p} = ${o.broadcastedIndicesToOffset(`output_indices${p}`,i)};
            let offset_c${p} = ${l.broadcastedIndicesToOffset(`output_indices${p}`,i)};
            let index_a${p} = offset_a${p} / 4u;
            let index_b${p} = offset_b${p} / 4u;
            let index_c${p} = offset_c${p} / 4u;
            let component_a${p} = offset_a${p} % 4u;
            let component_b${p} = offset_b${p} % 4u;
            let component_c${p} = offset_c${p} % 4u;
            ${u}[${p}] = ${m}(${d(y,P,g)});
          `};s===9?c=`
            var data = vec4<u32>(0);
            ${h("data",0,"u32")}
            ${h("data",1,"u32")}
            ${h("data",2,"u32")}
            ${h("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:c=`
            ${h("output_data[global_idx]",0)}
            ${h("output_data[global_idx]",1)}
            ${h("output_data[global_idx]",2)}
            ${h("output_data[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(l,a,o,i)}
        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${c}
      }`},uC=e=>{let t=e[1].dims,r=e[2].dims,n=e[0].dims,s=e[1].dataType,i=!(Ae.areEqual(t,r)&&Ae.areEqual(r,n)),a=t,o=Ae.size(t);if(i){let c=Bl.calcShape(Bl.calcShape(t,r,!1),n,!1);if(!c)throw new Error("Can't perform where op on the given tensors");a=c,o=Ae.size(a)}let l=Math.ceil(o/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:c=>cC(c,e,a,i,s),getRunData:()=>({outputs:[{dims:a,dataType:s}],dispatchGroup:{x:Math.ceil(o/64/4)},programUniforms:[{type:12,data:l},..._t(n,t,r,a)]})}},t3=e=>{e.compute(uC(e.inputs))}}),r3,w8=Je(()=>{jW(),Tw(),OW(),NW(),DW(),FW(),LW(),VW(),GW(),qW(),KW(),HW(),QW(),XW(),JW(),YW(),ZW(),e8(),t8(),r8(),n8(),s8(),i8(),a8(),o8(),xD(),l8(),c8(),u8(),d8(),h8(),Mw(),f8(),PD(),p8(),m8(),g8(),TD(),_8(),Ia(),Ew(),y8(),r3=new Map([["Abs",[QO]],["Acos",[XO]],["Acosh",[JO]],["Add",[IN]],["ArgMax",[GO,L0]],["ArgMin",[WO,L0]],["Asin",[YO]],["Asinh",[ZO]],["Atan",[eN]],["Atanh",[tN]],["Attention",[qO]],["AveragePool",[ND,OD]],["BatchNormalization",[KO]],["BiasAdd",[HO]],["BiasSplitGelu",[$N]],["Cast",[nN,rN]],["Ceil",[iN]],["Clip",[sN]],["Concat",[BN,UN]],["Conv",[W0,V0]],["ConvTranspose",[YN,JN]],["Cos",[aN]],["Cosh",[oN]],["CumSum",[ZN,eD]],["DepthToSpace",[tD,rD]],["DequantizeLinear",[UD,VD]],["Div",[AN]],["Einsum",[nD,sD]],["Elu",[lN,Hc]],["Equal",[jN]],["Erf",[cN]],["Exp",[uN]],["Expand",[iD]],["FastGelu",[aD]],["Floor",[dN]],["FusedConv",[W0,V0]],["Gather",[lD,oD]],["GatherElements",[pD,fD]],["GatherBlockQuantized",[dD,hD]],["GatherND",[cD,uD]],["Gelu",[hN]],["Gemm",[gD,mD]],["GlobalAveragePool",[FD,DD]],["GlobalMaxPool",[BD,zD]],["Greater",[FN]],["GreaterOrEqual",[RN]],["GridSample",[_D,yD]],["GroupQueryAttention",[kD]],["HardSigmoid",[vN,wN]],["InstanceNormalization",[SD]],["LayerNormalization",[CD]],["LeakyRelu",[fN,Hc]],["Less",[LN]],["LessOrEqual",[zN]],["Log",[SN]],["MatMul",[$D]],["MatMulNBits",[ID,AD]],["MaxPool",[LD,RD]],["Mul",[ON]],["MultiHeadAttention",[vD,wD]],["Neg",[mN]],["Not",[pN]],["Pad",[jD]],["Pow",[NN]],["QuickGelu",[CN,Hc]],["Range",[WD]],["Reciprocal",[gN]],["ReduceMin",[RO]],["ReduceMean",[OO]],["ReduceMax",[LO]],["ReduceSum",[BO]],["ReduceProd",[zO]],["ReduceL1",[NO]],["ReduceL2",[DO]],["ReduceLogSum",[VO]],["ReduceLogSumExp",[FO]],["ReduceSumSquare",[UO]],["Relu",[_N]],["Resize",[KD,HD]],["RotaryEmbedding",[ED]],["ScatterND",[qD,GD]],["Sigmoid",[yN]],["Sin",[xN]],["Sinh",[bN]],["Slice",[XD,JD]],["SkipLayerNormalization",[QD]],["Split",[bD,MD]],["Sqrt",[MN]],["Softmax",[YD,ZD]],["Sub",[DN]],["Tan",[TN]],["Tanh",[EN]],["ThresholdedRelu",[kN,Hc]],["Tile",[e3]],["Transpose",[bO,MO]],["Where",[t3]]])}),n3,v8=Je(()=>{fi(),Ki(),Rt(),n3=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,r,n,s){hi(e.programInfo.name);let i=this.backend.device,a=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let o=[];for(let c of t)o.push({binding:o.length,resource:{buffer:c.buffer}});for(let c of r)o.push({binding:o.length,resource:{buffer:c.buffer}});s&&o.push({binding:o.length,resource:s});let l=i.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:o,label:e.programInfo.name});if(this.backend.sessionStatus==="capturing"){let c={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:l,dispatchGroup:n};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(c)}a.setPipeline(e.computePipeline),a.setBindGroup(0,l),a.dispatchWorkgroups(...n),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Rs(e.programInfo.name)}dispose(){}build(e,t){hi(e.name);let r=this.backend.device,n=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(c=>{r.features.has(c.feature)&&n.push(`enable ${c.extension};`)});let s=xO(t,this.backend.device.limits),i=e.getShaderSource(s),a=`${n.join(`
`)}
${s.additionalImplementations}
${i}`,o=r.createShaderModule({code:a,label:e.name});Ht("verbose",()=>`[WebGPU] ${e.name} shader code: ${a}`);let l=r.createComputePipeline({compute:{module:o,entryPoint:"main"},layout:"auto",label:e.name});return Rs(e.name),{programInfo:e,computePipeline:l,uniformVariablesInfo:s.variablesInfo}}normalizeDispatchGroupSize(e){let t=typeof e=="number"?e:e.x,r=typeof e=="number"?1:e.y||1,n=typeof e=="number"?1:e.z||1,s=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(t<=s&&r<=s&&n<=s)return[t,r,n];let i=t*r*n,a=Math.ceil(Math.sqrt(i));if(a>s){if(a=Math.ceil(Math.cbrt(i)),a>s)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[a,a,a]}else return[a,a,1]}}}),s3={};Ql(s3,{WebGpuBackend:()=>i3});var dC,hC,fC,i3,x8=Je(()=>{fi(),Ct(),Ki(),gO(),IW(),w8(),v8(),dC=(e,t)=>{if(t.length!==e.length)throw new Error(`inputDependencies length ${t.length} is not equal to inputTensors length ${e.length}.`);let r=[];for(let n=0;n<e.length;++n){let s=e[n].dataType;switch(t[n]){case"none":{r.push("");break}case"type":{r.push(`${s}`);break}case"rank":{let i=e[n].dims.length;r.push(`${s};${i}`);break}case"dims":{let i=e[n].dims.join(",");r.push(`${s};${i}`);break}default:throw new Error(`unsupported input dependency: ${t[n]}`)}}return r.join("|")},hC=(e,t,r)=>{var s,i;let n=e.name;return(s=e.shaderCache)!=null&&s.hint&&(n+="["+e.shaderCache.hint+"]"),n+=":"+r+`:${dC(t,((i=e.shaderCache)==null?void 0:i.inputDependencies)??new Array(t.length).fill("dims"))}`,n},fC=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},i3=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}async initialize(e,t){this.env=e;let r=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:t.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:t.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:t.limits.maxStorageBufferBindingSize,maxBufferSize:t.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:t.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:t.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:t.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:t.limits.maxComputeWorkgroupSizeZ},requiredFeatures:r},s=i=>t.features.has(i)&&r.push(i)&&!0;s("chromium-experimental-timestamp-query-inside-passes")||s("timestamp-query"),s("shader-f16"),s("subgroups"),this.device=await t.requestDevice(n),this.adapterInfo=new fC(t.info||await t.requestAdapterInfo()),this.gpuDataManager=wO(this),this.programManager=new n3(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,ww(e.logLevel,!!e.debug),this.device.onuncapturederror=i=>{i.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${i.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),t={};this.queryType==="at-passes"&&(t.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=e.beginComputePass(t)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;hi(),this.endComputePass();let e;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),e=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&e.mapAsync(GPUMapMode.READ).then(()=>{var n;let t=new BigUint64Array(e.getMappedRange()),r=this.pendingQueries.get(e);for(let s=0;s<t.length/2;s++){let i=r[s],a=i.kernelId,o=this.kernels.get(a),l=o.kernelType,c=o.kernelName,d=i.programName,h=i.inputTensorViews,u=i.outputTensorViews,p=t[s*2],m=t[s*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=p);let y=Number(p-this.queryTimeBase),P=Number(m-this.queryTimeBase);if(!Number.isSafeInteger(y)||!Number.isSafeInteger(P))throw new RangeError("incorrect timestamp range");if((n=this.env.webgpu.profiling)!=null&&n.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:h.map(g=>({dims:g.dims,dataType:Fi(g.dataType)})),outputsMetadata:u.map(g=>({dims:g.dims,dataType:Fi(g.dataType)})),kernelId:a,kernelType:l,kernelName:c,programName:d,startTime:y,endTime:P});else{let g="";h.forEach((b,w)=>{g+=`input[${w}]: [${b.dims}] | ${Fi(b.dataType)}, `});let _="";u.forEach((b,w)=>{_+=`output[${w}]: [${b.dims}] | ${Fi(b.dataType)}, `}),console.log(`[profiling] kernel "${a}|${l}|${c}|${d}" ${g}${_}execution time: ${P-y} ns`)}Nu("GPU",`${d}::${p}::${m}`)}e.unmap(),this.pendingQueries.delete(e)}),Rs()}run(e,t,r,n,s,i){hi(e.name);let a=[];for(let _=0;_<t.length;++_){let b=t[_].data;if(b===0)continue;let w=this.gpuDataManager.get(b);if(!w)throw new Error(`no GPU data for input: ${b}`);a.push(w)}let{outputs:o,dispatchGroup:l,programUniforms:c}=e.getRunData(t),d=r.length===0?o.map((_,b)=>b):r;if(d.length!==o.length)throw new Error(`Output size ${d.length} must be equal to ${o.length}.`);let h=[],u=[];for(let _=0;_<o.length;++_){if(!Number.isInteger(d[_])||d[_]<-3||d[_]>=i)throw new Error(`Invalid output index: ${d[_]}`);if(d[_]===-3)continue;let b=d[_]===-1,w=d[_]===-2,M=b||w?s(o[_].dataType,o[_].dims):n(d[_],o[_].dataType,o[_].dims);if(h.push(M),M.data===0)continue;let E=this.gpuDataManager.get(M.data);if(!E)throw new Error(`no GPU data for output: ${M.data}`);if(b&&this.temporaryData.push(E),w){let T=this.kernelPersistentData.get(this.currentKernelId);T||(T=[],this.kernelPersistentData.set(this.currentKernelId,T)),T.push(E)}u.push(E)}if(a.length!==t.length||u.length!==h.length){if(u.length===0)return Rs(e.name),h;throw new Error(`Program ${e.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let p;if(c){let _=0,b=[];c.forEach(T=>{let S=typeof T.data=="number"?[T.data]:T.data;if(S.length===0)return;let A=T.type===10?2:4,j,U;T.type===10?(U=S.length>4?16:S.length>2?8:S.length*A,j=S.length>4?16:A*S.length):(U=S.length<=2?S.length*A:16,j=16),_=Math.ceil(_/U)*U,b.push(_);let W=T.type===10?8:4;_+=S.length>4?Math.ceil(S.length/W)*j:S.length*A});let w=16;_=Math.ceil(_/w)*w;let M=new ArrayBuffer(_);c.forEach((T,S)=>{let A=b[S],j=typeof T.data=="number"?[T.data]:T.data;if(T.type===6)new Int32Array(M,A,j.length).set(j);else if(T.type===12)new Uint32Array(M,A,j.length).set(j);else if(T.type===10)new Uint16Array(M,A,j.length).set(j);else if(T.type===1)new Float32Array(M,A,j.length).set(j);else throw new Error(`Unsupported uniform type: ${Fi(T.type)}`)});let E=this.gpuDataManager.create(_,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(E.buffer,0,M,0,_),this.gpuDataManager.release(E.id),p={offset:0,size:_,buffer:E.buffer}}let m=this.programManager.normalizeDispatchGroupSize(l),y=m[1]===1&&m[2]===1,P=hC(e,t,y),g=this.programManager.getArtifact(P);if(g||(g=this.programManager.build(e,m),this.programManager.setArtifact(P,g),Ht("info",()=>`[artifact] key: ${P}, programName: ${e.name}`)),c&&g.uniformVariablesInfo){if(c.length!==g.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${g.uniformVariablesInfo.length}, got ${c.length} in program "${g.programInfo.name}".`);for(let _=0;_<c.length;_++){let b=c[_],w=b.type,M=typeof b.data=="number"?1:b.data.length,[E,T]=g.uniformVariablesInfo[_];if(w!==E||M!==T)throw new Error(`Uniform variable ${_} mismatch: expect type ${E} with size ${T}, got type ${w} with size ${M} in program "${g.programInfo.name}".`)}}if(Ht("info",()=>`[ProgramManager] run "${e.name}" (key=${P}) with ${m[0]}x${m[1]}x${m[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let _={kernelId:this.currentKernelId,programName:g.programInfo.name,inputTensorViews:t,outputTensorViews:h};this.pendingKernels.push(_),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(_)}return this.programManager.run(g,a,u,m,p),Rs(e.name),h}upload(e,t){this.gpuDataManager.upload(e,t)}memcpy(e,t){this.gpuDataManager.memcpy(e,t)}async download(e,t){await this.gpuDataManager.download(e,t)}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,t,r,n){let s=r3.get(e);if(!s)throw new Error(`kernel not implemented: ${e}`);let i={kernelType:e,kernelName:n,kernelEntry:s[0],attributes:[s[1],r]};this.kernels.set(t,i)}releaseKernel(e){let t=this.kernelPersistentData.get(e);if(t){for(let r of t)this.gpuDataManager.release(r.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,t,r){let n=this.kernels.get(e);if(!n)throw new Error(`kernel not created: ${e}`);let s=n.kernelType,i=n.kernelName,a=n.kernelEntry,o=n.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${s}] ${i}" is not allowed to be called recursively`);this.currentKernelId=e,o[0]&&(o[1]=o[0](o[1]),o[0]=void 0),Ht("info",()=>`[WebGPU] Start to run kernel "[${s}] ${i}"...`);let l=this.env.debug;this.temporaryData=[];try{return l&&this.device.pushErrorScope("validation"),a(t,o[1]),0}catch(c){return r.push(Promise.resolve(`[WebGPU] Kernel "[${s}] ${i}" failed. ${c}`)),1}finally{l&&r.push(this.device.popErrorScope().then(c=>c?`GPU validation error for kernel "[${s}] ${i}": ${c.message}`:null));for(let c of this.temporaryData)this.gpuDataManager.release(c.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,t,r,n){let s=this.sessionExternalDataMapping.get(e);s||(s=new Map,this.sessionExternalDataMapping.set(e,s));let i=s.get(t),a=this.gpuDataManager.registerExternalBuffer(r,n,i);return s.set(t,[a,r]),a}unregisterBuffers(e){let t=this.sessionExternalDataMapping.get(e);t&&(t.forEach(r=>this.gpuDataManager.unregisterExternalBuffer(r[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let t=this.gpuDataManager.get(e);if(!t)throw new Error(`no GPU data for buffer: ${e}`);return t.buffer}createDownloader(e,t,r){return async()=>{let n=await N0(this,e,t);return vw(n.buffer,r)}}writeTimestamp(e){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){var e;this.queryType="none",(((e=this.env.webgpu.profiling)==null?void 0:e.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){Ht("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){Ht("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){Ht("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),t=this.capturedPendingKernels.get(this.currentSessionId),r=e.length;this.pendingKernels=[];for(let n=0;n<r;n++){let s=this.getComputePassEncoder(),i=e[n];this.writeTimestamp(this.pendingDispatchNumber*2),s.setPipeline(i.computePipeline),s.setBindGroup(0,i.bindGroup),s.dispatchWorkgroups(...i.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(t[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),a3={};Ql(a3,{init:()=>o3});var Th,pC,o3,b8=Je(()=>{Ct(),Ki(),Lt(),$W(),Th=class l3{constructor(t,r,n,s){this.module=t,this.dataType=r,this.data=n,this.dims=s}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let t=Ae.size(this.dims);return t===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let t=Ae.size(this.dims);return t===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let t=Ae.size(this.dims);return t===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let t=Ae.size(this.dims);return t===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,t)}reshape(t){if(Ae.size(t)!==Ae.size(this.dims))throw new Error("Invalid new shape");return new l3(this.module,this.dataType,this.data,t)}},pC=class{constructor(e,t,r){this.module=e,this.backend=t,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=t.adapterInfo;let n=e.PTR_SIZE,s=r/e.PTR_SIZE,i=n===4?"i32":"i64";this.opKernelContext=Number(e.getValue(n*s++,i));let a=Number(e.getValue(n*s++,i));this.outputCount=Number(e.getValue(n*s++,i)),this.customDataOffset=Number(e.getValue(n*s++,"*")),this.customDataSize=Number(e.getValue(n*s++,i));let o=[];for(let l=0;l<a;l++){let c=Number(e.getValue(n*s++,i)),d=Number(e.getValue(n*s++,"*")),h=Number(e.getValue(n*s++,i)),u=[];for(let p=0;p<h;p++)u.push(Number(e.getValue(n*s++,i)));o.push(new Th(e,c,d,u))}this.inputs=o}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,t){var a;let r=((a=t==null?void 0:t.inputs)==null?void 0:a.map(o=>typeof o=="number"?this.inputs[o]:o))??this.inputs,n=(t==null?void 0:t.outputs)??[],s=(o,l,c)=>new Th(this.module,l,this.output(o,c),c),i=(o,l)=>{let c=uo(o,l);if(!c)throw new Error(`Unsupported data type: ${o}`);let d=c>0?this.backend.gpuDataManager.create(c).id:0;return new Th(this.module,o,d,l)};return this.backend.run(e,r,n,s,i,this.outputCount)}output(e,t){let r=this.module.stackSave();try{let n=this.module.PTR_SIZE,s=n===4?"i32":"i64",i=this.module.stackAlloc((1+t.length)*n);this.module.setValue(i,t.length,s);for(let a=0;a<t.length;a++)this.module.setValue(i+n*(a+1),t[a],s);return this.module._JsepOutput(this.opKernelContext,e,i)}catch(n){throw new Error(`Failed to generate kernel's output[${e}] with dims [${t}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${n}`)}finally{this.module.stackRestore(r)}}},o3=async(e,t,r,n)=>{let s=t.jsepInit;if(!s)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(e==="webgpu"){let i=(x8(),Ou(s3)).WebGpuBackend,a=new i;await a.initialize(r,n),s("webgpu",[a,o=>a.alloc(Number(o)),o=>a.free(o),(o,l,c,d=!1)=>{if(d)Ht("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(o)}, dst=${Number(l)}, size=${Number(c)}`),a.memcpy(Number(o),Number(l));else{Ht("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(o)}, gpuDataId=${Number(l)}, size=${Number(c)}`);let h=t.HEAPU8.subarray(Number(o>>>0),Number(o>>>0)+Number(c));a.upload(Number(l),h)}},async(o,l,c)=>{Ht("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${o}, dataOffset=${l}, size=${c}`),await a.download(Number(o),()=>t.HEAPU8.subarray(Number(l)>>>0,Number(l+c)>>>0))},(o,l,c)=>a.createKernel(o,Number(l),c,t.UTF8ToString(t._JsepGetNodeName(Number(l)))),o=>a.releaseKernel(o),(o,l,c,d)=>{Ht("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${c}, kernel=${o}, contextDataOffset=${l}`);let h=new pC(t,a,Number(l));return a.computeKernel(Number(o),h,d)},()=>a.captureBegin(),()=>a.captureEnd(),()=>a.replay()])}else{let i=new yO(r);s("webnn",[i,()=>i.reserveTensorId(),a=>i.releaseTensorId(a),async(a,o,l,c,d)=>i.ensureTensor(a,o,l,c,d),(a,o)=>{i.uploadTensor(a,o)},async(a,o)=>i.downloadTensor(a,o)])}}}),mC,Iw,Aw,aa,gC,c_,If,jw,Ow,u_,Nw,Dw,Fw,c3=Je(()=>{kW(),SW(),Ct(),Ao(),pw(),hO(),mC=(e,t)=>{hr()._OrtInit(e,t)!==0&&ir("Can't initialize onnxruntime.")},Iw=async e=>{mC(e.wasm.numThreads,Pf(e.logLevel))},Aw=async(e,t)=>{var r,n;(n=(r=hr()).asyncInit)==null||n.call(r);{let s=(b8(),Ou(a3)).init;if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let i=e.webgpu.adapter;if(i){if(typeof i.limits!="object"||typeof i.features!="object"||typeof i.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let a=e.webgpu.powerPreference;if(a!==void 0&&a!=="low-power"&&a!=="high-performance")throw new Error(`Invalid powerPreference setting: "${a}"`);let o=e.webgpu.forceFallbackAdapter;if(o!==void 0&&typeof o!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${o}"`);if(i=await navigator.gpu.requestAdapter({powerPreference:a,forceFallbackAdapter:o}),!i)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await s("webgpu",hr(),e,i)}if(t==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await s("webnn",hr(),e)}}},aa=new Map,gC=e=>{let t=hr(),r=t.stackSave();try{let n=t.PTR_SIZE,s=t.stackAlloc(2*n);t._OrtGetInputOutputCount(e,s,s+n)!==0&&ir("Can't get session input/output count.");let i=n===4?"i32":"i64";return[Number(t.getValue(s,i)),Number(t.getValue(s+n,i))]}finally{t.stackRestore(r)}},c_=(e,t)=>{let r=hr(),n=r.stackSave(),s=0;try{let i=r.PTR_SIZE,a=r.stackAlloc(2*i);r._OrtGetInputOutputMetadata(e,t,a,a+i)!==0&&ir("Can't get session input/output metadata.");let o=Number(r.getValue(a,"*"));s=Number(r.getValue(a+i,"*"));let l=r.HEAP32[s/4];if(l===0)return[o,0];let c=r.HEAPU32[s/4+1],d=[];for(let h=0;h<c;h++){let u=Number(r.getValue(s+8+h*i,"*"));d.push(u!==0?r.UTF8ToString(u):Number(r.getValue(s+8+(h+c)*i,"*")))}return[o,l,d]}finally{r.stackRestore(n),s!==0&&r._OrtFree(s)}},If=e=>{let t=hr(),r=t._malloc(e.byteLength);if(r===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,r),[r,e.byteLength]},jw=async(e,t)=>{var h,u,p,m;let r,n,s=hr();Array.isArray(e)?[r,n]=e:e.buffer===s.HEAPU8.buffer?[r,n]=[e.byteOffset,e.byteLength]:[r,n]=If(e);let i=0,a=0,o=0,l=[],c=[],d=[];try{if([a,l]=await dO(t),(t==null?void 0:t.externalData)&&s.mountExternalData){let S=[];for(let A of t.externalData){let j=typeof A=="string"?A:A.path;S.push(yw(typeof A=="string"?A:A.data).then(U=>{s.mountExternalData(j,U)}))}await Promise.all(S)}for(let S of(t==null?void 0:t.executionProviders)??[])if((typeof S=="string"?S:S.name)==="webnn"){if(s.shouldTransferToMLTensor=!1,typeof S!="string"){let A=S,j=A==null?void 0:A.context,U=A==null?void 0:A.gpuDevice,W=A==null?void 0:A.deviceType,B=A==null?void 0:A.powerPreference;j?s.currentContext=j:U?s.currentContext=await s.webnnCreateMLContext(U):s.currentContext=await s.webnnCreateMLContext({deviceType:W,powerPreference:B})}else s.currentContext=await s.webnnCreateMLContext();break}i=await s._OrtCreateSession(r,n,a),(h=s.webgpuOnCreateSession)==null||h.call(s,i),i===0&&ir("Can't create a session."),(u=s.jsepOnCreateSession)==null||u.call(s),s.currentContext&&(s.webnnRegisterMLContext(i,s.currentContext),s.currentContext=void 0,s.shouldTransferToMLTensor=!0);let[y,P]=gC(i),g=!!(t!=null&&t.enableGraphCapture),_=[],b=[],w=[],M=[],E=[];for(let S=0;S<y;S++){let[A,j,U]=c_(i,S);A===0&&ir("Can't get an input name."),c.push(A);let W=s.UTF8ToString(A);_.push(W),w.push(j===0?{name:W,isTensor:!1}:{name:W,isTensor:!0,type:Fi(j),shape:U})}for(let S=0;S<P;S++){let[A,j,U]=c_(i,S+y);A===0&&ir("Can't get an output name."),d.push(A);let W=s.UTF8ToString(A);b.push(W),M.push(j===0?{name:W,isTensor:!1}:{name:W,isTensor:!0,type:Fi(j),shape:U});{if(g&&(t==null?void 0:t.preferredOutputLocation)===void 0){E.push("gpu-buffer");continue}let B=typeof(t==null?void 0:t.preferredOutputLocation)=="string"?t.preferredOutputLocation:((p=t==null?void 0:t.preferredOutputLocation)==null?void 0:p[W])??"cpu";if(B!=="cpu"&&B!=="cpu-pinned"&&B!=="gpu-buffer"&&B!=="ml-tensor")throw new Error(`Not supported preferred output location: ${B}.`);if(g&&B!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${B}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);E.push(B)}}let T=null;return E.some(S=>S==="gpu-buffer"||S==="ml-tensor")&&(o=s._OrtCreateBinding(i),o===0&&ir("Can't create IO binding."),T={handle:o,outputPreferredLocations:E,outputPreferredLocationsEncoded:E.map(S=>j0(S))}),aa.set(i,[i,c,d,T,g,!1]),[i,_,b,w,M]}catch(y){throw c.forEach(P=>s._OrtFree(P)),d.forEach(P=>s._OrtFree(P)),o!==0&&s._OrtReleaseBinding(o)!==0&&ir("Can't release IO binding."),i!==0&&s._OrtReleaseSession(i)!==0&&ir("Can't release session."),y}finally{s._free(r),a!==0&&s._OrtReleaseSessionOptions(a)!==0&&ir("Can't release session options."),l.forEach(y=>s._free(y)),(m=s.unmountExternalData)==null||m.call(s)}},Ow=e=>{var l,c,d;let t=hr(),r=aa.get(e);if(!r)throw new Error(`cannot release session. invalid session id: ${e}`);let[n,s,i,a,o]=r;a&&(o&&t._OrtClearBoundOutputs(a.handle)!==0&&ir("Can't clear bound outputs."),t._OrtReleaseBinding(a.handle)!==0&&ir("Can't release IO binding.")),(l=t.jsepOnReleaseSession)==null||l.call(t,e),(c=t.webnnOnReleaseSession)==null||c.call(t,e),(d=t.webgpuOnReleaseSession)==null||d.call(t,e),s.forEach(h=>t._OrtFree(h)),i.forEach(h=>t._OrtFree(h)),t._OrtReleaseSession(n)!==0&&ir("Can't release session."),aa.delete(e)},u_=async(e,t,r,n,s,i,a=!1)=>{if(!e){t.push(0);return}let o=hr(),l=o.PTR_SIZE,c=e[0],d=e[1],h=e[3],u=h,p,m;if(c==="string"&&(h==="gpu-buffer"||h==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(a&&h!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${i} when enableGraphCapture is true.`);if(h==="gpu-buffer"){let g=e[2].gpuBuffer;m=uo(ol(c),d);{let _=o.jsepRegisterBuffer;if(!_)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');p=_(n,i,g,m)}}else if(h==="ml-tensor"){let g=e[2].mlTensor;m=uo(ol(c),d);let _=o.webnnRegisterMLTensor;if(!_)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');p=_(n,g,ol(c),d)}else{let g=e[2];if(Array.isArray(g)){m=l*g.length,p=o._malloc(m),r.push(p);for(let _=0;_<g.length;_++){if(typeof g[_]!="string")throw new TypeError(`tensor data at index ${_} is not a string`);o.setValue(p+_*l,ii(g[_],r),"*")}}else{let _=o.webnnIsGraphInput;if(c!=="string"&&_){let b=o.UTF8ToString(s);if(_(n,b)){let w=ol(c);m=uo(w,d),u="ml-tensor";let M=o.webnnCreateTemporaryTensor,E=o.webnnUploadTensor;if(!M||!E)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let T=await M(n,w,d);E(T,new Uint8Array(g.buffer,g.byteOffset,g.byteLength)),p=T}else m=g.byteLength,p=o._malloc(m),r.push(p),o.HEAPU8.set(new Uint8Array(g.buffer,g.byteOffset,m),p)}else m=g.byteLength,p=o._malloc(m),r.push(p),o.HEAPU8.set(new Uint8Array(g.buffer,g.byteOffset,m),p)}}let y=o.stackSave(),P=o.stackAlloc(4*d.length);try{d.forEach((_,b)=>o.setValue(P+b*l,_,l===4?"i32":"i64"));let g=o._OrtCreateTensor(ol(c),p,m,P,d.length,j0(u));g===0&&ir(`Can't create tensor for input/output. session=${n}, index=${i}.`),t.push(g)}finally{o.stackRestore(y)}},Nw=async(e,t,r,n,s,i)=>{var U,W,B,ee;let a=hr(),o=a.PTR_SIZE,l=aa.get(e);if(!l)throw new Error(`cannot run inference. invalid session id: ${e}`);let c=l[0],d=l[1],h=l[2],u=l[3],p=l[4],m=l[5],y=t.length,P=n.length,g=0,_=[],b=[],w=[],M=[],E=a.stackSave(),T=a.stackAlloc(y*o),S=a.stackAlloc(y*o),A=a.stackAlloc(P*o),j=a.stackAlloc(P*o);try{[g,_]=uO(i);for(let J=0;J<y;J++)await u_(r[J],b,M,e,d[t[J]],t[J],p);for(let J=0;J<P;J++)await u_(s[J],w,M,e,h[n[J]],y+n[J],p);for(let J=0;J<y;J++)a.setValue(T+J*o,b[J],"*"),a.setValue(S+J*o,d[t[J]],"*");for(let J=0;J<P;J++)a.setValue(A+J*o,w[J],"*"),a.setValue(j+J*o,h[n[J]],"*");if(u&&!m){let{handle:J,outputPreferredLocations:X,outputPreferredLocationsEncoded:ae}=u;if(d.length!==y)throw new Error(`input count from feeds (${y}) is expected to be always equal to model's input count (${d.length}).`);for(let le=0;le<y;le++){let ne=t[le];await a._OrtBindInput(J,d[ne],b[le])!==0&&ir(`Can't bind input[${le}] for session=${e}.`)}for(let le=0;le<P;le++){let ne=n[le];(U=s[le])!=null&&U[3]?a._OrtBindOutput(J,h[ne],w[le],0)!==0&&ir(`Can't bind pre-allocated output[${le}] for session=${e}.`):a._OrtBindOutput(J,h[ne],0,ae[ne])!==0&&ir(`Can't bind output[${le}] to ${X[le]} for session=${e}.`)}aa.set(e,[c,d,h,u,p,!0])}(W=a.jsepOnRunStart)==null||W.call(a,c),(B=a.webnnOnRunStart)==null||B.call(a,c);let Q;u?Q=await a._OrtRunWithBinding(c,u.handle,P,A,g):Q=await a._OrtRun(c,S,T,y,j,P,A,g),Q!==0&&ir("failed to call OrtRun().");let Z=[];for(let J=0;J<P;J++){let X=Number(a.getValue(A+J*o,"*"));if(X===w[J]){Z.push(s[J]);continue}let ae=a.stackSave(),le=a.stackAlloc(4*o),ne=!1,L,F=0;try{a._OrtGetTensorData(X,le,le+o,le+2*o,le+3*o)!==0&&ir(`Can't access output tensor data on index ${J}.`);let G=o===4?"i32":"i64",oe=Number(a.getValue(le,G));F=a.getValue(le+o,"*");let H=a.getValue(le+o*2,"*"),Te=Number(a.getValue(le+o*3,G)),Ce=[];for(let te=0;te<Te;te++)Ce.push(Number(a.getValue(H+te*o,G)));a._OrtFree(H)!==0&&ir("Can't free memory for tensor dims.");let Be=Ce.reduce((te,O)=>te*O,1);L=Fi(oe);let $e=u==null?void 0:u.outputPreferredLocations[n[J]];if(L==="string"){if($e==="gpu-buffer"||$e==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let te=[];for(let O=0;O<Be;O++){let ue=a.getValue(F+O*o,"*"),Ee=a.getValue(F+(O+1)*o,"*"),fe=O===Be-1?void 0:Ee-ue;te.push(a.UTF8ToString(ue,fe))}Z.push([L,Ce,te,"cpu"])}else if($e==="gpu-buffer"&&Be>0){let te=a.jsepGetBuffer;if(!te)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let O=te(F),ue=uo(oe,Be);if(ue===void 0||!gw(L))throw new Error(`Unsupported data type: ${L}`);ne=!0,Z.push([L,Ce,{gpuBuffer:O,download:a.jsepCreateDownloader(O,ue,L),dispose:()=>{a._OrtReleaseTensor(X)!==0&&ir("Can't release tensor.")}},"gpu-buffer"])}else if($e==="ml-tensor"&&Be>0){let te=a.webnnEnsureTensor,O=a.webnnIsInt64Supported;if(!te||!O)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(uo(oe,Be)===void 0||!_w(L))throw new Error(`Unsupported data type: ${L}`);if(L==="int64"&&!O(e))throw new Error('preferredLocation "ml-tensor" for int64 output is not supported by current WebNN Context.');let ue=await te(e,F,oe,Ce,!1);ne=!0,Z.push([L,Ce,{mlTensor:ue,download:a.webnnCreateMLTensorDownloader(F,L),dispose:()=>{a.webnnReleaseTensorId(F),a._OrtReleaseTensor(X)}},"ml-tensor"])}else{let te=mw(L),O=new te(Be);new Uint8Array(O.buffer,O.byteOffset,O.byteLength).set(a.HEAPU8.subarray(F,F+O.byteLength)),Z.push([L,Ce,O,"cpu"])}}finally{a.stackRestore(ae),L==="string"&&F&&a._free(F),ne||a._OrtReleaseTensor(X),(ee=a.webnnOnRunEnd)==null||ee.call(a,c)}}return u&&!p&&(a._OrtClearBoundOutputs(u.handle)!==0&&ir("Can't clear bound outputs."),aa.set(e,[c,d,h,u,p,!1])),Z}finally{a.stackRestore(E),b.forEach(Q=>a._OrtReleaseTensor(Q)),w.forEach(Q=>a._OrtReleaseTensor(Q)),M.forEach(Q=>a._free(Q)),g!==0&&a._OrtReleaseRunOptions(g),_.forEach(Q=>a._free(Q))}},Dw=e=>{let t=hr(),r=aa.get(e);if(!r)throw new Error("invalid session id");let n=r[0],s=t._OrtEndProfiling(n);s===0&&ir("Can't get an profile file name."),t._OrtFree(s)},Fw=e=>{let t=[];for(let r of e){let n=r[2];!Array.isArray(n)&&"buffer"in n&&t.push(n.buffer)}return t}}),oa,Yn,nl,Rc,zc,Eh,d_,Ph,Za,eo,_C,u3,d3,h3,f3,p3,m3,g3,_3=Je(()=>{fi(),c3(),Ao(),hw(),oa=()=>!!_r.wasm.proxy&&typeof document<"u",nl=!1,Rc=!1,zc=!1,Ph=new Map,Za=(e,t)=>{let r=Ph.get(e);r?r.push(t):Ph.set(e,[t])},eo=()=>{if(nl||!Rc||zc||!Yn)throw new Error("worker not ready")},_C=e=>{switch(e.data.type){case"init-wasm":nl=!1,e.data.err?(zc=!0,d_[1](e.data.err)):(Rc=!0,d_[0]()),Eh&&(URL.revokeObjectURL(Eh),Eh=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=Ph.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}}},u3=async()=>{if(!Rc){if(nl)throw new Error("multiple calls to 'initWasm()' detected.");if(zc)throw new Error("previous call to 'initWasm()' failed.");if(nl=!0,oa())return new Promise((e,t)=>{Yn==null||Yn.terminate(),lO().then(([r,n])=>{try{Yn=n,Yn.onerror=i=>t(i),Yn.onmessage=_C,d_=[e,t];let s={type:"init-wasm",in:_r};!s.in.wasm.wasmPaths&&(r||A0)&&(s.in.wasm.wasmPaths={wasm:new URL("/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href}),Yn.postMessage(s),Eh=r}catch(s){t(s)}},t)});try{await fw(_r.wasm),await Iw(_r),Rc=!0}catch(e){throw zc=!0,e}finally{nl=!1}}},d3=async e=>{if(oa())return eo(),new Promise((t,r)=>{Za("init-ep",[t,r]);let n={type:"init-ep",in:{epName:e,env:_r}};Yn.postMessage(n)});await Aw(_r,e)},h3=async e=>oa()?(eo(),new Promise((t,r)=>{Za("copy-from",[t,r]);let n={type:"copy-from",in:{buffer:e}};Yn.postMessage(n,[e.buffer])})):If(e),f3=async(e,t)=>{if(oa()){if(t!=null&&t.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return eo(),new Promise((r,n)=>{Za("create",[r,n]);let s={type:"create",in:{model:e,options:{...t}}},i=[];e instanceof Uint8Array&&i.push(e.buffer),Yn.postMessage(s,i)})}else return jw(e,t)},p3=async e=>{if(oa())return eo(),new Promise((t,r)=>{Za("release",[t,r]);let n={type:"release",in:e};Yn.postMessage(n)});Ow(e)},m3=async(e,t,r,n,s,i)=>{if(oa()){if(r.some(a=>a[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(s.some(a=>a))throw new Error("pre-allocated output tensor is not supported for proxy.");return eo(),new Promise((a,o)=>{Za("run",[a,o]);let l=r,c={type:"run",in:{sessionId:e,inputIndices:t,inputs:l,outputIndices:n,options:i}};Yn.postMessage(c,Fw(l))})}else return Nw(e,t,r,n,s,i)},g3=async e=>{if(oa())return eo(),new Promise((t,r)=>{Za("end-profiling",[t,r]);let n={type:"end-profiling",in:e};Yn.postMessage(n)});Dw(e)}}),h_,yC,y3,M8=Je(()=>{fi(),_3(),Ct(),dw(),hO(),h_=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},yC=e=>{switch(e[3]){case"cpu":return new ai(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!gw(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:r,download:n,dispose:s}=e[2];return ai.fromGpuBuffer(r,{dataType:t,dims:e[1],download:n,dispose:s})}case"ml-tensor":{let t=e[0];if(!_w(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:r,download:n,dispose:s}=e[2];return ai.fromMLTensor(r,{dataType:t,dims:e[1],download:n,dispose:s})}default:throw new Error(`invalid data location: ${e[3]}`)}},y3=class{async fetchModelAndCopyToWasmMemory(e){return h3(await yw(e))}async loadModel(e,t){hi();let r;typeof e=="string"?r=await this.fetchModelAndCopyToWasmMemory(e):r=e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await f3(r,t),Rs()}async dispose(){return p3(this.sessionId)}async run(e,t,r){hi();let n=[],s=[];Object.entries(e).forEach(h=>{let u=h[0],p=h[1],m=this.inputNames.indexOf(u);if(m===-1)throw new Error(`invalid input '${u}'`);n.push(p),s.push(m)});let i=[],a=[];Object.entries(t).forEach(h=>{let u=h[0],p=h[1],m=this.outputNames.indexOf(u);if(m===-1)throw new Error(`invalid output '${u}'`);i.push(p),a.push(m)});let o=n.map((h,u)=>h_(h,()=>`input "${this.inputNames[s[u]]}"`)),l=i.map((h,u)=>h?h_(h,()=>`output "${this.outputNames[a[u]]}"`):null),c=await m3(this.sessionId,s,o,a,l,r),d={};for(let h=0;h<c.length;h++)d[this.outputNames[a[h]]]=i[h]??yC(c[h]);return Rs(),d}startProfiling(){}endProfiling(){g3(this.sessionId)}}}),w3={};Ql(w3,{OnnxruntimeWebAssemblyBackend:()=>K0,initializeFlags:()=>q0,wasmBackend:()=>v3});var q0,K0,v3,T8=Je(()=>{fi(),_3(),M8(),q0=()=>{(typeof _r.wasm.initTimeout!="number"||_r.wasm.initTimeout<0)&&(_r.wasm.initTimeout=0);let e=_r.wasm.simd;if(typeof e!="boolean"&&e!==void 0&&e!=="fixed"&&e!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),_r.wasm.simd=!1),typeof _r.wasm.proxy!="boolean"&&(_r.wasm.proxy=!1),typeof _r.wasm.trace!="boolean"&&(_r.wasm.trace=!1),typeof _r.wasm.numThreads!="number"||!Number.isInteger(_r.wasm.numThreads)||_r.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)_r.wasm.numThreads=1;else{let t=typeof navigator>"u"?uW("node:os").cpus().length:navigator.hardwareConcurrency;_r.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},K0=class{async init(e){q0(),await u3(),await d3(e)}async createInferenceSessionHandler(e,t){let r=new y3;return await r.loadModel(e,t),r}},v3=new K0});fi();fi();fi();var E8="1.22.0-dev.20250409-89f8206ba4",P8=rO;{let e=(T8(),Ou(w3)).wasmBackend;go("webgpu",e,5),go("webnn",e,5),go("cpu",e,10),go("wasm",e,10)}Object.defineProperty(_r.versions,"web",{value:E8,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k8=Object.freeze(Object.defineProperty({__proto__:null,get InferenceSession(){return uw},get TRACE(){return Nu},get TRACE_FUNC_BEGIN(){return hi},get TRACE_FUNC_END(){return Rs},get Tensor(){return ai},default:P8,get env(){return _r},get registerBackend(){return go}},Symbol.toStringTag,{value:"Module"}));var ji={},S8={"onnxruntime-common":e=>{e.exports=aW},"onnxruntime-web":e=>{e.exports=k8},"?2ce3":()=>{},"?7992":()=>{},"?5af5":()=>{},"?2b25":()=>{},"?db59":()=>{},"?383f":()=>{},"?fa4b":()=>{},"./node_modules/@huggingface/jinja/dist/index.js":(e,t,r)=>{r.r(t),r.d(t,{Environment:()=>ze,Interpreter:()=>yt,Template:()=>or,parse:()=>H,tokenize:()=>d});var n=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Comment:"Comment"}),s=class{constructor(I,re){this.value=I,this.type=re}};function i(I){return/\w/.test(I)}function a(I){return/[0-9]/.test(I)}var o=[["{%",n.OpenStatement],["%}",n.CloseStatement],["{{",n.OpenExpression],["}}",n.CloseExpression],["(",n.OpenParen],[")",n.CloseParen],["{",n.OpenCurlyBracket],["}",n.CloseCurlyBracket],["[",n.OpenSquareBracket],["]",n.CloseSquareBracket],[",",n.Comma],[".",n.Dot],[":",n.Colon],["|",n.Pipe],["<=",n.ComparisonBinaryOperator],[">=",n.ComparisonBinaryOperator],["==",n.ComparisonBinaryOperator],["!=",n.ComparisonBinaryOperator],["<",n.ComparisonBinaryOperator],[">",n.ComparisonBinaryOperator],["+",n.AdditiveBinaryOperator],["-",n.AdditiveBinaryOperator],["~",n.AdditiveBinaryOperator],["*",n.MultiplicativeBinaryOperator],["/",n.MultiplicativeBinaryOperator],["%",n.MultiplicativeBinaryOperator],["=",n.Equals]],l=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function c(I,re={}){return I.endsWith(`
`)&&(I=I.slice(0,-1)),re.lstrip_blocks&&(I=I.replace(/^[ \t]*({[#%-])/gm,"$1")),re.trim_blocks&&(I=I.replace(/([#%-]})\n/g,"$1")),I.replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{").replace(/-#}\s*/g,"#}").replace(/\s*{#-/g,"{#").replace(/{%\s*(end)?generation\s*%}/gs,"")}function d(I,re={}){var ct,kt;const V=[],Y=c(I,re);let ce=0,Se=0;const Re=xt=>{let jt="";for(;xt(Y[ce]);){if(Y[ce]==="\\"){if(++ce,ce>=Y.length)throw new SyntaxError("Unexpected end of input");const ot=Y[ce++],Wt=l.get(ot);if(Wt===void 0)throw new SyntaxError(`Unexpected escaped character: ${ot}`);jt+=Wt;continue}if(jt+=Y[ce++],ce>=Y.length)throw new SyntaxError("Unexpected end of input")}return jt};e:for(;ce<Y.length;){const xt=(ct=V.at(-1))==null?void 0:ct.type;if(xt===void 0||xt===n.CloseStatement||xt===n.CloseExpression||xt===n.Comment){let ot="";for(;ce<Y.length&&!(Y[ce]==="{"&&(Y[ce+1]==="%"||Y[ce+1]==="{"||Y[ce+1]==="#"));)ot+=Y[ce++];if(ot.length>0){V.push(new s(ot,n.Text));continue}}if(Y[ce]==="{"&&Y[ce+1]==="#"){ce+=2;let ot="";for(;Y[ce]!=="#"||Y[ce+1]!=="}";){if(ce+2>=Y.length)throw new SyntaxError("Missing end of comment tag");ot+=Y[ce++]}V.push(new s(ot,n.Comment)),ce+=2;continue}Re(ot=>/\s/.test(ot));const jt=Y[ce];if(jt==="-"||jt==="+"){const ot=(kt=V.at(-1))==null?void 0:kt.type;if(ot===n.Text||ot===void 0)throw new SyntaxError(`Unexpected character: ${jt}`);switch(ot){case n.Identifier:case n.NumericLiteral:case n.StringLiteral:case n.CloseParen:case n.CloseSquareBracket:break;default:{++ce;const Wt=Re(a);V.push(new s(`${jt}${Wt}`,Wt.length>0?n.NumericLiteral:n.UnaryOperator));continue}}}for(const[ot,Wt]of o){if(ot==="}}"&&Se>0)continue;if(Y.slice(ce,ce+ot.length)===ot){V.push(new s(ot,Wt)),Wt===n.OpenExpression?Se=0:Wt===n.OpenCurlyBracket?++Se:Wt===n.CloseCurlyBracket&&--Se,ce+=ot.length;continue e}}if(jt==="'"||jt==='"'){++ce;const ot=Re(Wt=>Wt!==jt);V.push(new s(ot,n.StringLiteral)),++ce;continue}if(a(jt)){let ot=Re(a);if(Y[ce]==="."&&a(Y[ce+1])){++ce;const Wt=Re(a);ot=`${ot}.${Wt}`}V.push(new s(ot,n.NumericLiteral));continue}if(i(jt)){const ot=Re(i);V.push(new s(ot,n.Identifier));continue}throw new SyntaxError(`Unexpected character: ${jt}`)}return V}var h=class{constructor(){ie(this,"type","Statement")}},u=class extends h{constructor(re){super();ie(this,"type","Program");this.body=re}},p=class extends h{constructor(re,V,Y){super();ie(this,"type","If");this.test=re,this.body=V,this.alternate=Y}},m=class extends h{constructor(re,V,Y,ce){super();ie(this,"type","For");this.loopvar=re,this.iterable=V,this.body=Y,this.defaultBlock=ce}},y=class extends h{constructor(){super(...arguments);ie(this,"type","Break")}},P=class extends h{constructor(){super(...arguments);ie(this,"type","Continue")}},g=class extends h{constructor(re,V,Y){super();ie(this,"type","Set");this.assignee=re,this.value=V,this.body=Y}},_=class extends h{constructor(re,V,Y){super();ie(this,"type","Macro");this.name=re,this.args=V,this.body=Y}},b=class extends h{constructor(re){super();ie(this,"type","Comment");this.value=re}},w=class extends h{constructor(){super(...arguments);ie(this,"type","Expression")}},M=class extends w{constructor(re,V,Y){super();ie(this,"type","MemberExpression");this.object=re,this.property=V,this.computed=Y}},E=class extends w{constructor(re,V){super();ie(this,"type","CallExpression");this.callee=re,this.args=V}},T=class extends w{constructor(re){super();ie(this,"type","Identifier");this.value=re}},S=class extends w{constructor(re){super();ie(this,"type","Literal");this.value=re}},A=class extends S{constructor(){super(...arguments);ie(this,"type","IntegerLiteral")}},j=class extends S{constructor(){super(...arguments);ie(this,"type","FloatLiteral")}},U=class extends S{constructor(){super(...arguments);ie(this,"type","StringLiteral")}},W=class extends S{constructor(){super(...arguments);ie(this,"type","ArrayLiteral")}},B=class extends S{constructor(){super(...arguments);ie(this,"type","TupleLiteral")}},ee=class extends S{constructor(){super(...arguments);ie(this,"type","ObjectLiteral")}},Q=class extends w{constructor(re,V,Y){super();ie(this,"type","BinaryExpression");this.operator=re,this.left=V,this.right=Y}},Z=class extends w{constructor(re,V){super();ie(this,"type","FilterExpression");this.operand=re,this.filter=V}},J=class extends h{constructor(re,V){super();ie(this,"type","FilterStatement");this.filter=re,this.body=V}},X=class extends w{constructor(re,V){super();ie(this,"type","SelectExpression");this.lhs=re,this.test=V}},ae=class extends w{constructor(re,V,Y){super();ie(this,"type","TestExpression");this.operand=re,this.negate=V,this.test=Y}},le=class extends w{constructor(re,V){super();ie(this,"type","UnaryExpression");this.operator=re,this.argument=V}},ne=class extends w{constructor(re=void 0,V=void 0,Y=void 0){super();ie(this,"type","SliceExpression");this.start=re,this.stop=V,this.step=Y}},L=class extends w{constructor(re,V){super();ie(this,"type","KeywordArgumentExpression");this.key=re,this.value=V}},F=class extends w{constructor(re){super();ie(this,"type","SpreadExpression");this.argument=re}},G=class extends h{constructor(re,V,Y){super();ie(this,"type","CallStatement");this.call=re,this.callerArgs=V,this.body=Y}},oe=class extends w{constructor(re,V,Y){super();ie(this,"type","Ternary");this.condition=re,this.trueExpr=V,this.falseExpr=Y}};function H(I){const re=new u([]);let V=0;function Y(He,Qe){const lt=I[V++];if(!lt||lt.type!==He)throw new Error(`Parser Error: ${Qe}. ${lt.type} !== ${He}.`);return lt}function ce(He){if(!kt(He))throw new SyntaxError(`Expected ${He}`);++V}function Se(){switch(I[V].type){case n.Comment:return new b(I[V++].value);case n.Text:return xt();case n.OpenStatement:return jt();case n.OpenExpression:return ot();default:throw new SyntaxError(`Unexpected token type: ${I[V].type}`)}}function Re(...He){return V+He.length<=I.length&&He.every((Qe,lt)=>Qe===I[V+lt].type)}function ct(...He){var Qe,lt,lr;return((Qe=I[V])==null?void 0:Qe.type)===n.OpenStatement&&((lt=I[V+1])==null?void 0:lt.type)===n.Identifier&&He.includes((lr=I[V+1])==null?void 0:lr.value)}function kt(...He){return V+He.length<=I.length&&He.every((Qe,lt)=>I[V+lt].type==="Identifier"&&Qe===I[V+lt].value)}function xt(){return new U(Y(n.Text,"Expected text token").value)}function jt(){if(Y(n.OpenStatement,"Expected opening statement token"),I[V].type!==n.Identifier)throw new SyntaxError(`Unknown statement, got ${I[V].type}`);const He=I[V].value;let Qe;switch(He){case"set":++V,Qe=Wt();break;case"if":++V,Qe=ar(),Y(n.OpenStatement,"Expected {% token"),ce("endif"),Y(n.CloseStatement,"Expected %} token");break;case"macro":++V,Qe=In(),Y(n.OpenStatement,"Expected {% token"),ce("endmacro"),Y(n.CloseStatement,"Expected %} token");break;case"for":++V,Qe=Nr(),Y(n.OpenStatement,"Expected {% token"),ce("endfor"),Y(n.CloseStatement,"Expected %} token");break;case"call":{++V;let lt=null;Re(n.OpenParen)&&(lt=Xn());const lr=An();if(lr.type!=="Identifier")throw new SyntaxError("Expected identifier following call statement");const Ci=Xn();Y(n.CloseStatement,"Expected closing statement token");const Vs=[];for(;!ct("endcall");)Vs.push(Se());Y(n.OpenStatement,"Expected '{%'"),ce("endcall"),Y(n.CloseStatement,"Expected closing statement token");const os=new E(lr,Ci);Qe=new G(os,lt,Vs);break}case"break":++V,Y(n.CloseStatement,"Expected closing statement token"),Qe=new y;break;case"continue":++V,Y(n.CloseStatement,"Expected closing statement token"),Qe=new P;break;case"filter":{++V;let lt=An();lt instanceof T&&Re(n.OpenParen)&&(lt=Es(lt)),Y(n.CloseStatement,"Expected closing statement token");const lr=[];for(;!ct("endfilter");)lr.push(Se());Y(n.OpenStatement,"Expected '{%'"),ce("endfilter"),Y(n.CloseStatement,"Expected '%}'"),Qe=new J(lt,lr);break}default:throw new SyntaxError(`Unknown statement type: ${He}`)}return Qe}function ot(){Y(n.OpenExpression,"Expected opening expression token");const He=Xr();return Y(n.CloseExpression,"Expected closing expression token"),He}function Wt(){const He=Bn();let Qe=null;const lt=[];if(Re(n.Equals))++V,Qe=Bn();else{for(Y(n.CloseStatement,"Expected %} token");!ct("endset");)lt.push(Se());Y(n.OpenStatement,"Expected {% token"),ce("endset")}return Y(n.CloseStatement,"Expected closing statement token"),new g(He,Qe,lt)}function ar(){const He=Xr();Y(n.CloseStatement,"Expected closing statement token");const Qe=[],lt=[];for(;!ct("elif","else","endif");)Qe.push(Se());if(ct("elif")){++V,++V;const lr=ar();lt.push(lr)}else if(ct("else"))for(++V,++V,Y(n.CloseStatement,"Expected closing statement token");!ct("endif");)lt.push(Se());return new p(He,Qe,lt)}function In(){const He=An();if(He.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");const Qe=Xn();Y(n.CloseStatement,"Expected closing statement token");const lt=[];for(;!ct("endmacro");)lt.push(Se());return new _(He,Qe,lt)}function Bn(He=!1){const Qe=He?An:Xr,lt=[Qe()],lr=Re(n.Comma);for(;lr&&(++V,lt.push(Qe()),!!Re(n.Comma)););return lr?new B(lt):lt[0]}function Nr(){const He=Bn(!0);if(!(He instanceof T||He instanceof B))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${He.type} instead`);if(!kt("in"))throw new SyntaxError("Expected `in` keyword following loop variable");++V;const Qe=Xr();Y(n.CloseStatement,"Expected closing statement token");const lt=[];for(;!ct("endfor","else");)lt.push(Se());const lr=[];if(ct("else"))for(++V,++V,Y(n.CloseStatement,"Expected closing statement token");!ct("endfor");)lr.push(Se());return new m(He,Qe,lt,lr)}function Xr(){return Dr()}function Dr(){const He=Ms();if(kt("if")){++V;const Qe=Ms();if(kt("else")){++V;const lt=Dr();return new oe(Qe,He,lt)}else return new X(He,Qe)}return He}function Ms(){let He=Ts();for(;kt("or");){const Qe=I[V];++V;const lt=Ts();He=new Q(Qe,He,lt)}return He}function Ts(){let He=dn();for(;kt("and");){const Qe=I[V];++V;const lt=dn();He=new Q(Qe,He,lt)}return He}function dn(){let He;for(;kt("not");){const Qe=I[V];++V;const lt=dn();He=new le(Qe,lt)}return He??mi()}function mi(){let He=gi();for(;;){let Qe;if(kt("not","in"))Qe=new s("not in",n.Identifier),V+=2;else if(kt("in"))Qe=I[V++];else if(Re(n.ComparisonBinaryOperator))Qe=I[V++];else break;const lt=gi();He=new Q(Qe,He,lt)}return He}function gi(){let He=$r();for(;Re(n.AdditiveBinaryOperator);){const Qe=I[V];++V;const lt=$r();He=new Q(Qe,He,lt)}return He}function Zr(){const He=Wr(An());return Re(n.OpenParen)?Es(He):He}function Es(He){let Qe=new E(He,Xn());return Qe=Wr(Qe),Re(n.OpenParen)&&(Qe=Es(Qe)),Qe}function Xn(){Y(n.OpenParen,"Expected opening parenthesis for arguments list");const He=En();return Y(n.CloseParen,"Expected closing parenthesis for arguments list"),He}function En(){const He=[];for(;!Re(n.CloseParen);){let Qe;if(I[V].type===n.MultiplicativeBinaryOperator&&I[V].value==="*"){++V;const lt=Xr();Qe=new F(lt)}else if(Qe=Xr(),Re(n.Equals)){if(++V,!(Qe instanceof T))throw new SyntaxError("Expected identifier for keyword argument");const lt=Xr();Qe=new L(Qe,lt)}He.push(Qe),Re(n.Comma)&&++V}return He}function Ps(){const He=[];let Qe=!1;for(;!Re(n.CloseSquareBracket);)Re(n.Colon)?(He.push(void 0),++V,Qe=!0):(He.push(Xr()),Re(n.Colon)&&(++V,Qe=!0));if(He.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(Qe){if(He.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new ne(...He)}return He[0]}function Wr(He){for(;Re(n.Dot)||Re(n.OpenSquareBracket);){const Qe=I[V];++V;let lt;const lr=Qe.type===n.OpenSquareBracket;if(lr)lt=Ps(),Y(n.CloseSquareBracket,"Expected closing square bracket");else if(lt=An(),lt.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");He=new M(He,lt,lr)}return He}function $r(){let He=ks();for(;Re(n.MultiplicativeBinaryOperator);){const Qe=I[V++],lt=ks();He=new Q(Qe,He,lt)}return He}function ks(){let He=Si();for(;kt("is");){++V;const Qe=kt("not");Qe&&++V;const lt=An();if(!(lt instanceof T))throw new SyntaxError("Expected identifier for the test");He=new ae(He,Qe,lt)}return He}function Si(){let He=Zr();for(;Re(n.Pipe);){++V;let Qe=An();if(!(Qe instanceof T))throw new SyntaxError("Expected identifier for the filter");Re(n.OpenParen)&&(Qe=Es(Qe)),He=new Z(He,Qe)}return He}function An(){const He=I[V++];switch(He.type){case n.NumericLiteral:{const Qe=He.value;return Qe.includes(".")?new j(Number(Qe)):new A(Number(Qe))}case n.StringLiteral:{let Qe=He.value;for(;Re(n.StringLiteral);)Qe+=I[V++].value;return new U(Qe)}case n.Identifier:return new T(He.value);case n.OpenParen:{const Qe=Bn();return Y(n.CloseParen,"Expected closing parenthesis, got ${tokens[current].type} instead."),Qe}case n.OpenSquareBracket:{const Qe=[];for(;!Re(n.CloseSquareBracket);)Qe.push(Xr()),Re(n.Comma)&&++V;return++V,new W(Qe)}case n.OpenCurlyBracket:{const Qe=new Map;for(;!Re(n.CloseCurlyBracket);){const lt=Xr();Y(n.Colon,"Expected colon between key and value in object literal");const lr=Xr();Qe.set(lt,lr),Re(n.Comma)&&++V}return++V,new ee(Qe)}default:throw new SyntaxError(`Unexpected token: ${He.type}`)}}for(;V<I.length;)re.body.push(Se());return re}function Te(I,re,V=1){re===void 0&&(re=I,I=0);const Y=[];for(let ce=I;ce<re;ce+=V)Y.push(ce);return Y}function Ce(I,re,V,Y=1){const ce=Math.sign(Y);ce>=0?(re=(re??(re=0))<0?Math.max(I.length+re,0):Math.min(re,I.length),V=(V??(V=I.length))<0?Math.max(I.length+V,0):Math.min(V,I.length)):(re=(re??(re=I.length-1))<0?Math.max(I.length+re,-1):Math.min(re,I.length-1),V=(V??(V=-1))<-1?Math.max(I.length+V,-1):Math.min(V,I.length-1));const Se=[];for(let Re=re;ce*Re<ce*V;Re+=Y)Se.push(I[Re]);return Se}function Be(I){return I.replace(/\b\w/g,re=>re.toUpperCase())}function $e(I){return te(new Date,I)}function te(I,re){const V=new Intl.DateTimeFormat(void 0,{month:"long"}),Y=new Intl.DateTimeFormat(void 0,{month:"short"}),ce=Se=>Se<10?"0"+Se:Se.toString();return re.replace(/%[YmdbBHM%]/g,Se=>{switch(Se){case"%Y":return I.getFullYear().toString();case"%m":return ce(I.getMonth()+1);case"%d":return ce(I.getDate());case"%b":return Y.format(I);case"%B":return V.format(I);case"%H":return ce(I.getHours());case"%M":return ce(I.getMinutes());case"%%":return"%";default:return Se}})}function O(I){return I.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ue(I,re,V,Y){if(Y===0)return I;let ce=Y==null||Y<0?1/0:Y;const Se=re.length===0?new RegExp("(?=)","gu"):new RegExp(O(re),"gu");return I.replaceAll(Se,Re=>ce>0?(--ce,V):Re)}var Ee=class extends Error{},fe=class extends Error{},me=class{constructor(I=void 0){ie(this,"type","RuntimeValue");ie(this,"value");ie(this,"builtins",new Map);this.value=I}__bool__(){return new je(!!this.value)}toString(){return String(this.value)}},ve=class extends me{constructor(){super(...arguments);ie(this,"type","IntegerValue")}},xe=class extends me{constructor(){super(...arguments);ie(this,"type","FloatValue")}toString(){return this.value%1===0?this.value.toFixed(1):this.value.toString()}},_e=class extends me{constructor(){super(...arguments);ie(this,"type","StringValue");ie(this,"builtins",new Map([["upper",new Le(()=>new _e(this.value.toUpperCase()))],["lower",new Le(()=>new _e(this.value.toLowerCase()))],["strip",new Le(()=>new _e(this.value.trim()))],["title",new Le(()=>new _e(Be(this.value)))],["capitalize",new Le(()=>new _e(this.value.charAt(0).toUpperCase()+this.value.slice(1)))],["length",new ve(this.value.length)],["rstrip",new Le(()=>new _e(this.value.trimEnd()))],["lstrip",new Le(()=>new _e(this.value.trimStart()))],["startswith",new Le(re=>{if(re.length===0)throw new Error("startswith() requires at least one argument");const V=re[0];if(V instanceof _e)return new je(this.value.startsWith(V.value));if(V instanceof Me){for(const Y of V.value){if(!(Y instanceof _e))throw new Error("startswith() tuple elements must be strings");if(this.value.startsWith(Y.value))return new je(!0)}return new je(!1)}throw new Error("startswith() argument must be a string or tuple of strings")})],["endswith",new Le(re=>{if(re.length===0)throw new Error("endswith() requires at least one argument");const V=re[0];if(V instanceof _e)return new je(this.value.endsWith(V.value));if(V instanceof Me){for(const Y of V.value){if(!(Y instanceof _e))throw new Error("endswith() tuple elements must be strings");if(this.value.endsWith(Y.value))return new je(!0)}return new je(!1)}throw new Error("endswith() argument must be a string or tuple of strings")})],["split",new Le(re=>{const V=re[0]??new rt;if(!(V instanceof _e||V instanceof rt))throw new Error("sep argument must be a string or null");const Y=re[1]??new ve(-1);if(!(Y instanceof ve))throw new Error("maxsplit argument must be a number");let ce=[];if(V instanceof rt){const Se=this.value.trimStart();for(const{0:Re,index:ct}of Se.matchAll(/\S+/g)){if(Y.value!==-1&&ce.length>=Y.value&&ct!==void 0){ce.push(Re+Se.slice(ct+Re.length));break}ce.push(Re)}}else{if(V.value==="")throw new Error("empty separator");ce=this.value.split(V.value),Y.value!==-1&&ce.length>Y.value&&ce.push(ce.splice(Y.value).join(V.value))}return new Me(ce.map(Se=>new _e(Se)))})],["replace",new Le(re=>{if(re.length<2)throw new Error("replace() requires at least two arguments");const V=re[0],Y=re[1];if(!(V instanceof _e&&Y instanceof _e))throw new Error("replace() arguments must be strings");let ce;if(re.length>2?re[2].type==="KeywordArgumentsValue"?ce=re[2].value.get("count")??new rt:ce=re[2]:ce=new rt,!(ce instanceof ve||ce instanceof rt))throw new Error("replace() count argument must be a number or null");return new _e(ue(this.value,V.value,Y.value,ce.value))})]]))}},je=class extends me{constructor(){super(...arguments);ie(this,"type","BooleanValue")}},we=class extends me{constructor(){super(...arguments);ie(this,"type","ObjectValue");ie(this,"builtins",new Map([["get",new Le(([re,V])=>{if(!(re instanceof _e))throw new Error(`Object key must be a string: got ${re.type}`);return this.value.get(re.value)??V??new rt})],["items",new Le(()=>this.items())],["keys",new Le(()=>this.keys())],["values",new Le(()=>this.values())]]))}__bool__(){return new je(this.value.size>0)}items(){return new Me(Array.from(this.value.entries()).map(([re,V])=>new Me([new _e(re),V])))}keys(){return new Me(Array.from(this.value.keys()).map(re=>new _e(re)))}values(){return new Me(Array.from(this.value.values()))}},Oe=class extends we{constructor(){super(...arguments);ie(this,"type","KeywordArgumentsValue")}},Me=class extends me{constructor(){super(...arguments);ie(this,"type","ArrayValue");ie(this,"builtins",new Map([["length",new ve(this.value.length)]]))}__bool__(){return new je(this.value.length>0)}},We=class extends Me{constructor(){super(...arguments);ie(this,"type","TupleValue")}},Le=class extends me{constructor(){super(...arguments);ie(this,"type","FunctionValue")}},rt=class extends me{constructor(){super(...arguments);ie(this,"type","NullValue")}},Ye=class extends me{constructor(){super(...arguments);ie(this,"type","UndefinedValue")}},ze=class{constructor(I){ie(this,"variables",new Map([["namespace",new Le(I=>{if(I.length===0)return new we(new Map);if(I.length!==1||!(I[0]instanceof we))throw new Error("`namespace` expects either zero arguments or a single object argument");return I[0]})]]));ie(this,"tests",new Map([["boolean",I=>I.type==="BooleanValue"],["callable",I=>I instanceof Le],["odd",I=>{if(!(I instanceof ve))throw new Error(`cannot odd on ${I.type}`);return I.value%2!==0}],["even",I=>{if(!(I instanceof ve))throw new Error(`cannot even on ${I.type}`);return I.value%2===0}],["false",I=>I.type==="BooleanValue"&&!I.value],["true",I=>I.type==="BooleanValue"&&I.value],["none",I=>I.type==="NullValue"],["string",I=>I.type==="StringValue"],["number",I=>I instanceof ve||I instanceof xe],["integer",I=>I instanceof ve],["iterable",I=>I.type==="ArrayValue"||I.type==="StringValue"],["mapping",I=>I.type==="ObjectValue"],["lower",I=>{const re=I.value;return I.type==="StringValue"&&re===re.toLowerCase()}],["upper",I=>{const re=I.value;return I.type==="StringValue"&&re===re.toUpperCase()}],["none",I=>I.type==="NullValue"],["defined",I=>I.type!=="UndefinedValue"],["undefined",I=>I.type==="UndefinedValue"],["equalto",(I,re)=>I.value===re.value],["eq",(I,re)=>I.value===re.value]]));this.parent=I}set(I,re){return this.declareVariable(I,Ve(re))}declareVariable(I,re){if(this.variables.has(I))throw new SyntaxError(`Variable already declared: ${I}`);return this.variables.set(I,re),re}setVariable(I,re){return this.variables.set(I,re),re}resolve(I){if(this.variables.has(I))return this;if(this.parent)return this.parent.resolve(I);throw new Error(`Unknown variable: ${I}`)}lookupVariable(I){try{return this.resolve(I).variables.get(I)??new Ye}catch{return new Ye}}};function Ke(I){I.set("false",!1),I.set("true",!0),I.set("none",null),I.set("raise_exception",re=>{throw new Error(re)}),I.set("range",Te),I.set("strftime_now",$e),I.set("True",!0),I.set("False",!1),I.set("None",null)}var yt=class{constructor(I){ie(this,"global");this.global=I??new ze}run(I){return this.evaluate(I,this.global)}evaluateBinaryExpression(I,re){const V=this.evaluate(I.left,re);switch(I.operator.value){case"and":return V.__bool__().value?this.evaluate(I.right,re):V;case"or":return V.__bool__().value?V:this.evaluate(I.right,re)}const Y=this.evaluate(I.right,re);switch(I.operator.value){case"==":return new je(V.value==Y.value);case"!=":return new je(V.value!=Y.value)}if(V instanceof Ye||Y instanceof Ye){if(Y instanceof Ye&&["in","not in"].includes(I.operator.value))return new je(I.operator.value==="not in");throw new Error(`Cannot perform operation ${I.operator.value} on undefined values`)}else{if(V instanceof rt||Y instanceof rt)throw new Error("Cannot perform operation on null values");if(I.operator.value==="~")return new _e(V.value.toString()+Y.value.toString());if((V instanceof ve||V instanceof xe)&&(Y instanceof ve||Y instanceof xe)){const ce=V.value,Se=Y.value;switch(I.operator.value){case"+":case"-":case"*":{const Re=I.operator.value==="+"?ce+Se:I.operator.value==="-"?ce-Se:ce*Se;return V instanceof xe||Y instanceof xe?new xe(Re):new ve(Re)}case"/":return new xe(ce/Se);case"%":{const Re=ce%Se;return V instanceof xe||Y instanceof xe?new xe(Re):new ve(Re)}case"<":return new je(ce<Se);case">":return new je(ce>Se);case">=":return new je(ce>=Se);case"<=":return new je(ce<=Se)}}else if(V instanceof Me&&Y instanceof Me)switch(I.operator.value){case"+":return new Me(V.value.concat(Y.value))}else if(Y instanceof Me){const ce=Y.value.find(Se=>Se.value===V.value)!==void 0;switch(I.operator.value){case"in":return new je(ce);case"not in":return new je(!ce)}}}if(V instanceof _e||Y instanceof _e)switch(I.operator.value){case"+":return new _e(V.value.toString()+Y.value.toString())}if(V instanceof _e&&Y instanceof _e)switch(I.operator.value){case"in":return new je(Y.value.includes(V.value));case"not in":return new je(!Y.value.includes(V.value))}if(V instanceof _e&&Y instanceof we)switch(I.operator.value){case"in":return new je(Y.value.has(V.value));case"not in":return new je(!Y.value.has(V.value))}throw new SyntaxError(`Unknown operator "${I.operator.value}" between ${V.type} and ${Y.type}`)}evaluateArguments(I,re){const V=[],Y=new Map;for(const ce of I)if(ce.type==="SpreadExpression"){const Se=ce,Re=this.evaluate(Se.argument,re);if(!(Re instanceof Me))throw new Error(`Cannot unpack non-iterable type: ${Re.type}`);for(const ct of Re.value)V.push(ct)}else if(ce.type==="KeywordArgumentExpression"){const Se=ce;Y.set(Se.key.value,this.evaluate(Se.value,re))}else{if(Y.size>0)throw new Error("Positional arguments must come before keyword arguments");V.push(this.evaluate(ce,re))}return[V,Y]}applyFilter(I,re,V){if(re.type==="Identifier"){const Y=re;if(Y.value==="tojson")return new _e(wt(I));if(I instanceof Me)switch(Y.value){case"list":return I;case"first":return I.value[0];case"last":return I.value[I.value.length-1];case"length":return new ve(I.value.length);case"reverse":return new Me(I.value.reverse());case"sort":return new Me(I.value.sort((ce,Se)=>{if(ce.type!==Se.type)throw new Error(`Cannot compare different types: ${ce.type} and ${Se.type}`);switch(ce.type){case"IntegerValue":case"FloatValue":return ce.value-Se.value;case"StringValue":return ce.value.localeCompare(Se.value);default:throw new Error(`Cannot compare type: ${ce.type}`)}}));case"join":return new _e(I.value.map(ce=>ce.value).join(""));case"string":return new _e(wt(I));case"unique":{const ce=new Set,Se=[];for(const Re of I.value)ce.has(Re.value)||(ce.add(Re.value),Se.push(Re));return new Me(Se)}default:throw new Error(`Unknown ArrayValue filter: ${Y.value}`)}else if(I instanceof _e)switch(Y.value){case"length":case"upper":case"lower":case"title":case"capitalize":{const ce=I.builtins.get(Y.value);if(ce instanceof Le)return ce.value([],V);if(ce instanceof ve)return ce;throw new Error(`Unknown StringValue filter: ${Y.value}`)}case"trim":return new _e(I.value.trim());case"indent":return new _e(I.value.split(`
`).map((ce,Se)=>Se===0||ce.length===0?ce:"    "+ce).join(`
`));case"join":case"string":return I;case"int":{const ce=parseInt(I.value,10);return new ve(isNaN(ce)?0:ce)}case"float":{const ce=parseFloat(I.value);return new xe(isNaN(ce)?0:ce)}default:throw new Error(`Unknown StringValue filter: ${Y.value}`)}else if(I instanceof ve||I instanceof xe)switch(Y.value){case"abs":return I instanceof ve?new ve(Math.abs(I.value)):new xe(Math.abs(I.value));case"int":return new ve(Math.floor(I.value));case"float":return new xe(I.value);default:throw new Error(`Unknown NumericValue filter: ${Y.value}`)}else if(I instanceof we)switch(Y.value){case"items":return new Me(Array.from(I.value.entries()).map(([ce,Se])=>new Me([new _e(ce),Se])));case"length":return new ve(I.value.size);default:throw new Error(`Unknown ObjectValue filter: ${Y.value}`)}else if(I instanceof je)switch(Y.value){case"bool":return new je(I.value);case"int":return new ve(I.value?1:0);case"float":return new xe(I.value?1:0);case"string":return new _e(I.value?"true":"false");default:throw new Error(`Unknown BooleanValue filter: ${Y.value}`)}throw new Error(`Cannot apply filter "${Y.value}" to type: ${I.type}`)}else if(re.type==="CallExpression"){const Y=re;if(Y.callee.type!=="Identifier")throw new Error(`Unknown filter: ${Y.callee.type}`);const ce=Y.callee.value;if(ce==="tojson"){const[,Se]=this.evaluateArguments(Y.args,V),Re=Se.get("indent")??new rt;if(!(Re instanceof ve||Re instanceof rt))throw new Error("If set, indent must be a number");return new _e(wt(I,Re.value))}else if(ce==="join"){let Se;if(I instanceof _e)Se=Array.from(I.value);else if(I instanceof Me)Se=I.value.map(xt=>xt.value);else throw new Error(`Cannot apply filter "${ce}" to type: ${I.type}`);const[Re,ct]=this.evaluateArguments(Y.args,V),kt=Re.at(0)??ct.get("separator")??new _e("");if(!(kt instanceof _e))throw new Error("separator must be a string");return new _e(Se.join(kt.value))}else if(ce==="int"||ce==="float"){const[Se,Re]=this.evaluateArguments(Y.args,V),ct=Se.at(0)??Re.get("default")??(ce==="int"?new ve(0):new xe(0));if(I instanceof _e){const kt=ce==="int"?parseInt(I.value,10):parseFloat(I.value);return isNaN(kt)?ct:ce==="int"?new ve(kt):new xe(kt)}else{if(I instanceof ve||I instanceof xe)return I;if(I instanceof je)return ce==="int"?new ve(I.value?1:0):new xe(I.value?1:0);throw new Error(`Cannot apply filter "${ce}" to type: ${I.type}`)}}else if(ce==="default"){const[Se,Re]=this.evaluateArguments(Y.args,V),ct=Se[0]??new _e(""),kt=Se[1]??Re.get("boolean")??new je(!1);if(!(kt instanceof je))throw new Error("`default` filter flag must be a boolean");return I instanceof Ye||kt.value&&!I.__bool__().value?ct:I}if(I instanceof Me){switch(ce){case"selectattr":case"rejectattr":{const Se=ce==="selectattr";if(I.value.some(ot=>!(ot instanceof we)))throw new Error(`\`${ce}\` can only be applied to array of objects`);if(Y.args.some(ot=>ot.type!=="StringLiteral"))throw new Error(`arguments of \`${ce}\` must be strings`);const[Re,ct,kt]=Y.args.map(ot=>this.evaluate(ot,V));let xt;if(ct){const ot=V.tests.get(ct.value);if(!ot)throw new Error(`Unknown test: ${ct.value}`);xt=ot}else xt=(...ot)=>ot[0].__bool__().value;const jt=I.value.filter(ot=>{const Wt=ot.value.get(Re.value),ar=Wt?xt(Wt,kt):!1;return Se?ar:!ar});return new Me(jt)}case"map":{const[,Se]=this.evaluateArguments(Y.args,V);if(Se.has("attribute")){const Re=Se.get("attribute");if(!(Re instanceof _e))throw new Error("attribute must be a string");const ct=Se.get("default"),kt=I.value.map(xt=>{if(!(xt instanceof we))throw new Error("items in map must be an object");return xt.value.get(Re.value)??ct??new Ye});return new Me(kt)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${ce}`)}else if(I instanceof _e){switch(ce){case"indent":{const[Se,Re]=this.evaluateArguments(Y.args,V),ct=Se.at(0)??Re.get("width")??new ve(4);if(!(ct instanceof ve))throw new Error("width must be a number");const kt=Se.at(1)??Re.get("first")??new je(!1),xt=Se.at(2)??Re.get("blank")??new je(!1),jt=I.value.split(`
`),ot=" ".repeat(ct.value),Wt=jt.map((ar,In)=>!kt.value&&In===0||!xt.value&&ar.length===0?ar:ot+ar);return new _e(Wt.join(`
`))}case"replace":{const Se=I.builtins.get("replace");if(!(Se instanceof Le))throw new Error("replace filter not available");const[Re,ct]=this.evaluateArguments(Y.args,V);return Se.value([...Re,new Oe(ct)],V)}}throw new Error(`Unknown StringValue filter: ${ce}`)}else throw new Error(`Cannot apply filter "${ce}" to type: ${I.type}`)}throw new Error(`Unknown filter: ${re.type}`)}evaluateFilterExpression(I,re){const V=this.evaluate(I.operand,re);return this.applyFilter(V,I.filter,re)}evaluateTestExpression(I,re){const V=this.evaluate(I.operand,re),Y=re.tests.get(I.test.value);if(!Y)throw new Error(`Unknown test: ${I.test.value}`);const ce=Y(V);return new je(I.negate?!ce:ce)}evaluateSelectExpression(I,re){return this.evaluate(I.test,re).__bool__().value?this.evaluate(I.lhs,re):new Ye}evaluateUnaryExpression(I,re){const V=this.evaluate(I.argument,re);switch(I.operator.value){case"not":return new je(!V.value);default:throw new SyntaxError(`Unknown operator: ${I.operator.value}`)}}evaluateTernaryExpression(I,re){return this.evaluate(I.condition,re).__bool__().value?this.evaluate(I.trueExpr,re):this.evaluate(I.falseExpr,re)}evalProgram(I,re){return this.evaluateBlock(I.body,re)}evaluateBlock(I,re){let V="";for(const Y of I){const ce=this.evaluate(Y,re);ce.type!=="NullValue"&&ce.type!=="UndefinedValue"&&(V+=ce.toString())}return new _e(V)}evaluateIdentifier(I,re){return re.lookupVariable(I.value)}evaluateCallExpression(I,re){const[V,Y]=this.evaluateArguments(I.args,re);Y.size>0&&V.push(new Oe(Y));const ce=this.evaluate(I.callee,re);if(ce.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${ce.type}`);return ce.value(V,re)}evaluateSliceExpression(I,re,V){if(!(I instanceof Me||I instanceof _e))throw new Error("Slice object must be an array or string");const Y=this.evaluate(re.start,V),ce=this.evaluate(re.stop,V),Se=this.evaluate(re.step,V);if(!(Y instanceof ve||Y instanceof Ye))throw new Error("Slice start must be numeric or undefined");if(!(ce instanceof ve||ce instanceof Ye))throw new Error("Slice stop must be numeric or undefined");if(!(Se instanceof ve||Se instanceof Ye))throw new Error("Slice step must be numeric or undefined");return I instanceof Me?new Me(Ce(I.value,Y.value,ce.value,Se.value)):new _e(Ce(Array.from(I.value),Y.value,ce.value,Se.value).join(""))}evaluateMemberExpression(I,re){const V=this.evaluate(I.object,re);let Y;if(I.computed){if(I.property.type==="SliceExpression")return this.evaluateSliceExpression(V,I.property,re);Y=this.evaluate(I.property,re)}else Y=new _e(I.property.value);let ce;if(V instanceof we){if(!(Y instanceof _e))throw new Error(`Cannot access property with non-string: got ${Y.type}`);ce=V.value.get(Y.value)??V.builtins.get(Y.value)}else if(V instanceof Me||V instanceof _e)if(Y instanceof ve)ce=V.value.at(Y.value),V instanceof _e&&(ce=new _e(V.value.at(Y.value)));else if(Y instanceof _e)ce=V.builtins.get(Y.value);else throw new Error(`Cannot access property with non-string/non-number: got ${Y.type}`);else{if(!(Y instanceof _e))throw new Error(`Cannot access property with non-string: got ${Y.type}`);ce=V.builtins.get(Y.value)}return ce instanceof me?ce:new Ye}evaluateSet(I,re){const V=I.value?this.evaluate(I.value,re):this.evaluateBlock(I.body,re);if(I.assignee.type==="Identifier"){const Y=I.assignee.value;re.setVariable(Y,V)}else if(I.assignee.type==="TupleLiteral"){const Y=I.assignee;if(!(V instanceof Me))throw new Error(`Cannot unpack non-iterable type in set: ${V.type}`);const ce=V.value;if(ce.length!==Y.value.length)throw new Error(`Too ${Y.value.length>ce.length?"few":"many"} items to unpack in set`);for(let Se=0;Se<Y.value.length;++Se){const Re=Y.value[Se];if(Re.type!=="Identifier")throw new Error(`Cannot unpack to non-identifier in set: ${Re.type}`);re.setVariable(Re.value,ce[Se])}}else if(I.assignee.type==="MemberExpression"){const Y=I.assignee,ce=this.evaluate(Y.object,re);if(!(ce instanceof we))throw new Error("Cannot assign to member of non-object");if(Y.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");ce.value.set(Y.property.value,V)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(I.assignee)}`);return new rt}evaluateIf(I,re){const V=this.evaluate(I.test,re);return this.evaluateBlock(V.__bool__().value?I.body:I.alternate,re)}evaluateFor(I,re){const V=new ze(re);let Y,ce;if(I.iterable.type==="SelectExpression"){const xt=I.iterable;ce=this.evaluate(xt.lhs,V),Y=xt.test}else ce=this.evaluate(I.iterable,V);if(!(ce instanceof Me||ce instanceof we))throw new Error(`Expected iterable or object type in for loop: got ${ce.type}`);ce instanceof we&&(ce=ce.keys());const Se=[],Re=[];for(let xt=0;xt<ce.value.length;++xt){const jt=new ze(V),ot=ce.value[xt];let Wt;if(I.loopvar.type==="Identifier")Wt=ar=>ar.setVariable(I.loopvar.value,ot);else if(I.loopvar.type==="TupleLiteral"){const ar=I.loopvar;if(ot.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${ot.type}`);const In=ot;if(ar.value.length!==In.value.length)throw new Error(`Too ${ar.value.length>In.value.length?"few":"many"} items to unpack`);Wt=Bn=>{for(let Nr=0;Nr<ar.value.length;++Nr){if(ar.value[Nr].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${ar.value[Nr].type}`);Bn.setVariable(ar.value[Nr].value,In.value[Nr])}}}else throw new Error(`Invalid loop variable(s): ${I.loopvar.type}`);Y&&(Wt(jt),!this.evaluate(Y,jt).__bool__().value)||(Se.push(ot),Re.push(Wt))}let ct="",kt=!0;for(let xt=0;xt<Se.length;++xt){const jt=new Map([["index",new ve(xt+1)],["index0",new ve(xt)],["revindex",new ve(Se.length-xt)],["revindex0",new ve(Se.length-xt-1)],["first",new je(xt===0)],["last",new je(xt===Se.length-1)],["length",new ve(Se.length)],["previtem",xt>0?Se[xt-1]:new Ye],["nextitem",xt<Se.length-1?Se[xt+1]:new Ye]]);V.setVariable("loop",new we(jt)),Re[xt](V);try{const ot=this.evaluateBlock(I.body,V);ct+=ot.value}catch(ot){if(ot instanceof fe)continue;if(ot instanceof Ee)break;throw ot}kt=!1}if(kt){const xt=this.evaluateBlock(I.defaultBlock,V);ct+=xt.value}return new _e(ct)}evaluateMacro(I,re){return re.setVariable(I.name.value,new Le((V,Y)=>{var Re;const ce=new ze(Y);V=V.slice();let Se;((Re=V.at(-1))==null?void 0:Re.type)==="KeywordArgumentsValue"&&(Se=V.pop());for(let ct=0;ct<I.args.length;++ct){const kt=I.args[ct],xt=V[ct];if(kt.type==="Identifier"){const jt=kt;if(!xt)throw new Error(`Missing positional argument: ${jt.value}`);ce.setVariable(jt.value,xt)}else if(kt.type==="KeywordArgumentExpression"){const jt=kt,ot=xt??(Se==null?void 0:Se.value.get(jt.key.value))??this.evaluate(jt.value,ce);ce.setVariable(jt.key.value,ot)}else throw new Error(`Unknown argument type: ${kt.type}`)}return this.evaluateBlock(I.body,ce)})),new rt}evaluateCallStatement(I,re){const V=new Le((ct,kt)=>{const xt=new ze(kt);if(I.callerArgs)for(let jt=0;jt<I.callerArgs.length;++jt){const ot=I.callerArgs[jt];if(ot.type!=="Identifier")throw new Error(`Caller parameter must be an identifier, got ${ot.type}`);xt.setVariable(ot.value,ct[jt]??new Ye)}return this.evaluateBlock(I.body,xt)}),[Y,ce]=this.evaluateArguments(I.call.args,re);Y.push(new Oe(ce));const Se=this.evaluate(I.call.callee,re);if(Se.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${Se.type}`);const Re=new ze(re);return Re.setVariable("caller",V),Se.value(Y,Re)}evaluateFilterStatement(I,re){const V=this.evaluateBlock(I.body,re);return this.applyFilter(V,I.filter,re)}evaluate(I,re){if(!I)return new Ye;switch(I.type){case"Program":return this.evalProgram(I,re);case"Set":return this.evaluateSet(I,re);case"If":return this.evaluateIf(I,re);case"For":return this.evaluateFor(I,re);case"Macro":return this.evaluateMacro(I,re);case"CallStatement":return this.evaluateCallStatement(I,re);case"Break":throw new Ee;case"Continue":throw new fe;case"IntegerLiteral":return new ve(I.value);case"FloatLiteral":return new xe(I.value);case"StringLiteral":return new _e(I.value);case"ArrayLiteral":return new Me(I.value.map(V=>this.evaluate(V,re)));case"TupleLiteral":return new We(I.value.map(V=>this.evaluate(V,re)));case"ObjectLiteral":{const V=new Map;for(const[Y,ce]of I.value){const Se=this.evaluate(Y,re);if(!(Se instanceof _e))throw new Error(`Object keys must be strings: got ${Se.type}`);V.set(Se.value,this.evaluate(ce,re))}return new we(V)}case"Identifier":return this.evaluateIdentifier(I,re);case"CallExpression":return this.evaluateCallExpression(I,re);case"MemberExpression":return this.evaluateMemberExpression(I,re);case"UnaryExpression":return this.evaluateUnaryExpression(I,re);case"BinaryExpression":return this.evaluateBinaryExpression(I,re);case"FilterExpression":return this.evaluateFilterExpression(I,re);case"FilterStatement":return this.evaluateFilterStatement(I,re);case"TestExpression":return this.evaluateTestExpression(I,re);case"SelectExpression":return this.evaluateSelectExpression(I,re);case"Ternary":return this.evaluateTernaryExpression(I,re);case"Comment":return new rt;default:throw new SyntaxError(`Unknown node type: ${I.type}`)}}};function Ve(I){switch(typeof I){case"number":return Number.isInteger(I)?new ve(I):new xe(I);case"string":return new _e(I);case"boolean":return new je(I);case"undefined":return new Ye;case"object":return I===null?new rt:Array.isArray(I)?new Me(I.map(Ve)):new we(new Map(Object.entries(I).map(([re,V])=>[re,Ve(V)])));case"function":return new Le((re,V)=>{const Y=I(...re.map(ce=>ce.value))??null;return Ve(Y)});default:throw new Error(`Cannot convert to runtime value: ${I}`)}}function wt(I,re,V){const Y=V??0;switch(I.type){case"NullValue":case"UndefinedValue":return"null";case"IntegerValue":case"FloatValue":case"StringValue":case"BooleanValue":return JSON.stringify(I.value);case"ArrayValue":case"ObjectValue":{const ce=re?" ".repeat(re):"",Se=`
`+ce.repeat(Y),Re=Se+ce;if(I.type==="ArrayValue"){const ct=I.value.map(kt=>wt(kt,re,Y+1));return re?`[${Re}${ct.join(`,${Re}`)}${Se}]`:`[${ct.join(", ")}]`}else{const ct=Array.from(I.value.entries()).map(([kt,xt])=>{const jt=`"${kt}": ${wt(xt,re,Y+1)}`;return re?`${Re}${jt}`:jt});return re?`{${ct.join(",")}${Se}}`:`{${ct.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${I.type}`)}}var ut=`
`,yr="{%- ",wr=" -%}";function Hr(I){switch(I.operator.type){case"MultiplicativeBinaryOperator":return 4;case"AdditiveBinaryOperator":return 3;case"ComparisonBinaryOperator":return 2;case"Identifier":return I.operator.value==="and"?1:I.operator.value==="in"||I.operator.value==="not in"?2:0}return 0}function Qr(I,re="	"){const V=typeof re=="number"?" ".repeat(re):re;return un(I.body,0,V).replace(/\n$/,"")}function Er(...I){return yr+I.join(" ")+wr}function un(I,re,V){return I.map(Y=>Hi(Y,re,V)).join(ut)}function Hi(I,re,V){const Y=V.repeat(re);switch(I.type){case"Program":return un(I.body,re,V);case"If":return Qi(I,re,V);case"For":return Xi(I,re,V);case"Set":return bs(I,re,V);case"Macro":return ki(I,re,V);case"Break":return Y+Er("break");case"Continue":return Y+Er("continue");case"CallStatement":return Et(I,re,V);case"FilterStatement":return pi(I,re,V);case"Comment":return Y+"{# "+I.value+" #}";default:return Y+"{{- "+zt(I)+" -}}"}}function Qi(I,re,V){const Y=V.repeat(re),ce=[];let Se=I;for(;Se&&(ce.push({test:Se.test,body:Se.body}),Se.alternate.length===1&&Se.alternate[0].type==="If");)Se=Se.alternate[0];let Re=Y+Er("if",zt(ce[0].test))+ut+un(ce[0].body,re+1,V);for(let ct=1;ct<ce.length;++ct)Re+=ut+Y+Er("elif",zt(ce[ct].test))+ut+un(ce[ct].body,re+1,V);return Se&&Se.alternate.length>0&&(Re+=ut+Y+Er("else")+ut+un(Se.alternate,re+1,V)),Re+=ut+Y+Er("endif"),Re}function Xi(I,re,V){const Y=V.repeat(re);let ce="";if(I.iterable.type==="SelectExpression"){const Re=I.iterable;ce=`${zt(Re.lhs)} if ${zt(Re.test)}`}else ce=zt(I.iterable);let Se=Y+Er("for",zt(I.loopvar),"in",ce)+ut+un(I.body,re+1,V);return I.defaultBlock.length>0&&(Se+=ut+Y+Er("else")+ut+un(I.defaultBlock,re+1,V)),Se+=ut+Y+Er("endfor"),Se}function bs(I,re,V){const Y=V.repeat(re),ce=zt(I.assignee),Se=I.value?zt(I.value):"",Re=Y+Er("set",`${ce}${I.value?" = "+Se:""}`);return I.body.length===0?Re:Re+ut+un(I.body,re+1,V)+ut+Y+Er("endset")}function ki(I,re,V){const Y=V.repeat(re),ce=I.args.map(zt).join(", ");return Y+Er("macro",`${I.name.value}(${ce})`)+ut+un(I.body,re+1,V)+ut+Y+Er("endmacro")}function Et(I,re,V){const Y=V.repeat(re),ce=I.callerArgs&&I.callerArgs.length>0?`(${I.callerArgs.map(zt).join(", ")})`:"",Se=zt(I.call);let Re=Y+Er(`call${ce}`,Se)+ut;return Re+=un(I.body,re+1,V)+ut,Re+=Y+Er("endcall"),Re}function pi(I,re,V){const Y=V.repeat(re),ce=I.filter.type==="Identifier"?I.filter.value:zt(I.filter);let Se=Y+Er("filter",ce)+ut;return Se+=un(I.body,re+1,V)+ut,Se+=Y+Er("endfilter"),Se}function zt(I,re=-1){switch(I.type){case"SpreadExpression":return`*${zt(I.argument)}`;case"Identifier":return I.value;case"IntegerLiteral":return`${I.value}`;case"FloatLiteral":return`${I.value}`;case"StringLiteral":return JSON.stringify(I.value);case"BinaryExpression":{const V=I,Y=Hr(V),ce=zt(V.left,Y),Se=zt(V.right,Y+1),Re=`${ce} ${V.operator.value} ${Se}`;return Y<re?`(${Re})`:Re}case"UnaryExpression":{const V=I;return V.operator.value+(V.operator.value==="not"?" ":"")+zt(V.argument,1/0)}case"CallExpression":{const V=I,Y=V.args.map(zt).join(", ");return`${zt(V.callee)}(${Y})`}case"MemberExpression":{const V=I;let Y=zt(V.object);["Identifier","MemberExpression","CallExpression","StringLiteral","IntegerLiteral","FloatLiteral","ArrayLiteral","TupleLiteral","ObjectLiteral"].includes(V.object.type)||(Y=`(${Y})`);let ce=zt(V.property);return!V.computed&&V.property.type!=="Identifier"&&(ce=`(${ce})`),V.computed?`${Y}[${ce}]`:`${Y}.${ce}`}case"FilterExpression":{const V=I,Y=zt(V.operand,1/0);return V.filter.type==="CallExpression"?`${Y} | ${zt(V.filter)}`:`${Y} | ${V.filter.value}`}case"SelectExpression":{const V=I;return`${zt(V.lhs)} if ${zt(V.test)}`}case"TestExpression":{const V=I;return`${zt(V.operand)} is${V.negate?" not":""} ${V.test.value}`}case"ArrayLiteral":case"TupleLiteral":{const V=I.value.map(zt),Y=I.type==="ArrayLiteral"?"[]":"()";return`${Y[0]}${V.join(", ")}${Y[1]}`}case"ObjectLiteral":return`{${Array.from(I.value.entries()).map(([Y,ce])=>`${zt(Y)}: ${zt(ce)}`).join(", ")}}`;case"SliceExpression":{const V=I,Y=V.start?zt(V.start):"",ce=V.stop?zt(V.stop):"",Se=V.step?`:${zt(V.step)}`:"";return`${Y}:${ce}${Se}`}case"KeywordArgumentExpression":{const V=I;return`${V.key.value}=${zt(V.value)}`}case"Ternary":{const V=I,Y=`${zt(V.trueExpr)} if ${zt(V.condition,0)} else ${zt(V.falseExpr)}`;return re>-1?`(${Y})`:Y}default:throw new Error(`Unknown expression type: ${I.type}`)}}var or=class{constructor(I){ie(this,"parsed");const re=d(I,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=H(re)}render(I){const re=new ze;if(Ke(re),I)for(const[ce,Se]of Object.entries(I))re.set(ce,Se);return new yt(re).run(this.parsed).value}format(I){return Qr(this.parsed,(I==null?void 0:I.indent)||"	")}}},"./src/backends/onnx.js":(e,t,r)=>{var n;r.r(t),r.d(t,{Tensor:()=>o.Tensor,createInferenceSession:()=>P,deviceToExecutionProviders:()=>m,isONNXProxy:()=>E,isONNXTensor:()=>w,runInferenceSession:()=>b});var s=r("./src/env.js"),i=r("?2ce3"),a=r("onnxruntime-web"),o=r("onnxruntime-common");const l=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),c=[];let d,h;const u=Symbol.for("onnxruntime");if(u in globalThis)h=globalThis[u];else if(s.apis.IS_NODE_ENV){switch(h=i??(n||(n=r.t(i,2))),process.platform){case"win32":c.push("dml");break;case"linux":process.arch==="x64"&&c.push("cuda");break}c.push("cpu"),d=["cpu"]}else h=a,s.apis.IS_WEBNN_AVAILABLE&&c.push("webnn-npu","webnn-gpu","webnn-cpu","webnn"),s.apis.IS_WEBGPU_AVAILABLE&&c.push("webgpu"),c.push("wasm"),d=["wasm"];const p=h.InferenceSession;function m(T=null){if(!T)return d;switch(T){case"auto":return c;case"gpu":return c.filter(S=>["webgpu","cuda","dml","webnn-gpu"].includes(S))}if(c.includes(T))return[l[T]??T];throw new Error(`Unsupported device: "${T}". Should be one of: ${c.join(", ")}.`)}let y=null;async function P(T,S,A){y&&await y;const j=p.create(T,S);y??(y=j);const U=await j;return U.config=A,U}let g=Promise.resolve();const _=s.apis.IS_BROWSER_ENV||s.apis.IS_WEBWORKER_ENV;async function b(T,S){const A=()=>T.run(S);return await(_?g=g.then(A):A())}function w(T){return T instanceof h.Tensor}const M=h==null?void 0:h.env;M!=null&&M.wasm&&(!(typeof ServiceWorkerGlobalScope<"u"&&self instanceof ServiceWorkerGlobalScope)&&!M.wasm.wasmPaths&&(M.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${s.env.version}/dist/`),M.wasm.proxy=!1),M!=null&&M.webgpu&&(M.webgpu.powerPreference="high-performance");function E(){var T;return(T=M==null?void 0:M.wasm)==null?void 0:T.proxy}s.env.backends.onnx=M},"./src/base/feature_extraction_utils.js":(e,t,r)=>{r.r(t),r.d(t,{FeatureExtractor:()=>a,validate_audio_inputs:()=>o});var n=r("./src/utils/constants.js"),s=r("./src/utils/generic.js"),i=r("./src/utils/hub.js");class a extends s.Callable{constructor(c){super(),this.config=c}static async from_pretrained(c,d={}){const h=await(0,i.getModelJSON)(c,n.FEATURE_EXTRACTOR_NAME,!0,d);return new this(h)}}function o(l,c){var d;if(!(l instanceof Float32Array||l instanceof Float64Array))throw new Error(`${c} expects input to be a Float32Array or a Float64Array, but got ${((d=l==null?void 0:l.constructor)==null?void 0:d.name)??typeof l} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}},"./src/base/image_processors_utils.js":(e,t,r)=>{r.r(t),r.d(t,{ImageProcessor:()=>w,center_to_corners_format:()=>h,post_process_instance_segmentation:()=>b,post_process_object_detection:()=>u,post_process_panoptic_segmentation:()=>_,post_process_semantic_segmentation:()=>p});var n=r("./src/utils/generic.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/maths.js");r("./src/utils/image.js");var a=r("./src/utils/core.js"),o=r("./src/utils/hub.js"),l=r("./src/utils/constants.js");function c(M,E,T=0,S=null){const A=M/E;let j=(0,i.bankers_round)(A)*E;return S!==null&&j>S&&(j=Math.floor(A)*E),j<T&&(j=Math.ceil(A)*E),j}function d([M,E],T){return[Math.max(Math.floor(M/T),1)*T,Math.max(Math.floor(E/T),1)*T]}function h([M,E,T,S]){return[M-T/2,E-S/2,M+T/2,E+S/2]}function u(M,E=.5,T=null,S=!1){const A=M.logits,j=M.pred_boxes,[U,W,B]=A.dims;if(T!==null&&T.length!==U)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let ee=[];for(let Q=0;Q<U;++Q){let Z=T!==null?T[Q]:null,J={boxes:[],classes:[],scores:[]},X=A[Q],ae=j[Q];for(let le=0;le<W;++le){let ne=X[le],L=[],F;if(S){F=ne.sigmoid().data;for(let G=0;G<F.length;++G)F[G]>E&&L.push(G)}else{let G=(0,i.max)(ne.data)[1];if(G===B-1||(F=(0,i.softmax)(ne.data),F[G]<E))continue;L.push(G)}for(const G of L){let oe=ae[le].data;oe=h(oe),Z!==null&&(oe=oe.map((H,Te)=>H*Z[(Te+1)%2])),J.boxes.push(oe),J.classes.push(G),J.scores.push(F[G])}}ee.push(J)}return ee}function p(M,E=null){const T=M.logits,S=T.dims[0];if(E!==null&&E.length!==S)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const A=[];for(let j=0;j<S;++j){const U=E!==null?E[j]:null;let W=T[j];U!==null&&(W=(0,s.interpolate)(W,U,"bilinear",!1));const[B,ee]=U??W.dims.slice(-2),Q=new s.Tensor("int32",new Int32Array(B*ee),[B,ee]),Z=W[0].data,J=Q.data;for(let le=1;le<W.dims[0];++le){const ne=W[le].data;for(let L=0;L<ne.length;++L)ne[L]>Z[L]&&(Z[L]=ne[L],J[L]=le)}const X=new Array(W.dims[0]);for(let le=0;le<J.length;++le){const ne=J[le];X[ne]=ne}const ae=X.filter(le=>le!==void 0);A.push({segmentation:Q,labels:ae})}return A}function m(M,E,T,S){const A=[],j=[],U=[];for(let W=0;W<M.dims[0];++W){const B=M[W],ee=E[W],Q=(0,i.max)(B.data)[1];if(Q===S)continue;const J=(0,i.softmax)(B.data)[Q];J>T&&(A.push(ee),j.push(J),U.push(Q))}return[A,j,U]}function y(M,E,T,S=.5,A=.8){const j=[];let U=0,W=0;const B=E[T].data;for(let Q=0;Q<M.length;++Q)M[Q]===T&&(j.push(Q),++U),B[Q]>=S&&++W;let ee=U>0&&W>0;return ee&&(ee=U/W>A),[ee,j]}function P(M,E,T,S,A,j=null,U=null){const[W,B]=U??M[0].dims,ee=new s.Tensor("int32",new Int32Array(W*B),[W,B]),Q=[];if(U!==null)for(let le=0;le<M.length;++le)M[le]=(0,s.interpolate)(M[le],U,"bilinear",!1);const Z=new Int32Array(M[0].data.length),J=new Float32Array(M[0].data.length);for(let le=0;le<M.length;++le){let ne=E[le];const L=M[le].data;for(let F=0;F<L.length;++F)L[F]*=ne,L[F]>J[F]&&(Z[F]=le,J[F]=L[F])}let X=0;const ae=ee.data;for(let le=0;le<T.length;++le){const ne=T[le],[L,F]=y(Z,M,le,S,A);if(L){++X;for(const G of F)ae[G]=X;Q.push({id:X,label_id:ne,score:E[le]})}}return[ee,Q]}function g(M,E,T=28,S=56*56,A=14*14*4*1280){if(M<T||E<T)throw new Error(`height:${M} or width:${E} must be larger than factor:${T}`);if(Math.max(M,E)/Math.min(M,E)>200)throw new Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(M,E)/Math.min(M,E)}`);let j=Math.round(M/T)*T,U=Math.round(E/T)*T;if(j*U>A){const W=Math.sqrt(M*E/A);j=Math.floor(M/W/T)*T,U=Math.floor(E/W/T)*T}else if(j*U<S){const W=Math.sqrt(S/(M*E));j=Math.ceil(M*W/T)*T,U=Math.ceil(E*W/T)*T}return[j,U]}function _(M,E=.5,T=.5,S=.8,A=null,j=null){A===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),A=new Set);const U=M.class_queries_logits??M.logits,B=(M.masks_queries_logits??M.pred_masks).sigmoid();let[ee,Q,Z]=U.dims;if(Z-=1,j!==null&&j.length!==ee)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let J=[];for(let X=0;X<ee;++X){let ae=j!==null?j[X]:null,le=U[X],ne=B[X],[L,F,G]=m(le,ne,E,Z);if(G.length===0){let[Te,Ce]=ae??ne.dims.slice(-2),Be=new s.Tensor("int32",new Int32Array(Te*Ce).fill(-1),[Te,Ce]);J.push({segmentation:Be,segments_info:[]});continue}let[oe,H]=P(L,F,G,T,S,A,ae);J.push({segmentation:oe,segments_info:H})}return J}function b(M,E=.5,T=null){throw new Error("`post_process_instance_segmentation` is not yet implemented.")}class w extends n.Callable{constructor(E){super(),this.image_mean=E.image_mean??E.mean,this.image_std=E.image_std??E.std,this.resample=E.resample??2,this.do_rescale=E.do_rescale??!0,this.rescale_factor=E.rescale_factor??1/255,this.do_normalize=E.do_normalize,this.do_thumbnail=E.do_thumbnail,this.size=E.size??E.image_size,this.do_resize=E.do_resize??this.size!==void 0,this.size_divisibility=E.size_divisibility??E.size_divisor,this.do_center_crop=E.do_center_crop,this.crop_size=E.crop_size,this.do_convert_rgb=E.do_convert_rgb??!0,this.do_crop_margin=E.do_crop_margin,this.pad_size=E.pad_size,this.do_pad=E.do_pad,this.min_pixels=E.min_pixels,this.max_pixels=E.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=E.do_flip_channel_order??!1,this.config=E}async thumbnail(E,T,S=2){const A=E.height,j=E.width,U=T.height,W=T.width;let B=Math.min(A,U),ee=Math.min(j,W);return B===A&&ee===j?E:(A>j?ee=Math.floor(j*B/A):j>A&&(B=Math.floor(A*ee/j)),await E.resize(ee,B,{resample:S}))}async crop_margin(E,T=200){const S=E.clone().grayscale(),A=(0,i.min)(S.data)[0],U=(0,i.max)(S.data)[0]-A;if(U===0)return E;const W=T/255;let B=S.width,ee=S.height,Q=0,Z=0;const J=S.data;for(let X=0;X<S.height;++X){const ae=X*S.width;for(let le=0;le<S.width;++le)(J[ae+le]-A)/U<W&&(B=Math.min(B,le),ee=Math.min(ee,X),Q=Math.max(Q,le),Z=Math.max(Z,X))}return E=await E.crop([B,ee,Q,Z]),E}pad_image(E,T,S,{mode:A="constant",center:j=!1,constant_values:U=0}={}){const[W,B,ee]=T;let Q,Z;if(typeof S=="number"?(Q=S,Z=S):S==="square"?Q=Z=Math.max(W,B):(Q=S.width,Z=S.height),Q!==B||Z!==W){const J=new Float32Array(Q*Z*ee);if(Array.isArray(U))for(let le=0;le<J.length;++le)J[le]=U[le%ee];else U!==0&&J.fill(U);const[X,ae]=j?[Math.floor((Q-B)/2),Math.floor((Z-W)/2)]:[0,0];for(let le=0;le<W;++le){const ne=(le+ae)*Q,L=le*B;for(let F=0;F<B;++F){const G=(ne+F+X)*ee,oe=(L+F)*ee;for(let H=0;H<ee;++H)J[G+H]=E[oe+H]}}if(A==="symmetric"){if(j)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const le=W-1,ne=B-1;for(let L=0;L<Z;++L){const F=L*Q,G=(0,a.calculateReflectOffset)(L,le)*B;for(let oe=0;oe<Q;++oe){if(L<W&&oe<B)continue;const H=(F+oe)*ee,Te=(G+(0,a.calculateReflectOffset)(oe,ne))*ee;for(let Ce=0;Ce<ee;++Ce)J[H+Ce]=E[Te+Ce]}}}E=J,T=[Z,Q,ee]}return[E,T]}rescale(E){for(let T=0;T<E.length;++T)E[T]=this.rescale_factor*E[T]}get_resize_output_image_size(E,T){const[S,A]=E.size;let j,U;if(this.do_thumbnail){const{height:W,width:B}=T;j=Math.min(W,B)}else Number.isInteger(T)?(j=T,U=this.config.max_size??j):T!==void 0&&(j=T.shortest_edge,U=T.longest_edge);if(j!==void 0||U!==void 0){const W=j===void 0?1:Math.max(j/S,j/A),B=S*W,ee=A*W,Q=U===void 0?1:Math.min(U/B,U/ee);let Z=Math.floor(Number((B*Q).toFixed(2))),J=Math.floor(Number((ee*Q).toFixed(2)));return this.size_divisibility!==void 0&&([Z,J]=d([Z,J],this.size_divisibility)),[Z,J]}else if(T!==void 0&&T.width!==void 0&&T.height!==void 0){let W=T.width,B=T.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let ee=B/A,Q=W/S;Math.abs(1-Q)<Math.abs(1-ee)?ee=Q:Q=ee,B=c(ee*A,this.config.ensure_multiple_of),W=c(Q*S,this.config.ensure_multiple_of)}return[W,B]}else{if(this.size_divisibility!==void 0)return d([S,A],this.size_divisibility);if(this.min_pixels!==void 0&&this.max_pixels!==void 0){const W=this.config.patch_size*this.config.merge_size;return g(A,S,W,this.min_pixels,this.max_pixels)}else throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(T)}`)}}async resize(E){const[T,S]=this.get_resize_output_image_size(E,this.size);return await E.resize(T,S,{resample:this.resample})}async preprocess(E,{do_normalize:T=null,do_pad:S=null,do_convert_rgb:A=null,do_convert_grayscale:j=null,do_flip_channel_order:U=null}={}){this.do_crop_margin&&(E=await this.crop_margin(E));const[W,B]=E.size;if(A??this.do_convert_rgb?E=E.rgb():j&&(E=E.grayscale()),this.do_resize&&(E=await this.resize(E)),this.do_thumbnail&&(E=await this.thumbnail(E,this.size,this.resample)),this.do_center_crop){let X,ae;Number.isInteger(this.crop_size)?(X=this.crop_size,ae=this.crop_size):(X=this.crop_size.width,ae=this.crop_size.height),E=await E.center_crop(X,ae)}const ee=[E.height,E.width];let Q=Float32Array.from(E.data),Z=[E.height,E.width,E.channels];if(this.do_rescale&&this.rescale(Q),T??this.do_normalize){let X=this.image_mean;Array.isArray(this.image_mean)||(X=new Array(E.channels).fill(X));let ae=this.image_std;if(Array.isArray(this.image_std)||(ae=new Array(E.channels).fill(ae)),X.length!==E.channels||ae.length!==E.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${X.length}) and \`image_std\` (${ae.length}) must match the number of channels in the image (${E.channels}).`);for(let le=0;le<Q.length;le+=E.channels)for(let ne=0;ne<E.channels;++ne)Q[le+ne]=(Q[le+ne]-X[ne])/ae[ne]}if(S??this.do_pad){if(this.pad_size)[Q,Z]=this.pad_image(Q,[E.height,E.width,E.channels],this.pad_size);else if(this.size_divisibility){const[X,ae]=d([Z[1],Z[0]],this.size_divisibility);[Q,Z]=this.pad_image(Q,Z,{width:X,height:ae})}}if(U??this.do_flip_channel_order){if(Z[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let X=0;X<Q.length;X+=3){const ae=Q[X];Q[X]=Q[X+2],Q[X+2]=ae}}const J=new s.Tensor("float32",Q,Z).permute(2,0,1);return{original_size:[B,W],reshaped_input_size:ee,pixel_values:J}}async _call(E,...T){Array.isArray(E)||(E=[E]);const S=await Promise.all(E.map(j=>this.preprocess(j)));return{pixel_values:(0,s.stack)(S.map(j=>j.pixel_values),0),original_sizes:S.map(j=>j.original_size),reshaped_input_sizes:S.map(j=>j.reshaped_input_size)}}static async from_pretrained(E,T={}){const S=await(0,o.getModelJSON)(E,l.IMAGE_PROCESSOR_NAME,!0,T);return new this(S)}}},"./src/base/processing_utils.js":(e,t,r)=>{r.r(t),r.d(t,{Processor:()=>a});var n=r("./src/utils/constants.js"),s=r("./src/utils/generic.js"),i=r("./src/utils/hub.js");class a extends s.Callable{constructor(l,c,d){super(),this.config=l,this.components=c,this.chat_template=d}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(l,c={}){if(!this.tokenizer)throw new Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(l,{tokenize:!1,chat_template:this.chat_template??void 0,...c})}batch_decode(...l){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...l)}decode(...l){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...l)}async _call(l,...c){for(const d of[this.image_processor,this.feature_extractor,this.tokenizer])if(d)return d(l,...c);throw new Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(l,c={}){const[d,h,u]=await Promise.all([this.uses_processor_config?(0,i.getModelJSON)(l,n.PROCESSOR_NAME,!0,c):{},Promise.all(this.classes.filter(p=>p in this).map(async p=>{const m=await this[p].from_pretrained(l,c);return[p.replace(/_class$/,""),m]})).then(Object.fromEntries),this.uses_chat_template_file?(0,i.getModelText)(l,n.CHAT_TEMPLATE_NAME,!0,c):null]);return new this(d,h,u)}}ie(a,"classes",["image_processor_class","tokenizer_class","feature_extractor_class"]),ie(a,"uses_processor_config",!1),ie(a,"uses_chat_template_file",!1)},"./src/configs.js":(e,t,r)=>{r.r(t),r.d(t,{AutoConfig:()=>d,PretrainedConfig:()=>c,getCacheShapes:()=>o});var n=r("./src/utils/core.js"),s=r("./src/utils/hub.js");async function i(h,u){return await(0,s.getModelJSON)(h,"config.json",!0,u)}function a(h){const u={};let p={};switch(h.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"voxtral":case"smolvlm":case"gemma3n":p=a(h.text_config);break;case"moondream1":p=a(h.phi_config);break;case"musicgen":p=a(h.decoder);break;case"multi_modality":p=a(h.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":u.num_heads="n_head",u.num_layers="n_layer",u.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":case"modernbert-decoder":u.num_heads="num_attention_heads",u.num_layers="num_hidden_layers",u.hidden_size="hidden_size";break;case"llama":case"llama4_text":case"nanochat":case"arcee":case"lfm2":case"smollm3":case"olmo":case"olmo2":case"mobilellm":case"granite":case"granitemoehybrid":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":case"llava_qwen2":u.num_heads="num_key_value_heads",u.num_layers="num_hidden_layers",u.hidden_size="hidden_size",u.num_attention_heads="num_attention_heads",u.dim_kv="head_dim";break;case"qwen3":case"gemma":case"gemma2":case"vaultgemma":case"gemma3_text":case"gemma3n_text":case"glm":case"helium":case"ernie4_5":u.num_heads="num_key_value_heads",u.num_layers="num_hidden_layers",u.dim_kv="head_dim";break;case"openelm":u.num_heads="num_kv_heads",u.num_layers="num_transformer_layers",u.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":u.num_heads="num_heads",u.num_layers="num_layers",u.hidden_size="hidden_size";break;case"bloom":u.num_heads="n_head",u.num_layers="n_layer",u.hidden_size="hidden_size";break;case"mpt":u.num_heads="n_heads",u.num_layers="n_layers",u.hidden_size="d_model";break;case"exaone":u.num_heads="num_key_value_heads",u.num_layers="num_layers",u.dim_kv="head_dim",u.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":u.num_decoder_layers="num_decoder_layers",u.num_decoder_heads="num_heads",u.decoder_dim_kv="d_kv",u.num_encoder_layers="num_layers",u.num_encoder_heads="num_heads",u.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":u.num_decoder_layers="decoder_layers",u.num_decoder_heads="decoder_attention_heads",u.decoder_hidden_size="d_model",u.num_encoder_layers="encoder_layers",u.num_encoder_heads="encoder_attention_heads",u.encoder_hidden_size="d_model";break;case"speecht5":u.num_decoder_layers="decoder_layers",u.num_decoder_heads="decoder_attention_heads",u.decoder_hidden_size="hidden_size",u.num_encoder_layers="encoder_layers",u.num_encoder_heads="encoder_attention_heads",u.encoder_hidden_size="hidden_size";break;case"trocr":u.num_encoder_layers=u.num_decoder_layers="decoder_layers",u.num_encoder_heads=u.num_decoder_heads="decoder_attention_heads",u.encoder_hidden_size=u.decoder_hidden_size="d_model";break;case"musicgen_decoder":u.num_encoder_layers=u.num_decoder_layers="num_hidden_layers",u.num_encoder_heads=u.num_decoder_heads="num_attention_heads",u.encoder_hidden_size=u.decoder_hidden_size="hidden_size";break;case"moonshine":u.num_decoder_layers="decoder_num_hidden_layers",u.num_decoder_heads="decoder_num_key_value_heads",u.num_encoder_layers="encoder_num_hidden_layers",u.num_encoder_heads="encoder_num_key_value_heads",u.encoder_hidden_size=u.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":const y=a(h.decoder),P="num_decoder_layers"in y,g=(0,n.pick)(h,["model_type","is_encoder_decoder"]);return P?(g.num_decoder_layers=y.num_decoder_layers,g.num_decoder_heads=y.num_decoder_heads,g.decoder_hidden_size=y.decoder_hidden_size,g.num_encoder_layers=y.num_encoder_layers,g.num_encoder_heads=y.num_encoder_heads,g.encoder_hidden_size=y.encoder_hidden_size):(g.num_layers=y.num_layers,g.num_heads=y.num_heads,g.hidden_size=y.hidden_size),g}const m={...p,...(0,n.pick)(h,["model_type","multi_query","is_encoder_decoder"])};for(const y in u)m[y]=h[u[y]];return m}function o(h,u){if(h.model_type==="lfm2"){const p=(u==null?void 0:u.prefix)??"past_key_values",m=p==="present"?"present":"past",y={},{layer_types:P,num_attention_heads:g,num_key_value_heads:_,hidden_size:b,conv_L_cache:w}=h,M=b/g,E=(u==null?void 0:u.batch_size)??1;for(let T=0;T<P.length;++T)if(P[T]==="full_attention")for(const S of["key","value"])y[`${p}.${T}.${S}`]=[E,_,0,M];else if(P[T]==="conv")y[`${m}_conv.${T}`]=[E,b,w];else throw new Error(`Unsupported layer type: ${P[T]}`);return y}return l(h,u)}function l(h,{prefix:u="past_key_values",batch_size:p=1}={}){const m={},y=h.normalized_config;if(y.is_encoder_decoder&&"num_encoder_heads"in y&&"num_decoder_heads"in y){const P=y.encoder_dim_kv??y.encoder_hidden_size/y.num_encoder_heads,g=y.decoder_dim_kv??y.decoder_hidden_size/y.num_decoder_heads,_=[p,y.num_encoder_heads,0,P],b=[p,y.num_decoder_heads,0,g];for(let w=0;w<y.num_decoder_layers;++w)m[`${u}.${w}.encoder.key`]=_,m[`${u}.${w}.encoder.value`]=_,m[`${u}.${w}.decoder.key`]=b,m[`${u}.${w}.decoder.value`]=b}else{const P=y.num_heads,g=y.num_layers,_=y.dim_kv??y.hidden_size/(y.num_attention_heads??P);if(y.model_type==="falcon"){const b=[p*P,0,_];for(let w=0;w<g;++w)m[`${u}.${w}.key`]=b,m[`${u}.${w}.value`]=b}else if(y.multi_query){const b=[p*P,0,2*_];for(let w=0;w<g;++w)m[`${u}.${w}.key_value`]=b}else if(y.model_type==="bloom"){const b=[p*P,_,0],w=[p*P,0,_];for(let M=0;M<g;++M)m[`${u}.${M}.key`]=b,m[`${u}.${M}.value`]=w}else if(y.model_type==="openelm")for(let b=0;b<g;++b){const w=[p,P[b],0,_];m[`${u}.${b}.key`]=w,m[`${u}.${b}.value`]=w}else{const b=[p,P,0,_];for(let w=0;w<g;++w)m[`${u}.${w}.key`]=b,m[`${u}.${w}.value`]=b}}return m}class c{constructor(u){ie(this,"model_type",null);ie(this,"is_encoder_decoder",!1);ie(this,"max_position_embeddings");ie(this,"transformers.js_config");Object.assign(this,u),this.normalized_config=a(this)}static async from_pretrained(u,{progress_callback:p=null,config:m=null,cache_dir:y=null,local_files_only:P=!1,revision:g="main"}={}){m&&!(m instanceof c)&&(m=new c(m));const _=m??await i(u,{progress_callback:p,config:m,cache_dir:y,local_files_only:P,revision:g});return new this(_)}}class d{static async from_pretrained(...u){return c.from_pretrained(...u)}}},"./src/env.js":(e,t,r)=>{var A,j;r.r(t),r.d(t,{apis:()=>g,env:()=>T});var n=r("?db59"),s=r("?383f"),i=r("?fa4b");const a="3.8.0",o=typeof window<"u"&&typeof window.document<"u",l=typeof self<"u"&&["DedicatedWorkerGlobalScope","ServiceWorkerGlobalScope","SharedWorkerGlobalScope"].includes((A=self.constructor)==null?void 0:A.name),c=typeof self<"u"&&"caches"in self,d=typeof navigator<"u"&&"gpu"in navigator,h=typeof navigator<"u"&&"ml"in navigator,u=typeof process<"u",p=u&&((j=process==null?void 0:process.release)==null?void 0:j.name)==="node",m=!S(n),y=!S(s),P=typeof globalThis.Deno<"u",g=Object.freeze({IS_BROWSER_ENV:o,IS_WEBWORKER_ENV:l,IS_WEB_CACHE_AVAILABLE:c,IS_WEBGPU_AVAILABLE:d,IS_WEBNN_AVAILABLE:h,IS_PROCESS_AVAILABLE:u,IS_NODE_ENV:p,IS_FS_AVAILABLE:m,IS_PATH_AVAILABLE:y}),_=m&&y;let b="./";if(_){const U=Object(import.meta).url;U?b=s.dirname(s.dirname(i.fileURLToPath(U))):typeof __dirname<"u"&&(b=s.dirname(__dirname))}const w=_?s.join(b,"/.cache/"):null,M="/models/",E=_?s.join(b,M):M,T={version:a,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(o||l),localModelPath:E,useFS:m,useBrowserCache:c&&!P,useFSCache:m,cacheDir:w,useCustomCache:!1,customCache:null};function S(U){return Object.keys(U).length===0}},"./src/generation/configuration_utils.js":(e,t,r)=>{r.r(t),r.d(t,{GenerationConfig:()=>s});var n=r("./src/utils/core.js");class s{constructor(a){ie(this,"max_length",20);ie(this,"max_new_tokens",null);ie(this,"min_length",0);ie(this,"min_new_tokens",null);ie(this,"early_stopping",!1);ie(this,"max_time",null);ie(this,"do_sample",!1);ie(this,"num_beams",1);ie(this,"num_beam_groups",1);ie(this,"penalty_alpha",null);ie(this,"use_cache",!0);ie(this,"temperature",1);ie(this,"top_k",50);ie(this,"top_p",1);ie(this,"typical_p",1);ie(this,"epsilon_cutoff",0);ie(this,"eta_cutoff",0);ie(this,"diversity_penalty",0);ie(this,"repetition_penalty",1);ie(this,"encoder_repetition_penalty",1);ie(this,"length_penalty",1);ie(this,"no_repeat_ngram_size",0);ie(this,"bad_words_ids",null);ie(this,"force_words_ids",null);ie(this,"renormalize_logits",!1);ie(this,"constraints",null);ie(this,"forced_bos_token_id",null);ie(this,"forced_eos_token_id",null);ie(this,"remove_invalid_values",!1);ie(this,"exponential_decay_length_penalty",null);ie(this,"suppress_tokens",null);ie(this,"streamer",null);ie(this,"begin_suppress_tokens",null);ie(this,"forced_decoder_ids",null);ie(this,"guidance_scale",null);ie(this,"num_return_sequences",1);ie(this,"output_attentions",!1);ie(this,"output_hidden_states",!1);ie(this,"output_scores",!1);ie(this,"return_dict_in_generate",!1);ie(this,"pad_token_id",null);ie(this,"bos_token_id",null);ie(this,"eos_token_id",null);ie(this,"encoder_no_repeat_ngram_size",0);ie(this,"decoder_start_token_id",null);ie(this,"generation_kwargs",{});Object.assign(this,(0,n.pick)(a,Object.getOwnPropertyNames(this)))}}},"./src/generation/logits_process.js":(e,t,r)=>{r.r(t),r.d(t,{ClassifierFreeGuidanceLogitsProcessor:()=>g,ForcedBOSTokenLogitsProcessor:()=>l,ForcedEOSTokenLogitsProcessor:()=>c,LogitsProcessor:()=>i,LogitsProcessorList:()=>o,LogitsWarper:()=>a,MinLengthLogitsProcessor:()=>m,MinNewTokensLengthLogitsProcessor:()=>y,NoBadWordsLogitsProcessor:()=>P,NoRepeatNGramLogitsProcessor:()=>u,RepetitionPenaltyLogitsProcessor:()=>p,SuppressTokensAtBeginLogitsProcessor:()=>d,TemperatureLogitsWarper:()=>_,TopKLogitsWarper:()=>w,TopPLogitsWarper:()=>b,WhisperTimeStampLogitsProcessor:()=>h});var n=r("./src/utils/generic.js");r("./src/utils/tensor.js");var s=r("./src/utils/maths.js");class i extends n.Callable{_call(E,T){throw Error("`_call` should be implemented in a subclass")}}class a extends n.Callable{_call(E,T){throw Error("`_call` should be implemented in a subclass")}}class o extends n.Callable{constructor(){super(),this.processors=[]}push(E){this.processors.push(E)}extend(E){this.processors.push(...E)}_call(E,T){let S=T;for(const A of this.processors)S=A(E,S);return S}[Symbol.iterator](){return this.processors.values()}}class l extends i{constructor(E){super(),this.bos_token_id=E}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length===1){const A=T[S].data;A.fill(-1/0),A[this.bos_token_id]=0}return T}}class c extends i{constructor(E,T){super(),this.max_length=E,this.eos_token_id=Array.isArray(T)?T:[T]}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length===this.max_length-1){const A=T[S].data;A.fill(-1/0);for(const j of this.eos_token_id)A[j]=0}return T}}class d extends i{constructor(E,T){super(),this.begin_suppress_tokens=E,this.begin_index=T}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length===this.begin_index){const A=T[S].data;for(const j of this.begin_suppress_tokens)A[j]=-1/0}return T}}class h extends i{constructor(E,T){super(),this.eos_token_id=Array.isArray(E.eos_token_id)?E.eos_token_id[0]:E.eos_token_id,this.no_timestamps_token_id=E.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=T.length,T.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=E.max_initial_timestamp_index}_call(E,T){for(let S=0;S<E.length;++S){const A=T[S].data;if(A[this.no_timestamps_token_id]=-1/0,E[S].length===this.begin_index-1){A.fill(-1/0),A[this.timestamp_begin]=0;continue}const j=E[S].slice(this.begin_index),U=j.length>=1&&j[j.length-1]>=this.timestamp_begin,W=j.length<2||j[j.length-2]>=this.timestamp_begin;if(U&&(W?A.subarray(this.timestamp_begin).fill(-1/0):A.subarray(0,this.eos_token_id).fill(-1/0)),E[S].length===this.begin_index&&this.max_initial_timestamp_index!==null){const Z=this.timestamp_begin+this.max_initial_timestamp_index;A.subarray(Z+1).fill(-1/0)}const B=(0,s.log_softmax)(A),ee=Math.log(B.subarray(this.timestamp_begin).map(Math.exp).reduce((Z,J)=>Z+J)),Q=(0,s.max)(B.subarray(0,this.timestamp_begin))[0];ee>Q&&A.subarray(0,this.timestamp_begin).fill(-1/0)}return T}}class u extends i{constructor(E){super(),this.no_repeat_ngram_size=E}getNgrams(E){const T=E.length,S=[];for(let j=0;j<T+1-this.no_repeat_ngram_size;++j){const U=[];for(let W=0;W<this.no_repeat_ngram_size;++W)U.push(E[j+W]);S.push(U.map(Number))}const A=new Map;for(const j of S){const U=j.slice(0,j.length-1),W=JSON.stringify(U),B=A.get(W)??[];B.push(j[j.length-1]),A.set(W,B)}return A}getGeneratedNgrams(E,T){const S=T.slice(T.length+1-this.no_repeat_ngram_size,T.length);return E.get(JSON.stringify(S.map(Number)))??[]}calcBannedNgramTokens(E){const T=[];if(E.length+1<this.no_repeat_ngram_size)return T;{const S=this.getNgrams(E);return this.getGeneratedNgrams(S,E)}}_call(E,T){for(let S=0;S<E.length;++S){const A=T[S].data,j=this.calcBannedNgramTokens(E[S]);for(const U of j)A[U]=-1/0}return T}}class p extends i{constructor(E){super(),this.penalty=E}_call(E,T){for(let S=0;S<E.length;++S){const A=T[S].data;for(const j of new Set(E[S])){const U=Number(j);A[U]<0?A[U]*=this.penalty:A[U]/=this.penalty}}return T}}class m extends i{constructor(E,T){super(),this.min_length=E,this.eos_token_id=Array.isArray(T)?T:[T]}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length<this.min_length){const A=T[S].data;for(const j of this.eos_token_id)A[j]=-1/0}return T}}class y extends i{constructor(E,T,S){super(),this.prompt_length_to_skip=E,this.min_new_tokens=T,this.eos_token_id=Array.isArray(S)?S:[S]}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length-this.prompt_length_to_skip<this.min_new_tokens){const j=T[S].data;for(const U of this.eos_token_id)j[U]=-1/0}return T}}class P extends i{constructor(E,T){super(),this.bad_words_ids=E,this.eos_token_id=Array.isArray(T)?T:[T]}_call(E,T){for(let S=0;S<E.length;++S){const A=T[S].data,j=E[S];for(const U of this.bad_words_ids){if(j.length<U.length-1)continue;let W=!0;for(let B=1;B<=U.length-1;++B)if(U.at(-B-1)!=j.at(-B)){W=!1;break}W&&(A[U.at(-1)]=-1/0)}}return T}}class g extends i{constructor(E){if(super(),E<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${E}.`);this.guidance_scale=E}_call(E,T){if(T.dims[0]!==2*E.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${T.dims[0]} for the logits and ${E.length} for the input ids.`);const S=E.length,A=T.slice([0,S],null),j=T.slice([S,T.dims[0]],null);for(let U=0;U<j.data.length;++U)j.data[U]+=(A.data[U]-j.data[U])*this.guidance_scale;return j}}class _ extends a{constructor(E){super(),this.temperature=E}_call(E,T){const S=T.data;for(let A=0;A<S.length;++A)S[A]/=this.temperature;return T}}class b extends a{constructor(E,{filter_value:T=-1/0,min_tokens_to_keep:S=1}={}){if(super(),E<0||E>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${E}`);if(!Number.isInteger(S)||S<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${S}`);this.top_p=E,this.filter_value=T,this.min_tokens_to_keep=S}}class w extends a{constructor(E,{filter_value:T=-1/0,min_tokens_to_keep:S=1}={}){if(super(),!Number.isInteger(E)||E<0)throw new Error(`\`top_k\` must be a positive integer, but is ${E}`);this.top_k=Math.max(E,S),this.filter_value=T}}},"./src/generation/logits_sampler.js":(e,t,r)=>{r.r(t),r.d(t,{LogitsSampler:()=>a});var n=r("./src/utils/generic.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/maths.js");r("./src/generation/configuration_utils.js");class a extends n.Callable{constructor(h){super(),this.generation_config=h}async _call(h){return this.sample(h)}async sample(h){throw Error("sample should be implemented in subclasses.")}getLogits(h,u){let p=h.dims.at(-1),m=h.data;if(u===-1)m=m.slice(-p);else{let y=u*p;m=m.slice(y,y+p)}return m}randomSelect(h){let u=0;for(let m=0;m<h.length;++m)u+=h[m];let p=Math.random()*u;for(let m=0;m<h.length;++m)if(p-=h[m],p<=0)return m;return 0}static getSampler(h){if(h.do_sample)return new l(h);if(h.num_beams>1)return new c(h);if(h.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${h.num_return_sequences}.`);return new o(h)}}class o extends a{async sample(h){const u=(0,i.max)(h.data)[1];return[[BigInt(u),0]]}}class l extends a{async sample(h){let u=h.dims.at(-1);this.generation_config.top_k>0&&(u=Math.min(this.generation_config.top_k,u));const[p,m]=await(0,s.topk)(h,u),y=(0,i.softmax)(p.data);return Array.from({length:this.generation_config.num_beams},()=>{const P=this.randomSelect(y);return[m.data[P],Math.log(y[P])]})}}class c extends a{async sample(h){let u=h.dims.at(-1);this.generation_config.top_k>0&&(u=Math.min(this.generation_config.top_k,u));const[p,m]=await(0,s.topk)(h,u),y=(0,i.softmax)(p.data);return Array.from({length:this.generation_config.num_beams},(P,g)=>[m.data[g],Math.log(y[g])])}}},"./src/generation/stopping_criteria.js":(e,t,r)=>{r.r(t),r.d(t,{EosTokenCriteria:()=>o,InterruptableStoppingCriteria:()=>l,MaxLengthCriteria:()=>a,StoppingCriteria:()=>s,StoppingCriteriaList:()=>i});var n=r("./src/utils/generic.js");class s extends n.Callable{_call(d,h){throw Error("StoppingCriteria needs to be subclassed")}}class i extends n.Callable{constructor(){super(),this.criteria=[]}push(d){this.criteria.push(d)}extend(d){d instanceof i?d=d.criteria:d instanceof s&&(d=[d]),this.criteria.push(...d)}_call(d,h){const u=new Array(d.length).fill(!1);for(const p of this.criteria){const m=p(d,h);for(let y=0;y<u.length;++y)u[y]||(u[y]=m[y])}return u}[Symbol.iterator](){return this.criteria.values()}}class a extends s{constructor(d,h=null){super(),this.max_length=d,this.max_position_embeddings=h}_call(d){return d.map(h=>h.length>=this.max_length)}}class o extends s{constructor(d){super(),Array.isArray(d)||(d=[d]),this.eos_token_id=d}_call(d,h){return d.map(u=>{const p=u.at(-1);return this.eos_token_id.some(m=>p==m)})}}class l extends s{constructor(){super(),this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(d,h){return new Array(d.length).fill(this.interrupted)}}},"./src/generation/streamers.js":(e,t,r)=>{r.r(t),r.d(t,{BaseStreamer:()=>a,TextStreamer:()=>l,WhisperTextStreamer:()=>c});var n=r("./src/utils/core.js"),s=r("./src/tokenizers.js"),i=r("./src/env.js");class a{put(h){throw Error("Not implemented")}end(){throw Error("Not implemented")}}const o=i.apis.IS_PROCESS_AVAILABLE?d=>process.stdout.write(d):d=>console.log(d);class l extends a{constructor(h,{skip_prompt:u=!1,callback_function:p=null,token_callback_function:m=null,skip_special_tokens:y=!0,decode_kwargs:P={},...g}={}){super(),this.tokenizer=h,this.skip_prompt=u,this.callback_function=p??o,this.token_callback_function=m,this.decode_kwargs={skip_special_tokens:y,...P,...g},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(h){var P;if(h.length>1)throw Error("TextStreamer only supports batch size of 1");const u=this.next_tokens_are_prompt;if(u&&(this.next_tokens_are_prompt=!1,this.skip_prompt))return;const p=h[0];(P=this.token_callback_function)==null||P.call(this,p),this.token_cache=(0,n.mergeArrays)(this.token_cache,p);const m=this.tokenizer.decode(this.token_cache,this.decode_kwargs);let y;u||m.endsWith(`
`)?(y=m.slice(this.print_len),this.token_cache=[],this.print_len=0):m.length>0&&(0,s.is_chinese_char)(m.charCodeAt(m.length-1))?(y=m.slice(this.print_len),this.print_len+=y.length):(y=m.slice(this.print_len,m.lastIndexOf(" ")+1),this.print_len+=y.length),this.on_finalized_text(y,!1)}end(){let h;this.token_cache.length>0?(h=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0):h="",this.next_tokens_are_prompt=!0,this.on_finalized_text(h,!0)}on_finalized_text(h,u){var p,m;h.length>0&&((p=this.callback_function)==null||p.call(this,h)),u&&this.callback_function===o&&i.apis.IS_PROCESS_AVAILABLE&&((m=this.callback_function)==null||m.call(this,`
`))}}class c extends l{constructor(h,{skip_prompt:u=!1,callback_function:p=null,token_callback_function:m=null,on_chunk_start:y=null,on_chunk_end:P=null,on_finalize:g=null,time_precision:_=.02,skip_special_tokens:b=!0,decode_kwargs:w={}}={}){super(h,{skip_prompt:u,skip_special_tokens:b,callback_function:p,token_callback_function:m,decode_kwargs:w}),this.timestamp_begin=h.timestamp_begin,this.on_chunk_start=y,this.on_chunk_end=P,this.on_finalize=g,this.time_precision=_,this.waiting_for_timestamp=!1}put(h){var p,m,y;if(h.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");const u=h[0];if(u.length===1){const P=Number(u[0])-this.timestamp_begin;if(P>=0){const g=P*this.time_precision;this.waiting_for_timestamp?(p=this.on_chunk_end)==null||p.call(this,g):(m=this.on_chunk_start)==null||m.call(this,g),this.waiting_for_timestamp=!this.waiting_for_timestamp,(y=this.token_callback_function)==null||y.call(this,u);return}}return super.put(h)}end(){var h;super.end(),(h=this.on_finalize)==null||h.call(this)}}},"./src/models.js":(e,t,r)=>{r.r(t),r.d(t,{ASTForAudioClassification:()=>rd,ASTModel:()=>td,ASTPreTrainedModel:()=>No,AlbertForMaskedLM:()=>tt,AlbertForQuestionAnswering:()=>it,AlbertForSequenceClassification:()=>Xe,AlbertModel:()=>De,AlbertPreTrainedModel:()=>ge,ArceeForCausalLM:()=>Ii,ArceeModel:()=>rn,ArceePreTrainedModel:()=>er,AutoModel:()=>bm,AutoModelForAudioClassification:()=>eT,AutoModelForAudioFrameClassification:()=>rT,AutoModelForAudioTextToText:()=>dT,AutoModelForCTC:()=>ZM,AutoModelForCausalLM:()=>UM,AutoModelForDepthEstimation:()=>aT,AutoModelForDocumentQuestionAnswering:()=>nT,AutoModelForImageClassification:()=>qM,AutoModelForImageFeatureExtraction:()=>cT,AutoModelForImageMatting:()=>sT,AutoModelForImageSegmentation:()=>KM,AutoModelForImageTextToText:()=>uT,AutoModelForImageToImage:()=>iT,AutoModelForMaskGeneration:()=>YM,AutoModelForMaskedLM:()=>VM,AutoModelForNormalEstimation:()=>oT,AutoModelForObjectDetection:()=>XM,AutoModelForPoseEstimation:()=>lT,AutoModelForQuestionAnswering:()=>WM,AutoModelForSemanticSegmentation:()=>HM,AutoModelForSeq2SeqLM:()=>LM,AutoModelForSequenceClassification:()=>DM,AutoModelForSpeechSeq2Seq:()=>RM,AutoModelForTextToSpectrogram:()=>zM,AutoModelForTextToWaveform:()=>BM,AutoModelForTokenClassification:()=>FM,AutoModelForUniversalSegmentation:()=>QM,AutoModelForVision2Seq:()=>GM,AutoModelForXVector:()=>tT,AutoModelForZeroShotObjectDetection:()=>JM,BartForConditionalGeneration:()=>Ws,BartForSequenceClassification:()=>mr,BartModel:()=>en,BartPretrainedModel:()=>Un,BaseModelOutput:()=>Ee,BeitForImageClassification:()=>ix,BeitModel:()=>sx,BeitPreTrainedModel:()=>Dp,BertForMaskedLM:()=>ve,BertForQuestionAnswering:()=>je,BertForSequenceClassification:()=>xe,BertForTokenClassification:()=>_e,BertModel:()=>me,BertPreTrainedModel:()=>fe,BlenderbotForConditionalGeneration:()=>Lr,BlenderbotModel:()=>tn,BlenderbotPreTrainedModel:()=>jn,BlenderbotSmallForConditionalGeneration:()=>On,BlenderbotSmallModel:()=>Gr,BlenderbotSmallPreTrainedModel:()=>vr,BloomForCausalLM:()=>kv,BloomModel:()=>Pv,BloomPreTrainedModel:()=>Tp,CLIPModel:()=>Ro,CLIPPreTrainedModel:()=>Gs,CLIPSegForImageSegmentation:()=>Ba,CLIPSegModel:()=>ls,CLIPSegPreTrainedModel:()=>Zi,CLIPTextModel:()=>pd,CLIPTextModelWithProjection:()=>nc,CLIPVisionModel:()=>md,CLIPVisionModelWithProjection:()=>sc,CamembertForMaskedLM:()=>kt,CamembertForQuestionAnswering:()=>ot,CamembertForSequenceClassification:()=>xt,CamembertForTokenClassification:()=>jt,CamembertModel:()=>ct,CamembertPreTrainedModel:()=>Re,CausalLMOutput:()=>ta,CausalLMOutputWithPast:()=>L3,ChineseCLIPModel:()=>za,ChineseCLIPPreTrainedModel:()=>oc,ClapAudioModelWithProjection:()=>y1,ClapModel:()=>g1,ClapPreTrainedModel:()=>Ed,ClapTextModelWithProjection:()=>_1,CodeGenForCausalLM:()=>z,CodeGenModel:()=>D,CodeGenPreTrainedModel:()=>C,CohereForCausalLM:()=>iv,CohereModel:()=>sv,CoherePreTrainedModel:()=>pp,ConvBertForMaskedLM:()=>Et,ConvBertForQuestionAnswering:()=>or,ConvBertForSequenceClassification:()=>pi,ConvBertForTokenClassification:()=>zt,ConvBertModel:()=>ki,ConvBertPreTrainedModel:()=>bs,ConvNextForImageClassification:()=>Zx,ConvNextModel:()=>Yx,ConvNextPreTrainedModel:()=>Jp,ConvNextV2ForImageClassification:()=>tb,ConvNextV2Model:()=>eb,ConvNextV2PreTrainedModel:()=>Yp,DFineForObjectDetection:()=>yx,DFineModel:()=>_x,DFinePreTrainedModel:()=>Up,DINOv3ConvNextModel:()=>cb,DINOv3ConvNextPreTrainedModel:()=>lb,DINOv3ViTModel:()=>ob,DINOv3ViTPreTrainedModel:()=>ab,DPTForDepthEstimation:()=>Ox,DPTModel:()=>jx,DPTPreTrainedModel:()=>Hp,DacDecoderModel:()=>aM,DacDecoderOutput:()=>nM,DacEncoderModel:()=>iM,DacEncoderOutput:()=>rM,DacModel:()=>sM,DacPreTrainedModel:()=>Ad,DebertaForMaskedLM:()=>In,DebertaForQuestionAnswering:()=>Xr,DebertaForSequenceClassification:()=>Bn,DebertaForTokenClassification:()=>Nr,DebertaModel:()=>ar,DebertaPreTrainedModel:()=>Wt,DebertaV2ForMaskedLM:()=>Ts,DebertaV2ForQuestionAnswering:()=>gi,DebertaV2ForSequenceClassification:()=>dn,DebertaV2ForTokenClassification:()=>mi,DebertaV2Model:()=>Ms,DebertaV2PreTrainedModel:()=>Dr,DecisionTransformerModel:()=>R1,DecisionTransformerPreTrainedModel:()=>L1,DeiTForImageClassification:()=>Mx,DeiTModel:()=>bx,DeiTPreTrainedModel:()=>Wp,DepthAnythingForDepthEstimation:()=>Dx,DepthAnythingPreTrainedModel:()=>Nx,DepthProForDepthEstimation:()=>Bx,DepthProPreTrainedModel:()=>zx,DetrForObjectDetection:()=>ox,DetrForSegmentation:()=>Fp,DetrModel:()=>ax,DetrObjectDetectionOutput:()=>Lp,DetrPreTrainedModel:()=>yd,DetrSegmentationOutput:()=>lx,Dinov2ForImageClassification:()=>nb,Dinov2Model:()=>rb,Dinov2PreTrainedModel:()=>Zp,Dinov2WithRegistersForImageClassification:()=>ib,Dinov2WithRegistersModel:()=>sb,Dinov2WithRegistersPreTrainedModel:()=>em,DistilBertForMaskedLM:()=>Wr,DistilBertForQuestionAnswering:()=>Ps,DistilBertForSequenceClassification:()=>Xn,DistilBertForTokenClassification:()=>En,DistilBertModel:()=>Es,DistilBertPreTrainedModel:()=>Zr,DonutSwinModel:()=>Jx,DonutSwinPreTrainedModel:()=>Xx,EdgeTamModel:()=>vb,EfficientNetForImageClassification:()=>E1,EfficientNetModel:()=>T1,EfficientNetPreTrainedModel:()=>hm,ElectraForMaskedLM:()=>V,ElectraForQuestionAnswering:()=>Se,ElectraForSequenceClassification:()=>Y,ElectraForTokenClassification:()=>ce,ElectraModel:()=>re,ElectraPreTrainedModel:()=>I,Ernie4_5_ForCausalLM:()=>d1,Ernie4_5_Model:()=>u1,Ernie4_5_PretrainedModel:()=>om,EsmForMaskedLM:()=>Si,EsmForSequenceClassification:()=>An,EsmForTokenClassification:()=>He,EsmModel:()=>ks,EsmPreTrainedModel:()=>$r,ExaoneForCausalLM:()=>Kw,ExaoneModel:()=>qw,ExaonePreTrainedModel:()=>lp,FalconForCausalLM:()=>m1,FalconModel:()=>p1,FalconPreTrainedModel:()=>cm,FastViTForImageClassification:()=>Kv,FastViTModel:()=>qv,FastViTPreTrainedModel:()=>Ip,Florence2ForConditionalGeneration:()=>ld,Florence2PreTrainedModel:()=>od,GLPNForDepthEstimation:()=>Qx,GLPNModel:()=>Hx,GLPNPreTrainedModel:()=>Xp,GPT2LMHeadModel:()=>dc,GPT2Model:()=>uc,GPT2PreTrainedModel:()=>Ua,GPTBigCodeForCausalLM:()=>v,GPTBigCodeModel:()=>_c,GPTBigCodePreTrainedModel:()=>qo,GPTJForCausalLM:()=>gc,GPTJModel:()=>mc,GPTJPreTrainedModel:()=>Go,GPTNeoForCausalLM:()=>Va,GPTNeoModel:()=>fc,GPTNeoPreTrainedModel:()=>Vo,GPTNeoXForCausalLM:()=>pc,GPTNeoXModel:()=>Wo,GPTNeoXPreTrainedModel:()=>Wa,Gemma2ForCausalLM:()=>cv,Gemma2Model:()=>lv,Gemma2PreTrainedModel:()=>gp,Gemma3ForCausalLM:()=>fv,Gemma3Model:()=>hv,Gemma3PreTrainedModel:()=>yp,Gemma3nForConditionalGeneration:()=>tc,Gemma3nPreTrainedModel:()=>hd,GemmaForCausalLM:()=>ov,GemmaModel:()=>av,GemmaPreTrainedModel:()=>mp,GlmForCausalLM:()=>Gw,GlmModel:()=>Ww,GlmPreTrainedModel:()=>op,GraniteForCausalLM:()=>tv,GraniteModel:()=>ev,GraniteMoeHybridForCausalLM:()=>nv,GraniteMoeHybridModel:()=>rv,GraniteMoeHybridPreTrainedModel:()=>fp,GranitePreTrainedModel:()=>hp,GroundingDinoForObjectDetection:()=>db,GroundingDinoPreTrainedModel:()=>ub,GroupViTModel:()=>Gv,GroupViTPreTrainedModel:()=>Wv,HeliumForCausalLM:()=>Vw,HeliumModel:()=>Uw,HeliumPreTrainedModel:()=>ap,HieraForImageClassification:()=>Ex,HieraModel:()=>Tx,HieraPreTrainedModel:()=>Gp,HubertForCTC:()=>Kb,HubertForSequenceClassification:()=>Hb,HubertModel:()=>qb,HubertPreTrainedModel:()=>T3,IJepaForImageClassification:()=>Nv,IJepaModel:()=>Ov,IJepaPreTrainedModel:()=>Sp,Idefics3ForConditionalGeneration:()=>_i,Idefics3PreTrainedModel:()=>Ra,ImageMattingOutput:()=>fT,JAISLMHeadModel:()=>hc,JAISModel:()=>Uo,JAISPreTrainedModel:()=>Bo,JinaCLIPModel:()=>_d,JinaCLIPPreTrainedModel:()=>gt,JinaCLIPTextModel:()=>lc,JinaCLIPVisionModel:()=>cc,Lfm2ForCausalLM:()=>Rw,Lfm2Model:()=>Lw,Lfm2PreTrainedModel:()=>yc,LiteWhisperForConditionalGeneration:()=>nd,Llama4ForCausalLM:()=>nt,Llama4PreTrainedModel:()=>Ge,LlamaForCausalLM:()=>Ne,LlamaModel:()=>pe,LlamaPreTrainedModel:()=>K,LlavaForConditionalGeneration:()=>La,LlavaOnevisionForConditionalGeneration:()=>id,LlavaPreTrainedModel:()=>Fa,LlavaQwen2ForCausalLM:()=>dd,LongT5ForConditionalGeneration:()=>sr,LongT5Model:()=>Ir,LongT5PreTrainedModel:()=>Xt,M2M100ForConditionalGeneration:()=>Eb,M2M100Model:()=>Tb,M2M100PreTrainedModel:()=>nm,MBartForCausalLM:()=>vn,MBartForConditionalGeneration:()=>Ss,MBartForSequenceClassification:()=>Cs,MBartModel:()=>wn,MBartPreTrainedModel:()=>Fr,MPNetForMaskedLM:()=>ja,MPNetForQuestionAnswering:()=>Da,MPNetForSequenceClassification:()=>Oa,MPNetForTokenClassification:()=>Na,MPNetModel:()=>Aa,MPNetPreTrainedModel:()=>os,MT5ForConditionalGeneration:()=>kr,MT5Model:()=>Ar,MT5PreTrainedModel:()=>Pr,MarianMTModel:()=>Mb,MarianModel:()=>bb,MarianPreTrainedModel:()=>rm,MaskFormerForInstanceSegmentation:()=>Kx,MaskFormerModel:()=>qx,MaskFormerPreTrainedModel:()=>Qp,MaskedLMOutput:()=>hn,Metric3DForDepthEstimation:()=>Vx,Metric3DPreTrainedModel:()=>Ux,Metric3Dv2ForDepthEstimation:()=>Gx,Metric3Dv2PreTrainedModel:()=>Wx,MgpstrForSceneTextRecognition:()=>W1,MgpstrModelOutput:()=>U1,MgpstrPreTrainedModel:()=>V1,MimiDecoderModel:()=>tM,MimiDecoderOutput:()=>Y1,MimiEncoderModel:()=>eM,MimiEncoderOutput:()=>J1,MimiModel:()=>Z1,MimiPreTrainedModel:()=>Id,MistralForCausalLM:()=>c1,MistralModel:()=>l1,MistralPreTrainedModel:()=>am,MobileBertForMaskedLM:()=>lr,MobileBertForQuestionAnswering:()=>Vs,MobileBertForSequenceClassification:()=>Ci,MobileBertModel:()=>lt,MobileBertPreTrainedModel:()=>Qe,MobileLLMForCausalLM:()=>Qw,MobileLLMModel:()=>Hw,MobileLLMPreTrainedModel:()=>cp,MobileNetV1ForImageClassification:()=>k1,MobileNetV1ForSemanticSegmentation:()=>S1,MobileNetV1Model:()=>P1,MobileNetV1PreTrainedModel:()=>kd,MobileNetV2ForImageClassification:()=>$1,MobileNetV2ForSemanticSegmentation:()=>I1,MobileNetV2Model:()=>C1,MobileNetV2PreTrainedModel:()=>Sd,MobileNetV3ForImageClassification:()=>j1,MobileNetV3ForSemanticSegmentation:()=>O1,MobileNetV3Model:()=>A1,MobileNetV3PreTrainedModel:()=>Cd,MobileNetV4ForImageClassification:()=>D1,MobileNetV4ForSemanticSegmentation:()=>F1,MobileNetV4Model:()=>N1,MobileNetV4PreTrainedModel:()=>$d,MobileViTForImageClassification:()=>Jv,MobileViTModel:()=>Xv,MobileViTPreTrainedModel:()=>Ap,MobileViTV2ForImageClassification:()=>Zv,MobileViTV2Model:()=>Yv,MobileViTV2PreTrainedModel:()=>jp,ModelOutput:()=>ue,ModernBertDecoderForCausalLM:()=>yr,ModernBertDecoderModel:()=>ut,ModernBertDecoderPreTrainedModel:()=>wt,ModernBertForMaskedLM:()=>Ke,ModernBertForSequenceClassification:()=>yt,ModernBertForTokenClassification:()=>Ve,ModernBertModel:()=>ze,ModernBertPreTrainedModel:()=>Ye,Moondream1ForConditionalGeneration:()=>ad,MoonshineForConditionalGeneration:()=>sd,MoonshineModel:()=>sp,MoonshinePreTrainedModel:()=>Fo,MptForCausalLM:()=>Cv,MptModel:()=>Sv,MptPreTrainedModel:()=>Ep,MultiModalityCausalLM:()=>B1,MultiModalityPreTrainedModel:()=>z1,MusicgenForCausalLM:()=>S3,MusicgenForConditionalGeneration:()=>pm,MusicgenModel:()=>k3,MusicgenPreTrainedModel:()=>fm,NanoChatForCausalLM:()=>Kt,NanoChatModel:()=>Nt,NanoChatPreTrainedModel:()=>dt,NeoBertForMaskedLM:()=>Me,NeoBertForQuestionAnswering:()=>rt,NeoBertForSequenceClassification:()=>We,NeoBertForTokenClassification:()=>Le,NeoBertModel:()=>Oe,NeoBertPreTrainedModel:()=>we,NomicBertModel:()=>Hr,NomicBertPreTrainedModel:()=>wr,OPTForCausalLM:()=>Iv,OPTModel:()=>$v,OPTPreTrainedModel:()=>Pp,Olmo2ForCausalLM:()=>Zw,Olmo2Model:()=>Yw,Olmo2PreTrainedModel:()=>dp,OlmoForCausalLM:()=>Jw,OlmoModel:()=>Xw,OlmoPreTrainedModel:()=>up,OpenELMForCausalLM:()=>mv,OpenELMModel:()=>pv,OpenELMPreTrainedModel:()=>wp,OwlViTForObjectDetection:()=>tx,OwlViTModel:()=>ex,OwlViTPreTrainedModel:()=>Op,Owlv2ForObjectDetection:()=>nx,Owlv2Model:()=>rx,Owlv2PreTrainedModel:()=>Np,PaliGemmaForConditionalGeneration:()=>ud,PaliGemmaPreTrainedModel:()=>cd,ParakeetForCTC:()=>Ib,ParakeetPreTrainedModel:()=>$b,PatchTSMixerForPrediction:()=>H1,PatchTSMixerModel:()=>K1,PatchTSMixerPreTrainedModel:()=>gm,PatchTSTForPrediction:()=>q1,PatchTSTModel:()=>G1,PatchTSTPreTrainedModel:()=>mm,Phi3ForCausalLM:()=>Ev,Phi3Model:()=>Tv,Phi3PreTrainedModel:()=>Mp,Phi3VForCausalLM:()=>rc,Phi3VPreTrainedModel:()=>fd,PhiForCausalLM:()=>Mv,PhiModel:()=>bv,PhiPreTrainedModel:()=>bp,PreTrainedModel:()=>O,PretrainedMixin:()=>Yt,PvtForImageClassification:()=>Rv,PvtModel:()=>Lv,PvtPreTrainedModel:()=>Cp,PyAnnoteForAudioFrameClassification:()=>jb,PyAnnoteModel:()=>Ab,PyAnnotePreTrainedModel:()=>sm,QuestionAnsweringModelOutput:()=>Pn,Qwen2ForCausalLM:()=>_v,Qwen2Model:()=>gv,Qwen2PreTrainedModel:()=>vp,Qwen2VLForConditionalGeneration:()=>xv,Qwen2VLPreTrainedModel:()=>vv,Qwen3ForCausalLM:()=>wv,Qwen3Model:()=>yv,Qwen3PreTrainedModel:()=>xp,RFDetrForObjectDetection:()=>mx,RFDetrModel:()=>px,RFDetrObjectDetectionOutput:()=>gx,RFDetrPreTrainedModel:()=>Bp,RTDetrForObjectDetection:()=>ux,RTDetrModel:()=>cx,RTDetrObjectDetectionOutput:()=>wc,RTDetrPreTrainedModel:()=>Rp,RTDetrV2ForObjectDetection:()=>hx,RTDetrV2Model:()=>dx,RTDetrV2ObjectDetectionOutput:()=>fx,RTDetrV2PreTrainedModel:()=>zp,ResNetForImageClassification:()=>kx,ResNetModel:()=>Px,ResNetPreTrainedModel:()=>qp,RoFormerForMaskedLM:()=>un,RoFormerForQuestionAnswering:()=>Xi,RoFormerForSequenceClassification:()=>Hi,RoFormerForTokenClassification:()=>Qi,RoFormerModel:()=>Er,RoFormerPreTrainedModel:()=>Qr,RobertaForMaskedLM:()=>Wu,RobertaForQuestionAnswering:()=>qu,RobertaForSequenceClassification:()=>Xl,RobertaForTokenClassification:()=>Gu,RobertaModel:()=>Oo,RobertaPreTrainedModel:()=>$s,Sam2ImageSegmentationOutput:()=>yb,Sam2Model:()=>xd,Sam2PreTrainedModel:()=>wb,Sam3TrackerModel:()=>xb,SamImageSegmentationOutput:()=>_b,SamModel:()=>gb,SamPreTrainedModel:()=>mb,SapiensForDepthEstimation:()=>Lx,SapiensForNormalEstimation:()=>Rx,SapiensForSemanticSegmentation:()=>Fx,SapiensPreTrainedModel:()=>vd,SegformerForImageClassification:()=>v1,SegformerForSemanticSegmentation:()=>x1,SegformerModel:()=>P3,SegformerPreTrainedModel:()=>Pd,Seq2SeqLMOutput:()=>F3,SequenceClassifierOutput:()=>Dt,SiglipModel:()=>ic,SiglipPreTrainedModel:()=>zo,SiglipTextModel:()=>gd,SiglipVisionModel:()=>ac,SmolLM3ForCausalLM:()=>Bw,SmolLM3Model:()=>zw,SmolLM3PreTrainedModel:()=>ip,SmolVLMForConditionalGeneration:()=>Lo,SnacDecoderModel:()=>cM,SnacEncoderModel:()=>lM,SnacModel:()=>oM,SnacPreTrainedModel:()=>jd,SpeechT5ForSpeechToText:()=>r1,SpeechT5ForTextToSpeech:()=>n1,SpeechT5HifiGan:()=>s1,SpeechT5Model:()=>E3,SpeechT5PreTrainedModel:()=>Td,SqueezeBertForMaskedLM:()=>q,SqueezeBertForQuestionAnswering:()=>he,SqueezeBertForSequenceClassification:()=>se,SqueezeBertModel:()=>N,SqueezeBertPreTrainedModel:()=>ye,StableLmForCausalLM:()=>M1,StableLmModel:()=>b1,StableLmPreTrainedModel:()=>dm,Starcoder2ForCausalLM:()=>f1,Starcoder2Model:()=>h1,Starcoder2PreTrainedModel:()=>lm,StyleTextToSpeech2Model:()=>t1,StyleTextToSpeech2PreTrainedModel:()=>e1,SupertonicForConditionalGeneration:()=>im,SupertonicPreTrainedModel:()=>i1,Swin2SRForImageSuperResolution:()=>Ax,Swin2SRModel:()=>Ix,Swin2SRPreTrainedModel:()=>Kp,SwinForImageClassification:()=>Cx,SwinForSemanticSegmentation:()=>$x,SwinModel:()=>Sx,SwinPreTrainedModel:()=>wd,T5ForConditionalGeneration:()=>qt,T5Model:()=>$t,T5PreTrainedModel:()=>at,TableTransformerForObjectDetection:()=>vx,TableTransformerModel:()=>wx,TableTransformerObjectDetectionOutput:()=>xx,TableTransformerPreTrainedModel:()=>Vp,TokenClassifierOutput:()=>nn,TrOCRForCausalLM:()=>o1,TrOCRPreTrainedModel:()=>a1,UltravoxModel:()=>_m,UltravoxPreTrainedModel:()=>Q1,UniSpeechForCTC:()=>Fb,UniSpeechForSequenceClassification:()=>Lb,UniSpeechModel:()=>Db,UniSpeechPreTrainedModel:()=>bd,UniSpeechSatForAudioFrameClassification:()=>Ub,UniSpeechSatForCTC:()=>zb,UniSpeechSatForSequenceClassification:()=>Bb,UniSpeechSatModel:()=>Rb,UniSpeechSatPreTrainedModel:()=>vc,VaultGemmaForCausalLM:()=>dv,VaultGemmaModel:()=>uv,VaultGemmaPreTrainedModel:()=>_p,ViTForImageClassification:()=>jv,ViTMAEModel:()=>Bv,ViTMAEPreTrainedModel:()=>zv,ViTMSNForImageClassification:()=>Vv,ViTMSNModel:()=>Uv,ViTMSNPreTrainedModel:()=>$p,ViTModel:()=>Av,ViTPreTrainedModel:()=>kp,VisionEncoderDecoderModel:()=>ec,VitMatteForImageMatting:()=>Qv,VitMattePreTrainedModel:()=>Hv,VitPoseForPoseEstimation:()=>Fv,VitPosePreTrainedModel:()=>Dv,VitsModel:()=>um,VitsModelOutput:()=>pT,VitsPreTrainedModel:()=>w1,VoxtralForConditionalGeneration:()=>X1,Wav2Vec2BertForCTC:()=>Wb,Wav2Vec2BertForSequenceClassification:()=>Gb,Wav2Vec2BertModel:()=>Vb,Wav2Vec2BertPreTrainedModel:()=>Md,Wav2Vec2ForAudioFrameClassification:()=>Cb,Wav2Vec2ForCTC:()=>kb,Wav2Vec2ForSequenceClassification:()=>Sb,Wav2Vec2Model:()=>Pb,Wav2Vec2PreTrainedModel:()=>ea,WavLMForAudioFrameClassification:()=>Zb,WavLMForCTC:()=>Xb,WavLMForSequenceClassification:()=>Jb,WavLMForXVector:()=>Yb,WavLMModel:()=>Qb,WavLMPreTrainedModel:()=>Ko,WeSpeakerResNetModel:()=>Nb,WeSpeakerResNetPreTrainedModel:()=>Ob,WhisperForConditionalGeneration:()=>$i,WhisperModel:()=>Zl,WhisperPreTrainedModel:()=>Do,XLMForQuestionAnswering:()=>Ju,XLMForSequenceClassification:()=>Qu,XLMForTokenClassification:()=>Xu,XLMModel:()=>Ku,XLMPreTrainedModel:()=>Ji,XLMRobertaForMaskedLM:()=>Zu,XLMRobertaForQuestionAnswering:()=>Yl,XLMRobertaForSequenceClassification:()=>ed,XLMRobertaForTokenClassification:()=>Jl,XLMRobertaModel:()=>Yu,XLMRobertaPreTrainedModel:()=>Yi,XLMWithLMHeadModel:()=>Hu,XVectorOutput:()=>hT,YolosForObjectDetection:()=>fb,YolosModel:()=>hb,YolosObjectDetectionOutput:()=>pb,YolosPreTrainedModel:()=>tm});var n=r("./src/configs.js"),s=r("./src/backends/onnx.js"),i=r("./src/utils/dtypes.js"),a=r("./src/utils/generic.js"),o=r("./src/utils/core.js"),l=r("./src/utils/hub.js"),c=r("./src/utils/constants.js"),d=r("./src/generation/logits_process.js"),h=r("./src/generation/configuration_utils.js"),u=r("./src/utils/tensor.js"),p=r("./src/utils/image.js"),m=r("./src/utils/maths.js"),y=r("./src/generation/stopping_criteria.js"),P=r("./src/generation/logits_sampler.js"),g=r("./src/env.js"),_=r("./src/models/whisper/generation_whisper.js"),b=r("./src/models/whisper/common_whisper.js");const w={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11,ImageAudioTextToText:12,Supertonic:13},M=new Map,E=new Map,T=new Map;async function S(k,$,R){var fn;let de=((fn=R.config)==null?void 0:fn["transformers.js_config"])??{},Pe=R.device??de.device;Pe&&typeof Pe!="string"&&(Pe.hasOwnProperty($)?Pe=Pe[$]:(console.warn(`device not specified for "${$}". Using the default device.`),Pe=null));const be=Pe??(g.apis.IS_NODE_ENV?"cpu":"wasm"),Ie=(0,s.deviceToExecutionProviders)(be),Ue=de.device_config??{};Ue.hasOwnProperty(be)&&(de={...de,...Ue[be]});let Ze=R.dtype??de.dtype;if(typeof Ze!="string"&&(Ze&&Ze.hasOwnProperty($)?Ze=Ze[$]:(Ze=i.DEFAULT_DEVICE_DTYPE_MAPPING[be]??i.DATA_TYPES.fp32,console.warn(`dtype not specified for "${$}". Using the default dtype (${Ze}) for this device (${be}).`))),Ze===i.DATA_TYPES.auto){let Ut=de.dtype;typeof Ut!="string"&&(Ut=Ut==null?void 0:Ut[$]),Ut&&Ut!==i.DATA_TYPES.auto&&i.DATA_TYPES.hasOwnProperty(Ut)?Ze=Ut:Ze=i.DEFAULT_DEVICE_DTYPE_MAPPING[be]??i.DATA_TYPES.fp32}const st=Ze;if(i.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(st)){if(st===i.DATA_TYPES.fp16&&be==="webgpu"&&!await(0,i.isWebGpuFp16Supported)())throw new Error(`The device (${be}) does not support fp16.`)}else throw new Error(`Invalid dtype: ${st}. Should be one of: ${Object.keys(i.DATA_TYPES).join(", ")}`);const vt=de.kv_cache_dtype,Pt=vt?typeof vt=="string"?vt:vt[st]??"float32":void 0;if(Pt&&!["float32","float16"].includes(Pt))throw new Error(`Invalid kv_cache_dtype: ${Pt}. Should be one of: float32, float16`);const It={dtype:st,kv_cache_dtype:Pt,device:be},Vt=i.DEFAULT_DTYPE_SUFFIX_MAPPING[st],bt=`${$}${Vt}.onnx`,Ot=`${R.subfolder??""}/${bt}`,pt={...R.session_options};pt.executionProviders??(pt.executionProviders=Ie);const Bt=de.free_dimension_overrides;Bt?pt.freeDimensionOverrides??(pt.freeDimensionOverrides=Bt):be.startsWith("webnn")&&!pt.freeDimensionOverrides&&console.warn(`WebNN does not currently support dynamic shapes and requires 'free_dimension_overrides' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${be}"]. When 'free_dimension_overrides' is not set, you may experience significant performance degradation.`);const Jt=g.apis.IS_NODE_ENV&&g.env.useFSCache,dr=(0,l.getModelFile)(k,Ot,!0,R,Jt),gr=R.use_external_data_format??de.use_external_data_format;let xr=[];if(gr){let Ut;typeof gr=="object"?gr.hasOwnProperty(bt)?Ut=gr[bt]:gr.hasOwnProperty($)?Ut=gr[$]:Ut=!1:Ut=gr;const sn=+Ut;if(sn>l.MAX_EXTERNAL_DATA_CHUNKS)throw new Error(`The number of external data chunks (${sn}) exceeds the maximum allowed value (${l.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let cs=0;cs<sn;++cs){const Ga=`${bt}_data${cs===0?"":"_"+cs}`,Vn=`${R.subfolder??""}/${Ga}`;xr.push(new Promise(async(Is,Od)=>{const qa=await(0,l.getModelFile)(k,Vn,!0,R,Jt);Is(qa instanceof Uint8Array?{path:Ga,data:qa}:Ga)}))}}else pt.externalData!==void 0&&(xr=pt.externalData.map(async Ut=>{if(typeof Ut.data=="string"){const sn=await(0,l.getModelFile)(k,Ut.data,!0,R);return{...Ut,data:sn}}return Ut}));if(xr.length>0){const Ut=await Promise.all(xr);g.apis.IS_NODE_ENV||(pt.externalData=Ut)}if(be==="webgpu"){const Ut=(0,n.getCacheShapes)(R.config,{prefix:"present"});if(Object.keys(Ut).length>0&&!(0,s.isONNXProxy)()){const sn={};for(const cs in Ut)sn[cs]="gpu-buffer";pt.preferredOutputLocation=sn}}return{buffer_or_path:await dr,session_options:pt,session_config:It}}async function A(k,$,R){return Object.fromEntries(await Promise.all(Object.keys($).map(async de=>{const{buffer_or_path:Pe,session_options:be,session_config:Ie}=await S(k,$[de],R),Ue=await(0,s.createInferenceSession)(Pe,be,Ie);return[de,Ue]})))}async function j(k,$,R){return Object.fromEntries(await Promise.all(Object.keys($).map(async de=>{const Pe=await(0,l.getModelJSON)(k,$[de],!1,R);return[de,Pe]})))}function U(k,$){const R=Object.create(null),de=[];for(const Ie of k.inputNames){const Ue=$[Ie];if(!(Ue instanceof u.Tensor)){de.push(Ie);continue}R[Ie]=(0,s.isONNXProxy)()?Ue.clone():Ue}if(de.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${de.join(", ")}.`);const Pe=Object.keys($).length,be=k.inputNames.length;if(Pe>be){let Ie=Object.keys($).filter(Ue=>!k.inputNames.includes(Ue));console.warn(`WARNING: Too many inputs were provided (${Pe} > ${be}). The following inputs will be ignored: "${Ie.join(", ")}".`)}return R}async function W(k,$){const R=U(k,$);try{const de=Object.fromEntries(Object.entries(R).map(([be,Ie])=>[be,Ie.ort_tensor])),Pe=await(0,s.runInferenceSession)(k,de);return B(Pe)}catch(de){const Pe=Object.fromEntries(Object.entries(R).map(([be,Ie])=>{const Ue={type:Ie.type,dims:Ie.dims,location:Ie.location};return Ue.location!=="gpu-buffer"&&(Ue.data=Ie.data),[be,Ue]}));throw console.error(`An error occurred during model execution: "${de}".`),console.error("Inputs given to model:",Pe),de}}function B(k){for(let $ in k)(0,s.isONNXTensor)(k[$])?k[$]=new u.Tensor(k[$]):typeof k[$]=="object"&&B(k[$]);return k}function ee(k){if(k instanceof u.Tensor)return k;if(k.length===0)throw Error("items must be non-empty");if(Array.isArray(k[0])){if(k.some($=>$.length!==k[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new u.Tensor("int64",BigInt64Array.from(k.flat().map($=>BigInt($))),[k.length,k[0].length])}else return new u.Tensor("int64",BigInt64Array.from(k.map($=>BigInt($))),[1,k.length])}function Q(k){return new u.Tensor("bool",[k],[1])}async function Z(k,$){let{encoder_outputs:R,input_ids:de,decoder_input_ids:Pe,...be}=$;if(!R){const Ue=(0,o.pick)($,k.sessions.model.inputNames);R=(await J(k,Ue)).last_hidden_state}return be.input_ids=Pe,be.encoder_hidden_states=R,k.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(be.encoder_attention_mask=$.attention_mask),await ae(k,be,!0)}async function J(k,$){const R=k.sessions.model,de=(0,o.pick)($,R.inputNames);if(R.inputNames.includes("inputs_embeds")&&!de.inputs_embeds){if(!$.input_ids)throw new Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");de.inputs_embeds=await k.encode_text({input_ids:$.input_ids})}if(R.inputNames.includes("token_type_ids")&&!de.token_type_ids){if(!de.input_ids)throw new Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");de.token_type_ids=(0,u.zeros_like)(de.input_ids)}if(R.inputNames.includes("pixel_mask")&&!de.pixel_mask){if(!de.pixel_values)throw new Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");const Pe=de.pixel_values.dims;de.pixel_mask=(0,u.ones)([Pe[0],Pe[2],Pe[3]])}return await W(R,de)}async function X(k,$){const R=await k.encode($);return await k.decode(R)}async function ae(k,$,R=!1){const de=k.sessions[R?"decoder_model_merged":"model"],{past_key_values:Pe,...be}=$;if(de.inputNames.includes("use_cache_branch")&&(be.use_cache_branch=Q(!!Pe)),de.inputNames.includes("position_ids")&&be.attention_mask&&!be.position_ids){const Ue=["paligemma","gemma3_text","gemma3"].includes(k.config.model_type)?1:0;be.position_ids=Te(be,Pe,Ue)}k.addPastKeyValues(be,Pe);const Ie=(0,o.pick)(be,de.inputNames);return await W(de,Ie)}function le({modality_token_id:k,inputs_embeds:$,modality_features:R,input_ids:de,attention_mask:Pe}){const be=de.tolist().map(st=>st.reduce((vt,Pt,It)=>(Pt==k&&vt.push(It),vt),[])),Ie=be.reduce((st,vt)=>st+vt.length,0),Ue=R.dims[0];if(Ie!==Ue)throw new Error(`Number of tokens and features do not match: tokens: ${Ie}, features ${Ue}`);let Ze=0;for(let st=0;st<be.length;++st){const vt=be[st],Pt=$[st];for(let It=0;It<vt.length;++It)Pt[vt[It]].data.set(R[Ze++].data)}return{inputs_embeds:$,attention_mask:Pe}}function ne({image_token_id:k,inputs_embeds:$,image_features:R,input_ids:de,attention_mask:Pe}){return le({modality_token_id:k,inputs_embeds:$,modality_features:R,input_ids:de,attention_mask:Pe})}function L({audio_token_id:k,inputs_embeds:$,audio_features:R,input_ids:de,attention_mask:Pe}){return le({modality_token_id:k,inputs_embeds:$,modality_features:R,input_ids:de,attention_mask:Pe})}async function F(k,{encode_function:$,merge_function:R,modality_input_name:de,modality_output_name:Pe,input_ids:be=null,attention_mask:Ie=null,position_ids:Ue=null,inputs_embeds:Ze=null,past_key_values:st=null,generation_config:vt=null,logits_processor:Pt=null,...It}){const Vt=It[de];if(!Ze){if(Ze=await k.encode_text({input_ids:be,...It}),Vt&&be.dims[1]!==1){const Ot=await $({[de]:Vt,...It});({inputs_embeds:Ze,attention_mask:Ie}=R({[Pe]:Ot,inputs_embeds:Ze,input_ids:be,attention_mask:Ie}))}else if(st&&Vt&&be.dims[1]===1){const Ot=be.dims[1],pt=Object.values(st)[0].dims.at(-2);Ie=(0,u.cat)([(0,u.ones)([be.dims[0],pt]),Ie.slice(null,[Ie.dims[1]-Ot,Ie.dims[1]])],1)}}if(!Ue&&k.config.model_type==="qwen2_vl"){const{image_grid_thw:Ot,video_grid_thw:pt}=It;[Ue]=k.get_rope_index(be,Ot,pt,Ie)}return await ae(k,{inputs_embeds:Ze,past_key_values:st,attention_mask:Ie,position_ids:Ue,generation_config:vt,logits_processor:Pt},!0)}async function G(k,$){return await F(k,{...$,modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:k.encode_audio.bind(k),merge_function:k._merge_input_ids_with_audio_features.bind(k)})}async function oe(k,$){return await F(k,{...$,modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:k.encode_image.bind(k),merge_function:k._merge_input_ids_with_image_features.bind(k)})}function H(k,$=0){const[R,de]=k.dims,Pe=k.data,be=new BigInt64Array(Pe.length);for(let Ie=0;Ie<R;++Ie){const Ue=Ie*de;let Ze=BigInt($);for(let st=0;st<de;++st){const vt=Ue+st;Pe[vt]===0n?be[vt]=BigInt(1):(be[vt]=Ze,Ze+=Pe[vt])}}return{data:be,dims:k.dims}}function Te(k,$=null,R=0){const{input_ids:de,inputs_embeds:Pe,attention_mask:be}=k,{data:Ie,dims:Ue}=H(be,R);let Ze=new u.Tensor("int64",Ie,Ue);if($){const st=-(de??Pe).dims.at(1);Ze=Ze.slice(null,[st,null])}return Ze}function Ce(k,$,R,de){const Pe=R.past_key_values?Object.values(R.past_key_values)[0].dims.at(-2):0;if(!R.attention_mask){let be;for(const Ie of["input_ids","inputs_embeds","position_ids"])if(R[Ie]){be=R[Ie].dims;break}if(!be)throw new Error("attention_mask is not provided, and unable to infer its shape from model inputs.");R.attention_mask=(0,u.ones)([be[0],Pe+be[1]])}if(R.past_key_values){const{input_ids:be,attention_mask:Ie}=R;Ie&&Ie.dims[1]>be.dims[1]||Pe<be.dims[1]&&(R.input_ids=be.slice(null,[Pe,null]))}return R}function Be(k,$,R,de){return R.past_key_values&&($=$.map(Pe=>[Pe.at(-1)])),{...R,decoder_input_ids:ee($)}}function $e(k,...$){return k.config.is_encoder_decoder?Be(k,...$):Ce(k,...$)}function te(k,$,R,de){const Pe=!!R.past_key_values;return de.guidance_scale!==null&&de.guidance_scale>1&&(Pe?R.input_ids=(0,u.cat)([R.input_ids,R.input_ids],0):(R.input_ids=(0,u.cat)([R.input_ids,(0,u.full_like)(R.input_ids,BigInt(de.pad_token_id))],0),R.attention_mask=(0,u.cat)([R.attention_mask,(0,u.full_like)(R.attention_mask,0n)],0))),(Pe||!R.pixel_values)&&(R.pixel_values=(0,u.full)([0,0,3,384,384],1)),Pe&&(R.images_seq_mask=new u.Tensor("bool",new Array(1).fill(!0).fill(!1,0,1),[1,1]),R.images_emb_mask=new u.Tensor("bool",new Array(0).fill(!1),[1,1,0])),R}class O extends a.Callable{constructor(R,de,Pe){super();ie(this,"main_input_name","input_ids");ie(this,"forward_params",["input_ids","attention_mask"]);this.config=R,this.sessions=de,this.configs=Pe;const be=T.get(this.constructor),Ie=M.get(be);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,Ie){case w.DecoderOnly:this.can_generate=!0,this._forward=ae,this._prepare_inputs_for_generation=Ce;break;case w.Seq2Seq:case w.Vision2Seq:case w.Musicgen:this.can_generate=!0,this._forward=Z,this._prepare_inputs_for_generation=Be;break;case w.EncoderDecoder:this._forward=Z;break;case w.ImageTextToText:this.can_generate=!0,this._forward=oe,this._prepare_inputs_for_generation=$e;break;case w.AudioTextToText:this.can_generate=!0,this._forward=G,this._prepare_inputs_for_generation=$e;break;case w.Phi3V:case w.ImageAudioTextToText:this.can_generate=!0,this._prepare_inputs_for_generation=$e;break;case w.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=te;break;case w.AutoEncoder:this._forward=X;break;default:this._forward=J;break}this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{}}async dispose(){var de;const R=[];for(const Pe of Object.values(this.sessions))(de=Pe==null?void 0:Pe.handler)!=null&&de.dispose&&R.push(Pe.handler.dispose());return await Promise.all(R)}static async from_pretrained(R,{progress_callback:de=null,config:Pe=null,cache_dir:be=null,local_files_only:Ie=!1,revision:Ue="main",model_file_name:Ze=null,subfolder:st="onnx",device:vt=null,dtype:Pt=null,use_external_data_format:It=null,session_options:Vt={}}={}){let bt={progress_callback:de,config:Pe,cache_dir:be,local_files_only:Ie,revision:Ue,model_file_name:Ze,subfolder:st,device:vt,dtype:Pt,use_external_data_format:It,session_options:Vt};const Ot=T.get(this),pt=M.get(Ot);Pe=bt.config=await n.AutoConfig.from_pretrained(R,bt);let Bt;if(pt===w.DecoderOnly)Bt=await Promise.all([A(R,{model:bt.model_file_name??"model"},bt),j(R,{generation_config:"generation_config.json"},bt)]);else if(pt===w.Seq2Seq||pt===w.Vision2Seq)Bt=await Promise.all([A(R,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},bt),j(R,{generation_config:"generation_config.json"},bt)]);else if(pt===w.MaskGeneration)Bt=await Promise.all([A(R,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},bt)]);else if(pt===w.EncoderDecoder)Bt=await Promise.all([A(R,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},bt)]);else if(pt===w.ImageTextToText){const Jt={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};Pe.is_encoder_decoder&&(Jt.model="encoder_model"),Bt=await Promise.all([A(R,Jt,bt),j(R,{generation_config:"generation_config.json"},bt)])}else if(pt===w.AudioTextToText){const Jt={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"};Bt=await Promise.all([A(R,Jt,bt),j(R,{generation_config:"generation_config.json"},bt)])}else if(pt===w.ImageAudioTextToText){const Jt={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};Bt=await Promise.all([A(R,Jt,bt),j(R,{generation_config:"generation_config.json"},bt)])}else if(pt===w.Musicgen)Bt=await Promise.all([A(R,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},bt),j(R,{generation_config:"generation_config.json"},bt)]);else if(pt===w.MultiModality)Bt=await Promise.all([A(R,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},bt),j(R,{generation_config:"generation_config.json"},bt)]);else if(pt===w.Phi3V)Bt=await Promise.all([A(R,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},bt),j(R,{generation_config:"generation_config.json"},bt)]);else if(pt===w.AutoEncoder)Bt=await Promise.all([A(R,{encoder_model:"encoder_model",decoder_model:"decoder_model"},bt)]);else if(pt===w.Supertonic)Bt=await Promise.all([A(R,{text_encoder:"text_encoder",latent_denoiser:"latent_denoiser",voice_decoder:"voice_decoder"},bt)]);else{if(pt!==w.EncoderOnly){const Jt=Ot??(Pe==null?void 0:Pe.model_type);Jt!=="custom"&&console.warn(`Model type for '${Jt}' not found, assuming encoder-only architecture. Please report this at ${c.GITHUB_ISSUE_URL}.`)}Bt=await Promise.all([A(R,{model:bt.model_file_name??"model"},bt)])}return new this(Pe,...Bt)}async _call(R){return await this.forward(R)}async forward(R){return await this._forward(this,R)}get generation_config(){var R;return((R=this.configs)==null?void 0:R.generation_config)??null}_get_logits_processor(R,de,Pe=null){const be=new d.LogitsProcessorList;if(R.repetition_penalty!==null&&R.repetition_penalty!==1&&be.push(new d.RepetitionPenaltyLogitsProcessor(R.repetition_penalty)),R.no_repeat_ngram_size!==null&&R.no_repeat_ngram_size>0&&be.push(new d.NoRepeatNGramLogitsProcessor(R.no_repeat_ngram_size)),R.bad_words_ids!==null&&be.push(new d.NoBadWordsLogitsProcessor(R.bad_words_ids,R.eos_token_id)),R.min_length!==null&&R.eos_token_id!==null&&R.min_length>0&&be.push(new d.MinLengthLogitsProcessor(R.min_length,R.eos_token_id)),R.min_new_tokens!==null&&R.eos_token_id!==null&&R.min_new_tokens>0&&be.push(new d.MinNewTokensLengthLogitsProcessor(de,R.min_new_tokens,R.eos_token_id)),R.forced_bos_token_id!==null&&be.push(new d.ForcedBOSTokenLogitsProcessor(R.forced_bos_token_id)),R.forced_eos_token_id!==null&&be.push(new d.ForcedEOSTokenLogitsProcessor(R.max_length,R.forced_eos_token_id)),R.begin_suppress_tokens!==null){const Ie=de>1||R.forced_bos_token_id===null?de:de+1;be.push(new d.SuppressTokensAtBeginLogitsProcessor(R.begin_suppress_tokens,Ie))}return R.guidance_scale!==null&&R.guidance_scale>1&&be.push(new d.ClassifierFreeGuidanceLogitsProcessor(R.guidance_scale)),R.temperature===0&&R.do_sample&&(console.warn("`do_sample` changed to false because `temperature: 0` implies greedy sampling (always selecting the most likely token), which is incompatible with `do_sample: true`."),R.do_sample=!1),R.do_sample&&R.temperature!==null&&R.temperature!==1&&be.push(new d.TemperatureLogitsWarper(R.temperature)),Pe!==null&&be.extend(Pe),be}_prepare_generation_config(R,de,Pe=h.GenerationConfig){const be={...this.config};for(const Ue of["decoder","generator","text_config"])Ue in be&&Object.assign(be,be[Ue]);const Ie=new Pe(be);return Object.assign(Ie,this.generation_config??{}),R&&Object.assign(Ie,R),de&&Object.assign(Ie,(0,o.pick)(de,Object.getOwnPropertyNames(Ie))),Ie}_get_stopping_criteria(R,de=null){const Pe=new y.StoppingCriteriaList;return R.max_length!==null&&Pe.push(new y.MaxLengthCriteria(R.max_length,this.config.max_position_embeddings??null)),R.eos_token_id!==null&&Pe.push(new y.EosTokenCriteria(R.eos_token_id)),de&&Pe.extend(de),Pe}_validate_model_class(){if(!this.can_generate){const R=[vm,xm,wm,ym],de=T.get(this.constructor),Pe=new Set,be=this.config.model_type;for(const Ue of R){const Ze=Ue.get(be);Ze&&Pe.add(Ze[0])}let Ie=`The current model class (${de}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw Pe.size>0&&(Ie+=` Please use the following class instead: ${[...Pe].join(", ")}`),Error(Ie)}}prepare_inputs_for_generation(...R){return this._prepare_inputs_for_generation(this,...R)}_update_model_kwargs_for_generation({generated_input_ids:R,outputs:de,model_inputs:Pe,is_encoder_decoder:be}){return Pe.past_key_values=this.getPastKeyValues(de,Pe.past_key_values),Pe.input_ids=new u.Tensor("int64",R.flat(),[R.length,1]),be||(Pe.attention_mask=(0,u.cat)([Pe.attention_mask,(0,u.ones)([Pe.attention_mask.dims[0],1])],1)),Pe.position_ids=null,Pe}_prepare_model_inputs({inputs:R,bos_token_id:de,model_kwargs:Pe}){const be=(0,o.pick)(Pe,this.forward_params),Ie=this.main_input_name;if(Ie in be){if(R)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else be[Ie]=R;return{inputs_tensor:be[Ie],model_inputs:be,model_input_name:Ie}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:R,model_inputs:de,model_input_name:Pe,generation_config:be}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!de.inputs_embeds&&"_prepare_inputs_embeds"in this){const{input_ids:Ue,pixel_values:Ze,attention_mask:st,...vt}=de,Pt=await this._prepare_inputs_embeds(de);de={...vt,...(0,o.pick)(Pt,["inputs_embeds","attention_mask"])}}let{last_hidden_state:Ie}=await J(this,de);if(be.guidance_scale!==null&&be.guidance_scale>1)Ie=(0,u.cat)([Ie,(0,u.full_like)(Ie,0)],0),"attention_mask"in de&&(de.attention_mask=(0,u.cat)([de.attention_mask,(0,u.zeros_like)(de.attention_mask)],0));else if(de.decoder_input_ids){const Ue=ee(de.decoder_input_ids).dims[0];if(Ue!==Ie.dims[0]){if(Ie.dims[0]!==1)throw new Error(`The encoder outputs have a different batch size (${Ie.dims[0]}) than the decoder inputs (${Ue}).`);Ie=(0,u.cat)(Array.from({length:Ue},()=>Ie),0)}}return de.encoder_outputs=Ie,de}_prepare_decoder_input_ids_for_generation({batch_size:R,model_input_name:de,model_kwargs:Pe,decoder_start_token_id:be,bos_token_id:Ie,generation_config:Ue}){let{decoder_input_ids:Ze,...st}=Pe;if(!(Ze instanceof u.Tensor)){if(Ze)Array.isArray(Ze[0])||(Ze=Array.from({length:R},()=>Ze));else if(be??(be=Ie),this.config.model_type==="musicgen")Ze=Array.from({length:R*this.config.decoder.num_codebooks},()=>[be]);else if(Array.isArray(be)){if(be.length!==R)throw new Error(`\`decoder_start_token_id\` expcted to have length ${R} but got ${be.length}`);Ze=be}else Ze=Array.from({length:R},()=>[be]);Ze=ee(Ze)}return Pe.decoder_attention_mask=(0,u.ones_like)(Ze),{input_ids:Ze,model_inputs:st}}async generate({inputs:R=null,generation_config:de=null,logits_processor:Pe=null,stopping_criteria:be=null,streamer:Ie=null,...Ue}){this._validate_model_class(),de=this._prepare_generation_config(de,Ue);let{inputs_tensor:Ze,model_inputs:st,model_input_name:vt}=this._prepare_model_inputs({inputs:R,model_kwargs:Ue});const Pt=this.config.is_encoder_decoder;Pt&&("encoder_outputs"in st||(st=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:Ze,model_inputs:st,model_input_name:vt,generation_config:de})));let It;Pt?{input_ids:It,model_inputs:st}=this._prepare_decoder_input_ids_for_generation({batch_size:st[vt].dims.at(0),model_input_name:vt,model_kwargs:st,decoder_start_token_id:de.decoder_start_token_id,bos_token_id:de.bos_token_id,generation_config:de}):It=st[vt];let Vt=It.dims.at(-1);de.max_new_tokens!==null&&(de.max_length=Vt+de.max_new_tokens);const bt=this._get_logits_processor(de,Vt,Pe),Ot=this._get_stopping_criteria(de,be),pt=st[vt].dims.at(0),Bt=P.LogitsSampler.getSampler(de),Jt=new Array(pt).fill(0),dr=It.tolist();Ie&&Ie.put(dr);let gr,xr={};for(;;){if(st=this.prepare_inputs_for_generation(dr,st,de),gr=await this.forward(st),de.output_attentions&&de.return_dict_in_generate){const Vn=this.getAttentions(gr);for(const Is in Vn)Is in xr||(xr[Is]=[]),xr[Is].push(Vn[Is])}const Ut=gr.logits.slice(null,-1,null),sn=bt(dr,Ut),cs=[];for(let Vn=0;Vn<sn.dims.at(0);++Vn){const Is=sn[Vn],Od=await Bt(Is);for(const[qa,Nd]of Od){const Dd=BigInt(qa);Jt[Vn]+=Nd,dr[Vn].push(Dd),cs.push([Dd]);break}}if(Ie&&Ie.put(cs),Ot(dr).every(Vn=>Vn))break;st=this._update_model_kwargs_for_generation({generated_input_ids:cs,outputs:gr,model_inputs:st,is_encoder_decoder:Pt})}Ie&&Ie.end();const Jr=this.getPastKeyValues(gr,st.past_key_values,!0),fn=new u.Tensor("int64",dr.flat(),[dr.length,dr[0].length]);if(de.return_dict_in_generate)return{sequences:fn,past_key_values:Jr,...xr};for(const Ut of Object.values(gr))Ut.location==="gpu-buffer"&&Ut.dispose();return fn}getPastKeyValues(R,de,Pe=!1){const be=Object.create(null);for(const Ie in R)if(Ie.startsWith("present")){const Ue=Ie.replace("present_conv","past_conv").replace("present","past_key_values"),Ze=Ie.includes("encoder");if(Ze&&de?be[Ue]=de[Ue]:be[Ue]=R[Ie],de&&(!Ze||Pe)){const st=de[Ue];st.location==="gpu-buffer"&&st.dispose()}}return be}getAttentions(R){const de={};for(const Pe of["cross_attentions","encoder_attentions","decoder_attentions"])for(const be in R)be.startsWith(Pe)&&(Pe in de||(de[Pe]=[]),de[Pe].push(R[be]));return de}addPastKeyValues(R,de){var Pe,be,Ie;if(de)Object.assign(R,de);else{const Ue=this.sessions.decoder_model_merged??this.sessions.model,Ze=((be=(Pe=R[this.main_input_name]??R.attention_mask)==null?void 0:Pe.dims)==null?void 0:be[0])??1,st=((Ie=Ue==null?void 0:Ue.config)==null?void 0:Ie.kv_cache_dtype)??"float32",vt=st==="float16"?u.DataTypeMap.float16:u.DataTypeMap.float32,Pt=(0,n.getCacheShapes)(this.config,{batch_size:Ze});for(const It in Pt){const Vt=Pt[It].reduce((bt,Ot)=>bt*Ot,1);R[It]=new u.Tensor(st,new vt(Vt),Pt[It])}}}async encode_image({pixel_values:R}){return(await W(this.sessions.vision_encoder,{pixel_values:R})).image_features}async encode_text({input_ids:R}){return(await W(this.sessions.embed_tokens,{input_ids:R})).inputs_embeds}async encode_audio({audio_values:R}){return(await W(this.sessions.audio_encoder,{audio_values:R})).audio_features}}class ue{}class Ee extends ue{constructor({last_hidden_state:$,hidden_states:R=null,attentions:de=null}){super(),this.last_hidden_state=$,this.hidden_states=R,this.attentions=de}}class fe extends O{}class me extends fe{}class ve extends fe{async _call($){return new hn(await super._call($))}}class xe extends fe{async _call($){return new Dt(await super._call($))}}class _e extends fe{async _call($){return new nn(await super._call($))}}class je extends fe{async _call($){return new Pn(await super._call($))}}class we extends O{}class Oe extends we{}class Me extends we{async _call($){return new hn(await super._call($))}}class We extends we{async _call($){return new Dt(await super._call($))}}class Le extends we{async _call($){return new nn(await super._call($))}}class rt extends we{async _call($){return new Pn(await super._call($))}}class Ye extends O{}class ze extends Ye{}class Ke extends Ye{async _call($){return new hn(await super._call($))}}class yt extends Ye{async _call($){return new Dt(await super._call($))}}class Ve extends Ye{async _call($){return new nn(await super._call($))}}class wt extends O{}class ut extends wt{}class yr extends wt{}class wr extends O{}class Hr extends wr{}class Qr extends O{}class Er extends Qr{}class un extends Qr{async _call($){return new hn(await super._call($))}}class Hi extends Qr{async _call($){return new Dt(await super._call($))}}class Qi extends Qr{async _call($){return new nn(await super._call($))}}class Xi extends Qr{async _call($){return new Pn(await super._call($))}}class bs extends O{}class ki extends bs{}class Et extends bs{async _call($){return new hn(await super._call($))}}class pi extends bs{async _call($){return new Dt(await super._call($))}}class zt extends bs{async _call($){return new nn(await super._call($))}}class or extends bs{async _call($){return new Pn(await super._call($))}}class I extends O{}class re extends I{}class V extends I{async _call($){return new hn(await super._call($))}}class Y extends I{async _call($){return new Dt(await super._call($))}}class ce extends I{async _call($){return new nn(await super._call($))}}class Se extends I{async _call($){return new Pn(await super._call($))}}class Re extends O{}class ct extends Re{}class kt extends Re{async _call($){return new hn(await super._call($))}}class xt extends Re{async _call($){return new Dt(await super._call($))}}class jt extends Re{async _call($){return new nn(await super._call($))}}class ot extends Re{async _call($){return new Pn(await super._call($))}}class Wt extends O{}class ar extends Wt{}class In extends Wt{async _call($){return new hn(await super._call($))}}class Bn extends Wt{async _call($){return new Dt(await super._call($))}}class Nr extends Wt{async _call($){return new nn(await super._call($))}}class Xr extends Wt{async _call($){return new Pn(await super._call($))}}class Dr extends O{}class Ms extends Dr{}class Ts extends Dr{async _call($){return new hn(await super._call($))}}class dn extends Dr{async _call($){return new Dt(await super._call($))}}class mi extends Dr{async _call($){return new nn(await super._call($))}}class gi extends Dr{async _call($){return new Pn(await super._call($))}}class Zr extends O{}class Es extends Zr{}class Xn extends Zr{async _call($){return new Dt(await super._call($))}}class En extends Zr{async _call($){return new nn(await super._call($))}}class Ps extends Zr{async _call($){return new Pn(await super._call($))}}class Wr extends Zr{async _call($){return new hn(await super._call($))}}class $r extends O{}class ks extends $r{}class Si extends $r{async _call($){return new hn(await super._call($))}}class An extends $r{async _call($){return new Dt(await super._call($))}}class He extends $r{async _call($){return new nn(await super._call($))}}class Qe extends O{}class lt extends Qe{}class lr extends Qe{async _call($){return new hn(await super._call($))}}class Ci extends Qe{async _call($){return new Dt(await super._call($))}}class Vs extends Qe{async _call($){return new Pn(await super._call($))}}class os extends O{}class Aa extends os{}class ja extends os{async _call($){return new hn(await super._call($))}}class Oa extends os{async _call($){return new Dt(await super._call($))}}class Na extends os{async _call($){return new nn(await super._call($))}}class Da extends os{async _call($){return new Pn(await super._call($))}}class ye extends O{}class N extends ye{}class q extends ye{async _call($){return new hn(await super._call($))}}class se extends ye{async _call($){return new Dt(await super._call($))}}class he extends ye{async _call($){return new Pn(await super._call($))}}class ge extends O{}class De extends ge{}class Xe extends ge{async _call($){return new Dt(await super._call($))}}class it extends ge{async _call($){return new Pn(await super._call($))}}class tt extends ge{async _call($){return new hn(await super._call($))}}class at extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class $t extends at{}class qt extends at{}class Xt extends O{}class Ir extends Xt{}class sr extends Xt{}class Pr extends O{}class Ar extends Pr{}class kr extends Pr{}class Un extends O{}class en extends Un{}class Ws extends Un{}class mr extends Un{async _call($){return new Dt(await super._call($))}}class Fr extends O{}class wn extends Fr{}class Ss extends Fr{}class Cs extends Fr{async _call($){return new Dt(await super._call($))}}class vn extends Fr{}class jn extends O{}class tn extends jn{}class Lr extends jn{}class vr extends O{}class Gr extends vr{}class On extends vr{}class $s extends O{}class Oo extends $s{}class Wu extends $s{async _call($){return new hn(await super._call($))}}class Xl extends $s{async _call($){return new Dt(await super._call($))}}class Gu extends $s{async _call($){return new nn(await super._call($))}}class qu extends $s{async _call($){return new Pn(await super._call($))}}class Ji extends O{}class Ku extends Ji{}class Hu extends Ji{async _call($){return new hn(await super._call($))}}class Qu extends Ji{async _call($){return new Dt(await super._call($))}}class Xu extends Ji{async _call($){return new nn(await super._call($))}}class Ju extends Ji{async _call($){return new Pn(await super._call($))}}class Yi extends O{}class Yu extends Yi{}class Zu extends Yi{async _call($){return new hn(await super._call($))}}class ed extends Yi{async _call($){return new Dt(await super._call($))}}class Jl extends Yi{async _call($){return new nn(await super._call($))}}class Yl extends Yi{async _call($){return new Pn(await super._call($))}}class No extends O{}class td extends No{}class rd extends No{}class Do extends O{constructor(){super(...arguments);ie(this,"requires_attention_mask",!1);ie(this,"main_input_name","input_features");ie(this,"forward_params",["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class Zl extends Do{}class $i extends Do{_prepare_generation_config($,R){return super._prepare_generation_config($,R,_.WhisperGenerationConfig)}_retrieve_init_tokens($){const R=[$.decoder_start_token_id];let de=$.language;const Pe=$.task;if($.is_multilingual){de||(console.warn("No language specified - defaulting to English (en)."),de="en");const Ie=`<|${(0,b.whisper_language_to_code)(de)}|>`;R.push($.lang_to_id[Ie]),R.push($.task_to_id[Pe??"transcribe"])}else if(de||Pe)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return!$.return_timestamps&&$.no_timestamps_token_id&&R.at(-1)!==$.no_timestamps_token_id?R.push($.no_timestamps_token_id):$.return_timestamps&&R.at(-1)===$.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),R.pop()),R.filter(be=>be!=null)}async generate({inputs:$=null,generation_config:R=null,logits_processor:de=null,stopping_criteria:Pe=null,...be}){R=this._prepare_generation_config(R,be);const Ie=be.decoder_input_ids??this._retrieve_init_tokens(R);if(R.return_timestamps&&(de??(de=new d.LogitsProcessorList),de.push(new d.WhisperTimeStampLogitsProcessor(R,Ie))),R.begin_suppress_tokens&&(de??(de=new d.LogitsProcessorList),de.push(new d.SuppressTokensAtBeginLogitsProcessor(R.begin_suppress_tokens,Ie.length))),R.return_token_timestamps){if(!R.alignment_heads)throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");R.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),R.output_attentions=!0,R.return_dict_in_generate=!0}const Ue=await super.generate({inputs:$,generation_config:R,logits_processor:de,decoder_input_ids:Ie,...be});return R.return_token_timestamps&&(Ue.token_timestamps=this._extract_token_timestamps(Ue,R.alignment_heads,R.num_frames)),Ue}_extract_token_timestamps($,R,de=null,Pe=.02){if(!$.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");de==null&&console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let be=this.config.median_filter_width;be===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),be=7);const Ie=$.cross_attentions,Ue=Array.from({length:this.config.decoder_layers},(Ot,pt)=>(0,u.cat)(Ie.map(Bt=>Bt[pt]),2)),Ze=(0,u.stack)(R.map(([Ot,pt])=>{if(Ot>=Ue.length)throw new Error(`Layer index ${Ot} is out of bounds for cross attentions (length ${Ue.length}).`);return de?Ue[Ot].slice(null,pt,null,[0,de]):Ue[Ot].slice(null,pt)})).transpose(1,0,2,3),[st,vt]=(0,u.std_mean)(Ze,-2,0,!0),Pt=Ze.clone();for(let Ot=0;Ot<Pt.dims[0];++Ot){const pt=Pt[Ot];for(let Bt=0;Bt<pt.dims[0];++Bt){const Jt=pt[Bt],dr=st[Ot][Bt][0].data,gr=vt[Ot][Bt][0].data;for(let xr=0;xr<Jt.dims[0];++xr){let Jr=Jt[xr].data;for(let fn=0;fn<Jr.length;++fn)Jr[fn]=(Jr[fn]-gr[fn])/dr[fn];Jr.set((0,m.medianFilter)(Jr,be))}}}const It=[(0,u.mean)(Pt,1)],Vt=$.sequences.dims,bt=new u.Tensor("float32",new Float32Array(Vt[0]*Vt[1]),Vt);for(let Ot=0;Ot<Vt[0];++Ot){const pt=It[Ot].neg().squeeze_(0),[Bt,Jt]=(0,m.dynamic_time_warping)(pt.tolist()),dr=Array.from({length:Bt.length-1},(Jr,fn)=>Bt[fn+1]-Bt[fn]),gr=(0,o.mergeArrays)([1],dr).map(Jr=>!!Jr),xr=[];for(let Jr=0;Jr<gr.length;++Jr)gr[Jr]&&xr.push(Jt[Jr]*Pe);bt[Ot].data.set(xr,1)}return bt}}class nd extends $i{}class Fo extends O{constructor(){super(...arguments);ie(this,"requires_attention_mask",!1);ie(this,"main_input_name","input_values");ie(this,"forward_params",["input_values","decoder_input_ids","past_key_values"])}}class sp extends Fo{}class sd extends Fo{}class ec extends O{constructor(){super(...arguments);ie(this,"main_input_name","pixel_values");ie(this,"forward_params",["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"])}}class Fa extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class La extends Fa{_merge_input_ids_with_image_features($){const R=$.image_features.dims.at(-1),de=$.image_features.view(-1,R);return ne({image_token_id:this.config.image_token_index,...$,image_features:de})}}class id extends La{}class ad extends La{}class od extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"]);ie(this,"main_input_name","inputs_embeds")}}class ld extends od{_merge_input_ids_with_image_features({inputs_embeds:$,image_features:R,input_ids:de,attention_mask:Pe}){return{inputs_embeds:(0,u.cat)([R,$],1),attention_mask:(0,u.cat)([(0,u.ones)(R.dims.slice(0,2)),Pe],1)}}async _prepare_inputs_embeds({input_ids:$,pixel_values:R,inputs_embeds:de,attention_mask:Pe}){if(!$&&!R)throw new Error("Either `input_ids` or `pixel_values` should be provided.");let be,Ie;return $&&(be=await this.encode_text({input_ids:$})),R&&(Ie=await this.encode_image({pixel_values:R})),be&&Ie?{inputs_embeds:de,attention_mask:Pe}=this._merge_input_ids_with_image_features({inputs_embeds:be,image_features:Ie,input_ids:$,attention_mask:Pe}):de=be||Ie,{inputs_embeds:de,attention_mask:Pe}}async forward({input_ids:$,pixel_values:R,attention_mask:de,decoder_input_ids:Pe,decoder_attention_mask:be,encoder_outputs:Ie,past_key_values:Ue,inputs_embeds:Ze,decoder_inputs_embeds:st}){if(Ze||({inputs_embeds:Ze,attention_mask:de}=await this._prepare_inputs_embeds({input_ids:$,pixel_values:R,inputs_embeds:Ze,attention_mask:de})),!Ie){let{last_hidden_state:It}=await J(this,{inputs_embeds:Ze,attention_mask:de});Ie=It}if(!st){if(!Pe)throw new Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");st=await this.encode_text({input_ids:Pe})}return await ae(this,{inputs_embeds:st,attention_mask:be,encoder_attention_mask:de,encoder_hidden_states:Ie,past_key_values:Ue},!0)}}class cd extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class ud extends cd{_merge_input_ids_with_image_features($){const R=$.image_features.dims.at(-1),de=$.image_features.view(-1,R);return ne({image_token_id:this.config.image_token_index,...$,image_features:de})}}class dd extends Fa{_merge_input_ids_with_image_features($){const R=$.image_features.dims.at(-1),de=$.image_features.view(-1,R);return ne({image_token_id:this.config.image_token_index,...$,image_features:de})}}class hd extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","attention_mask","inputs_embeds","per_layer_inputs","position_ids","pixel_values","input_features","input_features_mask","past_key_values"])}}class tc extends hd{async forward({input_ids:$=null,attention_mask:R=null,pixel_values:de=null,input_features:Pe=null,input_features_mask:be=null,position_ids:Ie=null,inputs_embeds:Ue=null,per_layer_inputs:Ze=null,past_key_values:st=null,generation_config:vt=null,logits_processor:Pt=null,...It}){if((!Ue||!Ze)&&({inputs_embeds:Ue,per_layer_inputs:Ze}=await W(this.sessions.embed_tokens,{input_ids:$}),$.dims[1]!==1)){if(de){const{image_features:bt}=await W(this.sessions.vision_encoder,{pixel_values:de});({inputs_embeds:Ue,attention_mask:R}=this._merge_input_ids_with_image_features({image_features:bt,inputs_embeds:Ue,input_ids:$,attention_mask:R}))}if(Pe){const{audio_features:bt}=await W(this.sessions.audio_encoder,{input_features:Pe,input_features_mask:be});({inputs_embeds:Ue,attention_mask:R}=this._merge_input_ids_with_audio_features({audio_features:bt,inputs_embeds:Ue,input_ids:$,attention_mask:R}))}}return await ae(this,{inputs_embeds:Ue,per_layer_inputs:Ze,past_key_values:st,attention_mask:R,position_ids:Ie,generation_config:vt,logits_processor:Pt},!0)}_merge_input_ids_with_image_features($){const R=$.image_features.dims.at(-1),de=$.image_features.view(-1,R);return ne({image_token_id:this.config.image_token_id,...$,image_features:de})}_merge_input_ids_with_audio_features($){const R=$.audio_features.dims.at(-1),de=$.audio_features.view(-1,R);return L({audio_token_id:this.config.audio_token_id,...$,audio_features:de})}}class Ra extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"])}}class _i extends Ra{async encode_image({pixel_values:$,pixel_attention_mask:R}){return(await W(this.sessions.vision_encoder,{pixel_values:$,pixel_attention_mask:R})).image_features}_merge_input_ids_with_image_features($){const R=$.image_features.dims.at(-1),de=$.image_features.view(-1,R);return ne({image_token_id:this.config.image_token_id,...$,image_features:de})}}class Lo extends _i{}class fd extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"])}}class rc extends fd{async forward({input_ids:$=null,attention_mask:R=null,pixel_values:de=null,image_sizes:Pe=null,position_ids:be=null,inputs_embeds:Ie=null,past_key_values:Ue=null,generation_config:Ze=null,logits_processor:st=null,...vt}){if(!Ie){let It;if(de&&$.dims[1]!==1){if(!Pe)throw new Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:It}=await W(this.sessions.vision_encoder,{pixel_values:de,image_sizes:Pe}))}else{const Vt=this.config.normalized_config.hidden_size;It=new u.Tensor("float32",[],[0,Vt])}({inputs_embeds:Ie}=await W(this.sessions.prepare_inputs_embeds,{input_ids:$,image_features:It}))}return await ae(this,{inputs_embeds:Ie,past_key_values:Ue,attention_mask:R,position_ids:be,generation_config:Ze,logits_processor:st},!1)}}class Gs extends O{}class Ro extends Gs{}class pd extends Gs{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"text_model"})}}class nc extends Gs{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"text_model"})}}class md extends Gs{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"vision_model"})}}class sc extends Gs{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"vision_model"})}}class zo extends O{}class ic extends zo{}class gd extends zo{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"text_model"})}}class ac extends Gs{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"vision_model"})}}class oc extends O{}class za extends oc{}class gt extends O{}class _d extends gt{async forward($){const R=!$.input_ids,de=!$.pixel_values;if(R&&de)throw new Error("Either `input_ids` or `pixel_values` should be provided.");if(R&&($.input_ids=(0,u.ones)([$.pixel_values.dims[0],1])),de){const{image_size:st}=this.config.vision_config;$.pixel_values=(0,u.full)([0,3,st,st],0)}const{text_embeddings:Pe,image_embeddings:be,l2norm_text_embeddings:Ie,l2norm_image_embeddings:Ue}=await super.forward($),Ze={};return R||(Ze.text_embeddings=Pe,Ze.l2norm_text_embeddings=Ie),de||(Ze.image_embeddings=be,Ze.l2norm_image_embeddings=Ue),Ze}}class lc extends gt{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"text_model"})}}class cc extends gt{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"vision_model"})}}class Zi extends O{}class ls extends Zi{}class Ba extends Zi{}class Ua extends O{}class uc extends Ua{}class dc extends Ua{}class Bo extends O{}class Uo extends Bo{}class hc extends Bo{}class Vo extends O{}class fc extends Vo{}class Va extends Vo{}class Wa extends O{}class Wo extends Wa{}class pc extends Wa{}class Go extends O{}class mc extends Go{}class gc extends Go{}class qo extends O{}class _c extends qo{}class v extends qo{}class C extends O{}class D extends C{}class z extends C{}class K extends O{}class pe extends K{}class Ne extends K{}class Ge extends O{}class nt extends Ge{}class dt extends O{}class Nt extends dt{}class Kt extends dt{}class er extends O{}class rn extends er{}class Ii extends er{}class yc extends O{}class Lw extends yc{}class Rw extends yc{}class ip extends O{}class zw extends ip{}class Bw extends ip{}class ap extends O{}class Uw extends ap{}class Vw extends ap{}class op extends O{}class Ww extends op{}class Gw extends op{}class lp extends O{}class qw extends lp{}class Kw extends lp{}class cp extends O{}class Hw extends cp{}class Qw extends cp{}class up extends O{}class Xw extends up{}class Jw extends up{}class dp extends O{}class Yw extends dp{}class Zw extends dp{}class hp extends O{}class ev extends hp{}class tv extends hp{}class fp extends O{}class rv extends fp{}class nv extends fp{}class pp extends O{}class sv extends pp{}class iv extends pp{}class mp extends O{}class av extends mp{}class ov extends mp{}class gp extends O{}class lv extends gp{}class cv extends gp{}class _p extends O{}class uv extends _p{}class dv extends _p{}class yp extends O{}class hv extends yp{}class fv extends yp{}class wp extends O{}class pv extends wp{}class mv extends wp{}class vp extends O{}class gv extends vp{}class _v extends vp{}class xp extends O{}class yv extends xp{}class wv extends xp{}class vv extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"])}}class xv extends vv{get_rope_index($,R,de,Pe){const{vision_config:be,image_token_id:Ie,video_token_id:Ue,vision_start_token_id:Ze}=this.config,st=be.spatial_merge_size??2,vt=[];if(R||de){let Pt=$.tolist();Pe||(Pe=(0,u.ones_like)($));const It=Pe.tolist(),Vt=Array.from({length:3},Jt=>Array.from({length:$.dims[0]},dr=>Array.from({length:$.dims[1]},gr=>1))),bt=R?R.tolist():[],Ot=de?de.tolist():[];let pt=0,Bt=0;for(let Jt=0;Jt<Pt.length;++Jt){const dr=Pt[Jt].filter((br,an)=>It[Jt][an]==1),xr=dr.reduce((br,an,ra)=>(an==Ze&&br.push(ra),br),[]).map(br=>dr[br+1]),Jr=xr.filter(br=>br==Ie).length,fn=xr.filter(br=>br==Ue).length;let Ut=[],sn=0,cs=Jr,Ga=fn;for(let br=0;br<xr.length;++br){const an=dr.findIndex((Ha,qs)=>qs>sn&&Ha==Ie),ra=dr.findIndex((Ha,qs)=>qs>sn&&Ha==Ue),Ka=cs>0&&an!==-1?an:dr.length+1,Qo=Ga>0&&ra!==-1?ra:dr.length+1;let Fd,Mm,Tm,Em;Ka<Qo?([Mm,Tm,Em]=bt[pt],++pt,--cs,Fd=Ka):([Mm,Tm,Em]=Ot[Bt],++Bt,--Ga,Fd=Qo);const[R3,Pm,Ld]=[Number(Mm),Math.floor(Number(Tm)/st),Math.floor(Number(Em)/st)],km=Fd-sn,mT=Ut.length>0?(0,m.max)(Ut.at(-1))[0]+1:0;Ut.push(Array.from({length:3*km},(Ha,qs)=>mT+qs%km));const Sm=km+mT,Rd=R3*Pm*Ld,z3=Array.from({length:Rd},(Ha,qs)=>Sm+Math.floor(qs/(Pm*Ld))),B3=Array.from({length:Rd},(Ha,qs)=>Sm+Math.floor(qs/Ld)%Pm),U3=Array.from({length:Rd},(Ha,qs)=>Sm+qs%Ld);Ut.push([z3,B3,U3].flat()),sn=Fd+Rd}if(sn<dr.length){const br=Ut.length>0?(0,m.max)(Ut.at(-1))[0]+1:0,an=dr.length-sn;Ut.push(Array.from({length:3*an},(ra,Ka)=>br+Ka%an))}const Vn=Ut.reduce((br,an)=>br+an.length,0),Is=new Array(Vn);let Od=0;for(let br=0;br<3;++br)for(let an=0;an<Ut.length;++an){const ra=Ut[an],Ka=ra.length/3;for(let Qo=br*Ka;Qo<(br+1)*Ka;++Qo)Is[Od++]=ra[Qo]}let qa=0;const Nd=It[Jt];for(let br=0;br<Nd.length;++br)if(Nd[br]==1){for(let an=0;an<3;++an)Vt[an][Jt][br]=Is[an*Vn/3+qa];++qa}const Dd=(0,m.max)(Is)[0];vt.push(Dd+1-Pt[Jt].length)}return[new u.Tensor("int64",Vt.flat(1/0),[3,$.dims[0],$.dims[1]]),new u.Tensor("int64",vt,[vt.length,1])]}else if(Pe){const{data:Pt,dims:It}=H(Pe),Vt=BigInt64Array.from({length:3*Pt.length},(Ot,pt)=>Pt[pt%Pt.length]),bt=Array.from({length:It[0]},(Ot,pt)=>(0,m.max)(Pt.subarray(It[1]*pt,It[1]*(pt+1)))[0]+1n+BigInt(It[1]));return[new u.Tensor("int64",Vt,[3,...It]),new u.Tensor("int64",bt,[bt.length,1])]}else{const[Pt,It]=$.dims,Vt=BigInt64Array.from({length:3*Pt*It},(bt,Ot)=>BigInt(Math.floor(Ot%It/Pt)));return[new u.Tensor("int64",Vt,[3,...$.dims]),(0,u.zeros)([Pt,1])]}}async encode_image({pixel_values:$,image_grid_thw:R}){return(await W(this.sessions.vision_encoder,{pixel_values:$,grid_thw:R})).image_features}_merge_input_ids_with_image_features($){return ne({image_token_id:this.config.image_token_id,...$})}prepare_inputs_for_generation($,R,de){if(R.attention_mask&&!R.position_ids)if(!R.past_key_values)[R.position_ids,R.rope_deltas]=this.get_rope_index(R.input_ids,R.image_grid_thw,R.video_grid_thw,R.attention_mask);else{R.pixel_values=null;const Pe=BigInt(Object.values(R.past_key_values)[0].dims.at(-2)),be=R.rope_deltas.map(Ie=>Pe+Ie);R.position_ids=(0,u.stack)([be,be,be],0)}return R}}class bp extends O{}class bv extends bp{}class Mv extends bp{}class Mp extends O{}class Tv extends Mp{}class Ev extends Mp{}class Tp extends O{}class Pv extends Tp{}class kv extends Tp{}class Ep extends O{}class Sv extends Ep{}class Cv extends Ep{}class Pp extends O{}class $v extends Pp{}class Iv extends Pp{}class kp extends O{}class Av extends kp{}class jv extends kp{async _call($){return new Dt(await super._call($))}}class Sp extends O{}class Ov extends Sp{}class Nv extends Sp{async _call($){return new Dt(await super._call($))}}class Dv extends O{}class Fv extends Dv{}class Cp extends O{}class Lv extends Cp{}class Rv extends Cp{async _call($){return new Dt(await super._call($))}}class zv extends O{}class Bv extends zv{}class $p extends O{}class Uv extends $p{}class Vv extends $p{async _call($){return new Dt(await super._call($))}}class Wv extends O{}class Gv extends Wv{}class Ip extends O{}class qv extends Ip{}class Kv extends Ip{async _call($){return new Dt(await super._call($))}}class Hv extends O{}class Qv extends Hv{async _call($){return new fT(await super._call($))}}class Ap extends O{}class Xv extends Ap{}class Jv extends Ap{async _call($){return new Dt(await super._call($))}}class jp extends O{}class Yv extends jp{}class Zv extends jp{async _call($){return new Dt(await super._call($))}}class Op extends O{}class ex extends Op{}class tx extends Op{}class Np extends O{}class rx extends Np{}class nx extends Np{}class Dp extends O{}class sx extends Dp{}class ix extends Dp{async _call($){return new Dt(await super._call($))}}class yd extends O{}class ax extends yd{}class ox extends yd{async _call($){return new Lp(await super._call($))}}class Fp extends yd{async _call($){return new lx(await super._call($))}}class Lp extends ue{constructor({logits:$,pred_boxes:R}){super(),this.logits=$,this.pred_boxes=R}}class lx extends ue{constructor({logits:$,pred_boxes:R,pred_masks:de}){super(),this.logits=$,this.pred_boxes=R,this.pred_masks=de}}class Rp extends O{}class cx extends Rp{}class ux extends Rp{async _call($){return new wc(await super._call($))}}class wc extends ue{constructor({logits:$,pred_boxes:R}){super(),this.logits=$,this.pred_boxes=R}}class zp extends O{}class dx extends zp{}class hx extends zp{async _call($){return new fx(await super._call($))}}class fx extends wc{}class Bp extends O{}class px extends Bp{}class mx extends Bp{async _call($){return new gx(await super._call($))}}class gx extends wc{}class Up extends O{}class _x extends Up{}class yx extends Up{async _call($){return new wc(await super._call($))}}class Vp extends O{}class wx extends Vp{}class vx extends Vp{async _call($){return new xx(await super._call($))}}class xx extends Lp{}class Wp extends O{}class bx extends Wp{}class Mx extends Wp{async _call($){return new Dt(await super._call($))}}class Gp extends O{}class Tx extends Gp{}class Ex extends Gp{async _call($){return new Dt(await super._call($))}}class qp extends O{}class Px extends qp{}class kx extends qp{async _call($){return new Dt(await super._call($))}}class wd extends O{}class Sx extends wd{}class Cx extends wd{async _call($){return new Dt(await super._call($))}}class $x extends wd{}class Kp extends O{}class Ix extends Kp{}class Ax extends Kp{}class Hp extends O{}class jx extends Hp{}class Ox extends Hp{}class Nx extends O{}class Dx extends Nx{}class vd extends O{}class Fx extends vd{}class Lx extends vd{}class Rx extends vd{}class zx extends O{}class Bx extends zx{}class Ux extends O{}class Vx extends Ux{}class Wx extends O{}class Gx extends Wx{}class Qp extends O{}class qx extends Qp{}class Kx extends Qp{}class Xp extends O{}class Hx extends Xp{}class Qx extends Xp{}class Xx extends O{}class Jx extends Xx{}class Jp extends O{}class Yx extends Jp{}class Zx extends Jp{async _call($){return new Dt(await super._call($))}}class Yp extends O{}class eb extends Yp{}class tb extends Yp{async _call($){return new Dt(await super._call($))}}class Zp extends O{}class rb extends Zp{}class nb extends Zp{async _call($){return new Dt(await super._call($))}}class em extends O{}class sb extends em{}class ib extends em{async _call($){return new Dt(await super._call($))}}class ab extends O{}class ob extends ab{}class lb extends O{}class cb extends lb{}class ub extends O{}class db extends ub{}class tm extends O{}class hb extends tm{}class fb extends tm{async _call($){return new pb(await super._call($))}}class pb extends ue{constructor({logits:$,pred_boxes:R}){super(),this.logits=$,this.pred_boxes=R}}class mb extends O{}class gb extends mb{async get_image_embeddings({pixel_values:$}){return await J(this,{pixel_values:$})}async forward($){!$.image_embeddings||!$.image_positional_embeddings?$={...$,...await this.get_image_embeddings($)}:$={...$},$.input_labels??($.input_labels=(0,u.ones)($.input_points.dims.slice(0,-1)));const R={image_embeddings:$.image_embeddings,image_positional_embeddings:$.image_positional_embeddings};return $.input_points&&(R.input_points=$.input_points),$.input_labels&&(R.input_labels=$.input_labels),$.input_boxes&&(R.input_boxes=$.input_boxes),await W(this.sessions.prompt_encoder_mask_decoder,R)}async _call($){return new _b(await super._call($))}}class _b extends ue{constructor({iou_scores:$,pred_masks:R}){super(),this.iou_scores=$,this.pred_masks=R}}class yb extends ue{constructor({iou_scores:$,pred_masks:R,object_score_logits:de}){super(),this.iou_scores=$,this.pred_masks=R,this.object_score_logits=de}}class wb extends O{}class xd extends wb{async get_image_embeddings({pixel_values:$}){return await J(this,{pixel_values:$})}async forward($){const{num_feature_levels:R}=this.config.vision_config;if(Array.from({length:R},(Ie,Ue)=>`image_embeddings.${Ue}`).some(Ie=>!$[Ie])?$={...$,...await this.get_image_embeddings($)}:$={...$},$.input_points){if($.input_boxes&&$.input_boxes.dims[1]!==1)throw new Error("When both `input_points` and `input_boxes` are provided, the number of boxes per image must be 1.");const Ie=$.input_points.dims;$.input_labels??($.input_labels=(0,u.ones)(Ie.slice(0,-1))),$.input_boxes??($.input_boxes=(0,u.full)([Ie[0],0,4],0))}else if($.input_boxes){const Ie=$.input_boxes.dims;$.input_labels=(0,u.full)([Ie[0],Ie[1],0],-1n),$.input_points=(0,u.full)([Ie[0],1,0,2],0)}else throw new Error("At least one of `input_points` or `input_boxes` must be provided.");const Pe=this.sessions.prompt_encoder_mask_decoder,be=(0,o.pick)($,Pe.inputNames);return await W(Pe,be)}async _call($){return new yb(await super._call($))}}class vb extends xd{}class xb extends xd{}class rm extends O{}class bb extends rm{}class Mb extends rm{}class nm extends O{}class Tb extends nm{}class Eb extends nm{}class ea extends O{}class Pb extends ea{}class kb extends ea{async _call($){return new ta(await super._call($))}}class Sb extends ea{async _call($){return new Dt(await super._call($))}}class Cb extends ea{async _call($){return new nn(await super._call($))}}class $b extends O{}class Ib extends $b{async _call($){return new ta(await super._call($))}}class sm extends O{}class Ab extends sm{}class jb extends sm{async _call($){return new nn(await super._call($))}}class Ob extends O{}class Nb extends Ob{}class bd extends O{}class Db extends bd{}class Fb extends bd{async _call($){return new ta(await super._call($))}}class Lb extends bd{async _call($){return new Dt(await super._call($))}}class vc extends O{}class Rb extends vc{}class zb extends vc{async _call($){return new ta(await super._call($))}}class Bb extends vc{async _call($){return new Dt(await super._call($))}}class Ub extends vc{async _call($){return new nn(await super._call($))}}class Md extends O{}class Vb extends Md{}class Wb extends Md{async _call($){return new ta(await super._call($))}}class Gb extends Md{async _call($){return new Dt(await super._call($))}}class T3 extends O{}class qb extends ea{}class Kb extends ea{async _call($){return new ta(await super._call($))}}class Hb extends ea{async _call($){return new Dt(await super._call($))}}class Ko extends O{}class Qb extends Ko{}class Xb extends Ko{async _call($){return new ta(await super._call($))}}class Jb extends Ko{async _call($){return new Dt(await super._call($))}}class Yb extends Ko{async _call($){return new hT(await super._call($))}}class Zb extends Ko{async _call($){return new nn(await super._call($))}}class e1 extends O{}class t1 extends e1{}class Td extends O{}class E3 extends Td{}class r1 extends Td{}class n1 extends Td{async generate_speech($,R,{threshold:de=.5,minlenratio:Pe=0,maxlenratio:be=20,vocoder:Ie=null}={}){const Ue={input_ids:$},{encoder_outputs:Ze,encoder_attention_mask:st}=await J(this,Ue),vt=Ze.dims[1]/this.config.reduction_factor,Pt=Math.floor(vt*be),It=Math.floor(vt*Pe),Vt=this.config.num_mel_bins;let bt=[],Ot=null,pt=null,Bt=0;for(;;){++Bt;const gr=Q(!!pt);let xr;pt?xr=pt.output_sequence_out:xr=new u.Tensor("float32",new Float32Array(Vt),[1,1,Vt]);let Jr={use_cache_branch:gr,output_sequence:xr,encoder_attention_mask:st,speaker_embeddings:R,encoder_hidden_states:Ze};this.addPastKeyValues(Jr,Ot),pt=await W(this.sessions.decoder_model_merged,Jr),Ot=this.getPastKeyValues(pt,Ot);const{prob:fn,spectrum:Ut}=pt;if(bt.push(Ut),Bt>=It&&(Array.from(fn.data).filter(sn=>sn>=de).length>0||Bt>=Pt))break}const Jt=(0,u.cat)(bt),{waveform:dr}=await W(Ie.sessions.model,{spectrogram:Jt});return{spectrogram:Jt,waveform:dr}}}class s1 extends O{constructor(){super(...arguments);ie(this,"main_input_name","spectrogram")}}class i1 extends O{}class im extends i1{async generate_speech({input_ids:$,attention_mask:R,style:de,num_inference_steps:Pe=5,speed:be=1.05}){const{sampling_rate:Ie,chunk_compress_factor:Ue,base_chunk_size:Ze,latent_dim:st}=this.config,{last_hidden_state:vt,durations:Pt}=await W(this.sessions.text_encoder,{input_ids:$,attention_mask:R,style:de});Pt.div_(be);const It=Pt.max().item()*Ie,Vt=Ze*Ue,bt=Math.floor((It+Vt-1)/Vt),Ot=$.dims[0],pt=(0,u.ones)([Ot,bt]),Bt=(0,u.full)([Ot],Pe);let Jt=(0,u.randn)([Ot,st*Ue,bt]);for(let gr=0;gr<Pe;++gr){const xr=(0,u.full)([Ot],gr);({denoised_latents:Jt}=await W(this.sessions.latent_denoiser,{style:de,noisy_latents:Jt,latent_mask:pt,encoder_outputs:vt,attention_mask:R,timestep:xr,num_inference_steps:Bt}))}const{waveform:dr}=await W(this.sessions.voice_decoder,{latents:Jt});return{waveform:dr,durations:Pt}}}class a1 extends O{}class o1 extends a1{}class am extends O{}class l1 extends am{}class c1 extends am{}class om extends O{}class u1 extends om{}class d1 extends om{}class lm extends O{}class h1 extends lm{}class f1 extends lm{}class cm extends O{}class p1 extends cm{}class m1 extends cm{}class Ed extends O{}class g1 extends Ed{}class _1 extends Ed{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"text_model"})}}class y1 extends Ed{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"audio_model"})}}class w1 extends O{}class um extends w1{async _call($){return new pT(await super._call($))}}class Pd extends O{}class P3 extends Pd{}class v1 extends Pd{}class x1 extends Pd{}class dm extends O{}class b1 extends dm{}class M1 extends dm{}class hm extends O{}class T1 extends hm{}class E1 extends hm{async _call($){return new Dt(await super._call($))}}class fm extends O{}class k3 extends fm{}class S3 extends fm{}class pm extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}_apply_and_filter_by_delay_pattern_mask(R){const[de,Pe]=R.dims,be=this.config.decoder.num_codebooks,Ie=Pe-be;let Ue=0;for(let vt=0;vt<R.size;++vt){if(R.data[vt]===this.config.decoder.pad_token_id)continue;const Pt=vt%Pe,It=Math.floor(vt/Pe)%be,Vt=Pt-It;Vt>0&&Vt<=Ie&&(R.data[Ue++]=R.data[vt])}const Ze=Math.floor(de/be),st=Ue/(Ze*be);return new u.Tensor(R.type,R.data.slice(0,Ue),[Ze,be,st])}prepare_inputs_for_generation(R,de,Pe){let be=structuredClone(R);for(let Ue=0;Ue<be.length;++Ue)for(let Ze=0;Ze<be[Ue].length;++Ze)Ue%this.config.decoder.num_codebooks>=Ze&&(be[Ue][Ze]=BigInt(this.config.decoder.pad_token_id));return Pe.guidance_scale!==null&&Pe.guidance_scale>1&&(be=be.concat(be)),super.prepare_inputs_for_generation(be,de,Pe)}async generate(R){const de=await super.generate(R),Pe=this._apply_and_filter_by_delay_pattern_mask(de).unsqueeze_(0),{audio_values:be}=await W(this.sessions.encodec_decode,{audio_codes:Pe});return be}}class kd extends O{}class P1 extends kd{}class k1 extends kd{async _call($){return new Dt(await super._call($))}}class S1 extends kd{}class Sd extends O{}class C1 extends Sd{}class $1 extends Sd{async _call($){return new Dt(await super._call($))}}class I1 extends Sd{}class Cd extends O{}class A1 extends Cd{}class j1 extends Cd{async _call($){return new Dt(await super._call($))}}class O1 extends Cd{}class $d extends O{}class N1 extends $d{}class D1 extends $d{async _call($){return new Dt(await super._call($))}}class F1 extends $d{}class L1 extends O{}class R1 extends L1{}class z1 extends O{}class B1 extends z1{constructor(...R){super(...R);ie(this,"forward_params",["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"]);this._generation_mode="text"}async forward(R){const de=this._generation_mode??"text";let Pe;if(de==="text"||!R.past_key_values){const st=this.sessions.prepare_inputs_embeds,vt=(0,o.pick)(R,st.inputNames);Pe=await W(st,vt)}else{const st=this.sessions.gen_img_embeds,vt=(0,o.pick)({image_ids:R.input_ids},st.inputNames);Pe=await W(st,vt)}const be={...R,...Pe},Ie=await ae(this,be),Ue=this.sessions[de==="text"?"lm_head":"gen_head"];if(!Ue)throw new Error(`Unable to find "${Ue}" generation head`);const Ze=await W(Ue,(0,o.pick)(Ie,Ue.inputNames));return{...Pe,...Ie,...Ze}}async generate(R){return this._generation_mode="text",super.generate(R)}async generate_images(R){this._generation_mode="image";const de=(R.inputs??R[this.main_input_name]).dims[1],be=(await super.generate(R)).slice(null,[de,null]),Ie=this.sessions.image_decode,{decoded_image:Ue}=await W(Ie,{generated_tokens:be}),Ze=Ue.add_(1).mul_(255/2).clamp_(0,255).to("uint8"),st=[];for(const vt of Ze){const Pt=p.RawImage.fromTensor(vt);st.push(Pt)}return st}}class U1 extends ue{constructor({char_logits:$,bpe_logits:R,wp_logits:de}){super(),this.char_logits=$,this.bpe_logits=R,this.wp_logits=de}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class V1 extends O{}class W1 extends V1{async _call($){return new U1(await super._call($))}}class mm extends O{}class G1 extends mm{}class q1 extends mm{}class gm extends O{}class K1 extends gm{}class H1 extends gm{}class Q1 extends O{constructor(){super(...arguments);ie(this,"forward_params",["input_ids","attention_mask","position_ids","audio_values","past_key_values"])}}class _m extends Q1{_merge_input_ids_with_audio_features($){const R=$.audio_features.dims.at(-1),de=$.audio_features.view(-1,R);return L({audio_token_id:this.config.ignore_index??this.config.audio_token_id,...$,audio_features:de})}}class X1 extends _m{}class Id extends O{constructor(){super(...arguments);ie(this,"main_input_name","input_values");ie(this,"forward_params",["input_values"])}}class J1 extends ue{constructor({audio_codes:$}){super(),this.audio_codes=$}}class Y1 extends ue{constructor({audio_values:$}){super(),this.audio_values=$}}class Z1 extends Id{async encode($){return new J1(await W(this.sessions.encoder_model,$))}async decode($){return new Y1(await W(this.sessions.decoder_model,$))}}class eM extends Id{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"encoder_model"})}}class tM extends Id{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"decoder_model"})}}class Ad extends O{constructor(){super(...arguments);ie(this,"main_input_name","input_values");ie(this,"forward_params",["input_values"])}}class rM extends ue{constructor({audio_codes:$}){super(),this.audio_codes=$}}class nM extends ue{constructor({audio_values:$}){super(),this.audio_values=$}}class sM extends Ad{async encode($){return new rM(await W(this.sessions.encoder_model,$))}async decode($){return new nM(await W(this.sessions.decoder_model,$))}}class iM extends Ad{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"encoder_model"})}}class aM extends Ad{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"decoder_model"})}}class jd extends O{constructor(){super(...arguments);ie(this,"main_input_name","input_values");ie(this,"forward_params",["input_values"])}}class oM extends jd{async encode($){return await W(this.sessions.encoder_model,$)}async decode($){return await W(this.sessions.decoder_model,$)}}class lM extends jd{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"encoder_model"})}}class cM extends jd{static async from_pretrained($,R={}){return super.from_pretrained($,{...R,model_file_name:R.model_file_name??"decoder_model"})}}class Yt{static async from_pretrained($,{progress_callback:R=null,config:de=null,cache_dir:Pe=null,local_files_only:be=!1,revision:Ie="main",model_file_name:Ue=null,subfolder:Ze="onnx",device:st=null,dtype:vt=null,use_external_data_format:Pt=null,session_options:It={}}={}){const Vt={progress_callback:R,config:de,cache_dir:Pe,local_files_only:be,revision:Ie,model_file_name:Ue,subfolder:Ze,device:st,dtype:vt,use_external_data_format:Pt,session_options:It};if(Vt.config=await n.AutoConfig.from_pretrained($,Vt),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);const bt=Vt.config.model_type;for(const Ot of this.MODEL_CLASS_MAPPINGS){let pt=Ot.get(bt);if(!pt){for(const Bt of Ot.values())if(Bt[0]===bt){pt=Bt;break}if(!pt)continue}return await pt[1].from_pretrained($,Vt)}if(this.BASE_IF_FAIL)return NM.has(bt)||console.warn(`Unknown model class "${bt}", attempting to construct from base class.`),await O.from_pretrained($,Vt);throw Error(`Unsupported model type: ${bt}`)}}ie(Yt,"MODEL_CLASS_MAPPINGS",null),ie(Yt,"BASE_IF_FAIL",!1);const C3=new Map([["bert",["BertModel",me]],["neobert",["NeoBertModel",Oe]],["modernbert",["ModernBertModel",ze]],["nomic_bert",["NomicBertModel",Hr]],["roformer",["RoFormerModel",Er]],["electra",["ElectraModel",re]],["esm",["EsmModel",ks]],["convbert",["ConvBertModel",ki]],["camembert",["CamembertModel",ct]],["deberta",["DebertaModel",ar]],["deberta-v2",["DebertaV2Model",Ms]],["mpnet",["MPNetModel",Aa]],["albert",["AlbertModel",De]],["distilbert",["DistilBertModel",Es]],["roberta",["RobertaModel",Oo]],["xlm",["XLMModel",Ku]],["xlm-roberta",["XLMRobertaModel",Yu]],["clap",["ClapModel",g1]],["clip",["CLIPModel",Ro]],["clipseg",["CLIPSegModel",ls]],["chinese_clip",["ChineseCLIPModel",za]],["siglip",["SiglipModel",ic]],["jina_clip",["JinaCLIPModel",_d]],["mobilebert",["MobileBertModel",lt]],["squeezebert",["SqueezeBertModel",N]],["wav2vec2",["Wav2Vec2Model",Pb]],["wav2vec2-bert",["Wav2Vec2BertModel",Vb]],["unispeech",["UniSpeechModel",Db]],["unispeech-sat",["UniSpeechSatModel",Rb]],["hubert",["HubertModel",qb]],["wavlm",["WavLMModel",Qb]],["audio-spectrogram-transformer",["ASTModel",td]],["vits",["VitsModel",um]],["pyannote",["PyAnnoteModel",Ab]],["wespeaker-resnet",["WeSpeakerResNetModel",Nb]],["detr",["DetrModel",ax]],["rt_detr",["RTDetrModel",cx]],["rt_detr_v2",["RTDetrV2Model",dx]],["rf_detr",["RFDetrModel",px]],["d_fine",["DFineModel",_x]],["table-transformer",["TableTransformerModel",wx]],["vit",["ViTModel",Av]],["ijepa",["IJepaModel",Ov]],["pvt",["PvtModel",Lv]],["vit_msn",["ViTMSNModel",Uv]],["vit_mae",["ViTMAEModel",Bv]],["groupvit",["GroupViTModel",Gv]],["fastvit",["FastViTModel",qv]],["mobilevit",["MobileViTModel",Xv]],["mobilevitv2",["MobileViTV2Model",Yv]],["owlvit",["OwlViTModel",ex]],["owlv2",["Owlv2Model",rx]],["beit",["BeitModel",sx]],["deit",["DeiTModel",bx]],["hiera",["HieraModel",Tx]],["convnext",["ConvNextModel",Yx]],["convnextv2",["ConvNextV2Model",eb]],["dinov2",["Dinov2Model",rb]],["dinov2_with_registers",["Dinov2WithRegistersModel",sb]],["dinov3_vit",["DINOv3ViTModel",ob]],["dinov3_convnext",["DINOv3ConvNextModel",cb]],["resnet",["ResNetModel",Px]],["swin",["SwinModel",Sx]],["swin2sr",["Swin2SRModel",Ix]],["donut-swin",["DonutSwinModel",Jx]],["yolos",["YolosModel",hb]],["dpt",["DPTModel",jx]],["glpn",["GLPNModel",Hx]],["hifigan",["SpeechT5HifiGan",s1]],["efficientnet",["EfficientNetModel",T1]],["decision_transformer",["DecisionTransformerModel",R1]],["patchtst",["PatchTSTForPrediction",G1]],["patchtsmixer",["PatchTSMixerForPrediction",K1]],["mobilenet_v1",["MobileNetV1Model",P1]],["mobilenet_v2",["MobileNetV2Model",C1]],["mobilenet_v3",["MobileNetV3Model",A1]],["mobilenet_v4",["MobileNetV4Model",N1]],["maskformer",["MaskFormerModel",qx]],["mgp-str",["MgpstrForSceneTextRecognition",W1]],["style_text_to_speech_2",["StyleTextToSpeech2Model",t1]]]),$3=new Map([["t5",["T5Model",$t]],["longt5",["LongT5Model",Ir]],["mt5",["MT5Model",Ar]],["bart",["BartModel",en]],["mbart",["MBartModel",wn]],["marian",["MarianModel",bb]],["whisper",["WhisperModel",Zl]],["m2m_100",["M2M100Model",Tb]],["blenderbot",["BlenderbotModel",tn]],["blenderbot-small",["BlenderbotSmallModel",Gr]]]),I3=new Map([["mimi",["MimiModel",Z1]],["dac",["DacModel",sM]],["snac",["SnacModel",oM]]]),A3=new Map([["bloom",["BloomModel",Pv]],["jais",["JAISModel",Uo]],["gpt2",["GPT2Model",uc]],["gptj",["GPTJModel",mc]],["gpt_bigcode",["GPTBigCodeModel",_c]],["gpt_neo",["GPTNeoModel",fc]],["gpt_neox",["GPTNeoXModel",Wo]],["codegen",["CodeGenModel",D]],["llama",["LlamaModel",pe]],["nanochat",["NanoChatModel",Nt]],["arcee",["ArceeModel",rn]],["lfm2",["Lfm2Model",Lw]],["smollm3",["SmolLM3Model",zw]],["exaone",["ExaoneModel",qw]],["olmo",["OlmoModel",Xw]],["olmo2",["Olmo2Model",Yw]],["mobilellm",["MobileLLMModel",Hw]],["granite",["GraniteModel",ev]],["granitemoehybrid",["GraniteMoeHybridModel",rv]],["cohere",["CohereModel",sv]],["gemma",["GemmaModel",av]],["gemma2",["Gemma2Model",lv]],["vaultgemma",["VaultGemmaModel",uv]],["gemma3_text",["Gemma3Model",hv]],["helium",["HeliumModel",Uw]],["glm",["GlmModel",Ww]],["openelm",["OpenELMModel",pv]],["qwen2",["Qwen2Model",gv]],["qwen3",["Qwen3Model",yv]],["phi",["PhiModel",bv]],["phi3",["Phi3Model",Tv]],["mpt",["MptModel",Sv]],["opt",["OPTModel",$v]],["mistral",["MistralModel",l1]],["ernie4_5",["Ernie4_5_Model",u1]],["starcoder2",["Starcoder2Model",h1]],["falcon",["FalconModel",p1]],["stablelm",["StableLmModel",b1]],["modernbert-decoder",["ModernBertDecoderModel",ut]]]),ym=new Map([["speecht5",["SpeechT5ForSpeechToText",r1]],["whisper",["WhisperForConditionalGeneration",$i]],["lite-whisper",["LiteWhisperForConditionalGeneration",nd]],["moonshine",["MoonshineForConditionalGeneration",sd]]]),uM=new Map([["speecht5",["SpeechT5ForTextToSpeech",n1]]]),dM=new Map([["vits",["VitsModel",um]],["musicgen",["MusicgenForConditionalGeneration",pm]],["supertonic",["SupertonicForConditionalGeneration",im]]]),hM=new Map([["bert",["BertForSequenceClassification",xe]],["neobert",["NeoBertForSequenceClassification",We]],["modernbert",["ModernBertForSequenceClassification",yt]],["roformer",["RoFormerForSequenceClassification",Hi]],["electra",["ElectraForSequenceClassification",Y]],["esm",["EsmForSequenceClassification",An]],["convbert",["ConvBertForSequenceClassification",pi]],["camembert",["CamembertForSequenceClassification",xt]],["deberta",["DebertaForSequenceClassification",Bn]],["deberta-v2",["DebertaV2ForSequenceClassification",dn]],["mpnet",["MPNetForSequenceClassification",Oa]],["albert",["AlbertForSequenceClassification",Xe]],["distilbert",["DistilBertForSequenceClassification",Xn]],["roberta",["RobertaForSequenceClassification",Xl]],["xlm",["XLMForSequenceClassification",Qu]],["xlm-roberta",["XLMRobertaForSequenceClassification",ed]],["bart",["BartForSequenceClassification",mr]],["mbart",["MBartForSequenceClassification",Cs]],["mobilebert",["MobileBertForSequenceClassification",Ci]],["squeezebert",["SqueezeBertForSequenceClassification",se]]]),fM=new Map([["bert",["BertForTokenClassification",_e]],["neobert",["NeoBertForTokenClassification",Le]],["modernbert",["ModernBertForTokenClassification",Ve]],["roformer",["RoFormerForTokenClassification",Qi]],["electra",["ElectraForTokenClassification",ce]],["esm",["EsmForTokenClassification",He]],["convbert",["ConvBertForTokenClassification",zt]],["camembert",["CamembertForTokenClassification",jt]],["deberta",["DebertaForTokenClassification",Nr]],["deberta-v2",["DebertaV2ForTokenClassification",mi]],["mpnet",["MPNetForTokenClassification",Na]],["distilbert",["DistilBertForTokenClassification",En]],["roberta",["RobertaForTokenClassification",Gu]],["xlm",["XLMForTokenClassification",Xu]],["xlm-roberta",["XLMRobertaForTokenClassification",Jl]]]),wm=new Map([["t5",["T5ForConditionalGeneration",qt]],["longt5",["LongT5ForConditionalGeneration",sr]],["mt5",["MT5ForConditionalGeneration",kr]],["bart",["BartForConditionalGeneration",Ws]],["mbart",["MBartForConditionalGeneration",Ss]],["marian",["MarianMTModel",Mb]],["m2m_100",["M2M100ForConditionalGeneration",Eb]],["blenderbot",["BlenderbotForConditionalGeneration",Lr]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",On]]]),vm=new Map([["bloom",["BloomForCausalLM",kv]],["gpt2",["GPT2LMHeadModel",dc]],["jais",["JAISLMHeadModel",hc]],["gptj",["GPTJForCausalLM",gc]],["gpt_bigcode",["GPTBigCodeForCausalLM",v]],["gpt_neo",["GPTNeoForCausalLM",Va]],["gpt_neox",["GPTNeoXForCausalLM",pc]],["codegen",["CodeGenForCausalLM",z]],["llama",["LlamaForCausalLM",Ne]],["nanochat",["NanoChatForCausalLM",Kt]],["llama4_text",["Llama4ForCausalLM",nt]],["arcee",["ArceeForCausalLM",Ii]],["lfm2",["Lfm2ForCausalLM",Rw]],["smollm3",["SmolLM3ForCausalLM",Bw]],["exaone",["ExaoneForCausalLM",Kw]],["olmo",["OlmoForCausalLM",Jw]],["olmo2",["Olmo2ForCausalLM",Zw]],["mobilellm",["MobileLLMForCausalLM",Qw]],["granite",["GraniteForCausalLM",tv]],["granitemoehybrid",["GraniteMoeHybridForCausalLM",nv]],["cohere",["CohereForCausalLM",iv]],["gemma",["GemmaForCausalLM",ov]],["gemma2",["Gemma2ForCausalLM",cv]],["vaultgemma",["VaultGemmaForCausalLM",dv]],["gemma3_text",["Gemma3ForCausalLM",fv]],["helium",["HeliumForCausalLM",Vw]],["glm",["GlmForCausalLM",Gw]],["openelm",["OpenELMForCausalLM",mv]],["qwen2",["Qwen2ForCausalLM",_v]],["qwen3",["Qwen3ForCausalLM",wv]],["phi",["PhiForCausalLM",Mv]],["phi3",["Phi3ForCausalLM",Ev]],["mpt",["MptForCausalLM",Cv]],["opt",["OPTForCausalLM",Iv]],["mbart",["MBartForCausalLM",vn]],["mistral",["MistralForCausalLM",c1]],["ernie4_5",["Ernie4_5_ForCausalLM",d1]],["starcoder2",["Starcoder2ForCausalLM",f1]],["falcon",["FalconForCausalLM",m1]],["trocr",["TrOCRForCausalLM",o1]],["stablelm",["StableLmForCausalLM",M1]],["modernbert-decoder",["ModernBertDecoderForCausalLM",yr]],["phi3_v",["Phi3VForCausalLM",rc]]]),j3=new Map([["multi_modality",["MultiModalityCausalLM",B1]]]),pM=new Map([["bert",["BertForMaskedLM",ve]],["neobert",["NeoBertForMaskedLM",Me]],["modernbert",["ModernBertForMaskedLM",Ke]],["roformer",["RoFormerForMaskedLM",un]],["electra",["ElectraForMaskedLM",V]],["esm",["EsmForMaskedLM",Si]],["convbert",["ConvBertForMaskedLM",Et]],["camembert",["CamembertForMaskedLM",kt]],["deberta",["DebertaForMaskedLM",In]],["deberta-v2",["DebertaV2ForMaskedLM",Ts]],["mpnet",["MPNetForMaskedLM",ja]],["albert",["AlbertForMaskedLM",tt]],["distilbert",["DistilBertForMaskedLM",Wr]],["roberta",["RobertaForMaskedLM",Wu]],["xlm",["XLMWithLMHeadModel",Hu]],["xlm-roberta",["XLMRobertaForMaskedLM",Zu]],["mobilebert",["MobileBertForMaskedLM",lr]],["squeezebert",["SqueezeBertForMaskedLM",q]]]),mM=new Map([["bert",["BertForQuestionAnswering",je]],["neobert",["NeoBertForQuestionAnswering",rt]],["roformer",["RoFormerForQuestionAnswering",Xi]],["electra",["ElectraForQuestionAnswering",Se]],["convbert",["ConvBertForQuestionAnswering",or]],["camembert",["CamembertForQuestionAnswering",ot]],["deberta",["DebertaForQuestionAnswering",Xr]],["deberta-v2",["DebertaV2ForQuestionAnswering",gi]],["mpnet",["MPNetForQuestionAnswering",Da]],["albert",["AlbertForQuestionAnswering",it]],["distilbert",["DistilBertForQuestionAnswering",Ps]],["roberta",["RobertaForQuestionAnswering",qu]],["xlm",["XLMForQuestionAnswering",Ju]],["xlm-roberta",["XLMRobertaForQuestionAnswering",Yl]],["mobilebert",["MobileBertForQuestionAnswering",Vs]],["squeezebert",["SqueezeBertForQuestionAnswering",he]]]),xm=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",ec]],["idefics3",["Idefics3ForConditionalGeneration",_i]],["smolvlm",["SmolVLMForConditionalGeneration",Lo]]]),gM=new Map([["llava",["LlavaForConditionalGeneration",La]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",id]],["moondream1",["Moondream1ForConditionalGeneration",ad]],["florence2",["Florence2ForConditionalGeneration",ld]],["qwen2-vl",["Qwen2VLForConditionalGeneration",xv]],["idefics3",["Idefics3ForConditionalGeneration",_i]],["smolvlm",["SmolVLMForConditionalGeneration",Lo]],["paligemma",["PaliGemmaForConditionalGeneration",ud]],["llava_qwen2",["LlavaQwen2ForCausalLM",dd]],["gemma3n",["Gemma3nForConditionalGeneration",tc]]]),_M=new Map([["ultravox",["UltravoxModel",_m]],["voxtral",["VoxtralForConditionalGeneration",X1]]]),O3=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",ec]]]),yM=new Map([["vit",["ViTForImageClassification",jv]],["ijepa",["IJepaForImageClassification",Nv]],["pvt",["PvtForImageClassification",Rv]],["vit_msn",["ViTMSNForImageClassification",Vv]],["fastvit",["FastViTForImageClassification",Kv]],["mobilevit",["MobileViTForImageClassification",Jv]],["mobilevitv2",["MobileViTV2ForImageClassification",Zv]],["beit",["BeitForImageClassification",ix]],["deit",["DeiTForImageClassification",Mx]],["hiera",["HieraForImageClassification",Ex]],["convnext",["ConvNextForImageClassification",Zx]],["convnextv2",["ConvNextV2ForImageClassification",tb]],["dinov2",["Dinov2ForImageClassification",nb]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",ib]],["resnet",["ResNetForImageClassification",kx]],["swin",["SwinForImageClassification",Cx]],["segformer",["SegformerForImageClassification",v1]],["efficientnet",["EfficientNetForImageClassification",E1]],["mobilenet_v1",["MobileNetV1ForImageClassification",k1]],["mobilenet_v2",["MobileNetV2ForImageClassification",$1]],["mobilenet_v3",["MobileNetV3ForImageClassification",j1]],["mobilenet_v4",["MobileNetV4ForImageClassification",D1]]]),wM=new Map([["detr",["DetrForObjectDetection",ox]],["rt_detr",["RTDetrForObjectDetection",ux]],["rt_detr_v2",["RTDetrV2ForObjectDetection",hx]],["rf_detr",["RFDetrForObjectDetection",mx]],["d_fine",["DFineForObjectDetection",yx]],["table-transformer",["TableTransformerForObjectDetection",vx]],["yolos",["YolosForObjectDetection",fb]]]),vM=new Map([["owlvit",["OwlViTForObjectDetection",tx]],["owlv2",["Owlv2ForObjectDetection",nx]],["grounding-dino",["GroundingDinoForObjectDetection",db]]]),Ho=new Map([["detr",["DetrForSegmentation",Fp]],["clipseg",["CLIPSegForImageSegmentation",Ba]]]),xM=new Map([["segformer",["SegformerForSemanticSegmentation",x1]],["sapiens",["SapiensForSemanticSegmentation",Fx]],["swin",["SwinForSemanticSegmentation",$x]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",S1]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",I1]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",O1]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",F1]]]),bM=new Map([["detr",["DetrForSegmentation",Fp]],["maskformer",["MaskFormerForInstanceSegmentation",Kx]]]),MM=new Map([["sam",["SamModel",gb]],["sam2",["Sam2Model",xd]],["edgetam",["EdgeTamModel",vb]],["sam3_tracker",["Sam3TrackerModel",xb]]]),TM=new Map([["wav2vec2",["Wav2Vec2ForCTC",kb]],["wav2vec2-bert",["Wav2Vec2BertForCTC",Wb]],["unispeech",["UniSpeechForCTC",Fb]],["unispeech-sat",["UniSpeechSatForCTC",zb]],["wavlm",["WavLMForCTC",Xb]],["hubert",["HubertForCTC",Kb]],["parakeet_ctc",["ParakeetForCTC",Ib]]]),EM=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",Sb]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",Gb]],["unispeech",["UniSpeechForSequenceClassification",Lb]],["unispeech-sat",["UniSpeechSatForSequenceClassification",Bb]],["wavlm",["WavLMForSequenceClassification",Jb]],["hubert",["HubertForSequenceClassification",Hb]],["audio-spectrogram-transformer",["ASTForAudioClassification",rd]]]),PM=new Map([["wavlm",["WavLMForXVector",Yb]]]),kM=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",Ub]],["wavlm",["WavLMForAudioFrameClassification",Zb]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",Cb]],["pyannote",["PyAnnoteForAudioFrameClassification",jb]]]),SM=new Map([["vitmatte",["VitMatteForImageMatting",Qv]]]),N3=new Map([["patchtst",["PatchTSTForPrediction",q1]],["patchtsmixer",["PatchTSMixerForPrediction",H1]]]),CM=new Map([["swin2sr",["Swin2SRForImageSuperResolution",Ax]]]),$M=new Map([["dpt",["DPTForDepthEstimation",Ox]],["depth_anything",["DepthAnythingForDepthEstimation",Dx]],["glpn",["GLPNForDepthEstimation",Qx]],["sapiens",["SapiensForDepthEstimation",Lx]],["depth_pro",["DepthProForDepthEstimation",Bx]],["metric3d",["Metric3DForDepthEstimation",Vx]],["metric3dv2",["Metric3Dv2ForDepthEstimation",Gx]]]),IM=new Map([["sapiens",["SapiensForNormalEstimation",Rx]]]),AM=new Map([["vitpose",["VitPoseForPoseEstimation",Fv]]]),jM=new Map([["clip",["CLIPVisionModelWithProjection",sc]],["siglip",["SiglipVisionModel",ac]],["jina_clip",["JinaCLIPVisionModel",cc]]]),OM=[[C3,w.EncoderOnly],[$3,w.EncoderDecoder],[A3,w.DecoderOnly],[I3,w.AutoEncoder],[hM,w.EncoderOnly],[fM,w.EncoderOnly],[wm,w.Seq2Seq],[ym,w.Seq2Seq],[vm,w.DecoderOnly],[j3,w.MultiModality],[pM,w.EncoderOnly],[mM,w.EncoderOnly],[xm,w.Vision2Seq],[gM,w.ImageTextToText],[_M,w.AudioTextToText],[yM,w.EncoderOnly],[Ho,w.EncoderOnly],[bM,w.EncoderOnly],[xM,w.EncoderOnly],[SM,w.EncoderOnly],[N3,w.EncoderOnly],[CM,w.EncoderOnly],[$M,w.EncoderOnly],[IM,w.EncoderOnly],[AM,w.EncoderOnly],[wM,w.EncoderOnly],[vM,w.EncoderOnly],[MM,w.MaskGeneration],[TM,w.EncoderOnly],[EM,w.EncoderOnly],[uM,w.Seq2Seq],[dM,w.EncoderOnly],[PM,w.EncoderOnly],[kM,w.EncoderOnly],[jM,w.EncoderOnly]];for(const[k,$]of OM)for(const[R,de]of k.values())M.set(R,$),T.set(de,R),E.set(R,de);const D3=[["MusicgenForConditionalGeneration",pm,w.Musicgen],["Phi3VForCausalLM",rc,w.Phi3V],["CLIPTextModelWithProjection",nc,w.EncoderOnly],["SiglipTextModel",gd,w.EncoderOnly],["JinaCLIPTextModel",lc,w.EncoderOnly],["ClapTextModelWithProjection",_1,w.EncoderOnly],["ClapAudioModelWithProjection",y1,w.EncoderOnly],["DacEncoderModel",iM,w.EncoderOnly],["DacDecoderModel",aM,w.EncoderOnly],["MimiEncoderModel",eM,w.EncoderOnly],["MimiDecoderModel",tM,w.EncoderOnly],["SnacEncoderModel",lM,w.EncoderOnly],["SnacDecoderModel",cM,w.EncoderOnly],["Gemma3nForConditionalGeneration",tc,w.ImageAudioTextToText],["SupertonicForConditionalGeneration",im,w.Supertonic]];for(const[k,$,R]of D3)M.set(k,R),T.set($,k),E.set(k,$);const NM=new Map([["modnet",Ho],["birefnet",Ho],["isnet",Ho],["ben",Ho]]);for(const[k,$]of NM.entries())$.set(k,["PreTrainedModel",O]),M.set(k,w.EncoderOnly),T.set(O,k),E.set(k,O);class bm extends Yt{}ie(bm,"MODEL_CLASS_MAPPINGS",OM.map($=>$[0])),ie(bm,"BASE_IF_FAIL",!0);class DM extends Yt{}ie(DM,"MODEL_CLASS_MAPPINGS",[hM]);class FM extends Yt{}ie(FM,"MODEL_CLASS_MAPPINGS",[fM]);class LM extends Yt{}ie(LM,"MODEL_CLASS_MAPPINGS",[wm]);class RM extends Yt{}ie(RM,"MODEL_CLASS_MAPPINGS",[ym]);class zM extends Yt{}ie(zM,"MODEL_CLASS_MAPPINGS",[uM]);class BM extends Yt{}ie(BM,"MODEL_CLASS_MAPPINGS",[dM]);class UM extends Yt{}ie(UM,"MODEL_CLASS_MAPPINGS",[vm]);class VM extends Yt{}ie(VM,"MODEL_CLASS_MAPPINGS",[pM]);class WM extends Yt{}ie(WM,"MODEL_CLASS_MAPPINGS",[mM]);class GM extends Yt{}ie(GM,"MODEL_CLASS_MAPPINGS",[xm]);class qM extends Yt{}ie(qM,"MODEL_CLASS_MAPPINGS",[yM]);class KM extends Yt{}ie(KM,"MODEL_CLASS_MAPPINGS",[Ho]);class HM extends Yt{}ie(HM,"MODEL_CLASS_MAPPINGS",[xM]);class QM extends Yt{}ie(QM,"MODEL_CLASS_MAPPINGS",[bM]);class XM extends Yt{}ie(XM,"MODEL_CLASS_MAPPINGS",[wM]);class JM extends Yt{}ie(JM,"MODEL_CLASS_MAPPINGS",[vM]);class YM extends Yt{}ie(YM,"MODEL_CLASS_MAPPINGS",[MM]);class ZM extends Yt{}ie(ZM,"MODEL_CLASS_MAPPINGS",[TM]);class eT extends Yt{}ie(eT,"MODEL_CLASS_MAPPINGS",[EM]);class tT extends Yt{}ie(tT,"MODEL_CLASS_MAPPINGS",[PM]);class rT extends Yt{}ie(rT,"MODEL_CLASS_MAPPINGS",[kM]);class nT extends Yt{}ie(nT,"MODEL_CLASS_MAPPINGS",[O3]);class sT extends Yt{}ie(sT,"MODEL_CLASS_MAPPINGS",[SM]);class iT extends Yt{}ie(iT,"MODEL_CLASS_MAPPINGS",[CM]);class aT extends Yt{}ie(aT,"MODEL_CLASS_MAPPINGS",[$M]);class oT extends Yt{}ie(oT,"MODEL_CLASS_MAPPINGS",[IM]);class lT extends Yt{}ie(lT,"MODEL_CLASS_MAPPINGS",[AM]);class cT extends Yt{}ie(cT,"MODEL_CLASS_MAPPINGS",[jM]);class uT extends Yt{}ie(uT,"MODEL_CLASS_MAPPINGS",[gM]);class dT extends Yt{}ie(dT,"MODEL_CLASS_MAPPINGS",[_M]);class F3 extends ue{constructor({logits:$,past_key_values:R,encoder_outputs:de,decoder_attentions:Pe=null,cross_attentions:be=null}){super(),this.logits=$,this.past_key_values=R,this.encoder_outputs=de,this.decoder_attentions=Pe,this.cross_attentions=be}}class Dt extends ue{constructor({logits:$,...R}){super(),this.logits=$;const de=Object.values(R);de.length>0&&(this.attentions=de)}}class hT extends ue{constructor({logits:$,embeddings:R}){super(),this.logits=$,this.embeddings=R}}class nn extends ue{constructor({logits:$}){super(),this.logits=$}}class hn extends ue{constructor({logits:$}){super(),this.logits=$}}class Pn extends ue{constructor({start_logits:$,end_logits:R}){super(),this.start_logits=$,this.end_logits=R}}class ta extends ue{constructor({logits:$}){super(),this.logits=$}}class L3 extends ue{constructor({logits:$,past_key_values:R}){super(),this.logits=$,this.past_key_values=R}}class fT extends ue{constructor({alphas:$}){super(),this.alphas=$}}class pT extends ue{constructor({waveform:$,spectrogram:R}){super(),this.waveform=$,this.spectrogram=R}}},"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":(e,t,r)=>{r.r(t),r.d(t,{ASTFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js");class i extends n.FeatureExtractor{constructor(o){super(o);const l=this.config.sampling_rate,c=(0,s.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(l/2),l,null,"kaldi",!0);this.mel_filters=c,this.window=(0,s.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(o,l){return(0,s.spectrogram)(o,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:l,transpose:!0})}async _call(o){(0,n.validate_audio_inputs)(o,"ASTFeatureExtractor");const l=await this._extract_fbank_features(o,this.config.max_length);if(this.config.do_normalize){const c=this.std*2,d=l.data;for(let h=0;h<d.length;++h)d[h]=(d[h]-this.mean)/c}return{input_values:l.unsqueeze_(0)}}}},"./src/models/auto/feature_extraction_auto.js":(e,t,r)=>{r.r(t),r.d(t,{AutoFeatureExtractor:()=>a});var n=r("./src/utils/constants.js"),s=r("./src/utils/hub.js");r("./src/base/feature_extraction_utils.js");var i=r("./src/models/feature_extractors.js");class a{static async from_pretrained(l,c={}){const d=await(0,s.getModelJSON)(l,n.FEATURE_EXTRACTOR_NAME,!0,c),h=d.feature_extractor_type,u=i[h];if(!u)throw new Error(`Unknown feature_extractor_type: '${h}'. Please report this at ${n.GITHUB_ISSUE_URL}.`);return new u(d)}}},"./src/models/auto/image_processing_auto.js":(e,t,r)=>{r.r(t),r.d(t,{AutoImageProcessor:()=>o});var n=r("./src/utils/constants.js"),s=r("./src/utils/hub.js"),i=r("./src/base/image_processors_utils.js"),a=r("./src/models/image_processors.js");class o{static async from_pretrained(c,d={}){const h=await(0,s.getModelJSON)(c,n.IMAGE_PROCESSOR_NAME,!0,d),u=h.image_processor_type??h.feature_extractor_type;let p=a[u==null?void 0:u.replace(/Fast$/,"")];return p||(u!==void 0&&console.warn(`Image processor type '${u}' not found, assuming base ImageProcessor. Please report this at ${n.GITHUB_ISSUE_URL}.`),p=i.ImageProcessor),new p(h)}}},"./src/models/auto/processing_auto.js":(e,t,r)=>{r.r(t),r.d(t,{AutoProcessor:()=>c});var n=r("./src/utils/constants.js"),s=r("./src/utils/hub.js"),i=r("./src/base/processing_utils.js"),a=r("./src/models/processors.js"),o=r("./src/models/image_processors.js"),l=r("./src/models/feature_extractors.js");class c{static async from_pretrained(h,u={}){const p=await(0,s.getModelJSON)(h,n.IMAGE_PROCESSOR_NAME,!0,u),{image_processor_type:m,feature_extractor_type:y,processor_class:P}=p;if(P&&a[P])return a[P].from_pretrained(h,u);if(!m&&!y)throw new Error("No `image_processor_type` or `feature_extractor_type` found in the config.");const g={};if(m){const b=o[m.replace(/Fast$/,"")];if(!b)throw new Error(`Unknown image_processor_type: '${m}'.`);g.image_processor=new b(p)}if(y){const b=o[y];if(b)g.image_processor=new b(p);else{const w=l[y];if(!w)throw new Error(`Unknown feature_extractor_type: '${y}'.`);g.feature_extractor=new w(p)}}const _={};return new i.Processor(_,g,null)}}},"./src/models/beit/image_processing_beit.js":(e,t,r)=>{r.r(t),r.d(t,{BeitFeatureExtractor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/bit/image_processing_bit.js":(e,t,r)=>{r.r(t),r.d(t,{BitImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/chinese_clip/image_processing_chinese_clip.js":(e,t,r)=>{r.r(t),r.d(t,{ChineseCLIPFeatureExtractor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/clap/feature_extraction_clap.js":(e,t,r)=>{r.r(t),r.d(t,{ClapFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js");class i extends n.FeatureExtractor{constructor(o){super(o),this.mel_filters=(0,s.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,s.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,s.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(o,l,c,d){let h;const u=o.length-l;if(u>0)if(c==="rand_trunc"){const p=Math.floor(Math.random()*(u+1));o=o.subarray(p,p+l),h=await this._extract_fbank_features(o,this.mel_filters_slaney,this.config.nb_max_samples)}else throw new Error(`Truncation strategy "${c}" not implemented`);else{if(u<0){let p=new Float64Array(l);if(p.set(o),d==="repeat")for(let m=o.length;m<l;m+=o.length)p.set(o.subarray(0,Math.min(o.length,l-m)),m);else if(d==="repeatpad")for(let m=o.length;m<-u;m+=o.length)p.set(o,m);o=p}if(c==="fusion")throw new Error(`Truncation strategy "${c}" not implemented`);h=await this._extract_fbank_features(o,this.mel_filters_slaney,this.config.nb_max_samples)}return h.unsqueeze_(0)}async _extract_fbank_features(o,l,c=null){return(0,s.spectrogram)(o,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:l,log_mel:"dB",max_num_frames:c,do_pad:!1,transpose:!0})}async _call(o,{max_length:l=null}={}){return(0,n.validate_audio_inputs)(o,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(o,l??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}},"./src/models/clip/image_processing_clip.js":(e,t,r)=>{r.r(t),r.d(t,{CLIPFeatureExtractor:()=>i,CLIPImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/convnext/image_processing_convnext.js":(e,t,r)=>{r.r(t),r.d(t,{ConvNextFeatureExtractor:()=>i,ConvNextImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(o){super(o),this.crop_pct=this.config.crop_pct??224/256}async resize(o){var c;const l=(c=this.size)==null?void 0:c.shortest_edge;if(l===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(l<384){const d=Math.floor(l/this.crop_pct),[h,u]=this.get_resize_output_image_size(o,{shortest_edge:d});o=await o.resize(h,u,{resample:this.resample}),o=await o.center_crop(l,l)}else o=await o.resize(l,l,{resample:this.resample});return o}}class i extends s{}},"./src/models/dac/feature_extraction_dac.js":(e,t,r)=>{r.r(t),r.d(t,{DacFeatureExtractor:()=>s});var n=r("./src/models/encodec/feature_extraction_encodec.js");class s extends n.EncodecFeatureExtractor{}},"./src/models/deit/image_processing_deit.js":(e,t,r)=>{r.r(t),r.d(t,{DeiTFeatureExtractor:()=>i,DeiTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/detr/image_processing_detr.js":(e,t,r)=>{r.r(t),r.d(t,{DetrFeatureExtractor:()=>a,DetrImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{async _call(l){const c=await super._call(l),d=[c.pixel_values.dims[0],64,64],h=(0,s.full)(d,1n);return{...c,pixel_mask:h}}post_process_object_detection(...l){return(0,n.post_process_object_detection)(...l)}post_process_panoptic_segmentation(...l){return(0,n.post_process_panoptic_segmentation)(...l)}post_process_instance_segmentation(...l){return(0,n.post_process_instance_segmentation)(...l)}}class a extends i{}},"./src/models/dinov3_vit/image_processing_dinov3_vit.js":(e,t,r)=>{r.r(t),r.d(t,{DINOv3ViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/donut/image_processing_donut.js":(e,t,r)=>{r.r(t),r.d(t,{DonutFeatureExtractor:()=>i,DonutImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{pad_image(o,l,c,d={}){const[h,u,p]=l;let m=this.image_mean;Array.isArray(this.image_mean)||(m=new Array(p).fill(m));let y=this.image_std;Array.isArray(y)||(y=new Array(p).fill(m));const P=m.map((g,_)=>-g/y[_]);return super.pad_image(o,l,c,{center:!0,constant_values:P,...d})}}class i extends s{}},"./src/models/dpt/image_processing_dpt.js":(e,t,r)=>{r.r(t),r.d(t,{DPTFeatureExtractor:()=>i,DPTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/efficientnet/image_processing_efficientnet.js":(e,t,r)=>{r.r(t),r.d(t,{EfficientNetImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(a){super(a),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(o=>o*o))}}},"./src/models/encodec/feature_extraction_encodec.js":(e,t,r)=>{r.r(t),r.d(t,{EncodecFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js");class i extends n.FeatureExtractor{async _call(o){(0,n.validate_audio_inputs)(o,"EncodecFeatureExtractor"),o instanceof Float64Array&&(o=new Float32Array(o));const l=this.config.feature_size;if(o.length%l!==0)throw new Error(`The length of the audio data must be a multiple of the number of channels (${l}).`);const c=[1,l,o.length/l];return{input_values:new s.Tensor("float32",o,c)}}}},"./src/models/feature_extractors.js":(e,t,r)=>{r.r(t),r.d(t,{ASTFeatureExtractor:()=>n.ASTFeatureExtractor,ClapFeatureExtractor:()=>i.ClapFeatureExtractor,DacFeatureExtractor:()=>a.DacFeatureExtractor,EncodecFeatureExtractor:()=>s.EncodecFeatureExtractor,Gemma3nAudioFeatureExtractor:()=>o.Gemma3nAudioFeatureExtractor,ImageFeatureExtractor:()=>g.ImageProcessor,MoonshineFeatureExtractor:()=>l.MoonshineFeatureExtractor,ParakeetFeatureExtractor:()=>c.ParakeetFeatureExtractor,PyAnnoteFeatureExtractor:()=>d.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>h.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>u.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>p.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>m.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>y.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>P.WhisperFeatureExtractor});var n=r("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js"),s=r("./src/models/encodec/feature_extraction_encodec.js"),i=r("./src/models/clap/feature_extraction_clap.js"),a=r("./src/models/dac/feature_extraction_dac.js"),o=r("./src/models/gemma3n/feature_extraction_gemma3n.js"),l=r("./src/models/moonshine/feature_extraction_moonshine.js"),c=r("./src/models/parakeet/feature_extraction_parakeet.js"),d=r("./src/models/pyannote/feature_extraction_pyannote.js"),h=r("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js"),u=r("./src/models/snac/feature_extraction_snac.js"),p=r("./src/models/speecht5/feature_extraction_speecht5.js"),m=r("./src/models/wav2vec2/feature_extraction_wav2vec2.js"),y=r("./src/models/wespeaker/feature_extraction_wespeaker.js"),P=r("./src/models/whisper/feature_extraction_whisper.js"),g=r("./src/base/image_processors_utils.js")},"./src/models/florence2/processing_florence2.js":(e,t,r)=>{r.r(t),r.d(t,{Florence2Processor:()=>a});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");class a extends n.Processor{constructor(l,c,d){super(l,c,d);const{tasks_answer_post_processing_type:h,task_prompts_without_inputs:u,task_prompts_with_input:p}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(h??{})),this.task_prompts_without_inputs=new Map(Object.entries(u??{})),this.task_prompts_with_input=new Map(Object.entries(p??{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1e3}construct_prompts(l){typeof l=="string"&&(l=[l]);const c=[];for(const d of l)if(this.task_prompts_without_inputs.has(d))c.push(this.task_prompts_without_inputs.get(d));else{for(const[h,u]of this.task_prompts_with_input)if(d.includes(h)){c.push(u.replaceAll("{input}",d).replaceAll(h,""));break}c.length!==l.length&&c.push(d)}return c}post_process_generation(l,c,d){const h=this.tasks_answer_post_processing_type.get(c)??"pure_text";l=l.replaceAll("<s>","").replaceAll("</s>","");let u;switch(h){case"pure_text":u=l;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":const p=h==="ocr"?"quad_boxes":"bboxes",m=l.matchAll(this.regexes[p]),y=[],P=[];for(const[g,_,...b]of m)y.push(_?_.trim():y.at(-1)??""),P.push(b.map((w,M)=>(Number(w)+.5)/this.size_per_bin*d[M%2]));u={labels:y,[p]:P};break;default:throw new Error(`Task "${c}" (of type "${h}") not yet implemented.`)}return{[c]:u}}async _call(l,c=null,d={}){if(!l&&!c)throw new Error("Either text or images must be provided");const h=await this.image_processor(l,d),u=c?this.tokenizer(this.construct_prompts(c),d):{};return{...h,...u}}}ie(a,"tokenizer_class",i.AutoTokenizer),ie(a,"image_processor_class",s.AutoImageProcessor)},"./src/models/gemma3n/feature_extraction_gemma3n.js":(e,t,r)=>{r.r(t),r.d(t,{Gemma3nAudioFeatureExtractor:()=>a});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/audio.js");class a extends n.FeatureExtractor{constructor(l){super(l);const{fft_length:c,feature_size:d,min_frequency:h,max_frequency:u,sampling_rate:p,frame_length:m}=this.config,y=(0,i.mel_filter_bank)(Math.floor(1+c/2),d,h,u,p,null,"htk",!1);this.mel_filters=y,this.window=(0,i.window_function)(m,"hann")}async _extract_fbank_features(l,c){return(0,i.spectrogram)(l,this.window,this.config.frame_length,this.config.hop_length,{fft_length:this.config.fft_length,center:!1,onesided:!0,preemphasis:this.config.preemphasis,preemphasis_htk_flavor:this.config.preemphasis_htk_flavor,mel_filters:this.mel_filters,log_mel:"log",mel_floor:this.config.mel_floor,remove_dc_offset:!1,transpose:!0})}async _call(l,{max_length:c=48e4,truncation:d=!0,padding:h=!0,pad_to_multiple_of:u=128}={}){if((0,n.validate_audio_inputs)(l,"Gemma3nAudioFeatureExtractor"),d&&l.length>c&&(l=l.slice(0,c)),h&&l.length%u!==0){const y=u-l.length%u,P=new Float64Array(l.length+y);P.set(l),this.config.padding_value!==0&&P.fill(this.config.padding_value,l.length),l=P}const p=await this._extract_fbank_features(l,this.config.max_length),m=(0,s.full)([1,p.dims[0]],!0);return{input_features:p.unsqueeze_(0),input_features_mask:m}}}},"./src/models/gemma3n/processing_gemma3n.js":(e,t,r)=>{r.r(t),r.d(t,{Gemma3nProcessor:()=>o});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/models/auto/feature_extraction_auto.js"),a=r("./src/tokenizers.js");r("./src/utils/image.js"),r("./src/utils/audio.js");class o extends n.Processor{constructor(c,d,h){super(c,d,h),this.audio_seq_length=this.config.audio_seq_length,this.image_seq_length=this.config.image_seq_length;const{audio_token_id:u,boa_token:p,audio_token:m,eoa_token:y,image_token_id:P,boi_token:g,image_token:_,eoi_token:b}=this.tokenizer.config;this.audio_token_id=u,this.boa_token=p,this.audio_token=m;const w=m.repeat(this.audio_seq_length);this.full_audio_sequence=`

${p}${w}${y}

`,this.image_token_id=P,this.boi_token=g,this.image_token=_;const M=_.repeat(this.image_seq_length);this.full_image_sequence=`

${g}${M}${b}

`}async _call(c,d=null,h=null,u={}){typeof c=="string"&&(c=[c]);let p;h&&(p=await this.feature_extractor(h,u),c=c.map(P=>P.replaceAll(this.audio_token,this.full_audio_sequence)));let m;return d&&(m=await this.image_processor(d,u),c=c.map(P=>P.replaceAll(this.image_token,this.full_image_sequence))),{...this.tokenizer(c,u),...m,...p}}}ie(o,"image_processor_class",s.AutoImageProcessor),ie(o,"feature_extractor_class",i.AutoFeatureExtractor),ie(o,"tokenizer_class",a.AutoTokenizer),ie(o,"uses_processor_config",!0),ie(o,"uses_chat_template_file",!0)},"./src/models/glpn/image_processing_glpn.js":(e,t,r)=>{r.r(t),r.d(t,{GLPNFeatureExtractor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/grounding_dino/image_processing_grounding_dino.js":(e,t,r)=>{r.r(t),r.d(t,{GroundingDinoImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{async _call(o){const l=await super._call(o),c=l.pixel_values.dims,d=(0,s.ones)([c[0],c[2],c[3]]);return{...l,pixel_mask:d}}}},"./src/models/grounding_dino/processing_grounding_dino.js":(e,t,r)=>{r.r(t),r.d(t,{GroundingDinoProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js"),a=r("./src/base/image_processors_utils.js");function o(c,d){const u=c.dims.at(-1)-1,p=c.tolist();p.fill(!1,0,1),p.fill(!1,u);const m=d.tolist();return p.map((y,P)=>y?P:null).filter(y=>y!==null).map(y=>m[y])}class l extends n.Processor{async _call(d,h,u={}){const p=d?await this.image_processor(d,u):{};return{...h?this.tokenizer(h,u):{},...p}}post_process_grounded_object_detection(d,h,{box_threshold:u=.25,text_threshold:p=.25,target_sizes:m=null}={}){const{logits:y,pred_boxes:P}=d,g=y.dims[0];if(m!==null&&m.length!==g)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const _=y.dims.at(1),b=y.sigmoid(),w=b.max(-1).tolist(),M=P.tolist().map(T=>T.map(S=>(0,a.center_to_corners_format)(S))),E=[];for(let T=0;T<g;++T){const S=m!==null?m[T]:null;S!==null&&(M[T]=M[T].map(B=>B.map((ee,Q)=>ee*S[(Q+1)%2])));const A=w[T],j=[],U=[],W=[];for(let B=0;B<_;++B){const ee=A[B];if(ee<=u)continue;const Q=M[T][B],Z=b[T][B];j.push(ee),W.push(Q);const J=o(Z.gt(p),h[T]);U.push(J)}E.push({scores:j,boxes:W,labels:this.batch_decode(U)})}return E}}ie(l,"tokenizer_class",i.AutoTokenizer),ie(l,"image_processor_class",s.AutoImageProcessor)},"./src/models/idefics3/image_processing_idefics3.js":(e,t,r)=>{r.r(t),r.d(t,{Idefics3ImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{constructor(o){super(o),this.do_image_splitting=o.do_image_splitting??!0,this.max_image_size=o.max_image_size}get_resize_for_vision_encoder(o,l){let[c,d]=o.dims.slice(-2);const h=d/c;return d>=c?(d=Math.ceil(d/l)*l,c=Math.floor(d/h),c=Math.ceil(c/l)*l):(c=Math.ceil(c/l)*l,d=Math.floor(c*h),d=Math.ceil(d/l)*l),{height:c,width:d}}async _call(o,{do_image_splitting:l=null,return_row_col_info:c=!1}={}){let d;if(!Array.isArray(o))d=[[o]];else{if(o.length===0||!o[0])throw new Error("No images provided.");Array.isArray(o[0])?d=o:d=[o]}let h=[],u=[],p=[];const m=[],y=[];for(const T of d){let S=await Promise.all(T.map(U=>this.preprocess(U)));m.push(...S.map(U=>U.original_size)),y.push(...S.map(U=>U.reshaped_input_size)),S.forEach(U=>U.pixel_values.unsqueeze_(0));const{longest_edge:A}=this.max_image_size;let j;if(l??this.do_image_splitting){let U=new Array(S.length),W=new Array(S.length);j=await Promise.all(S.map(async(B,ee)=>{const Q=this.get_resize_for_vision_encoder(B.pixel_values,A),Z=await(0,s.interpolate_4d)(B.pixel_values,{size:[Q.height,Q.width]}),{frames:J,num_splits_h:X,num_splits_w:ae}=await this.split_image(Z,this.max_image_size);return U[ee]=X,W[ee]=ae,(0,s.cat)(J,0)})),u.push(U),p.push(W)}else{const U=[A,A];j=await Promise.all(S.map(W=>(0,s.interpolate_4d)(W.pixel_values,{size:U}))),u.push(new Array(S.length).fill(0)),p.push(new Array(S.length).fill(0))}h.push((0,s.cat)(j,0))}const P=h.length,[g,_,b,w]=h[0].dims;let M,E;if(P===1)M=h[0].unsqueeze_(0),E=(0,s.full)([P,g,b,w],!0);else{const T=Math.max(...h.map(j=>j.dims.at(0)));E=(0,s.full)([P,T,b,w],!0);const S=E.data,A=T*b*w;for(let j=0;j<P;++j){const U=h[j].dims[0];if(U<T){h[j]=(0,s.cat)([h[j],(0,s.full)([T-U,_,b,w],0)],0);const W=j*A+U*b*w,B=(j+1)*A;S.fill(!1,W,B)}}M=(0,s.stack)(h,0)}return{pixel_values:M,pixel_attention_mask:E,original_sizes:m,reshaped_input_sizes:y,...c?{rows:u,cols:p}:{}}}async split_image(o,{longest_edge:l}){const c=l,d=l,h=[],[u,p]=o.dims.slice(-2);let m=0,y=0;if(u>c||p>d){m=Math.ceil(u/c),y=Math.ceil(p/d);const P=Math.ceil(u/m),g=Math.ceil(p/y);for(let w=0;w<m;++w)for(let M=0;M<y;++M){let E,T,S,A;w===m-1?(T=u-P,A=u):(T=w*P,A=(w+1)*P),M===y-1?(E=p-g,S=p):(E=M*g,S=(M+1)*g);const j=[T,E],U=[A,S],W=await(0,s.slice)(o,j,U,[2,3]);h.push(W)}const _=c,b=d;(u!==_||p!==b)&&(o=await(0,s.interpolate_4d)(o,{size:[_,b]}))}return h.push(o),{frames:h,num_splits_h:m,num_splits_w:y}}}},"./src/models/idefics3/processing_idefics3.js":(e,t,r)=>{r.r(t),r.d(t,{Idefics3Processor:()=>d});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");r("./src/utils/image.js");var a=r("./src/utils/core.js");function o(h,u,p,m,y,P){let g="";for(let _=0;_<u;++_){for(let b=0;b<p;++b)g+=m+`<row_${_+1}_col_${b+1}>`+y.repeat(h);g+=`
`}return g+=`
${m}${P}`+y.repeat(h)+`${m}`,g}function l(h,u,p,m){return`${u}${m}`+p.repeat(h)+`${u}`}function c(h,u,p,m,y,P){return h===0&&u===0?l(p,m,y,P):o(p,h,u,m,y,P)}class d extends n.Processor{constructor(){super(...arguments);ie(this,"fake_image_token","<fake_token_around_image>");ie(this,"image_token","<image>");ie(this,"global_img_token","<global-img>")}async _call(p,m=null,y={}){y.return_row_col_info??(y.return_row_col_info=!0);let P;m&&(P=await this.image_processor(m,y)),Array.isArray(p)||(p=[p]);const g=P.rows??[new Array(p.length).fill(0)],_=P.cols??[new Array(p.length).fill(0)],b=this.config.image_seq_len,w=[],M=[];for(let T=0;T<p.length;++T){const S=p[T],A=g[T],j=_[T];w.push((0,a.count)(S,this.image_token));const U=A.map((ee,Q)=>c(ee,j[Q],b,this.fake_image_token,this.image_token,this.global_img_token)),W=S.split(this.image_token);if(W.length===0)throw new Error("The image token should be present in the text.");let B=W[0];for(let ee=0;ee<U.length;++ee)B+=U[ee]+W[ee+1];M.push(B)}return{...this.tokenizer(M),...P}}}ie(d,"image_processor_class",s.AutoImageProcessor),ie(d,"tokenizer_class",i.AutoTokenizer),ie(d,"uses_processor_config",!0)},"./src/models/image_processors.js":(e,t,r)=>{r.r(t),r.d(t,{BeitFeatureExtractor:()=>n.BeitFeatureExtractor,BitImageProcessor:()=>s.BitImageProcessor,CLIPFeatureExtractor:()=>a.CLIPFeatureExtractor,CLIPImageProcessor:()=>a.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>i.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>o.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>o.ConvNextImageProcessor,DINOv3ViTImageProcessor:()=>d.DINOv3ViTImageProcessor,DPTFeatureExtractor:()=>u.DPTFeatureExtractor,DPTImageProcessor:()=>u.DPTImageProcessor,DeiTFeatureExtractor:()=>l.DeiTFeatureExtractor,DeiTImageProcessor:()=>l.DeiTImageProcessor,DetrFeatureExtractor:()=>c.DetrFeatureExtractor,DetrImageProcessor:()=>c.DetrImageProcessor,DonutFeatureExtractor:()=>h.DonutFeatureExtractor,DonutImageProcessor:()=>h.DonutImageProcessor,EfficientNetImageProcessor:()=>p.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>m.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>y.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>P.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>_.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>b.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>w.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>M.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>M.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>E.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>E.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>T.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>T.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>S.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>S.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>A.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>A.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>j.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>j.MobileViTImageProcessor,NougatImageProcessor:()=>U.NougatImageProcessor,OwlViTFeatureExtractor:()=>B.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>B.OwlViTImageProcessor,Owlv2ImageProcessor:()=>W.Owlv2ImageProcessor,Phi3VImageProcessor:()=>ee.Phi3VImageProcessor,PvtImageProcessor:()=>Q.PvtImageProcessor,Qwen2VLImageProcessor:()=>Z.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>J.RTDetrImageProcessor,Sam2ImageProcessor:()=>ae.Sam2ImageProcessor,Sam3ImageProcessor:()=>le.Sam3ImageProcessor,SamImageProcessor:()=>X.SamImageProcessor,SegformerFeatureExtractor:()=>ne.SegformerFeatureExtractor,SegformerImageProcessor:()=>ne.SegformerImageProcessor,SiglipImageProcessor:()=>L.SiglipImageProcessor,SmolVLMImageProcessor:()=>F.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>G.Swin2SRImageProcessor,VLMImageProcessor:()=>g.VLMImageProcessor,ViTFeatureExtractor:()=>oe.ViTFeatureExtractor,ViTImageProcessor:()=>oe.ViTImageProcessor,VitMatteImageProcessor:()=>H.VitMatteImageProcessor,VitPoseImageProcessor:()=>Te.VitPoseImageProcessor,YolosFeatureExtractor:()=>Ce.YolosFeatureExtractor,YolosImageProcessor:()=>Ce.YolosImageProcessor});var n=r("./src/models/beit/image_processing_beit.js"),s=r("./src/models/bit/image_processing_bit.js"),i=r("./src/models/chinese_clip/image_processing_chinese_clip.js"),a=r("./src/models/clip/image_processing_clip.js"),o=r("./src/models/convnext/image_processing_convnext.js"),l=r("./src/models/deit/image_processing_deit.js"),c=r("./src/models/detr/image_processing_detr.js"),d=r("./src/models/dinov3_vit/image_processing_dinov3_vit.js"),h=r("./src/models/donut/image_processing_donut.js"),u=r("./src/models/dpt/image_processing_dpt.js"),p=r("./src/models/efficientnet/image_processing_efficientnet.js"),m=r("./src/models/glpn/image_processing_glpn.js"),y=r("./src/models/grounding_dino/image_processing_grounding_dino.js"),P=r("./src/models/idefics3/image_processing_idefics3.js"),g=r("./src/models/janus/image_processing_janus.js"),_=r("./src/models/jina_clip/image_processing_jina_clip.js"),b=r("./src/models/llava_onevision/image_processing_llava_onevision.js"),w=r("./src/models/mask2former/image_processing_mask2former.js"),M=r("./src/models/maskformer/image_processing_maskformer.js"),E=r("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js"),T=r("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js"),S=r("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js"),A=r("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js"),j=r("./src/models/mobilevit/image_processing_mobilevit.js"),U=r("./src/models/nougat/image_processing_nougat.js"),W=r("./src/models/owlv2/image_processing_owlv2.js"),B=r("./src/models/owlvit/image_processing_owlvit.js"),ee=r("./src/models/phi3_v/image_processing_phi3_v.js"),Q=r("./src/models/pvt/image_processing_pvt.js"),Z=r("./src/models/qwen2_vl/image_processing_qwen2_vl.js"),J=r("./src/models/rt_detr/image_processing_rt_detr.js"),X=r("./src/models/sam/image_processing_sam.js"),ae=r("./src/models/sam2/image_processing_sam2.js"),le=r("./src/models/sam3/image_processing_sam3.js"),ne=r("./src/models/segformer/image_processing_segformer.js"),L=r("./src/models/siglip/image_processing_siglip.js"),F=r("./src/models/smolvlm/image_processing_smolvlm.js"),G=r("./src/models/swin2sr/image_processing_swin2sr.js"),oe=r("./src/models/vit/image_processing_vit.js"),H=r("./src/models/vitmatte/image_processing_vitmatte.js"),Te=r("./src/models/vitpose/image_processing_vitpose.js"),Ce=r("./src/models/yolos/image_processing_yolos.js")},"./src/models/janus/image_processing_janus.js":(e,t,r)=>{r.r(t),r.d(t,{VLMImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(a){super({do_pad:!0,pad_size:{width:a.image_size,height:a.image_size},...a}),this.constant_values=this.config.background_color.map(o=>o*this.rescale_factor)}pad_image(a,o,l,c){return super.pad_image(a,o,l,{constant_values:this.constant_values,center:!0,...c})}}},"./src/models/janus/processing_janus.js":(e,t,r)=>{r.r(t),r.d(t,{VLChatProcessor:()=>c});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js"),a=r("./src/utils/core.js"),o=r("./src/utils/tensor.js"),l=r("./src/utils/image.js");class c extends n.Processor{constructor(h,u,p){super(h,u,p),this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(h,{images:u=null,chat_template:p="default"}={}){u?Array.isArray(u)||(u=[u]):u=await Promise.all(h.filter(j=>j.images).flatMap(j=>j.images).map(j=>l.RawImage.read(j)));const m=this.tokenizer,y=m.apply_chat_template(h,{tokenize:!1,add_generation_prompt:!0,chat_template:p}),P=j=>m.encode(j,{add_special_tokens:!1}),g=y.split(this.image_tag),_=g.length-1;if(u.length!==_)throw new Error(`Number of images provided (${u.length}) does not match number of "${this.image_tag}" image tags (${_})`);const[b,w,M]=m.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]);let E=P(g[0]),T=new Array(E.length).fill(!1);for(let j=1;j<g.length;++j){const U=new Array(this.num_image_tokens).fill(b),W=P(g[j]);E=(0,a.mergeArrays)(E,[w],U,[M],W);const B=new Array(this.num_image_tokens).fill(!0);T=(0,a.mergeArrays)(T,[!1],B,[!1],new Array(W.length).fill(!1))}const S=[1,E.length],A={input_ids:new o.Tensor("int64",E,S),attention_mask:new o.Tensor("int64",new Array(E.length).fill(1),S),images_seq_mask:new o.Tensor("bool",T,S),images_emb_mask:new o.Tensor("bool",new Array(_*this.num_image_tokens).fill(!0),[1,_,this.num_image_tokens])};if(u&&u.length>0){const j=await this.image_processor(u);return j.pixel_values.unsqueeze_(0),{...A,...j}}return A}}ie(c,"image_processor_class",s.AutoImageProcessor),ie(c,"tokenizer_class",i.AutoTokenizer),ie(c,"uses_processor_config",!0)},"./src/models/jina_clip/image_processing_jina_clip.js":(e,t,r)=>{r.r(t),r.d(t,{JinaCLIPImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(a){const{resize_mode:o,fill_color:l,interpolation:c,size:d,...h}=a,u=o==="squash"?{width:d,height:d}:o==="shortest"?{shortest_edge:d}:{longest_edge:d},p=c==="bicubic"?3:2;super({...h,size:u,resample:p,do_center_crop:!0,crop_size:d,do_normalize:!0})}}},"./src/models/jina_clip/processing_jina_clip.js":(e,t,r)=>{r.r(t),r.d(t,{JinaCLIPProcessor:()=>a});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");class a extends n.Processor{async _call(l=null,c=null,d={}){if(!l&&!c)throw new Error("Either text or images must be provided");const h=l?this.tokenizer(l,d):{},u=c?await this.image_processor(c,d):{};return{...h,...u}}}ie(a,"tokenizer_class",i.AutoTokenizer),ie(a,"image_processor_class",s.AutoImageProcessor)},"./src/models/llava/processing_llava.js":(e,t,r)=>{r.r(t),r.d(t,{LlavaProcessor:()=>a});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");class a extends n.Processor{async _call(l,c=null,d={}){const h=await this.image_processor(l,d);if(c){const[p,m]=h.pixel_values.dims.slice(-2),{image_token:y,patch_size:P,num_additional_image_tokens:g}=this.config,_=Math.floor(p/P)*Math.floor(m/P)+g;c=structuredClone(c),Array.isArray(c)||(c=[c]);for(let b=0;b<c.length;++b)c[b]=c[b].replace(y,y.repeat(_))}const u=c?this.tokenizer(c,d):{};return{...h,...u}}}ie(a,"tokenizer_class",i.AutoTokenizer),ie(a,"image_processor_class",s.AutoImageProcessor),ie(a,"uses_processor_config",!0)},"./src/models/llava_onevision/image_processing_llava_onevision.js":(e,t,r)=>{r.r(t),r.d(t,{LlavaOnevisionImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/mask2former/image_processing_mask2former.js":(e,t,r)=>{r.r(t),r.d(t,{Mask2FormerImageProcessor:()=>s});var n=r("./src/models/maskformer/image_processing_maskformer.js");class s extends n.MaskFormerImageProcessor{}},"./src/models/maskformer/image_processing_maskformer.js":(e,t,r)=>{r.r(t),r.d(t,{MaskFormerFeatureExtractor:()=>i,MaskFormerImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_panoptic_segmentation(...o){return(0,n.post_process_panoptic_segmentation)(...o)}post_process_instance_segmentation(...o){return(0,n.post_process_instance_segmentation)(...o)}}class i extends s{}},"./src/models/mgp_str/processing_mgp_str.js":(e,t,r)=>{r.r(t),r.d(t,{MgpstrProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js"),a=r("./src/utils/maths.js");const o={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class l extends n.Processor{get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(d,h){if(!o.hasOwnProperty(h))throw new Error(`Format ${h} is not supported.`);const[u,p]=o[h],m=this[u].bind(this),[y,P]=d.dims,g=[],_=[],b=d.tolist();for(let M=0;M<y;++M){const E=b[M],T=[],S=[];for(let j=1;j<P;++j){const[U,W]=(0,a.max)((0,a.softmax)(E[j]));if(S.push(U),W==p)break;T.push(W)}const A=S.length>0?S.reduce((j,U)=>j*U,1):0;_.push(T),g.push(A)}return[m(_),g]}char_decode(d){return this.char_tokenizer.batch_decode(d).map(h=>h.replaceAll(" ",""))}bpe_decode(d){return this.bpe_tokenizer.batch_decode(d)}wp_decode(d){return this.wp_tokenizer.batch_decode(d).map(h=>h.replaceAll(" ",""))}batch_decode([d,h,u]){const[p,m]=this._decode_helper(d,"char"),[y,P]=this._decode_helper(h,"bpe"),[g,_]=this._decode_helper(u,"wp"),b=[],w=[];for(let M=0;M<p.length;++M){const[E,T]=(0,a.max)([m[M],P[M],_[M]]);b.push([p[M],y[M],g[M]][T]),w.push(E)}return{generated_text:b,scores:w,char_preds:p,bpe_preds:y,wp_preds:g}}static async from_pretrained(...d){const h=await super.from_pretrained(...d),u=await i.AutoTokenizer.from_pretrained("Xenova/gpt2"),p=await i.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return h.components={image_processor:h.image_processor,char_tokenizer:h.tokenizer,bpe_tokenizer:u,wp_tokenizer:p},h}async _call(d,h=null){const u=await this.image_processor(d);return h&&(u.labels=this.tokenizer(h).input_ids),u}}ie(l,"tokenizer_class",i.AutoTokenizer),ie(l,"image_processor_class",s.AutoImageProcessor)},"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":(e,t,r)=>{r.r(t),r.d(t,{MobileNetV1FeatureExtractor:()=>i,MobileNetV1ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":(e,t,r)=>{r.r(t),r.d(t,{MobileNetV2FeatureExtractor:()=>i,MobileNetV2ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":(e,t,r)=>{r.r(t),r.d(t,{MobileNetV3FeatureExtractor:()=>i,MobileNetV3ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":(e,t,r)=>{r.r(t),r.d(t,{MobileNetV4FeatureExtractor:()=>i,MobileNetV4ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/mobilevit/image_processing_mobilevit.js":(e,t,r)=>{r.r(t),r.d(t,{MobileViTFeatureExtractor:()=>i,MobileViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/moonshine/feature_extraction_moonshine.js":(e,t,r)=>{r.r(t),r.d(t,{MoonshineFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js");class i extends n.FeatureExtractor{async _call(o){(0,n.validate_audio_inputs)(o,"MoonshineFeatureExtractor"),o instanceof Float64Array&&(o=new Float32Array(o));const l=[1,o.length];return{input_values:new s.Tensor("float32",o,l)}}}},"./src/models/moonshine/processing_moonshine.js":(e,t,r)=>{r.r(t),r.d(t,{MoonshineProcessor:()=>a});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),i=r("./src/base/processing_utils.js");class a extends i.Processor{async _call(l){return await this.feature_extractor(l)}}ie(a,"tokenizer_class",s.AutoTokenizer),ie(a,"feature_extractor_class",n.AutoFeatureExtractor)},"./src/models/nougat/image_processing_nougat.js":(e,t,r)=>{r.r(t),r.d(t,{NougatImageProcessor:()=>s});var n=r("./src/models/donut/image_processing_donut.js");class s extends n.DonutImageProcessor{}},"./src/models/owlv2/image_processing_owlv2.js":(e,t,r)=>{r.r(t),r.d(t,{Owlv2ImageProcessor:()=>s});var n=r("./src/models/owlvit/image_processing_owlvit.js");class s extends n.OwlViTImageProcessor{}},"./src/models/owlvit/image_processing_owlvit.js":(e,t,r)=>{r.r(t),r.d(t,{OwlViTFeatureExtractor:()=>i,OwlViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_object_detection(...o){return(0,n.post_process_object_detection)(...o)}}class i extends s{}},"./src/models/owlvit/processing_owlvit.js":(e,t,r)=>{r.r(t),r.d(t,{OwlViTProcessor:()=>a});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");class a extends n.Processor{}ie(a,"tokenizer_class",i.AutoTokenizer),ie(a,"image_processor_class",s.AutoImageProcessor)},"./src/models/paligemma/processing_paligemma.js":(e,t,r)=>{r.r(t),r.d(t,{PaliGemmaProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");const a="<image>";function o(c,d,h,u,p){return`${u.repeat(h*p)}${d}${c}
`}class l extends n.Processor{async _call(d,h=null,u={}){h||(console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),h=""),Array.isArray(d)||(d=[d]),Array.isArray(h)||(h=[h]);const p=this.tokenizer.bos_token,m=this.image_processor.config.image_seq_length;let y;h.some(_=>_.includes(a))?y=h.map(_=>{const b=_.replaceAll(a,a.repeat(m)),w=b.lastIndexOf(a),M=w===-1?0:w+a.length;return b.slice(0,M)+p+b.slice(M)+`
`}):(console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),y=h.map(_=>o(_,p,m,a,d.length)));const P=this.tokenizer(y,u);return{...await this.image_processor(d,u),...P}}}ie(l,"tokenizer_class",i.AutoTokenizer),ie(l,"image_processor_class",s.AutoImageProcessor),ie(l,"uses_processor_config",!1)},"./src/models/parakeet/feature_extraction_parakeet.js":(e,t,r)=>{r.r(t),r.d(t,{ParakeetFeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/audio.js");const a=1e-5;class o extends n.FeatureExtractor{constructor(c){var u;super(c),(u=this.config).mel_filters??(u.mel_filters=(0,i.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,this.config.sampling_rate/2,this.config.sampling_rate,"slaney","slaney"));const d=(0,i.window_function)(this.config.win_length,"hann",{periodic:!1});this.window=new Float64Array(this.config.n_fft);const h=Math.floor((this.config.n_fft-this.config.win_length)/2);this.window.set(d,h)}async _extract_fbank_features(c){const d=this.config.preemphasis;c=new Float64Array(c);for(let u=c.length-1;u>=1;--u)c[u]-=d*c[u-1];return await(0,i.spectrogram)(c,this.window,this.window.length,this.config.hop_length,{fft_length:this.config.n_fft,power:2,mel_filters:this.config.mel_filters,log_mel:"log",mel_floor:-1/0,pad_mode:"constant",center:!0,transpose:!0,mel_offset:2**-24})}async _call(c){(0,n.validate_audio_inputs)(c,"ParakeetFeatureExtractor");const d=await this._extract_fbank_features(c),h=Math.floor((c.length+Math.floor(this.config.n_fft/2)*2-this.config.n_fft)/this.config.hop_length),u=d.data;u.fill(0,h*d.dims[1]);const[p,m]=d.dims,y=new Float64Array(m),P=new Float64Array(m);for(let b=0;b<h;++b){const w=b*m;for(let M=0;M<m;++M){const E=u[w+M];y[M]+=E,P[M]+=E*E}}const g=h>1?h-1:1;for(let b=0;b<m;++b){const w=y[b]/h,M=(P[b]-h*w*w)/g,T=1/(Math.sqrt(M)+a);for(let S=0;S<h;++S){const A=S*m+b;u[A]=(u[A]-w)*T}}const _=new BigInt64Array(p);return _.fill(1n,0,h),{input_features:d.unsqueeze_(0),attention_mask:new s.Tensor("int64",_,[1,p])}}}},"./src/models/phi3_v/image_processing_phi3_v.js":(e,t,r)=>{r.r(t),r.d(t,{Phi3VImageProcessor:()=>d});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");const i=336,a=[2,3],{ceil:o,floor:l,sqrt:c}=Math;class d extends n.ImageProcessor{constructor(u){super({...u,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0}),this._num_crops=u.num_crops}calc_num_image_tokens_from_image_size(u,p){const{num_img_tokens:m}=this.config;return l((l(p/i)*l(u/i)+1)*m+1+(l(p/i)+1)*c(m))}get_resize_output_image_size(u,p){const m=this._num_crops,[y,P]=u.size;let g=y/P,_=1;for(;_*Math.ceil(_/g)<=m;)_+=1;_-=1;const b=Math.floor(_*336),w=Math.floor(b/g);return[b,w]}pad_image(u,p,m,y={}){const[P,g]=p,_=i*o(P/i),b=i*o(g/i),w=[1,1,1].map((M,E)=>(M-this.image_mean[E])/this.image_std[E]);return super.pad_image(u,p,{width:b,height:_},{center:!0,constant_values:w,...y})}async _call(u,{num_crops:p=null}={}){if(this._num_crops=p??(p=this.config.num_crops),p<4||c(p)%1!==0)throw new Error("num_crops must be a square number >= 4");Array.isArray(u)||(u=[u]);const m=u.length,y=await Promise.all(u.map(T=>this.preprocess(T))),P=y.map(T=>T.original_size),g=y.map(T=>T.reshaped_input_size),_=[];for(const{pixel_values:T}of y){T.unsqueeze_(0);const[S,A]=T.dims.slice(-2),j=await(0,s.interpolate_4d)(T,{size:[i,i],mode:"bicubic"});if(p>0){const U=[],W=c(p),B=l(A/W),ee=l(S/W);for(let Z=0;Z<W;++Z)for(let J=0;J<W;++J){let X,ae,le,ne;Z===W-1?(ae=S-ee,ne=S):(ae=Z*ee,ne=(Z+1)*ee),J===W-1?(X=A-B,le=A):(X=J*B,le=(J+1)*B);const L=[ae,X],F=[ne,le],G=await(0,s.slice)(T,L,F,a);U.push(G)}const Q=await(0,s.interpolate_4d)((0,s.cat)(U,0),{size:[i,i],mode:"bicubic"});_.push((0,s.cat)([j,Q],0))}else _.push(j)}const b=(0,s.stack)(_,0),w=g.map(T=>T.map(S=>i*o(S/i))),M=new s.Tensor("int64",w.flat(),[m,2]),E=w.map(([T,S])=>this.calc_num_image_tokens_from_image_size(S,T));return{pixel_values:b,original_sizes:P,reshaped_input_sizes:g,image_sizes:M,num_img_tokens:E}}}},"./src/models/phi3_v/processing_phi3_v.js":(e,t,r)=>{r.r(t),r.d(t,{Phi3VProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");r("./src/utils/image.js");const a="<|image|>",o=/<\|image_\d+\|>/g;class l extends n.Processor{async _call(d,h=null,{padding:u=!0,truncation:p=!0,num_crops:m=null}={}){Array.isArray(d)||(d=[d]);let y,P;if(h){P=await this.image_processor(h,{num_crops:m});const{num_img_tokens:g}=P,_=d.map((w,M)=>w.split(o).join(a.repeat(g[M])));y=this.tokenizer(_,{padding:u,truncation:p});const b=this.tokenizer.model.convert_tokens_to_ids([a])[0];y.input_ids.map_(w=>w==b?-w:w)}else y=this.tokenizer(d);return{...y,...P}}}ie(l,"image_processor_class",s.AutoImageProcessor),ie(l,"tokenizer_class",i.AutoTokenizer)},"./src/models/processors.js":(e,t,r)=>{r.r(t),r.d(t,{Florence2Processor:()=>n.Florence2Processor,Gemma3nProcessor:()=>s.Gemma3nProcessor,GroundingDinoProcessor:()=>i.GroundingDinoProcessor,Idefics3Processor:()=>a.Idefics3Processor,JinaCLIPProcessor:()=>l.JinaCLIPProcessor,LlavaProcessor:()=>c.LlavaProcessor,MgpstrProcessor:()=>d.MgpstrProcessor,MoonshineProcessor:()=>h.MoonshineProcessor,OwlViTProcessor:()=>u.OwlViTProcessor,PaliGemmaProcessor:()=>m.PaliGemmaProcessor,Phi3VProcessor:()=>p.Phi3VProcessor,PyAnnoteProcessor:()=>y.PyAnnoteProcessor,Qwen2VLProcessor:()=>P.Qwen2VLProcessor,Sam2Processor:()=>_.Sam2Processor,Sam2VideoProcessor:()=>_.Sam2VideoProcessor,SamProcessor:()=>g.SamProcessor,SmolVLMProcessor:()=>b.SmolVLMProcessor,SpeechT5Processor:()=>w.SpeechT5Processor,UltravoxProcessor:()=>M.UltravoxProcessor,VLChatProcessor:()=>o.VLChatProcessor,VoxtralProcessor:()=>E.VoxtralProcessor,Wav2Vec2Processor:()=>T.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>S.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>A.WhisperProcessor});var n=r("./src/models/florence2/processing_florence2.js"),s=r("./src/models/gemma3n/processing_gemma3n.js"),i=r("./src/models/grounding_dino/processing_grounding_dino.js"),a=r("./src/models/idefics3/processing_idefics3.js"),o=r("./src/models/janus/processing_janus.js"),l=r("./src/models/jina_clip/processing_jina_clip.js"),c=r("./src/models/llava/processing_llava.js"),d=r("./src/models/mgp_str/processing_mgp_str.js"),h=r("./src/models/moonshine/processing_moonshine.js"),u=r("./src/models/owlvit/processing_owlvit.js"),p=r("./src/models/phi3_v/processing_phi3_v.js"),m=r("./src/models/paligemma/processing_paligemma.js"),y=r("./src/models/pyannote/processing_pyannote.js"),P=r("./src/models/qwen2_vl/processing_qwen2_vl.js"),g=r("./src/models/sam/processing_sam.js"),_=r("./src/models/sam2/processing_sam2.js"),b=r("./src/models/smolvlm/processing_smolvlm.js"),w=r("./src/models/speecht5/processing_speecht5.js"),M=r("./src/models/ultravox/processing_ultravox.js"),E=r("./src/models/voxtral/processing_voxtral.js"),T=r("./src/models/wav2vec2/processing_wav2vec2.js"),S=r("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js"),A=r("./src/models/whisper/processing_whisper.js")},"./src/models/pvt/image_processing_pvt.js":(e,t,r)=>{r.r(t),r.d(t,{PvtImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/pyannote/feature_extraction_pyannote.js":(e,t,r)=>{r.r(t),r.d(t,{PyAnnoteFeatureExtractor:()=>a});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/maths.js");class a extends n.FeatureExtractor{async _call(l){(0,n.validate_audio_inputs)(l,"PyAnnoteFeatureExtractor"),l instanceof Float64Array&&(l=new Float32Array(l));const c=[1,1,l.length];return{input_values:new s.Tensor("float32",l,c)}}samples_to_frames(l){return(l-this.config.offset)/this.config.step}post_process_speaker_diarization(l,c){const d=c/this.samples_to_frames(c)/this.config.sampling_rate,h=[];for(const u of l.tolist()){const p=[];let m=-1;for(let y=0;y<u.length;++y){const P=(0,i.softmax)(u[y]),[g,_]=(0,i.max)(P),[b,w]=[y,y+1];_!==m?(m=_,p.push({id:_,start:b,end:w,score:g})):(p.at(-1).end=w,p.at(-1).score+=g)}h.push(p.map(({id:y,start:P,end:g,score:_})=>({id:y,start:P*d,end:g*d,confidence:_/(g-P)})))}return h}}},"./src/models/pyannote/processing_pyannote.js":(e,t,r)=>{r.r(t),r.d(t,{PyAnnoteProcessor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/models/pyannote/feature_extraction_pyannote.js");class i extends n.Processor{async _call(o){return await this.feature_extractor(o)}post_process_speaker_diarization(...o){return this.feature_extractor.post_process_speaker_diarization(...o)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}ie(i,"feature_extractor_class",s.PyAnnoteFeatureExtractor)},"./src/models/qwen2_vl/image_processing_qwen2_vl.js":(e,t,r)=>{r.r(t),r.d(t,{Qwen2VLImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{async _call(o,...l){const{pixel_values:c,original_sizes:d,reshaped_input_sizes:h}=await super._call(o,...l);let u=c;const{temporal_patch_size:p,merge_size:m,patch_size:y}=this.config;u.dims[0]===1&&(u=(0,s.cat)(Array.from({length:p},()=>u),0));const P=u.dims[0]/p,g=u.dims[1],_=Math.floor(u.dims[2]/y),b=Math.floor(u.dims[3]/y),w=u.view(P,p,g,Math.floor(_/m),m,y,Math.floor(b/m),m,y).permute(0,3,6,4,7,2,1,5,8).view(P*_*b,g*p*y*y),M=new s.Tensor("int64",[P,_,b],[1,3]);return{pixel_values:w,image_grid_thw:M,original_sizes:d,reshaped_input_sizes:h}}}},"./src/models/qwen2_vl/processing_qwen2_vl.js":(e,t,r)=>{r.r(t),r.d(t,{Qwen2VLProcessor:()=>a});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),i=r("./src/tokenizers.js");r("./src/utils/image.js");class a extends n.Processor{async _call(l,c=null,...d){Array.isArray(l)||(l=[l]);let h,u;if(c&&(h=await this.image_processor(c),u=h.image_grid_thw),u){let m=this.image_processor.config.merge_size**2,y=0;const P=u.tolist();l=l.map(g=>{for(;g.includes("<|image_pad|>");){const _=Number(P[y++].reduce((b,w)=>b*w,1n));g=g.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(_/m)))}return g.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(l),...h}}}ie(a,"image_processor_class",s.AutoImageProcessor),ie(a,"tokenizer_class",i.AutoTokenizer)},"./src/models/rt_detr/image_processing_rt_detr.js":(e,t,r)=>{r.r(t),r.d(t,{RTDetrImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_object_detection(...a){return(0,n.post_process_object_detection)(...a)}}},"./src/models/sam/image_processing_sam.js":(e,t,r)=>{r.r(t),r.d(t,{SamImageProcessor:()=>a});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/core.js"),i=r("./src/utils/tensor.js");class a extends n.ImageProcessor{reshape_input_points(l,c,d,h=!1){l=structuredClone(l);let u=(0,s.calculateDimensions)(l);if(u.length===3)h||(u=[1,...u]),l=[l];else if(u.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let p=0;p<l.length;++p){const[m,y]=c[p],[P,g]=d[p],_=[g/y,P/m];for(let b=0;b<l[p].length;++b)for(let w=0;w<l[p][b].length;++w)for(let M=0;M<l[p][b][w].length;++M)l[p][b][w][M]*=_[M%2]}return new i.Tensor("float32",Float32Array.from(l.flat(1/0)),u)}add_input_labels(l,c){let d=(0,s.calculateDimensions)(l);if(d.length===2)d=[1,...d],l=[l];else if(d.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(d.some((h,u)=>h!==c.dims[u]))throw Error(`The first ${d.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new i.Tensor("int64",l.flat(1/0).map(BigInt),d)}async _call(l,{input_points:c=null,input_labels:d=null,input_boxes:h=null}={}){const u=await super._call(l);if(c&&(u.input_points=this.reshape_input_points(c,u.original_sizes,u.reshaped_input_sizes)),d){if(!u.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");u.input_labels=this.add_input_labels(d,u.input_points)}return h&&(u.input_boxes=this.reshape_input_points(h,u.original_sizes,u.reshaped_input_sizes,!0)),u}async post_process_masks(l,c,d,{mask_threshold:h=0,binarize:u=!0,pad_size:p=null}={}){const m=[];p=p??this.pad_size??this.size;const y=[p.height,p.width];for(let P=0;P<c.length;++P){const g=c[P],_=d[P];let b=await(0,i.interpolate_4d)(l[P],{mode:"bilinear",size:y});if(b=b.slice(null,null,[0,_[0]],[0,_[1]]),b=await(0,i.interpolate_4d)(b,{mode:"bilinear",size:g}),u){const w=b.data,M=new Uint8Array(w.length);for(let E=0;E<w.length;++E)w[E]>h&&(M[E]=1);b=new i.Tensor("bool",M,b.dims)}m.push(b)}return m}generate_crop_boxes(l,c,{crop_n_layers:d=0,overlap_ratio:h=512/1500,points_per_crop:u=32,crop_n_points_downscale_factor:p=1}={}){}}},"./src/models/sam/processing_sam.js":(e,t,r)=>{r.r(t),r.d(t,{SamProcessor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js");class i extends n.Processor{async _call(...o){return await this.image_processor(...o)}post_process_masks(...o){return this.image_processor.post_process_masks(...o)}reshape_input_points(...o){return this.image_processor.reshape_input_points(...o)}}ie(i,"image_processor_class",s.AutoImageProcessor)},"./src/models/sam2/image_processing_sam2.js":(e,t,r)=>{r.r(t),r.d(t,{Sam2ImageProcessor:()=>n.SamImageProcessor});var n=r("./src/models/sam/image_processing_sam.js")},"./src/models/sam2/processing_sam2.js":(e,t,r)=>{r.r(t),r.d(t,{Sam2Processor:()=>s,Sam2VideoProcessor:()=>i});var n=r("./src/models/sam/processing_sam.js");class s extends n.SamProcessor{}class i extends s{}},"./src/models/sam3/image_processing_sam3.js":(e,t,r)=>{r.r(t),r.d(t,{Sam3ImageProcessor:()=>n.Sam2ImageProcessor});var n=r("./src/models/sam2/image_processing_sam2.js")},"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":(e,t,r)=>{r.r(t),r.d(t,{SeamlessM4TFeatureExtractor:()=>a});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),i=r("./src/utils/audio.js");class a extends n.FeatureExtractor{constructor(l){super(l);const c=this.config.sampling_rate,d=(0,i.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(c/2),c,null,"kaldi",!0);this.mel_filters=d,this.window=(0,i.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(l,c){return l=l.map(d=>d*32768),(0,i.spectrogram)(l,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:c,transpose:!0})}async _call(l,{padding:c=!0,pad_to_multiple_of:d=2,do_normalize_per_mel_bins:h=!0,return_attention_mask:u=!0}={}){(0,n.validate_audio_inputs)(l,"SeamlessM4TFeatureExtractor");let p=await this._extract_fbank_features(l,this.config.max_length);if(h){const[M,E]=p.dims,T=p.data;for(let S=0;S<E;++S){let A=0;for(let B=0;B<M;++B)A+=T[B*E+S];const j=A/M;let U=0;for(let B=0;B<M;++B)U+=(T[B*E+S]-j)**2;U/=M-1;const W=Math.sqrt(U+1e-7);for(let B=0;B<M;++B){const ee=B*E+S;T[ee]=(T[ee]-j)/W}}}let m;if(c){const[M,E]=p.dims,T=p.data,S=M%d;if(S>0){const A=new Float32Array(E*(M+S));A.set(T),A.fill(this.config.padding_value,T.length);const j=M+S;p=new s.Tensor(p.type,A,[j,E]),u&&(m=new s.Tensor("int64",new BigInt64Array(j),[1,j]),m.data.fill(1n,0,M))}}const[y,P]=p.dims,g=this.config.stride;if(y%g!==0)throw new Error(`The number of frames (${y}) must be a multiple of the stride (${g}).`);const b=p.view(1,Math.floor(y/g),P*g),w={input_features:b};if(u){const M=b.dims[1],E=new BigInt64Array(M);if(m){const T=m.data;for(let S=1,A=0;S<y;S+=g,++A)E[A]=T[S]}else E.fill(1n);w.attention_mask=new s.Tensor("int64",E,[1,M])}return w}}},"./src/models/segformer/image_processing_segformer.js":(e,t,r)=>{r.r(t),r.d(t,{SegformerFeatureExtractor:()=>i,SegformerImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_semantic_segmentation(...o){return(0,n.post_process_semantic_segmentation)(...o)}}class i extends s{}},"./src/models/siglip/image_processing_siglip.js":(e,t,r)=>{r.r(t),r.d(t,{SiglipImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/smolvlm/image_processing_smolvlm.js":(e,t,r)=>{r.r(t),r.d(t,{SmolVLMImageProcessor:()=>n.Idefics3ImageProcessor});var n=r("./src/models/idefics3/image_processing_idefics3.js")},"./src/models/smolvlm/processing_smolvlm.js":(e,t,r)=>{r.r(t),r.d(t,{SmolVLMProcessor:()=>n.Idefics3Processor});var n=r("./src/models/idefics3/processing_idefics3.js")},"./src/models/snac/feature_extraction_snac.js":(e,t,r)=>{r.r(t),r.d(t,{SnacFeatureExtractor:()=>s});var n=r("./src/models/dac/feature_extraction_dac.js");class s extends n.DacFeatureExtractor{}},"./src/models/speecht5/feature_extraction_speecht5.js":(e,t,r)=>{r.r(t),r.d(t,{SpeechT5FeatureExtractor:()=>s});var n=r("./src/base/feature_extraction_utils.js");class s extends n.FeatureExtractor{}},"./src/models/speecht5/processing_speecht5.js":(e,t,r)=>{r.r(t),r.d(t,{SpeechT5Processor:()=>a});var n=r("./src/base/processing_utils.js"),s=r("./src/tokenizers.js"),i=r("./src/models/auto/feature_extraction_auto.js");class a extends n.Processor{async _call(l){return await this.feature_extractor(l)}}ie(a,"tokenizer_class",s.AutoTokenizer),ie(a,"feature_extractor_class",i.AutoFeatureExtractor)},"./src/models/swin2sr/image_processing_swin2sr.js":(e,t,r)=>{r.r(t),r.d(t,{Swin2SRImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{pad_image(a,o,l,c={}){const[d,h,u]=o;return super.pad_image(a,o,{width:h+(l-h%l)%l,height:d+(l-d%l)%l},{mode:"symmetric",center:!1,constant_values:-1,...c})}}},"./src/models/ultravox/processing_ultravox.js":(e,t,r)=>{r.r(t),r.d(t,{UltravoxProcessor:()=>a});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),i=r("./src/base/processing_utils.js");class a extends i.Processor{async _call(l,c=null,d={}){if(Array.isArray(l))throw new Error("Batched inputs are not supported yet.");let h={};if(c){const p=c.length,{input_features:m}=await this.feature_extractor(c,{...d,max_length:p}),y=Math.round(p/this.config.encoder_ds_factor+1e-4),P=1+Math.ceil(y/this.config.stack_factor);h.audio_token_len=[P],h.audio_values=m;const g=this.config.audio_placeholder;if(!l.includes(g))throw new Error(`The input text does not contain the image token ${g}.`);l=l.replaceAll(g,g.repeat(P))}return{...this.tokenizer(l,{add_special_tokens:!1,...d}),...h}}}ie(a,"tokenizer_class",s.AutoTokenizer),ie(a,"feature_extractor_class",n.AutoFeatureExtractor),ie(a,"uses_processor_config",!0)},"./src/models/vit/image_processing_vit.js":(e,t,r)=>{r.r(t),r.d(t,{ViTFeatureExtractor:()=>i,ViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class i extends s{}},"./src/models/vitmatte/image_processing_vitmatte.js":(e,t,r)=>{r.r(t),r.d(t,{VitMatteImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class i extends n.ImageProcessor{async _call(o,l){Array.isArray(o)||(o=[o]),Array.isArray(l)||(l=[l]);const c=await Promise.all(o.map(u=>this.preprocess(u))),d=await Promise.all(l.map(u=>this.preprocess(u,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,s.stack)(c.map((u,p)=>(0,s.cat)([u.pixel_values,d[p].pixel_values],0)),0),original_sizes:c.map(u=>u.original_size),reshaped_input_sizes:c.map(u=>u.reshaped_input_size)}}}},"./src/models/vitpose/image_processing_vitpose.js":(e,t,r)=>{r.r(t),r.d(t,{VitPoseImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_pose_estimation(a,o,{threshold:l=null}={}){const c=a.tolist(),[d,h,u,p]=a.dims,m=[];for(let y=0;y<d;++y){const P=c[y],g=o[y],_=[];for(let b=0;b<g.length;++b){const w=g[b],M=[],E=[],T=[],S=w.at(-2)/p,A=w.at(-1)/u;for(let j=0;j<P.length;++j){let[U,W]=[0,0],B=0,ee=-1/0;const Q=P[j];for(let J=0;J<Q.length;++J){const X=Q[J];for(let ae=0;ae<X.length;++ae){const le=X[ae];B+=le,ee=Math.max(ee,le),U+=(ae+.5)*le,W+=J*le}}if(l!=null&&ee<l)continue;const Z=[S*U/B,A*W/B];M.push(Z),T.push(j),E.push(ee)}_.push({bbox:w,scores:E,labels:T,keypoints:M})}m.push(_)}return m}}},"./src/models/voxtral/processing_voxtral.js":(e,t,r)=>{r.r(t),r.d(t,{VoxtralProcessor:()=>h});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),i=r("./src/base/processing_utils.js"),a=r("./src/utils/tensor.js");const o="[AUDIO]",l="[BEGIN_AUDIO]",c=375;function d(u,p){const m=[];for(let y=0;y<u.length;y+=p)m.push(u.subarray(y,Math.min(y+p,u.length)));return m}class h extends i.Processor{async _call(p,m=null,y={}){if(Array.isArray(p))throw new Error("Batched inputs are not supported yet.");const P={};if(m){if(!p.includes(o))throw new Error(`The input text does not contain the audio token ${o}.`);Array.isArray(m)||(m=[m]);const _=p.split(o),b=_.length-1;if(b!==m.length)throw new Error(`The number of audio inputs (${m.length}) does not match the number of audio tokens in the text (${b}).`);const w=this.feature_extractor.config.n_samples,M=m.map(j=>d(j,w)),E=M.map(j=>j.length),T=M.flat(),S=(await Promise.all(T.map(j=>this.feature_extractor(j,y)))).map(j=>j.input_features);P.audio_values=S.length>1?(0,a.cat)(S,0):S[0];let A=_[0];for(let j=0;j<E.length;++j){A+=l;for(let U=0;U<E[j];++U)A+=o.repeat(c);A+=_[j+1]}p=A}return{...this.tokenizer(p,{add_special_tokens:!1,...y}),...P}}}ie(h,"tokenizer_class",s.AutoTokenizer),ie(h,"feature_extractor_class",n.AutoFeatureExtractor),ie(h,"uses_processor_config",!1)},"./src/models/wav2vec2/feature_extraction_wav2vec2.js":(e,t,r)=>{r.r(t),r.d(t,{Wav2Vec2FeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js");class i extends n.FeatureExtractor{_zero_mean_unit_var_norm(o){const c=o.reduce((h,u)=>h+u,0)/o.length,d=o.reduce((h,u)=>h+(u-c)**2,0)/o.length;return o.map(h=>(h-c)/Math.sqrt(d+1e-7))}async _call(o){(0,n.validate_audio_inputs)(o,"Wav2Vec2FeatureExtractor"),o instanceof Float64Array&&(o=new Float32Array(o));let l=o;this.config.do_normalize&&(l=this._zero_mean_unit_var_norm(l));const c=[1,l.length];return{input_values:new s.Tensor("float32",l,c),attention_mask:new s.Tensor("int64",new BigInt64Array(l.length).fill(1n),c)}}}},"./src/models/wav2vec2/processing_wav2vec2.js":(e,t,r)=>{r.r(t),r.d(t,{Wav2Vec2Processor:()=>a});var n=r("./src/tokenizers.js"),s=r("./src/models/auto/feature_extraction_auto.js"),i=r("./src/base/processing_utils.js");class a extends i.Processor{async _call(l){return await this.feature_extractor(l)}}ie(a,"tokenizer_class",n.AutoTokenizer),ie(a,"feature_extractor_class",s.AutoFeatureExtractor)},"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":(e,t,r)=>{r.r(t),r.d(t,{Wav2Vec2ProcessorWithLM:()=>a});var n=r("./src/tokenizers.js"),s=r("./src/models/auto/feature_extraction_auto.js"),i=r("./src/base/processing_utils.js");class a extends i.Processor{async _call(l){return await this.feature_extractor(l)}}ie(a,"tokenizer_class",n.AutoTokenizer),ie(a,"feature_extractor_class",s.AutoFeatureExtractor)},"./src/models/wespeaker/feature_extraction_wespeaker.js":(e,t,r)=>{r.r(t),r.d(t,{WeSpeakerFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js");class i extends n.FeatureExtractor{constructor(o){super(o);const l=this.config.sampling_rate,c=(0,s.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(l/2),l,null,"kaldi",!0);this.mel_filters=c,this.window=(0,s.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(o){return o=o.map(l=>l*32768),(0,s.spectrogram)(o,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(o){(0,n.validate_audio_inputs)(o,"WeSpeakerFeatureExtractor");const l=(await this._extract_fbank_features(o)).unsqueeze_(0);if(this.config.fbank_centering_span===null){const c=l.mean(1).data,d=l.data,[h,u,p]=l.dims;for(let m=0;m<h;++m){const y=m*u*p,P=m*p;for(let g=0;g<u;++g){const _=y+g*p;for(let b=0;b<p;++b)d[_+b]-=c[P+b]}}}return{input_features:l}}}},"./src/models/whisper/common_whisper.js":(e,t,r)=>{r.r(t),r.d(t,{WHISPER_LANGUAGE_MAPPING:()=>s,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>i,whisper_language_to_code:()=>a});const n=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],s=new Map(n),i=new Map([...n.map(([o,l])=>[l,o]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function a(o){o=o.toLowerCase();let l=i.get(o);if(l===void 0){const c=o.match(/^<\|([a-z]{2})\|>$/);if(c&&(o=c[1]),s.has(o))l=o;else{const h=o.length===2?s.keys():s.values();throw new Error(`Language "${o}" is not supported. Must be one of: ${JSON.stringify(Array.from(h))}`)}}return l}},"./src/models/whisper/feature_extraction_whisper.js":(e,t,r)=>{r.r(t),r.d(t,{WhisperFeatureExtractor:()=>a});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js"),i=r("./src/utils/maths.js");class a extends n.FeatureExtractor{constructor(l){var c;super(l),(c=this.config).mel_filters??(c.mel_filters=(0,s.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney")),this.window=(0,s.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(l){const c=await(0,s.spectrogram)(l,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(l.length/this.config.hop_length),this.config.nb_max_frames)}),d=c.data,h=(0,i.max)(d)[0];for(let u=0;u<d.length;++u)d[u]=(Math.max(d[u],h-8)+4)/4;return c}async _call(l,{max_length:c=null}={}){(0,n.validate_audio_inputs)(l,"WhisperFeatureExtractor");let d;const h=c??this.config.n_samples;return l.length>h?(l.length>this.config.n_samples&&console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),d=l.slice(0,h)):(d=new Float32Array(h),d.set(l)),{input_features:(await this._extract_fbank_features(d)).unsqueeze_(0)}}}},"./src/models/whisper/generation_whisper.js":(e,t,r)=>{r.r(t),r.d(t,{WhisperGenerationConfig:()=>s});var n=r("./src/generation/configuration_utils.js");class s extends n.GenerationConfig{constructor(){super(...arguments);ie(this,"return_timestamps",null);ie(this,"return_token_timestamps",null);ie(this,"num_frames",null);ie(this,"alignment_heads",null);ie(this,"task",null);ie(this,"language",null);ie(this,"no_timestamps_token_id",null);ie(this,"prompt_ids",null);ie(this,"is_multilingual",null);ie(this,"lang_to_id",null);ie(this,"task_to_id",null);ie(this,"max_initial_timestamp_index",1)}}},"./src/models/whisper/processing_whisper.js":(e,t,r)=>{r.r(t),r.d(t,{WhisperProcessor:()=>a});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),i=r("./src/base/processing_utils.js");class a extends i.Processor{async _call(l){return await this.feature_extractor(l)}}ie(a,"tokenizer_class",s.AutoTokenizer),ie(a,"feature_extractor_class",n.AutoFeatureExtractor)},"./src/models/yolos/image_processing_yolos.js":(e,t,r)=>{r.r(t),r.d(t,{YolosFeatureExtractor:()=>i,YolosImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_object_detection(...o){return(0,n.post_process_object_detection)(...o)}}class i extends s{}},"./src/ops/registry.js":(e,t,r)=>{r.r(t),r.d(t,{TensorOpRegistry:()=>a});var n=r("./src/backends/onnx.js"),s=r("./src/utils/tensor.js");const i=async(o,l,c)=>{const d=await(0,n.createInferenceSession)(new Uint8Array(o),l);return async h=>{const u=(0,n.isONNXProxy)(),p=Object.fromEntries(Object.entries(h).map(([y,P])=>[y,(u?P.clone():P).ort_tensor])),m=await(0,n.runInferenceSession)(d,p);return Array.isArray(c)?c.map(y=>new s.Tensor(m[y])):new s.Tensor(m[c])}};class a{static get nearest_interpolate_4d(){return this._nearest_interpolate_4d||(this._nearest_interpolate_4d=i([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y")),this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=i([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=i([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=i([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=i([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=i([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=i([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}static get slice(){return this._slice||(this._slice=i([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y")),this._slice}}ie(a,"session_options",{})},"./src/pipelines.js":(e,t,r)=>{r.r(t),r.d(t,{AudioClassificationPipeline:()=>W,AutomaticSpeechRecognitionPipeline:()=>ee,BackgroundRemovalPipeline:()=>X,DepthEstimationPipeline:()=>oe,DocumentQuestionAnsweringPipeline:()=>L,FeatureExtractionPipeline:()=>j,FillMaskPipeline:()=>b,ImageClassificationPipeline:()=>Z,ImageFeatureExtractionPipeline:()=>U,ImageSegmentationPipeline:()=>J,ImageToImagePipeline:()=>G,ImageToTextPipeline:()=>Q,ObjectDetectionPipeline:()=>le,Pipeline:()=>y,QuestionAnsweringPipeline:()=>_,SummarizationPipeline:()=>M,Text2TextGenerationPipeline:()=>w,TextClassificationPipeline:()=>P,TextGenerationPipeline:()=>S,TextToAudioPipeline:()=>F,TokenClassificationPipeline:()=>g,TranslationPipeline:()=>E,ZeroShotAudioClassificationPipeline:()=>B,ZeroShotClassificationPipeline:()=>A,ZeroShotImageClassificationPipeline:()=>ae,ZeroShotObjectDetectionPipeline:()=>ne,pipeline:()=>Ce});var n=r("./src/tokenizers.js"),s=r("./src/models.js"),i=r("./src/models/auto/processing_auto.js");r("./src/base/processing_utils.js");var a=r("./src/utils/generic.js"),o=r("./src/utils/core.js"),l=r("./src/utils/maths.js"),c=r("./src/utils/audio.js"),d=r("./src/utils/tensor.js"),h=r("./src/utils/image.js");async function u($e){return Array.isArray($e)||($e=[$e]),await Promise.all($e.map(te=>h.RawImage.read(te)))}async function p($e,te){return Array.isArray($e)||($e=[$e]),await Promise.all($e.map(O=>typeof O=="string"||O instanceof URL?(0,c.read_audio)(O,te):O instanceof Float64Array?new Float32Array(O):O))}function m($e,te){te&&($e=$e.map(me=>me|0));const[O,ue,Ee,fe]=$e;return{xmin:O,ymin:ue,xmax:Ee,ymax:fe}}class y extends a.Callable{constructor({task:te,model:O,tokenizer:ue=null,processor:Ee=null}){super(),this.task=te,this.model=O,this.tokenizer=ue,this.processor=Ee}async dispose(){await this.model.dispose()}}class P extends y{constructor(te){super(te)}async _call(te,{top_k:O=1}={}){const ue=this.tokenizer(te,{padding:!0,truncation:!0}),Ee=await this.model(ue),fe=this.model.config.problem_type==="multi_label_classification"?xe=>xe.sigmoid():xe=>new d.Tensor("float32",(0,l.softmax)(xe.data),xe.dims),me=this.model.config.id2label,ve=[];for(const xe of Ee.logits){const _e=fe(xe),je=await(0,d.topk)(_e,O),we=je[0].tolist(),Me=je[1].tolist().map((We,Le)=>({label:me?me[We]:`LABEL_${We}`,score:we[Le]}));O===1?ve.push(...Me):ve.push(Me)}return Array.isArray(te)||O===1?ve:ve[0]}}class g extends y{constructor(te){super(te)}async _call(te,{ignore_labels:O=["O"]}={}){const ue=Array.isArray(te),Ee=this.tokenizer(ue?te:[te],{padding:!0,truncation:!0}),me=(await this.model(Ee)).logits,ve=this.model.config.id2label,xe=[];for(let _e=0;_e<me.dims[0];++_e){const je=Ee.input_ids[_e],we=me[_e],Oe=[];for(let Me=0;Me<we.dims[0];++Me){const We=we[Me],Le=(0,l.max)(We.data)[1],rt=ve?ve[Le]:`LABEL_${Le}`;if(O.includes(rt))continue;const Ye=this.tokenizer.decode([je[Me].item()],{skip_special_tokens:!0});if(Ye==="")continue;const ze=(0,l.softmax)(We.data);Oe.push({entity:rt,score:ze[Le],index:Me,word:Ye})}xe.push(Oe)}return ue?xe:xe[0]}}class _ extends y{constructor(te){super(te)}async _call(te,O,{top_k:ue=1}={}){const Ee=this.tokenizer(te,{text_pair:O,padding:!0,truncation:!0}),{start_logits:fe,end_logits:me}=await this.model(Ee),ve=Ee.input_ids.tolist(),xe=Ee.attention_mask.tolist(),_e=this.tokenizer.all_special_ids,je=[];for(let we=0;we<fe.dims[0];++we){const Oe=ve[we],Me=Oe.findIndex(Ke=>Ke==this.tokenizer.sep_token_id);xe[we].map((Ke,yt)=>Ke==1&&(yt===0||yt>Me&&_e.findIndex(Ve=>Ve==Oe[yt])===-1));const We=fe[we].tolist(),Le=me[we].tolist();for(let Ke=1;Ke<We.length;++Ke)(xe[we]==0||Ke<=Me||_e.findIndex(yt=>yt==Oe[Ke])!==-1)&&(We[Ke]=-1/0,Le[Ke]=-1/0);const rt=(0,l.softmax)(We).map((Ke,yt)=>[Ke,yt]),Ye=(0,l.softmax)(Le).map((Ke,yt)=>[Ke,yt]);rt[0][0]=0,Ye[0][0]=0;const ze=(0,o.product)(rt,Ye).filter(Ke=>Ke[0][1]<=Ke[1][1]).map(Ke=>[Ke[0][1],Ke[1][1],Ke[0][0]*Ke[1][0]]).sort((Ke,yt)=>yt[2]-Ke[2]);for(let Ke=0;Ke<Math.min(ze.length,ue);++Ke){const[yt,Ve,wt]=ze[Ke],ut=Oe.slice(yt,Ve+1),yr=this.tokenizer.decode(ut,{skip_special_tokens:!0});je.push({answer:yr,score:wt})}}return ue===1?je[0]:je}}class b extends y{constructor(te){super(te)}async _call(te,{top_k:O=5}={}){const ue=this.tokenizer(te,{padding:!0,truncation:!0}),{logits:Ee}=await this.model(ue),fe=[],me=ue.input_ids.tolist();for(let ve=0;ve<me.length;++ve){const xe=me[ve],_e=xe.findIndex(We=>We==this.tokenizer.mask_token_id);if(_e===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const je=Ee[ve][_e],we=await(0,d.topk)(new d.Tensor("float32",(0,l.softmax)(je.data),je.dims),O),Oe=we[0].tolist(),Me=we[1].tolist();fe.push(Me.map((We,Le)=>{const rt=xe.slice();return rt[_e]=We,{score:Oe[Le],token:Number(We),token_str:this.tokenizer.decode([We]),sequence:this.tokenizer.decode(rt,{skip_special_tokens:!0})}}))}return Array.isArray(te)?fe:fe[0]}}class w extends y{constructor(O){super(O);ie(this,"_key","generated_text")}async _call(O,ue={}){Array.isArray(O)||(O=[O]),this.model.config.prefix&&(O=O.map(_e=>this.model.config.prefix+_e));const Ee=this.model.config.task_specific_params;Ee&&Ee[this.task]&&Ee[this.task].prefix&&(O=O.map(_e=>Ee[this.task].prefix+_e));const fe=this.tokenizer,me={padding:!0,truncation:!0};let ve;this instanceof E&&"_build_translation_inputs"in fe?ve=fe._build_translation_inputs(O,me,ue):ve=fe(O,me);const xe=await this.model.generate({...ve,...ue});return fe.batch_decode(xe,{skip_special_tokens:!0}).map(_e=>({[this._key]:_e}))}}class M extends w{constructor(O){super(O);ie(this,"_key","summary_text")}}class E extends w{constructor(O){super(O);ie(this,"_key","translation_text")}}function T($e){return Array.isArray($e)&&$e.every(te=>"role"in te&&"content"in te)}class S extends y{constructor(te){super(te)}async _call(te,O={}){let ue=!1,Ee=!1,fe=O.add_special_tokens??(this.tokenizer.add_bos_token||this.tokenizer.add_eos_token)??!1,me;if(typeof te=="string")me=te=[te];else if(Array.isArray(te)&&te.every(Me=>typeof Me=="string"))ue=!0,me=te;else{if(T(te))te=[te];else if(Array.isArray(te)&&te.every(T))ue=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");Ee=!0,me=te.map(Me=>this.tokenizer.apply_chat_template(Me,{tokenize:!1,add_generation_prompt:!0})),fe=!1}const ve=Ee?!1:O.return_full_text??!0;this.tokenizer.padding_side="left";const xe=this.tokenizer(me,{add_special_tokens:fe,padding:!0,truncation:!0}),_e=await this.model.generate({...xe,...O}),je=this.tokenizer.batch_decode(_e,{skip_special_tokens:!0});let we;!ve&&xe.input_ids.dims.at(-1)>0&&(we=this.tokenizer.batch_decode(xe.input_ids,{skip_special_tokens:!0}).map(Me=>Me.length));const Oe=Array.from({length:te.length},Me=>[]);for(let Me=0;Me<je.length;++Me){const We=Math.floor(Me/_e.dims[0]*te.length);we&&(je[Me]=je[Me].slice(we[We])),Oe[We].push({generated_text:Ee?[...te[We],{role:"assistant",content:je[Me]}]:je[Me]})}return!ue&&Oe.length===1?Oe[0]:Oe}}class A extends y{constructor(te){super(te),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([O,ue])=>[O.toLowerCase(),ue])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(te,O,{hypothesis_template:ue="This example is {}.",multi_label:Ee=!1}={}){const fe=Array.isArray(te);fe||(te=[te]),Array.isArray(O)||(O=[O]);const me=O.map(_e=>ue.replace("{}",_e)),ve=Ee||O.length===1,xe=[];for(const _e of te){const je=[];for(const Me of me){const We=this.tokenizer(_e,{text_pair:Me,padding:!0,truncation:!0}),Le=await this.model(We);ve?je.push([Le.logits.data[this.contradiction_id],Le.logits.data[this.entailment_id]]):je.push(Le.logits.data[this.entailment_id])}const Oe=(ve?je.map(Me=>(0,l.softmax)(Me)[1]):(0,l.softmax)(je)).map((Me,We)=>[Me,We]).sort((Me,We)=>We[0]-Me[0]);xe.push({sequence:_e,labels:Oe.map(Me=>O[Me[1]]),scores:Oe.map(Me=>Me[0])})}return fe?xe:xe[0]}}class j extends y{constructor(te){super(te)}async _call(te,{pooling:O="none",normalize:ue=!1,quantize:Ee=!1,precision:fe="binary"}={}){const me=this.tokenizer(te,{padding:!0,truncation:!0}),ve=await this.model(me);let xe=ve.last_hidden_state??ve.logits??ve.token_embeddings;switch(O){case"none":break;case"mean":xe=(0,d.mean_pooling)(xe,me.attention_mask);break;case"first_token":case"cls":xe=xe.slice(null,0);break;case"last_token":case"eos":xe=xe.slice(null,-1);break;default:throw Error(`Pooling method '${O}' not supported.`)}return ue&&(xe=xe.normalize(2,-1)),Ee&&(xe=(0,d.quantize_embeddings)(xe,fe)),xe}}class U extends y{constructor(te){super(te)}async _call(te,{pool:O=null}={}){const ue=await u(te),{pixel_values:Ee}=await this.processor(ue),fe=await this.model({pixel_values:Ee});let me;if(O){if(!("pooler_output"in fe))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");me=fe.pooler_output}else me=fe.last_hidden_state??fe.logits??fe.image_embeds;return me}}class W extends y{constructor(te){super(te)}async _call(te,{top_k:O=5}={}){const ue=this.processor.feature_extractor.config.sampling_rate,Ee=await p(te,ue),fe=this.model.config.id2label,me=[];for(const ve of Ee){const xe=await this.processor(ve),je=(await this.model(xe)).logits[0],we=await(0,d.topk)(new d.Tensor("float32",(0,l.softmax)(je.data),je.dims),O),Oe=we[0].tolist(),We=we[1].tolist().map((Le,rt)=>({label:fe?fe[Le]:`LABEL_${Le}`,score:Oe[rt]}));me.push(We)}return Array.isArray(te)?me:me[0]}}class B extends y{constructor(te){super(te)}async _call(te,O,{hypothesis_template:ue="This is a sound of {}."}={}){const Ee=!Array.isArray(te);Ee&&(te=[te]);const fe=O.map(je=>ue.replace("{}",je)),me=this.tokenizer(fe,{padding:!0,truncation:!0}),ve=this.processor.feature_extractor.config.sampling_rate,xe=await p(te,ve),_e=[];for(const je of xe){const we=await this.processor(je),Oe=await this.model({...me,...we}),Me=(0,l.softmax)(Oe.logits_per_audio.data);_e.push([...Me].map((We,Le)=>({score:We,label:O[Le]})))}return Ee?_e[0]:_e}}class ee extends y{constructor(te){super(te)}async _call(te,O={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(te,O);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":case"parakeet_ctc":return this._call_wav2vec2(te,O);case"moonshine":return this._call_moonshine(te,O);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(te,O){O.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),O.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const ue=!Array.isArray(te);ue&&(te=[te]);const Ee=this.processor.feature_extractor.config.sampling_rate,fe=await p(te,Ee),me=[];for(const ve of fe){const xe=await this.processor(ve),je=(await this.model(xe)).logits[0],we=[];for(const Me of je)we.push((0,l.max)(Me.data)[1]);const Oe=this.tokenizer.decode(we,{skip_special_tokens:!0}).trim();me.push({text:Oe})}return ue?me[0]:me}async _call_whisper(te,O){const ue=O.return_timestamps??!1,Ee=O.chunk_length_s??0,fe=O.force_full_sequences??!1;let me=O.stride_length_s??null;const ve={...O};ue==="word"&&(ve.return_token_timestamps=!0,ve.return_timestamps=!1);const xe=!Array.isArray(te);xe&&(te=[te]);const _e=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,je=this.processor.feature_extractor.config.hop_length,we=this.processor.feature_extractor.config.sampling_rate,Oe=await p(te,we),Me=[];for(const We of Oe){let Le=[];if(Ee>0){if(me===null)me=Ee/6;else if(Ee<=me)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const ze=we*Ee,Ke=we*me,yt=ze-2*Ke;let Ve=0;for(;;){const wt=Ve+ze,ut=We.subarray(Ve,wt),yr=await this.processor(ut),wr=Ve===0,Hr=wt>=We.length;if(Le.push({stride:[ut.length,wr?0:Ke,Hr?0:Ke],input_features:yr.input_features,is_last:Hr}),Hr)break;Ve+=yt}}else Le=[{stride:[We.length,0,0],input_features:(await this.processor(We)).input_features,is_last:!0}];for(const ze of Le){ve.num_frames=Math.floor(ze.stride[0]/je);const Ke=await this.model.generate({inputs:ze.input_features,...ve});ue==="word"?(ze.tokens=Ke.sequences.tolist()[0],ze.token_timestamps=Ke.token_timestamps.tolist()[0].map(yt=>(0,l.round)(yt,2))):ze.tokens=Ke[0].tolist(),ze.stride=ze.stride.map(yt=>yt/we)}const[rt,Ye]=this.tokenizer._decode_asr(Le,{time_precision:_e,return_timestamps:ue,force_full_sequences:fe});Me.push({text:rt,...Ye})}return xe?Me[0]:Me}async _call_moonshine(te,O){const ue=!Array.isArray(te);ue&&(te=[te]);const Ee=this.processor.feature_extractor.config.sampling_rate,fe=await p(te,Ee),me=[];for(const ve of fe){const xe=await this.processor(ve),_e=Math.floor(ve.length/Ee)*6,je=await this.model.generate({max_new_tokens:_e,...O,...xe}),we=this.processor.batch_decode(je,{skip_special_tokens:!0})[0];me.push({text:we})}return ue?me[0]:me}}class Q extends y{constructor(te){super(te)}async _call(te,O={}){const ue=Array.isArray(te),Ee=await u(te),{pixel_values:fe}=await this.processor(Ee),me=[];for(const ve of fe){ve.dims=[1,...ve.dims];const xe=await this.model.generate({inputs:ve,...O}),_e=this.tokenizer.batch_decode(xe,{skip_special_tokens:!0}).map(je=>({generated_text:je.trim()}));me.push(_e)}return ue?me:me[0]}}class Z extends y{constructor(te){super(te)}async _call(te,{top_k:O=5}={}){const ue=await u(te),{pixel_values:Ee}=await this.processor(ue),fe=await this.model({pixel_values:Ee}),me=this.model.config.id2label,ve=[];for(const xe of fe.logits){const _e=await(0,d.topk)(new d.Tensor("float32",(0,l.softmax)(xe.data),xe.dims),O),je=_e[0].tolist(),Oe=_e[1].tolist().map((Me,We)=>({label:me?me[Me]:`LABEL_${Me}`,score:je[We]}));ve.push(Oe)}return Array.isArray(te)?ve:ve[0]}}class J extends y{constructor(te){super(te),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(te,{threshold:O=.5,mask_threshold:ue=.5,overlap_mask_area_threshold:Ee=.8,label_ids_to_fuse:fe=null,target_sizes:me=null,subtask:ve=null}={}){if(Array.isArray(te)&&te.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const _e=await u(te),je=_e.map(ze=>[ze.height,ze.width]),we=await this.processor(_e),{inputNames:Oe,outputNames:Me}=this.model.sessions.model;if(!Oe.includes("pixel_values")){if(Oe.length!==1)throw Error(`Expected a single input name, but got ${Oe.length} inputs: ${Oe}.`);const ze=Oe[0];if(ze in we)throw Error(`Input name ${ze} already exists in the inputs.`);we[ze]=we.pixel_values}const We=await this.model(we);let Le=null;if(ve!==null)Le=this.subtasks_mapping[ve];else if(this.processor.image_processor){for(const[ze,Ke]of Object.entries(this.subtasks_mapping))if(Ke in this.processor.image_processor){Le=this.processor.image_processor[Ke].bind(this.processor.image_processor),ve=ze;break}}const rt=this.model.config.id2label,Ye=[];if(ve)if(ve==="panoptic"||ve==="instance"){const ze=Le(We,O,ue,Ee,fe,me??je)[0],Ke=ze.segmentation;for(const yt of ze.segments_info){const Ve=new Uint8ClampedArray(Ke.data.length);for(let ut=0;ut<Ke.data.length;++ut)Ke.data[ut]===yt.id&&(Ve[ut]=255);const wt=new h.RawImage(Ve,Ke.dims[1],Ke.dims[0],1);Ye.push({score:yt.score,label:rt[yt.label_id],mask:wt})}}else if(ve==="semantic"){const{segmentation:ze,labels:Ke}=Le(We,me??je)[0];for(const yt of Ke){const Ve=new Uint8ClampedArray(ze.data.length);for(let ut=0;ut<ze.data.length;++ut)ze.data[ut]===yt&&(Ve[ut]=255);const wt=new h.RawImage(Ve,ze.dims[1],ze.dims[0],1);Ye.push({score:null,label:rt[yt],mask:wt})}}else throw Error(`Subtask ${ve} not supported.`);else{const Ke=We[Me[0]];for(let yt=0;yt<je.length;++yt){const Ve=je[yt],wt=Ke[yt];wt.data.some(yr=>yr<-1e-5||yr>1+1e-5)&&wt.sigmoid_();const ut=await h.RawImage.fromTensor(wt.mul_(255).to("uint8")).resize(Ve[1],Ve[0]);Ye.push({label:null,score:null,mask:ut})}}return Ye}}class X extends J{constructor(te){super(te)}async _call(te,O={}){if(Array.isArray(te)&&te.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");const Ee=await u(te),fe=await super._call(te,O);return Ee.map((ve,xe)=>{const _e=ve.clone();return _e.putAlpha(fe[xe].mask),_e})}}class ae extends y{constructor(te){super(te)}async _call(te,O,{hypothesis_template:ue="This is a photo of {}"}={}){const Ee=Array.isArray(te),fe=await u(te),me=O.map(Oe=>ue.replace("{}",Oe)),ve=this.tokenizer(me,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:xe}=await this.processor(fe),_e=await this.model({...ve,pixel_values:xe}),je=this.model.config.model_type==="siglip"?Oe=>Oe.sigmoid().data:Oe=>(0,l.softmax)(Oe.data),we=[];for(const Oe of _e.logits_per_image){const We=[...je(Oe)].map((Le,rt)=>({score:Le,label:O[rt]}));We.sort((Le,rt)=>rt.score-Le.score),we.push(We)}return Ee?we:we[0]}}class le extends y{constructor(te){super(te)}async _call(te,{threshold:O=.9,percentage:ue=!1}={}){const Ee=Array.isArray(te);if(Ee&&te.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const fe=await u(te),me=ue?null:fe.map(Me=>[Me.height,Me.width]),{pixel_values:ve,pixel_mask:xe}=await this.processor(fe),_e=await this.model({pixel_values:ve,pixel_mask:xe}),je=this.processor.image_processor.post_process_object_detection(_e,O,me),we=this.model.config.id2label,Oe=je.map(Me=>Me.boxes.map((We,Le)=>({score:Me.scores[Le],label:we[Me.classes[Le]],box:m(We,!ue)})));return Ee?Oe:Oe[0]}}class ne extends y{constructor(te){super(te)}async _call(te,O,{threshold:ue=.1,top_k:Ee=null,percentage:fe=!1}={}){const me=Array.isArray(te),ve=await u(te),xe=this.tokenizer(O,{padding:!0,truncation:!0}),_e=await this.processor(ve),je=[];for(let we=0;we<ve.length;++we){const Oe=ve[we],Me=fe?null:[[Oe.height,Oe.width]],We=_e.pixel_values[we].unsqueeze_(0),Le=await this.model({...xe,pixel_values:We});let rt;if("post_process_grounded_object_detection"in this.processor){const Ye=this.processor.post_process_grounded_object_detection(Le,xe.input_ids,{box_threshold:ue,text_threshold:ue,target_sizes:Me})[0];rt=Ye.boxes.map((ze,Ke)=>({score:Ye.scores[Ke],label:Ye.labels[Ke],box:m(ze,!fe)}))}else{const Ye=this.processor.image_processor.post_process_object_detection(Le,ue,Me,!0)[0];rt=Ye.boxes.map((ze,Ke)=>({score:Ye.scores[Ke],label:O[Ye.classes[Ke]],box:m(ze,!fe)}))}rt.sort((Ye,ze)=>ze.score-Ye.score),Ee!==null&&(rt=rt.slice(0,Ee)),je.push(rt)}return me?je:je[0]}}class L extends y{constructor(te){super(te)}async _call(te,O,ue={}){const Ee=(await u(te))[0],{pixel_values:fe}=await this.processor(Ee),me=`<s_docvqa><s_question>${O}</s_question><s_answer>`,ve=this.tokenizer(me,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,xe=await this.model.generate({inputs:fe,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:ve,...ue}),je=this.tokenizer.batch_decode(xe)[0].match(/<s_answer>(.*?)<\/s_answer>/);let we=null;return je&&je.length>=2&&(we=je[1].trim()),[{answer:we}]}}class F extends y{constructor(O){super(O);ie(this,"DEFAULT_VOCODER_ID","Xenova/speecht5_hifigan");this.vocoder=O.vocoder??null}async _prepare_speaker_embeddings(O){if((typeof O=="string"||O instanceof URL)&&(O=new Float32Array(await(await fetch(O)).arrayBuffer())),O instanceof Float32Array)O=new d.Tensor("float32",O,[O.length]);else if(!(O instanceof d.Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");return O}async _call(O,{speaker_embeddings:ue=null,num_inference_steps:Ee,speed:fe}={}){return this.processor?this._call_text_to_spectrogram(O,{speaker_embeddings:ue}):this.model.config.model_type==="supertonic"?this._call_supertonic(O,{speaker_embeddings:ue,num_inference_steps:Ee,speed:fe}):this._call_text_to_waveform(O)}async _call_supertonic(O,{speaker_embeddings:ue,num_inference_steps:Ee,speed:fe}){if(!ue)throw new Error("Speaker embeddings must be provided for Supertonic models.");ue=await this._prepare_speaker_embeddings(ue);const{sampling_rate:me,style_dim:ve}=this.model.config;ue=ue.view(1,-1,ve);const xe=this.tokenizer(O,{padding:!0,truncation:!0}),{waveform:_e}=await this.model.generate_speech({...xe,style:ue,num_inference_steps:Ee,speed:fe});return new c.RawAudio(_e.data,me)}async _call_text_to_waveform(O){const ue=this.tokenizer(O,{padding:!0,truncation:!0}),{waveform:Ee}=await this.model(ue),fe=this.model.config.sampling_rate;return new c.RawAudio(Ee.data,fe)}async _call_text_to_spectrogram(O,{speaker_embeddings:ue}){this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await s.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"}));const{input_ids:Ee}=this.tokenizer(O,{padding:!0,truncation:!0});ue=await this._prepare_speaker_embeddings(ue),ue=ue.view(1,-1);const{waveform:fe}=await this.model.generate_speech(Ee,ue,{vocoder:this.vocoder}),me=this.processor.feature_extractor.config.sampling_rate;return new c.RawAudio(fe.data,me)}}class G extends y{constructor(te){super(te)}async _call(te){const O=await u(te),ue=await this.processor(O),Ee=await this.model(ue),fe=[];for(const me of Ee.reconstruction){const ve=me.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");fe.push(h.RawImage.fromTensor(ve))}return fe.length>1?fe:fe[0]}}class oe extends y{constructor(te){super(te)}async _call(te){const O=await u(te),ue=await this.processor(O),{predicted_depth:Ee}=await this.model(ue),fe=[];for(let me=0;me<O.length;++me){const ve=Ee[me],[xe,_e]=ve.dims.slice(-2),[je,we]=O[me].size,Oe=(await(0,d.interpolate_4d)(ve.view(1,1,xe,_e),{size:[we,je],mode:"bilinear"})).view(we,je),Me=Oe.min().item(),We=Oe.max().item(),Le=Oe.sub(Me).div_(We-Me).mul_(255).to("uint8").unsqueeze(0),rt=h.RawImage.fromTensor(Le);fe.push({predicted_depth:Oe,depth:rt})}return fe.length>1?fe:fe[0]}}const H=Object.freeze({"text-classification":{tokenizer:n.AutoTokenizer,pipeline:P,model:s.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:n.AutoTokenizer,pipeline:g,model:s.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:n.AutoTokenizer,pipeline:_,model:s.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:n.AutoTokenizer,pipeline:b,model:s.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:n.AutoTokenizer,pipeline:M,model:s.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:n.AutoTokenizer,pipeline:E,model:s.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:n.AutoTokenizer,pipeline:w,model:s.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:n.AutoTokenizer,pipeline:S,model:s.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:n.AutoTokenizer,pipeline:A,model:s.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:W,model:s.AutoModelForAudioClassification,processor:i.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:n.AutoTokenizer,pipeline:B,model:s.AutoModel,processor:i.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:n.AutoTokenizer,pipeline:ee,model:[s.AutoModelForSpeechSeq2Seq,s.AutoModelForCTC],processor:i.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:n.AutoTokenizer,pipeline:F,model:[s.AutoModelForTextToWaveform,s.AutoModelForTextToSpectrogram],processor:[i.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:n.AutoTokenizer,pipeline:Q,model:s.AutoModelForVision2Seq,processor:i.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:Z,model:s.AutoModelForImageClassification,processor:i.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:J,model:[s.AutoModelForImageSegmentation,s.AutoModelForSemanticSegmentation,s.AutoModelForUniversalSegmentation],processor:i.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:X,model:[s.AutoModelForImageSegmentation,s.AutoModelForSemanticSegmentation,s.AutoModelForUniversalSegmentation],processor:i.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:n.AutoTokenizer,pipeline:ae,model:s.AutoModel,processor:i.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:le,model:s.AutoModelForObjectDetection,processor:i.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:n.AutoTokenizer,pipeline:ne,model:s.AutoModelForZeroShotObjectDetection,processor:i.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:n.AutoTokenizer,pipeline:L,model:s.AutoModelForDocumentQuestionAnswering,processor:i.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:G,model:s.AutoModelForImageToImage,processor:i.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:oe,model:s.AutoModelForDepthEstimation,processor:i.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:n.AutoTokenizer,pipeline:j,model:s.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:i.AutoProcessor,pipeline:U,model:[s.AutoModelForImageFeatureExtraction,s.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),Te=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function Ce($e,te=null,{progress_callback:O=null,config:ue=null,cache_dir:Ee=null,local_files_only:fe=!1,revision:me="main",device:ve=null,dtype:xe=null,subfolder:_e="onnx",use_external_data_format:je=null,model_file_name:we=null,session_options:Oe={}}={}){$e=Te[$e]??$e;const Me=H[$e.split("_",1)[0]];if(!Me)throw Error(`Unsupported pipeline: ${$e}. Must be one of [${Object.keys(H)}]`);te||(te=Me.default.model,console.log(`No model specified. Using default model: "${te}".`));const We={progress_callback:O,config:ue,cache_dir:Ee,local_files_only:fe,revision:me,device:ve,dtype:xe,subfolder:_e,use_external_data_format:je,model_file_name:we,session_options:Oe},Le=new Map([["tokenizer",Me.tokenizer],["model",Me.model],["processor",Me.processor]]),rt=await Be(Le,te,We);rt.task=$e,(0,o.dispatchCallback)(O,{status:"ready",task:$e,model:te});const Ye=Me.pipeline;return new Ye(rt)}async function Be($e,te,O){const ue=Object.create(null),Ee=[];for(const[fe,me]of $e.entries()){if(!me)continue;let ve;Array.isArray(me)?ve=new Promise(async(xe,_e)=>{var we,Oe;let je;for(const Me of me){if(Me===null){xe(null);return}try{xe(await Me.from_pretrained(te,O));return}catch(We){if((we=We.message)!=null&&we.includes("Unsupported model type"))je=We;else if((Oe=We.message)!=null&&Oe.includes("Could not locate file"))je=We;else{_e(We);return}}}_e(je)}):ve=me.from_pretrained(te,O),ue[fe]=ve,Ee.push(ve)}await Promise.all(Ee);for(const[fe,me]of Object.entries(ue))ue[fe]=await me;return ue}},"./src/tokenizers.js":(e,t,r)=>{r.r(t),r.d(t,{AlbertTokenizer:()=>zt,AutoTokenizer:()=>Da,BartTokenizer:()=>Wt,BertTokenizer:()=>pi,BlenderbotSmallTokenizer:()=>Ci,BlenderbotTokenizer:()=>lr,BloomTokenizer:()=>Nr,CLIPTokenizer:()=>An,CamembertTokenizer:()=>ct,CodeGenTokenizer:()=>Si,CodeLlamaTokenizer:()=>Ms,CohereTokenizer:()=>ja,ConvBertTokenizer:()=>ce,DebertaTokenizer:()=>re,DebertaV2Tokenizer:()=>V,DistilBertTokenizer:()=>Re,ElectraTokenizer:()=>xt,Ernie4_5_Tokenizer:()=>Na,EsmTokenizer:()=>Zr,FalconTokenizer:()=>mi,GPT2Tokenizer:()=>ot,GPTNeoXTokenizer:()=>gi,GemmaTokenizer:()=>Xn,Grok1Tokenizer:()=>En,HerbertTokenizer:()=>Y,LlamaTokenizer:()=>Dr,M2M100Tokenizer:()=>$r,MBart50Tokenizer:()=>In,MBartTokenizer:()=>ar,MPNetTokenizer:()=>dn,MarianTokenizer:()=>Qe,MgpstrTokenizer:()=>Oa,MobileBertTokenizer:()=>or,NllbTokenizer:()=>Wr,NougatTokenizer:()=>os,PreTrainedTokenizer:()=>Et,Qwen2Tokenizer:()=>Es,RoFormerTokenizer:()=>Se,RobertaTokenizer:()=>Bn,SiglipTokenizer:()=>He,SpeechT5Tokenizer:()=>Vs,SqueezeBertTokenizer:()=>I,T5Tokenizer:()=>jt,TokenizerModel:()=>U,VitsTokenizer:()=>Aa,Wav2Vec2CTCTokenizer:()=>lt,WhisperTokenizer:()=>ks,XLMRobertaTokenizer:()=>Ts,XLMTokenizer:()=>kt,is_chinese_char:()=>b});var n=r("./src/utils/generic.js"),s=r("./src/utils/core.js"),i=r("./src/utils/hub.js"),a=r("./src/utils/maths.js"),o=r("./src/utils/tensor.js"),l=r("./src/utils/data-structures.js"),c=r("./node_modules/@huggingface/jinja/dist/index.js"),d=r("./src/models/whisper/common_whisper.js");async function h(ye,N){const q=await Promise.all([(0,i.getModelJSON)(ye,"tokenizer.json",!0,N),(0,i.getModelJSON)(ye,"tokenizer_config.json",!0,N)]);return N.legacy!==null&&(q[1].legacy=N.legacy),q}function u(ye,N){const q=[];let se=0;for(const he of ye.matchAll(N)){const ge=he[0];se<he.index&&q.push(ye.slice(se,he.index)),ge.length>0&&q.push(ge),se=he.index+ge.length}return se<ye.length&&q.push(ye.slice(se)),q}function p(ye,N=!0){if(ye.Regex!==void 0){let q=ye.Regex.replace(/\\([#&~])/g,"$1");for(const[se,he]of A)q=q.replaceAll(se,he);return new RegExp(q,"gu")}else if(ye.String!==void 0){const q=(0,s.escapeRegExp)(ye.String);return new RegExp(N?q:`(${q})`,"gu")}else return console.warn("Unknown pattern type:",ye),null}function m(ye){return new Map(Object.entries(ye))}function y(ye){const N=ye.dims;switch(N.length){case 1:return ye.tolist();case 2:if(N[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return ye.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${N.length}.`)}}function P(ye){return ye.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function g(ye){return ye.replace(new RegExp("\\p{M}","gu"),"")}function _(ye){return g(ye.toLowerCase())}function b(ye){return ye>=19968&&ye<=40959||ye>=13312&&ye<=19903||ye>=131072&&ye<=173791||ye>=173824&&ye<=177983||ye>=177984&&ye<=178207||ye>=178208&&ye<=183983||ye>=63744&&ye<=64255||ye>=194560&&ye<=195103}function w(ye,N,q){const se=[];let he=0;for(;he<ye.length;){if(se.push(ye[he]),(N.get(ye[he])??q)!==q){++he;continue}for(;++he<ye.length&&(N.get(ye[he])??q)===q;)N.get(se.at(-1))!==q&&(se[se.length-1]+=ye[he])}return se}function M(ye){return ye.match(/\S+/g)||[]}const E="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",T=new RegExp(`^[${E}]+$`,"gu"),S=".,!?",A=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],["(?i:[sdmt]|ll|ve|re)","(?:[sS]|[dD]|[mM]|[tT]|[lL][lL]|[vV][eE]|[rR][eE])"],["[^\\r\\n\\p{L}\\p{N}]?+","[^\\r\\n\\p{L}\\p{N}]?"],["[^\\s\\p{L}\\p{N}]++","[^\\s\\p{L}\\p{N}]+"],[` ?[^(\\s|[${S}])]+`,` ?[^\\s${S}]+`]]);class j{constructor(N){this.content=N.content,this.id=N.id,this.single_word=N.single_word??!1,this.lstrip=N.lstrip??!1,this.rstrip=N.rstrip??!1,this.special=N.special??!1,this.normalized=N.normalized??null}}class U extends n.Callable{constructor(N){super(),this.config=N,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(N,...q){switch(N.type){case"WordPiece":return new W(N);case"Unigram":return new B(N,...q);case"BPE":return new Z(N);default:if(N.vocab)return Array.isArray(N.vocab)?new B(N,...q):Object.hasOwn(N,"continuing_subword_prefix")&&Object.hasOwn(N,"unk_token")?Object.hasOwn(N,"merges")?new Z(N):new W(N):new J(N,...q);throw new Error(`Unknown TokenizerModel type: ${N.type}`)}}_call(N){return N=this.encode(N),this.fuse_unk&&(N=w(N,this.tokens_to_ids,this.unk_token_id)),N}encode(N){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(N){return N.map(q=>this.tokens_to_ids.get(q)??this.unk_token_id)}convert_ids_to_tokens(N){return N.map(q=>this.vocab[q]??this.unk_token)}}class W extends U{constructor(N){super(N),this.tokens_to_ids=m(N.vocab),this.unk_token_id=this.tokens_to_ids.get(N.unk_token),this.unk_token=N.unk_token,this.max_input_chars_per_word=N.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(const[q,se]of this.tokens_to_ids)this.vocab[se]=q}encode(N){const q=[];for(const se of N){const he=[...se];if(he.length>this.max_input_chars_per_word){q.push(this.unk_token);continue}let ge=!1,De=0;const Xe=[];for(;De<he.length;){let it=he.length,tt=null;for(;De<it;){let at=he.slice(De,it).join("");if(De>0&&(at=this.config.continuing_subword_prefix+at),this.tokens_to_ids.has(at)){tt=at;break}--it}if(tt===null){ge=!0;break}Xe.push(tt),De=it}ge?q.push(this.unk_token):q.push(...Xe)}return q}}class B extends U{constructor(N,q){super(N);const se=N.vocab.length;this.vocab=new Array(se),this.scores=new Array(se);for(let he=0;he<se;++he)[this.vocab[he],this.scores[he]]=N.vocab[he];this.unk_token_id=N.unk_id,this.unk_token=this.vocab[N.unk_id],this.tokens_to_ids=new Map(this.vocab.map((he,ge)=>[he,ge])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=q.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,a.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new l.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(N){const q=N.chars,se=1;let he=0;for(;he<q.length;){let ge=!1;const De=q.slice(he).join(""),Xe=this.trie.commonPrefixSearch(De);for(const it of Xe){const tt=this.tokens_to_ids.get(it),at=this.scores[tt],$t=(0,s.len)(it);N.insert(he,$t,at,tt),!ge&&$t===se&&(ge=!0)}ge||N.insert(he,se,this.unk_score,this.unk_token_id),he+=se}}tokenize(N){const q=new l.TokenLattice(N,this.bos_token_id,this.eos_token_id);return this.populateNodes(q),q.tokens()}encode(N){const q=[];for(const se of N){const he=this.tokenize(se);q.push(...he)}return q}}const ee=(()=>{const ye=[...Array.from({length:94},(he,ge)=>ge+33),...Array.from({length:12},(he,ge)=>ge+161),...Array.from({length:82},(he,ge)=>ge+174)],N=ye.slice();let q=0;for(let he=0;he<256;++he)ye.includes(he)||(ye.push(he),N.push(256+q),q+=1);const se=N.map(he=>String.fromCharCode(he));return Object.fromEntries(ye.map((he,ge)=>[he,se[ge]]))})(),Q=(0,s.reverseDictionary)(ee);class Z extends U{constructor(N){super(N),this.tokens_to_ids=m(N.vocab),this.unk_token_id=this.tokens_to_ids.get(N.unk_token),this.unk_token=N.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[se,he]of this.tokens_to_ids)this.vocab[he]=se;const q=Array.isArray(N.merges[0]);this.merges=q?N.merges:N.merges.map(se=>se.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((se,he)=>[JSON.stringify(se),he])),this.end_of_word_suffix=N.end_of_word_suffix,this.continuing_subword_suffix=N.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new l.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(N){if(N.length===0)return[];const q=this.cache.get(N);if(q!==void 0)return q;const se=Array.from(N);this.end_of_word_suffix&&(se[se.length-1]+=this.end_of_word_suffix);let he=[];if(se.length>1){const ge=new l.PriorityQueue((it,tt)=>it.score<tt.score);let De={token:se[0],bias:0,prev:null,next:null},Xe=De;for(let it=1;it<se.length;++it){const tt={bias:it/se.length,token:se[it],prev:Xe,next:null};Xe.next=tt,this._add_node(ge,Xe),Xe=tt}for(;!ge.isEmpty();){const it=ge.pop();if(it.deleted||!it.next||it.next.deleted)continue;if(it.deleted=!0,it.next.deleted=!0,it.prev){const at={...it.prev};it.prev.deleted=!0,it.prev=at,at.prev?at.prev.next=at:De=at}const tt={token:it.token+it.next.token,bias:it.bias,prev:it.prev,next:it.next.next};tt.prev?(tt.prev.next=tt,this._add_node(ge,tt.prev)):De=tt,tt.next&&(tt.next.prev=tt,this._add_node(ge,tt))}for(let it=De;it!==null;it=it.next)he.push(it.token)}else he=se;if(this.continuing_subword_suffix)for(let ge=0;ge<he.length-1;++ge)he[ge]+=this.continuing_subword_suffix;return N.length<this.max_length_to_cache&&this.cache.put(N,he),he}_add_node(N,q){const se=this.bpe_ranks.get(JSON.stringify([q.token,q.next.token]));se!==void 0&&(q.score=se+q.bias,N.push(q))}encode(N){const q=[];for(const se of N){if(this.ignore_merges&&this.tokens_to_ids.has(se)){q.push(se);continue}const he=this.bpe(se);for(const ge of he)if(this.tokens_to_ids.has(ge))q.push(ge);else if(this.byte_fallback){const De=Array.from(this.text_encoder.encode(ge)).map(Xe=>`<0x${Xe.toString(16).toUpperCase().padStart(2,"0")}>`);De.every(Xe=>this.tokens_to_ids.has(Xe))?q.push(...De):q.push(this.unk_token)}else q.push(this.unk_token)}return q}}class J extends U{constructor(N,q){super(N),this.tokens_to_ids=m(q.target_lang?N.vocab[q.target_lang]:N.vocab),this.bos_token=q.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=q.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=q.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=q.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[se,he]of this.tokens_to_ids)this.vocab[he]=se}encode(N){return N}}class X extends n.Callable{constructor(N){super(),this.config=N}static fromConfig(N){if(N===null)return null;switch(N.type){case"BertNormalizer":return new $e(N);case"Precompiled":return new Hr(N);case"Sequence":return new Be(N);case"Replace":return new ae(N);case"NFC":return new ne(N);case"NFD":return new L(N);case"NFKC":return new F(N);case"NFKD":return new G(N);case"Strip":return new oe(N);case"StripAccents":return new H(N);case"Lowercase":return new Te(N);case"Prepend":return new Ce(N);default:throw new Error(`Unknown Normalizer type: ${N.type}`)}}normalize(N){throw Error("normalize should be implemented in subclass.")}_call(N){return this.normalize(N)}}class ae extends X{normalize(N){const q=p(this.config.pattern);return q===null?N:N.replaceAll(q,this.config.content)}}class le extends X{constructor(){super(...arguments);ie(this,"form")}normalize(q){return q=q.normalize(this.form),q}}class ne extends le{constructor(){super(...arguments);ie(this,"form","NFC")}}class L extends le{constructor(){super(...arguments);ie(this,"form","NFD")}}class F extends le{constructor(){super(...arguments);ie(this,"form","NFKC")}}class G extends le{constructor(){super(...arguments);ie(this,"form","NFKD")}}class oe extends X{normalize(N){return this.config.strip_left&&this.config.strip_right?N=N.trim():(this.config.strip_left&&(N=N.trimStart()),this.config.strip_right&&(N=N.trimEnd())),N}}class H extends X{normalize(N){return N=g(N),N}}class Te extends X{normalize(N){return N=N.toLowerCase(),N}}class Ce extends X{normalize(N){return N=this.config.prepend+N,N}}class Be extends X{constructor(N){super(N),this.normalizers=N.normalizers.map(q=>X.fromConfig(q))}normalize(N){return this.normalizers.reduce((q,se)=>se.normalize(q),N)}}class $e extends X{_tokenize_chinese_chars(N){const q=[];for(let se=0;se<N.length;++se){const he=N[se],ge=he.charCodeAt(0);b(ge)?(q.push(" "),q.push(he),q.push(" ")):q.push(he)}return q.join("")}stripAccents(N){return N.normalize("NFD").replace(new RegExp("\\p{Mn}","gu"),"")}_is_control(N){switch(N){case"	":case`
`:case"\r":return!1;default:return new RegExp("^\\p{Cc}|\\p{Cf}|\\p{Co}|\\p{Cs}$","u").test(N)}}_clean_text(N){const q=[];for(const se of N){const he=se.charCodeAt(0);he===0||he===65533||this._is_control(se)||(/^\s$/.test(se)?q.push(" "):q.push(se))}return q.join("")}normalize(N){return this.config.clean_text&&(N=this._clean_text(N)),this.config.handle_chinese_chars&&(N=this._tokenize_chinese_chars(N)),this.config.lowercase?(N=N.toLowerCase(),this.config.strip_accents!==!1&&(N=this.stripAccents(N))):this.config.strip_accents&&(N=this.stripAccents(N)),N}}class te extends n.Callable{static fromConfig(N){if(N===null)return null;switch(N.type){case"BertPreTokenizer":return new O(N);case"Sequence":return new Qr(N);case"Whitespace":return new Er(N);case"WhitespaceSplit":return new un(N);case"Metaspace":return new yr(N);case"ByteLevel":return new ue(N);case"Split":return new Ee(N);case"Punctuation":return new fe(N);case"Digits":return new me(N);case"Replace":return new Hi(N);case"FixedLength":return new Qi(N);default:throw new Error(`Unknown PreTokenizer type: ${N.type}`)}}pre_tokenize_text(N,q){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(N,q){return(Array.isArray(N)?N.map(se=>this.pre_tokenize_text(se,q)):this.pre_tokenize_text(N,q)).flat()}_call(N,q){return this.pre_tokenize(N,q)}}class O extends te{constructor(N){super(),this.pattern=new RegExp(`[^\\s${E}]+|[${E}]`,"gu")}pre_tokenize_text(N,q){return N.trim().match(this.pattern)||[]}}class ue extends te{constructor(N){super(),this.config=N,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=new RegExp("'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+","gu"),this.byte_encoder=ee,this.text_encoder=new TextEncoder}pre_tokenize_text(N,q){return this.add_prefix_space&&!N.startsWith(" ")&&(N=" "+N),(this.use_regex?N.match(this.pattern)||[]:[N]).map(he=>Array.from(this.text_encoder.encode(he),ge=>this.byte_encoder[ge]).join(""))}}class Ee extends te{constructor(N){super(),this.config=N,this.pattern=p(this.config.pattern,this.config.invert)}pre_tokenize_text(N,q){var se;return this.pattern===null?[]:this.config.invert?N.match(this.pattern)||[]:((se=this.config.behavior)==null?void 0:se.toLowerCase())==="removed"?N.split(this.pattern).filter(he=>he):u(N,this.pattern)}}class fe extends te{constructor(N){super(),this.config=N,this.pattern=new RegExp(`[^${E}]+|[${E}]+`,"gu")}pre_tokenize_text(N,q){return N.match(this.pattern)||[]}}class me extends te{constructor(N){super(),this.config=N;const q=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(q,"gu")}pre_tokenize_text(N,q){return N.match(this.pattern)||[]}}class ve extends n.Callable{constructor(N){super(),this.config=N}static fromConfig(N){if(N===null)return null;switch(N.type){case"TemplateProcessing":return new je(N);case"ByteLevel":return new we(N);case"RobertaProcessing":return new _e(N);case"BertProcessing":return new xe(N);case"Sequence":return new Oe(N);default:throw new Error(`Unknown PostProcessor type: ${N.type}`)}}post_process(N,...q){throw Error("post_process should be implemented in subclass.")}_call(N,...q){return this.post_process(N,...q)}}class xe extends ve{constructor(N){super(N),this.cls=N.cls[0],this.sep=N.sep[0]}post_process(N,q=null,{add_special_tokens:se=!0}={}){se&&(N=(0,s.mergeArrays)([this.cls],N,[this.sep]));let he=new Array(N.length).fill(0);if(q!==null){const ge=se&&this instanceof _e?[this.sep]:[],De=se?[this.sep]:[];N=(0,s.mergeArrays)(N,ge,q,De),he=(0,s.mergeArrays)(he,new Array(q.length+ge.length+De.length).fill(1))}return{tokens:N,token_type_ids:he}}}class _e extends xe{}class je extends ve{constructor(N){super(N),this.single=N.single,this.pair=N.pair}post_process(N,q=null,{add_special_tokens:se=!0}={}){const he=q===null?this.single:this.pair;let ge=[],De=[];for(const Xe of he)"SpecialToken"in Xe?se&&(ge.push(Xe.SpecialToken.id),De.push(Xe.SpecialToken.type_id)):"Sequence"in Xe&&(Xe.Sequence.id==="A"?(ge=(0,s.mergeArrays)(ge,N),De=(0,s.mergeArrays)(De,new Array(N.length).fill(Xe.Sequence.type_id))):Xe.Sequence.id==="B"&&(ge=(0,s.mergeArrays)(ge,q),De=(0,s.mergeArrays)(De,new Array(q.length).fill(Xe.Sequence.type_id))));return{tokens:ge,token_type_ids:De}}}class we extends ve{post_process(N,q=null){return q&&(N=(0,s.mergeArrays)(N,q)),{tokens:N}}}class Oe extends ve{constructor(N){super(N),this.processors=N.processors.map(q=>ve.fromConfig(q))}post_process(N,q=null,se={}){let he;for(const ge of this.processors)if(ge instanceof we)N=ge.post_process(N).tokens,q&&(q=ge.post_process(q).tokens);else{const De=ge.post_process(N,q,se);N=De.tokens,he=De.token_type_ids}return{tokens:N,token_type_ids:he}}}class Me extends n.Callable{constructor(N){super(),this.config=N,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=N.trim_offsets}static fromConfig(N){if(N===null)return null;switch(N.type){case"WordPiece":return new ze(N);case"Metaspace":return new wr(N);case"ByteLevel":return new Ke(N);case"Replace":return new We(N);case"ByteFallback":return new Le(N);case"Fuse":return new rt(N);case"Strip":return new Ye(N);case"Sequence":return new Ve(N);case"CTC":return new yt(N);case"BPEDecoder":return new wt(N);default:throw new Error(`Unknown Decoder type: ${N.type}`)}}_call(N){return this.decode(N)}decode(N){return this.decode_chain(N).join("")}decode_chain(N){throw Error("`decode_chain` should be implemented in subclass.")}}class We extends Me{decode_chain(N){const q=p(this.config.pattern);return q===null?N:N.map(se=>se.replaceAll(q,this.config.content))}}class Le extends Me{constructor(N){super(N),this.text_decoder=new TextDecoder}decode_chain(N){const q=[];let se=[];for(const he of N){let ge=null;if(he.length===6&&he.startsWith("<0x")&&he.endsWith(">")){const De=parseInt(he.slice(3,5),16);isNaN(De)||(ge=De)}if(ge!==null)se.push(ge);else{if(se.length>0){const De=this.text_decoder.decode(Uint8Array.from(se));q.push(De),se=[]}q.push(he)}}if(se.length>0){const he=this.text_decoder.decode(Uint8Array.from(se));q.push(he),se=[]}return q}}class rt extends Me{decode_chain(N){return[N.join("")]}}class Ye extends Me{constructor(N){super(N),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(N){return N.map(q=>{let se=0;for(let ge=0;ge<this.start&&q[ge]===this.content;++ge){se=ge+1;continue}let he=q.length;for(let ge=0;ge<this.stop;++ge){const De=q.length-ge-1;if(q[De]===this.content){he=De;continue}else break}return q.slice(se,he)})}}class ze extends Me{constructor(N){super(N),this.cleanup=N.cleanup}decode_chain(N){return N.map((q,se)=>(se!==0&&(q.startsWith(this.config.prefix)?q=q.replace(this.config.prefix,""):q=" "+q),this.cleanup&&(q=P(q)),q))}}class Ke extends Me{constructor(N){super(N),this.byte_decoder=Q,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(N){const q=N.join(""),se=new Uint8Array([...q].map(ge=>this.byte_decoder[ge]));return this.text_decoder.decode(se)}decode_chain(N){const q=[];let se=[];for(const he of N)this.added_tokens.find(ge=>ge.content===he)!==void 0?(se.length>0&&(q.push(this.convert_tokens_to_string(se)),se=[]),q.push(he)):se.push(he);return se.length>0&&q.push(this.convert_tokens_to_string(se)),q}}class yt extends Me{constructor(N){super(N),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(N){if(N.length===0)return"";const q=[N[0]];for(let ge=1;ge<N.length;++ge)N[ge]!==q.at(-1)&&q.push(N[ge]);let he=q.filter(ge=>ge!==this.pad_token).join("");return this.cleanup&&(he=P(he).replaceAll(this.word_delimiter_token," ").trim()),he}decode_chain(N){return[this.convert_tokens_to_string(N)]}}class Ve extends Me{constructor(N){super(N),this.decoders=N.decoders.map(q=>Me.fromConfig(q))}decode_chain(N){return this.decoders.reduce((q,se)=>se.decode_chain(q),N)}}class wt extends Me{constructor(N){super(N),this.suffix=this.config.suffix}decode_chain(N){return N.map((q,se)=>q.replaceAll(this.suffix,se===N.length-1?"":" "))}}class ut extends Me{decode_chain(N){let q="";for(let se=1;se<N.length;se+=2)q+=N[se];return[q]}}class yr extends te{constructor(N){super(),this.replacement=N.replacement,this.strRep=N.str_rep||this.replacement,this.prepend_scheme=N.prepend_scheme??"always"}pre_tokenize_text(N,{section_index:q=void 0}={}){let se=N.replaceAll(" ",this.strRep);return!se.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&q===0)&&(se=this.strRep+se),[se]}}class wr extends Me{constructor(N){super(N),this.replacement=N.replacement}decode_chain(N){const q=[];for(let se=0;se<N.length;++se){let he=N[se].replaceAll(this.replacement," ");se==0&&he.startsWith(" ")&&(he=he.substring(1)),q.push(he)}return q}}class Hr extends X{constructor(N){super(N),this.charsmap=N.precompiled_charsmap}normalize(N){return N=N.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),N=N.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),N.includes("")?N=N.split("").map(se=>se.normalize("NFKC")).join(""):N=N.normalize("NFKC"),N}}class Qr extends te{constructor(N){super(),this.tokenizers=N.pretokenizers.map(q=>te.fromConfig(q))}pre_tokenize_text(N,q){return this.tokenizers.reduce((se,he)=>he.pre_tokenize(se,q),[N])}}class Er extends te{constructor(N){super()}pre_tokenize_text(N,q){return N.match(/\w+|[^\w\s]+/g)||[]}}class un extends te{constructor(N){super()}pre_tokenize_text(N,q){return M(N)}}class Hi extends te{constructor(N){super(),this.config=N,this.pattern=p(this.config.pattern),this.content=this.config.content}pre_tokenize_text(N,q){return this.pattern===null?[N]:[N.replaceAll(this.pattern,this.config.content)]}}class Qi extends te{constructor(N){super(),this._length=N.length}pre_tokenize_text(N,q){const se=[];for(let he=0;he<N.length;he+=this._length)se.push(N.slice(he,he+this._length));return se}}const Xi=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function bs(ye,N,q,se){for(const he of Object.keys(ye)){const ge=N-ye[he].length,De=q(he),Xe=new Array(ge).fill(De);ye[he]=se==="right"?(0,s.mergeArrays)(ye[he],Xe):(0,s.mergeArrays)(Xe,ye[he])}}function ki(ye,N){for(const q of Object.keys(ye))ye[q].length=N}class Et extends n.Callable{constructor(q,se){super();ie(this,"return_token_type_ids",!1);ie(this,"padding_side","right");this.config=se,this.normalizer=X.fromConfig(q.normalizer),this.pre_tokenizer=te.fromConfig(q.pre_tokenizer),this.model=U.fromConfig(q.model,se),this.post_processor=ve.fromConfig(q.post_processor),this.decoder=Me.fromConfig(q.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const he of q.added_tokens){const ge=new j(he);this.added_tokens.push(ge),this.model.tokens_to_ids.set(ge.content,ge.id),this.model.vocab[ge.id]=ge.content,ge.special&&(this.special_tokens.push(ge.content),this.all_special_ids.push(ge.id))}if(this.additional_special_tokens=se.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_splitter=new l.DictionarySplitter(this.added_tokens.map(he=>he.content)),this.added_tokens_map=new Map(this.added_tokens.map(he=>[he.content,he])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=se.model_max_length,this.remove_space=se.remove_space,this.clean_up_tokenization_spaces=se.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=se.do_lowercase_and_remove_accent??!1,se.padding_side&&(this.padding_side=se.padding_side),this.add_bos_token=se.add_bos_token,this.add_eos_token=se.add_eos_token,this.legacy=!1,this.chat_template=se.chat_template??null,Array.isArray(this.chat_template)){const he=Object.create(null);for(const{name:ge,template:De}of this.chat_template){if(typeof ge!="string"||typeof De!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');he[ge]=De}this.chat_template=he}this._compiled_template_cache=new Map}getToken(...q){for(const se of q){const he=this.config[se];if(he)if(typeof he=="object"){if(he.__type==="AddedToken")return he.content;throw Error(`Unknown token: ${he}`)}else return he}return null}static async from_pretrained(q,{progress_callback:se=null,config:he=null,cache_dir:ge=null,local_files_only:De=!1,revision:Xe="main",legacy:it=null}={}){const tt=await h(q,{progress_callback:se,config:he,cache_dir:ge,local_files_only:De,revision:Xe,legacy:it});return new this(...tt)}_call(q,{text_pair:se=null,add_special_tokens:he=!0,padding:ge=!1,truncation:De=null,max_length:Xe=null,return_tensor:it=!0,return_token_type_ids:tt=null}={}){const at=Array.isArray(q);let $t;if(at){if(q.length===0)throw Error("text array must be non-empty");if(se!==null){if(Array.isArray(se)){if(q.length!==se.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");$t=q.map((Xt,Ir)=>this._encode_plus(Xt,{text_pair:se[Ir],add_special_tokens:he,return_token_type_ids:tt}))}else $t=q.map(Xt=>this._encode_plus(Xt,{add_special_tokens:he,return_token_type_ids:tt}))}else{if(q==null)throw Error("text may not be null or undefined");if(Array.isArray(se))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");$t=[this._encode_plus(q,{text_pair:se,add_special_tokens:he,return_token_type_ids:tt})]}if(Xe===null?Xe=this.model_max_length:De===null&&(ge===!0?(console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: 'max_length'`."),Xe=this.model_max_length):ge===!1&&(console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),De=!0)),ge===!0&&(Xe=Math.min((0,a.max)($t.map(Xt=>Xt.input_ids.length))[0],Xe??1/0)),Xe=Math.min(Xe,this.model_max_length??1/0),ge||De)for(let Xt=0;Xt<$t.length;++Xt)$t[Xt].input_ids.length!==Xe&&($t[Xt].input_ids.length>Xe?De&&ki($t[Xt],Xe):ge&&bs($t[Xt],Xe,Ir=>Ir==="input_ids"?this.pad_token_id:0,this.padding_side));const qt={};if(it){if(!(ge&&De)&&$t.some(Ir=>{var sr;for(const Pr of Object.keys(Ir))if(Ir[Pr].length!==((sr=$t[0][Pr])==null?void 0:sr.length))return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const Xt=[$t.length,$t[0].input_ids.length];for(const Ir of Object.keys($t[0]))qt[Ir]=new o.Tensor("int64",BigInt64Array.from($t.flatMap(sr=>sr[Ir]).map(BigInt)),Xt)}else{for(const Xt of Object.keys($t[0]))qt[Xt]=$t.map(Ir=>Ir[Xt]);if(!at)for(const Xt of Object.keys(qt))qt[Xt]=qt[Xt][0]}return qt}_encode_text(q){if(q===null)return null;const se=this.added_tokens_splitter.split(q);for(let ge=0;ge<se.length;++ge){const De=this.added_tokens_map.get(se[ge]);De&&(De.lstrip&&ge>0&&(se[ge-1]=se[ge-1].trimEnd()),De.rstrip&&ge<se.length-1&&(se[ge+1]=se[ge+1].trimStart()))}return se.flatMap((ge,De)=>{if(ge.length===0)return[];if(this.added_tokens_map.has(ge))return[ge];if(this.remove_space===!0&&(ge=ge.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(ge=_(ge)),this.normalizer!==null&&(ge=this.normalizer(ge)),ge.length===0)return[];const Xe=this.pre_tokenizer!==null?this.pre_tokenizer(ge,{section_index:De}):[ge];return this.model(Xe)})}_encode_plus(q,{text_pair:se=null,add_special_tokens:he=!0,return_token_type_ids:ge=null}={}){const{tokens:De,token_type_ids:Xe}=this._tokenize_helper(q,{pair:se,add_special_tokens:he}),it=this.model.convert_tokens_to_ids(De),tt={input_ids:it,attention_mask:new Array(it.length).fill(1)};return(ge??this.return_token_type_ids)&&Xe&&(tt.token_type_ids=Xe),tt}_tokenize_helper(q,{pair:se=null,add_special_tokens:he=!1}={}){const ge=this._encode_text(q),De=this._encode_text(se);return this.post_processor?this.post_processor(ge,De,{add_special_tokens:he}):{tokens:(0,s.mergeArrays)(ge??[],De??[])}}tokenize(q,{pair:se=null,add_special_tokens:he=!1}={}){return this._tokenize_helper(q,{pair:se,add_special_tokens:he}).tokens}encode(q,{text_pair:se=null,add_special_tokens:he=!0,return_token_type_ids:ge=null}={}){return this._encode_plus(q,{text_pair:se,add_special_tokens:he,return_token_type_ids:ge}).input_ids}batch_decode(q,se={}){return q instanceof o.Tensor&&(q=q.tolist()),q.map(he=>this.decode(he,se))}decode(q,se={}){if(q instanceof o.Tensor&&(q=y(q)),!Array.isArray(q)||q.length===0||!(0,s.isIntegralNumber)(q[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(q,se)}decode_single(q,{skip_special_tokens:se=!1,clean_up_tokenization_spaces:he=null}){let ge=this.model.convert_ids_to_tokens(q);se&&(ge=ge.filter(Xe=>!this.special_tokens.includes(Xe)));let De=this.decoder?this.decoder(ge):ge.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(De=De.replaceAll(this.decoder.end_of_word_suffix," "),se&&(De=De.trim())),(he??this.clean_up_tokenization_spaces)&&(De=P(De)),De}get_chat_template({chat_template:q=null,tools:se=null}={}){if(this.chat_template&&typeof this.chat_template=="object"){const he=this.chat_template;if(q!==null&&Object.hasOwn(he,q))q=he[q];else if(q===null)if(se!==null&&"tool_use"in he)q=he.tool_use;else if("default"in he)q=he.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(he).sort()}.`)}else if(q===null)if(this.chat_template)q=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return q}apply_chat_template(q,{tools:se=null,documents:he=null,chat_template:ge=null,add_generation_prompt:De=!1,tokenize:Xe=!0,padding:it=!1,truncation:tt=!1,max_length:at=null,return_tensor:$t=!0,return_dict:qt=!1,tokenizer_kwargs:Xt={},...Ir}={}){if(ge=this.get_chat_template({chat_template:ge,tools:se}),typeof ge!="string")throw Error(`chat_template must be a string, but got ${typeof ge}`);let sr=this._compiled_template_cache.get(ge);sr===void 0&&(sr=new c.Template(ge),this._compiled_template_cache.set(ge,sr));const Pr=Object.create(null);for(const kr of Xi){const Un=this.getToken(kr);Un&&(Pr[kr]=Un)}const Ar=sr.render({messages:q,add_generation_prompt:De,tools:se,documents:he,...Pr,...Ir});if(Xe){const kr=this._call(Ar,{add_special_tokens:!1,padding:it,truncation:tt,max_length:at,return_tensor:$t,...Xt});return qt?kr:kr.input_ids}return Ar}}class pi extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class zt extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class or extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class I extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class re extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class V extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class Y extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class ce extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class Se extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class Re extends Et{}class ct extends Et{}class kt extends Et{constructor(q,se){super(q,se);ie(this,"return_token_type_ids",!0);console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class xt extends Et{constructor(){super(...arguments);ie(this,"return_token_type_ids",!0)}}class jt extends Et{}class ot extends Et{}class Wt extends Et{}class ar extends Et{constructor(N,q){super(N,q),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(se=>this.languageRegex.test(se)),this.lang_to_token=se=>se}_build_translation_inputs(N,q,se){return Ps(this,N,q,se)}}class In extends ar{}class Bn extends Et{}class Nr extends Et{}const Xr="";class Dr extends Et{constructor(q,se){super(q,se);ie(this,"padding_side","left");this.legacy=se.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new yr({replacement:Xr,prepend_scheme:"first"}))}_encode_text(q){if(q===null)return null;if(this.legacy||q.length===0)return super._encode_text(q);let se=super._encode_text(Xr+q.replaceAll(Xr," "));return se.length>1&&se[0]===Xr&&this.special_tokens.includes(se[1])&&(se=se.slice(1)),se}}class Ms extends Et{}class Ts extends Et{}class dn extends Et{}class mi extends Et{}class gi extends Et{}class Zr extends Et{}class Es extends Et{}class Xn extends Et{}class En extends Et{}function Ps(ye,N,q,se){if(!("language_codes"in ye)||!Array.isArray(ye.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in ye)||!(ye.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in ye)||typeof ye.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const he=se.src_lang,ge=se.tgt_lang;if(!ye.language_codes.includes(ge))throw new Error(`Target language code "${ge}" is not valid. Must be one of: {${ye.language_codes.join(", ")}}`);if(he!==void 0){if(!ye.language_codes.includes(he))throw new Error(`Source language code "${he}" is not valid. Must be one of: {${ye.language_codes.join(", ")}}`);for(const De of ye.post_processor.config.single)if("SpecialToken"in De&&ye.languageRegex.test(De.SpecialToken.id)){De.SpecialToken.id=ye.lang_to_token(he);break}}return se.forced_bos_token_id=ye.model.convert_tokens_to_ids([ye.lang_to_token(ge)])[0],ye._call(N,q)}class Wr extends Et{constructor(N,q){super(N,q),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(se=>this.languageRegex.test(se)),this.lang_to_token=se=>se}_build_translation_inputs(N,q,se){return Ps(this,N,q,se)}}class $r extends Et{constructor(N,q){super(N,q),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(se=>this.languageRegex.test(se)).map(se=>se.slice(2,-2)),this.lang_to_token=se=>`__${se}__`}_build_translation_inputs(N,q,se){return Ps(this,N,q,se)}}class ks extends Et{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(N,{return_timestamps:q=!1,return_language:se=!1,time_precision:he=null,force_full_sequences:ge=!0}={}){if(he===null)throw Error("Must specify time_precision");let De=null;const Xe=q==="word";function it(){return{language:De,timestamp:[null,null],text:""}}const tt=[];let at=it(),$t=0;const qt=this.timestamp_begin,Ir=qt+1500;let sr=[],Pr=[],Ar=!1,kr=null;const Un=new Set(this.all_special_ids);for(const mr of N){const Fr=mr.tokens,wn=Xe?mr.token_timestamps:null;let Ss=null,Cs=qt;if("stride"in mr){const[tn,Lr,vr]=mr.stride;if($t-=Lr,kr=tn-vr,Lr&&(Cs=Lr/he+qt),vr)for(let Gr=Fr.length-1;Gr>=0;--Gr){const On=Number(Fr[Gr]);if(On>=qt){if(Ss!==null&&(On-qt)*he<kr)break;Ss=On}}}let vn=[],jn=[];for(let tn=0;tn<Fr.length;++tn){const Lr=Number(Fr[tn]);if(Un.has(Lr)){const vr=this.decode([Lr]),Gr=d.WHISPER_LANGUAGE_MAPPING.get(vr.slice(2,-2));if(Gr!==void 0){if(De!==null&&Gr!==De&&!q){sr.push(vn);const On=this.findLongestCommonSequence(sr)[0],$s=this.decode(On);at.text=$s,tt.push(at),sr=[],vn=[],at=it()}De=at.language=Gr}}else if(Lr>=qt&&Lr<=Ir){const vr=(Lr-qt)*he+$t,Gr=(0,a.round)(vr,2);if(Ss!==null&&Lr>=Ss)Ar=!0;else if(Ar||sr.length>0&&Lr<Cs)Ar=!1;else if(at.timestamp[0]===null)at.timestamp[0]=Gr;else if(Gr!==at.timestamp[0]){at.timestamp[1]=Gr,sr.push(vn),Xe&&Pr.push(jn);const[On,$s]=this.findLongestCommonSequence(sr,Pr),Oo=this.decode(On);at.text=Oo,Xe&&(at.words=this.collateWordTimestamps(On,$s,De)),tt.push(at),sr=[],vn=[],Pr=[],jn=[],at=it()}}else if(vn.push(Lr),Xe){let vr=(0,a.round)(wn[tn]+$t,2),Gr;if(tn+1<wn.length){Gr=(0,a.round)(wn[tn+1]+$t,2);const On=this.decode([Lr]);T.test(On)&&(Gr=(0,a.round)(Math.min(vr+he,Gr),2))}else Gr=null;jn.push([vr,Gr])}}if("stride"in mr){const[tn,Lr,vr]=mr.stride;$t+=tn-vr}vn.length>0?(sr.push(vn),Xe&&Pr.push(jn)):sr.every(tn=>tn.length===0)&&(at=it(),sr=[],vn=[],Pr=[],jn=[])}if(sr.length>0){if(ge&&q)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[mr,Fr]=this.findLongestCommonSequence(sr,Pr),wn=this.decode(mr);at.text=wn,Xe&&(at.words=this.collateWordTimestamps(mr,Fr,De)),tt.push(at)}let en=Object.create(null);const Ws=tt.map(mr=>mr.text).join("");if(q||se){for(let mr=0;mr<tt.length;++mr){const Fr=tt[mr];q||delete Fr.timestamp,se||delete Fr.language}if(Xe){const mr=[];for(const Fr of tt)for(const wn of Fr.words)mr.push(wn);en={chunks:mr}}else en={chunks:tt}}return[Ws,en]}findLongestCommonSequence(N,q=null){let se=N[0],he=se.length,ge=[];const De=Array.isArray(q)&&q.length>0;let Xe=De?[]:null,it=De?q[0]:null;for(let tt=1;tt<N.length;++tt){const at=N[tt];let $t=0,qt=[he,he,0,0];const Xt=at.length;for(let en=1;en<he+Xt;++en){const Ws=Math.max(0,he-en),mr=Math.min(he,he+Xt-en),Fr=se.slice(Ws,mr),wn=Math.max(0,en-he),Ss=Math.min(Xt,en),Cs=at.slice(wn,Ss);if(Fr.length!==Cs.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let vn;De?vn=Fr.filter((Lr,vr)=>Lr===Cs[vr]&&it[Ws+vr]<=q[tt][wn+vr]).length:vn=Fr.filter((Lr,vr)=>Lr===Cs[vr]).length;const jn=en/1e4,tn=vn/en+jn;vn>1&&tn>$t&&($t=tn,qt=[Ws,mr,wn,Ss])}const[Ir,sr,Pr,Ar]=qt,kr=Math.floor((sr+Ir)/2),Un=Math.floor((Ar+Pr)/2);ge.push(...se.slice(0,kr)),se=at.slice(Un),he=se.length,De&&(Xe.push(...it.slice(0,kr)),it=q[tt].slice(Un))}return ge.push(...se),De?(Xe.push(...it),[ge,Xe]):[ge,[]]}collateWordTimestamps(N,q,se){const[he,ge,De]=this.combineTokensIntoWords(N,se),Xe=[];for(let it=0;it<he.length;++it){const tt=De[it];Xe.push({text:he[it],timestamp:[q[tt.at(0)][0],q[tt.at(-1)][1]]})}return Xe}combineTokensIntoWords(N,q,se=`"'([{-`,he=`"'.,!?:)]}`){q=q??"english";let ge,De,Xe;return["chinese","japanese","thai","lao","myanmar"].includes(q)?[ge,De,Xe]=this.splitTokensOnUnicode(N):[ge,De,Xe]=this.splitTokensOnSpaces(N),this.mergePunctuations(ge,De,Xe,se,he)}decode(N,q){let se;return q!=null&&q.decode_with_timestamps?(N instanceof o.Tensor&&(N=y(N)),se=this.decodeWithTimestamps(N,q)):se=super.decode(N,q),se}decodeWithTimestamps(N,q){const se=(q==null?void 0:q.time_precision)??.02,he=Array.from(this.all_special_ids).at(-1)+1;let ge=[[]];for(let De of N)if(De=Number(De),De>=he){const Xe=((De-he)*se).toFixed(2);ge.push(`<|${Xe}|>`),ge.push([])}else ge[ge.length-1].push(De);return ge=ge.map(De=>typeof De=="string"?De:super.decode(De,q)),ge.join("")}splitTokensOnUnicode(N){const q=this.decode(N,{decode_with_timestamps:!0}),se="",he=[],ge=[],De=[];let Xe=[],it=[],tt=0;for(let at=0;at<N.length;++at){const $t=N[at];Xe.push($t),it.push(at);const qt=this.decode(Xe,{decode_with_timestamps:!0});(!qt.includes(se)||q[tt+qt.indexOf(se)]===se)&&(he.push(qt),ge.push(Xe),De.push(it),Xe=[],it=[],tt+=qt.length)}return[he,ge,De]}splitTokensOnSpaces(N){const[q,se,he]=this.splitTokensOnUnicode(N),ge=[],De=[],Xe=[],it=new RegExp(`^[${E}]$`,"gu");for(let tt=0;tt<q.length;++tt){const at=q[tt],$t=se[tt],qt=he[tt],Xt=$t[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),Ir=at.startsWith(" "),sr=at.trim(),Pr=it.test(sr);if(Xt||Ir||Pr||ge.length===0)ge.push(at),De.push($t),Xe.push(qt);else{const Ar=ge.length-1;ge[Ar]+=at,De[Ar].push(...$t),Xe[Ar].push(...qt)}}return[ge,De,Xe]}mergePunctuations(N,q,se,he,ge){const De=structuredClone(N),Xe=structuredClone(q),it=structuredClone(se);let tt=De.length-2,at=De.length-1;for(;tt>=0;)De[tt].startsWith(" ")&&he.includes(De[tt].trim())?(De[at]=De[tt]+De[at],Xe[at]=(0,s.mergeArrays)(Xe[tt],Xe[at]),it[at]=(0,s.mergeArrays)(it[tt],it[at]),De[tt]="",Xe[tt]=[],it[tt]=[]):at=tt,--tt;for(tt=0,at=1;at<De.length;)!De[tt].endsWith(" ")&&ge.includes(De[at])?(De[tt]+=De[at],Xe[tt]=(0,s.mergeArrays)(Xe[tt],Xe[at]),it[tt]=(0,s.mergeArrays)(it[tt],it[at]),De[at]="",Xe[at]=[],it[at]=[]):tt=at,++at;return[De.filter($t=>$t),Xe.filter($t=>$t.length>0),it.filter($t=>$t.length>0)]}}class Si extends Et{}class An extends Et{}class He extends Et{}class Qe extends Et{constructor(N,q){super(N,q),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(se=>this.languageRegex.test(se)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(N){if(N===null)return null;const[q,...se]=N.trim().split(this.languageRegex);if(se.length===0)return super._encode_text(q);if(se.length===2){const[he,ge]=se;return this.supported_language_codes.includes(he)||console.warn(`Unsupported language code "${he}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,s.mergeArrays)([he],super._encode_text(ge))}}}class lt extends Et{}class lr extends Et{}class Ci extends Et{}class Vs extends Et{}class os extends Et{}class Aa extends Et{constructor(N,q){super(N,q),this.decoder=new ut({})}}class ja extends Et{}class Oa extends Et{}class Na extends Et{}class Da{static async from_pretrained(N,{progress_callback:q=null,config:se=null,cache_dir:he=null,local_files_only:ge=!1,revision:De="main",legacy:Xe=null}={}){var qt;const[it,tt]=await h(N,{progress_callback:q,config:se,cache_dir:he,local_files_only:ge,revision:De,legacy:Xe}),at=((qt=tt.tokenizer_class)==null?void 0:qt.replace(/Fast$/,""))??"PreTrainedTokenizer";let $t=this.TOKENIZER_CLASS_MAPPING[at];return $t||(console.warn(`Unknown tokenizer class "${at}", attempting to construct from base class.`),$t=Et),new $t(it,tt)}}ie(Da,"TOKENIZER_CLASS_MAPPING",{T5Tokenizer:jt,DistilBertTokenizer:Re,CamembertTokenizer:ct,DebertaTokenizer:re,DebertaV2Tokenizer:V,BertTokenizer:pi,HerbertTokenizer:Y,ConvBertTokenizer:ce,RoFormerTokenizer:Se,XLMTokenizer:kt,ElectraTokenizer:xt,MobileBertTokenizer:or,SqueezeBertTokenizer:I,AlbertTokenizer:zt,GPT2Tokenizer:ot,BartTokenizer:Wt,MBartTokenizer:ar,MBart50Tokenizer:In,RobertaTokenizer:Bn,WhisperTokenizer:ks,CodeGenTokenizer:Si,CLIPTokenizer:An,SiglipTokenizer:He,MarianTokenizer:Qe,BloomTokenizer:Nr,NllbTokenizer:Wr,M2M100Tokenizer:$r,LlamaTokenizer:Dr,CodeLlamaTokenizer:Ms,XLMRobertaTokenizer:Ts,MPNetTokenizer:dn,FalconTokenizer:mi,GPTNeoXTokenizer:gi,EsmTokenizer:Zr,Wav2Vec2CTCTokenizer:lt,BlenderbotTokenizer:lr,BlenderbotSmallTokenizer:Ci,SpeechT5Tokenizer:Vs,NougatTokenizer:os,VitsTokenizer:Aa,Qwen2Tokenizer:Es,GemmaTokenizer:Xn,Grok1Tokenizer:En,CohereTokenizer:ja,MgpstrTokenizer:Oa,Ernie4_5_Tokenizer:Na,PreTrainedTokenizer:Et})},"./src/utils/audio.js":(e,t,r)=>{r.r(t),r.d(t,{RawAudio:()=>W,hamming:()=>u,hanning:()=>h,mel_filter_bank:()=>b,read_audio:()=>c,spectrogram:()=>S,window_function:()=>A});var n=r("./src/utils/hub.js"),s=r("./src/utils/maths.js"),i=r("./src/utils/core.js"),a=r("./src/env.js"),o=r("./src/utils/tensor.js"),l=r("?7992");async function c(B,ee){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const Q=await(await(0,n.getFile)(B)).arrayBuffer(),Z=new AudioContext({sampleRate:ee});typeof ee>"u"&&console.warn(`No sampling rate provided, using default of ${Z.sampleRate}Hz.`);const J=await Z.decodeAudioData(Q);let X;if(J.numberOfChannels===2){const ae=Math.sqrt(2),le=J.getChannelData(0),ne=J.getChannelData(1);X=new Float32Array(le.length);for(let L=0;L<J.length;++L)X[L]=ae*(le[L]+ne[L])/2}else X=J.getChannelData(0);return X}function d(B,ee){if(B<1)return new Float64Array;if(B===1)return new Float64Array([1]);const Q=1-ee,Z=2*Math.PI/(B-1),J=new Float64Array(B);for(let X=0;X<B;++X)J[X]=ee-Q*Math.cos(X*Z);return J}function h(B){return d(B,.5)}function u(B){return d(B,.54)}const p={htk:B=>2595*Math.log10(1+B/700),kaldi:B=>1127*Math.log(1+B/700),slaney:(B,ee=1e3,Q=15,Z=27/Math.log(6.4))=>B>=ee?Q+Math.log(B/ee)*Z:3*B/200};function m(B,ee="htk"){const Q=p[ee];if(!Q)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof B=="number"?Q(B):B.map(Z=>Q(Z))}const y={htk:B=>700*(10**(B/2595)-1),kaldi:B=>700*(Math.exp(B/1127)-1),slaney:(B,ee=1e3,Q=15,Z=Math.log(6.4)/27)=>B>=Q?ee*Math.exp(Z*(B-Q)):200*B/3};function P(B,ee="htk"){const Q=y[ee];if(!Q)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof B=="number"?Q(B):B.map(Z=>Q(Z))}function g(B,ee){const Q=Float64Array.from({length:ee.length-1},(ae,le)=>ee[le+1]-ee[le]),Z=Array.from({length:B.length},()=>new Array(ee.length));for(let ae=0;ae<B.length;++ae){const le=Z[ae];for(let ne=0;ne<ee.length;++ne)le[ne]=ee[ne]-B[ae]}const J=ee.length-2,X=Array.from({length:J},()=>new Array(B.length));for(let ae=0;ae<B.length;++ae){const le=Z[ae];for(let ne=0;ne<J;++ne){const L=-le[ne]/Q[ne],F=le[ne+2]/Q[ne+1];X[ne][ae]=Math.max(0,Math.min(L,F))}}return X}function _(B,ee,Q){const Z=(ee-B)/(Q-1);return Float64Array.from({length:Q},(J,X)=>B+Z*X)}function b(B,ee,Q,Z,J,X=null,ae="htk",le=!1){if(X!==null&&X!=="slaney")throw new Error('norm must be one of null or "slaney"');if(B<2)throw new Error(`Require num_frequency_bins: ${B} >= 2`);if(Q>Z)throw new Error(`Require min_frequency: ${Q} <= max_frequency: ${Z}`);const ne=m(Q,ae),L=m(Z,ae),F=_(ne,L,ee+2);let G=P(F,ae),oe;if(le){const Te=J/((B-1)*2);oe=m(Float64Array.from({length:B},(Ce,Be)=>Be*Te),ae),G=F}else oe=_(0,Math.floor(J/2),B);const H=g(oe,G);if(X!==null&&X==="slaney")for(let Te=0;Te<ee;++Te){const Ce=H[Te],Be=2/(G[Te+2]-G[Te]);for(let $e=0;$e<B;++$e)Ce[$e]*=Be}return H}function w(B,ee,Q){const Z=new B.constructor(B.length+ee+Q),J=B.length-1;for(let X=0;X<B.length;++X)Z[ee+X]=B[X];for(let X=1;X<=ee;++X)Z[ee-X]=B[(0,i.calculateReflectOffset)(X,J)];for(let X=1;X<=Q;++X)Z[J+ee+X]=B[(0,i.calculateReflectOffset)(J-X,J)];return Z}function M(B,ee,Q,Z,J){if(Q<=0)throw new Error("reference must be greater than zero");if(Z<=0)throw new Error("min_value must be greater than zero");Q=Math.max(Z,Q);const X=Math.log10(Q);for(let ae=0;ae<B.length;++ae)B[ae]=ee*Math.log10(Math.max(Z,B[ae])-X);if(J!==null){if(J<=0)throw new Error("db_range must be greater than zero");const ae=(0,s.max)(B)[0]-J;for(let le=0;le<B.length;++le)B[le]=Math.max(B[le],ae)}return B}function E(B,ee=1,Q=1e-5,Z=null){return M(B,20,ee,Q,Z)}function T(B,ee=1,Q=1e-10,Z=null){return M(B,10,ee,Q,Z)}async function S(B,ee,Q,Z,{fft_length:J=null,power:X=1,center:ae=!0,pad_mode:le="reflect",onesided:ne=!0,preemphasis:L=null,preemphasis_htk_flavor:F=!0,mel_filters:G=null,mel_floor:oe=1e-10,log_mel:H=null,reference:Te=1,min_value:Ce=1e-10,db_range:Be=null,remove_dc_offset:$e=null,min_num_frames:te=null,max_num_frames:O=null,do_pad:ue=!0,transpose:Ee=!1,mel_offset:fe=0}={}){const me=ee.length;if(J===null&&(J=Q),Q>J)throw Error(`frame_length (${Q}) may not be larger than fft_length (${J})`);if(me!==Q)throw new Error(`Length of the window (${me}) must equal frame_length (${Q})`);if(Z<=0)throw new Error("hop_length must be greater than zero");if(X===null&&G!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(!F)throw new Error("`preemphasis_htk_flavor=false` is not currently supported.");if(ae)switch(le){case"reflect":{const ze=Math.floor((J-1)/2)+1;B=w(B,ze,ze);break}case"constant":{const ze=Math.floor(J/2),Ke=new B.constructor(B.length+2*ze);Ke.set(B,ze),B=Ke;break}default:throw new Error(`pad_mode="${le}" not implemented yet.`)}let ve=Math.floor(1+Math.floor((B.length-Q)/Z));te!==null&&ve<te&&(ve=te);const xe=ne?Math.floor(J/2)+1:J;let _e=ve,je=ve;O!==null&&(O>ve?ue&&(je=O):je=_e=O);const we=new s.FFT(J),Oe=new Float64Array(J),Me=new Float64Array(we.outputBufferSize),We=new Float32Array(xe*je);for(let ze=0;ze<_e;++ze){const Ke=ze*Z,yt=Math.min(B.length-Ke,Q);yt!==Q&&Oe.fill(0,0,Q);for(let Ve=0;Ve<yt;++Ve)Oe[Ve]=B[Ke+Ve];if($e){let Ve=0;for(let ut=0;ut<yt;++ut)Ve+=Oe[ut];const wt=Ve/yt;for(let ut=0;ut<yt;++ut)Oe[ut]-=wt}if(L!==null){for(let Ve=yt-1;Ve>=1;--Ve)Oe[Ve]-=L*Oe[Ve-1];Oe[0]*=1-L}for(let Ve=0;Ve<ee.length;++Ve)Oe[Ve]*=ee[Ve];we.realTransform(Me,Oe);for(let Ve=0;Ve<xe;++Ve){const wt=Ve<<1;We[Ve*je+ze]=Me[wt]**2+Me[wt+1]**2}}if(X!==null&&X!==2){const ze=X/2;for(let Ke=0;Ke<We.length;++Ke)We[Ke]**=ze}const Le=G.length;let rt=await(0,o.matmul)(new o.Tensor("float32",G.flat(),[Le,xe]),new o.Tensor("float32",We,[xe,je]));Ee&&(rt=rt.transpose(1,0));const Ye=rt.data;for(let ze=0;ze<Ye.length;++ze)Ye[ze]=fe+Math.max(oe,Ye[ze]);if(X!==null&&H!==null){const ze=Math.min(Ye.length,_e*Le);switch(H){case"log":for(let Ke=0;Ke<ze;++Ke)Ye[Ke]=Math.log(Ye[Ke]);break;case"log10":for(let Ke=0;Ke<ze;++Ke)Ye[Ke]=Math.log10(Ye[Ke]);break;case"dB":if(X===1)E(Ye,Te,Ce,Be);else if(X===2)T(Ye,Te,Ce,Be);else throw new Error(`Cannot use log_mel option '${H}' with power ${X}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${H}'`)}}return rt}function A(B,ee,{periodic:Q=!0,frame_length:Z=null,center:J=!0}={}){const X=Q?B+1:B;let ae;switch(ee){case"boxcar":ae=new Float64Array(X).fill(1);break;case"hann":case"hann_window":ae=h(X);break;case"hamming":ae=u(X);break;case"povey":ae=h(X).map(le=>Math.pow(le,.85));break;default:throw new Error(`Unknown window type ${ee}.`)}if(Q&&(ae=ae.subarray(0,B)),Z===null)return ae;if(B>Z)throw new Error(`Length of the window (${B}) may not be larger than frame_length (${Z})`);return ae}function j(B,ee){let Q=44;const Z=new ArrayBuffer(Q+B.length*4),J=new DataView(Z);U(J,0,"RIFF"),J.setUint32(4,36+B.length*4,!0),U(J,8,"WAVE"),U(J,12,"fmt "),J.setUint32(16,16,!0),J.setUint16(20,3,!0),J.setUint16(22,1,!0),J.setUint32(24,ee,!0),J.setUint32(28,ee*4,!0),J.setUint16(32,4,!0),J.setUint16(34,32,!0),U(J,36,"data"),J.setUint32(40,B.length*4,!0);for(let X=0;X<B.length;++X,Q+=4)J.setFloat32(Q,B[X],!0);return Z}function U(B,ee,Q){for(let Z=0;Z<Q.length;++Z)B.setUint8(ee+Z,Q.charCodeAt(Z))}class W{constructor(ee,Q){this.audio=ee,this.sampling_rate=Q}toWav(){return j(this.audio,this.sampling_rate)}toBlob(){const ee=this.toWav();return new Blob([ee],{type:"audio/wav"})}async save(ee){let Q;if(a.apis.IS_BROWSER_ENV){if(a.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save a file from a Web Worker.");Q=i.saveBlob}else if(a.apis.IS_FS_AVAILABLE)Q=async(Z,J)=>{let X=await J.arrayBuffer();l.writeFileSync(Z,Buffer.from(X))};else throw new Error("Unable to save because filesystem is disabled in this environment.");await Q(ee,this.toBlob())}}},"./src/utils/constants.js":(e,t,r)=>{r.r(t),r.d(t,{CHAT_TEMPLATE_NAME:()=>l,CONFIG_NAME:()=>s,FEATURE_EXTRACTOR_NAME:()=>i,GENERATION_CONFIG_NAME:()=>c,GITHUB_ISSUE_URL:()=>n,IMAGE_PROCESSOR_NAME:()=>a,PROCESSOR_NAME:()=>o});const n="https://github.com/huggingface/transformers.js/issues/new/choose",s="config.json",i="preprocessor_config.json",a=i,o="processor_config.json",l="chat_template.jinja",c="generation_config.json"},"./src/utils/core.js":(e,t,r)=>{r.r(t),r.d(t,{calculateDimensions:()=>c,calculateReflectOffset:()=>p,count:()=>g,dispatchCallback:()=>n,escapeRegExp:()=>i,isIntegralNumber:()=>o,isNullishDimension:()=>l,isTypedArray:()=>a,len:()=>P,mergeArrays:()=>h,pick:()=>y,pop:()=>d,product:()=>u,reverseDictionary:()=>s,saveBlob:()=>m});function n(_,b){_&&_(b)}function s(_){return Object.fromEntries(Object.entries(_).map(([b,w])=>[w,b]))}function i(_){return _.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function a(_){var b,w,M;return((M=(w=(b=_==null?void 0:_.prototype)==null?void 0:b.__proto__)==null?void 0:w.constructor)==null?void 0:M.name)==="TypedArray"}function o(_){return Number.isInteger(_)||typeof _=="bigint"}function l(_){return _==null||_===-1}function c(_){const b=[];let w=_;for(;Array.isArray(w);)b.push(w.length),w=w[0];return b}function d(_,b,w=void 0){const M=_[b];if(M!==void 0)return delete _[b],M;if(w===void 0)throw Error(`Key ${b} does not exist in object.`);return w}function h(..._){return Array.prototype.concat.apply([],_)}function u(..._){return _.reduce((b,w)=>b.flatMap(M=>w.map(E=>[M,E])))}function p(_,b){return Math.abs((_+b)%(2*b)-b)}function m(_,b){const w=URL.createObjectURL(b),M=document.createElement("a");M.href=w,M.download=_,M.click(),M.remove(),URL.revokeObjectURL(w)}function y(_,b){return Object.assign({},...b.map(w=>{if(_[w]!==void 0)return{[w]:_[w]}}))}function P(_){let b=0;for(const w of _)++b;return b}function g(_,b){let w=0;for(const M of _)M===b&&++w;return w}},"./src/utils/data-structures.js":(e,t,r)=>{r.r(t),r.d(t,{CharTrie:()=>s,DictionarySplitter:()=>l,LRUCache:()=>c,PriorityQueue:()=>n,TokenLattice:()=>a});class n{constructor(h=(p,m)=>p>m,u=1/0){this._heap=[],this._comparator=h,this._maxSize=u}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...h){return this.extend(h)}extend(h){for(const u of h)if(this.size<this._maxSize)this._heap.push(u),this._siftUp();else{const p=this._smallest();this._comparator(u,this._heap[p])&&(this._heap[p]=u,this._siftUpFrom(p))}return this.size}pop(){const h=this.peek(),u=this.size-1;return u>0&&this._swap(0,u),this._heap.pop(),this._siftDown(),h}replace(h){const u=this.peek();return this._heap[0]=h,this._siftDown(),u}_parent(h){return(h+1>>>1)-1}_left(h){return(h<<1)+1}_right(h){return h+1<<1}_greater(h,u){return this._comparator(this._heap[h],this._heap[u])}_swap(h,u){const p=this._heap[h];this._heap[h]=this._heap[u],this._heap[u]=p}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(h){for(;h>0&&this._greater(h,this._parent(h));)this._swap(h,this._parent(h)),h=this._parent(h)}_siftDown(){let h=0;for(;this._left(h)<this.size&&this._greater(this._left(h),h)||this._right(h)<this.size&&this._greater(this._right(h),h);){const u=this._right(h)<this.size&&this._greater(this._right(h),this._left(h))?this._right(h):this._left(h);this._swap(h,u),h=u}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class s{constructor(){this.root=i.default()}extend(h){for(const u of h)this.push(u)}push(h){let u=this.root;for(const p of h){let m=u.children.get(p);m===void 0&&(m=i.default(),u.children.set(p,m)),u=m}u.isLeaf=!0}*commonPrefixSearch(h){let u=this.root;if(u===void 0)return;let p="";for(const m of h){if(p+=m,u=u.children.get(m),u===void 0)return;u.isLeaf&&(yield p)}}}class i{constructor(h,u){this.isLeaf=h,this.children=u}static default(){return new i(!1,new Map)}}class a{constructor(h,u,p){this.chars=Array.from(h),this.len=this.chars.length,this.bosTokenId=u,this.eosTokenId=p,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const m=new o(this.bosTokenId,0,0,0,0),y=new o(this.eosTokenId,1,this.len,0,0);this.nodes.push(m.clone()),this.nodes.push(y.clone()),this.beginNodes[this.len].push(y),this.endNodes[0].push(m)}insert(h,u,p,m){const y=this.nodes.length,P=new o(m,y,h,u,p);this.beginNodes[h].push(P),this.endNodes[h+u].push(P),this.nodes.push(P)}viterbi(){const h=this.len;let u=0;for(;u<=h;){if(this.beginNodes[u].length==0)return[];for(let g of this.beginNodes[u]){g.prev=null;let _=0,b=null;for(let w of this.endNodes[u]){const M=w.backtraceScore+g.score;(b===null||M>_)&&(b=w.clone(),_=M)}if(b!==null)g.prev=b,g.backtraceScore=_;else return[]}++u}const p=[],y=this.beginNodes[h][0].prev;if(y===null)return[];let P=y.clone();for(;P.prev!==null;)p.push(P.clone()),P=P.clone().prev.clone();return p.reverse(),p}piece(h){return this.chars.slice(h.pos,h.pos+h.length).join("")}tokens(){return this.viterbi().map(u=>this.piece(u))}tokenIds(){return this.viterbi().map(u=>u.tokenId)}}class o{constructor(h,u,p,m,y){this.tokenId=h,this.nodeId=u,this.pos=p,this.length=m,this.score=y,this.prev=null,this.backtraceScore=0}clone(){const h=new o(this.tokenId,this.nodeId,this.pos,this.length,this.score);return h.prev=this.prev,h.backtraceScore=this.backtraceScore,h}}class l{constructor(h){this.trie=this._buildTrie(h)}_buildTrie(h){var p;const u=Object.create(null);for(const m of h){let y=u;for(let P=0;P<m.length;++P)y=y[p=m[P]]??(y[p]=Object.create(null));y.end=m}return u}split(h){const u=[],p=h.length;let m=0,y=0;for(;y<p;){let P=this.trie,g=null,_=y;for(;_<p&&(P=P[h[_]]);)P.end&&(g=P.end),++_;g?(y>m&&u.push(h.slice(m,y)),u.push(g),y+=g.length,m=y):++y}return m<p&&u.push(h.slice(m)),u}}class c{constructor(h){this.capacity=h,this.cache=new Map}get(h){if(!this.cache.has(h))return;const u=this.cache.get(h);return this.cache.delete(h),this.cache.set(h,u),u}put(h,u){this.cache.has(h)&&this.cache.delete(h),this.cache.set(h,u),this.cache.size>this.capacity&&this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}},"./src/utils/devices.js":(e,t,r)=>{r.r(t),r.d(t,{DEVICE_TYPES:()=>n});const n=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})},"./src/utils/dtypes.js":(e,t,r)=>{r.r(t),r.d(t,{DATA_TYPES:()=>a,DEFAULT_DEVICE_DTYPE_MAPPING:()=>o,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>l,isWebGpuFp16Supported:()=>i});var n=r("./src/env.js"),s=r("./src/utils/devices.js");const i=function(){let c;return async function(){if(c===void 0)if(!n.apis.IS_WEBGPU_AVAILABLE)c=!1;else try{c=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{c=!1}return c}}(),a=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),o=Object.freeze({[s.DEVICE_TYPES.wasm]:a.q8}),l=Object.freeze({[a.fp32]:"",[a.fp16]:"_fp16",[a.int8]:"_int8",[a.uint8]:"_uint8",[a.q8]:"_quantized",[a.q4]:"_q4",[a.q4f16]:"_q4f16",[a.bnb4]:"_bnb4"})},"./src/utils/generic.js":(e,t,r)=>{r.r(t),r.d(t,{Callable:()=>n});const n=class{constructor(){let s=function(...i){return s._call(...i)};return Object.setPrototypeOf(s,new.target.prototype)}_call(...s){throw Error("Must implement _call method in subclass")}}},"./src/utils/hub.js":(e,t,r)=>{r.r(t),r.d(t,{MAX_EXTERNAL_DATA_CHUNKS:()=>o,getFile:()=>p,getModelFile:()=>_,getModelJSON:()=>w,getModelText:()=>b});var n=r("?7992"),s=r("?5af5"),i=r("./src/env.js"),a=r("./src/utils/core.js");const o=100,l={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class c{constructor(S){if(this.filePath=S,this.headers=new Headers,this.exists=n.existsSync(S),this.exists){this.status=200,this.statusText="OK";let A=n.statSync(S);this.headers.set("content-length",A.size.toString()),this.updateContentType();const j=n.createReadStream(S);this.body=new ReadableStream({start(U){j.on("data",W=>U.enqueue(W)),j.on("end",()=>U.close()),j.on("error",W=>U.error(W))},cancel(){j.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const S=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",l[S]??"application/octet-stream")}clone(){let S=new c(this.filePath);return S.exists=this.exists,S.status=this.status,S.statusText=this.statusText,S.headers=new Headers(this.headers),S}async arrayBuffer(){return(await n.promises.readFile(this.filePath)).buffer}async blob(){const S=await n.promises.readFile(this.filePath);return new Blob([S],{type:this.headers.get("content-type")})}async text(){return await n.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function d(T,S=null,A=null){let j;try{j=new URL(T)}catch{return!1}return!(S&&!S.includes(j.protocol)||A&&!A.includes(j.hostname))}const h=/^(\b[\w\-.]+\b\/)?\b[\w\-.]{1,96}\b$/;function u(T){return!(!h.test(T)||T.includes("..")||T.includes("--")||T.endsWith(".git")||T.endsWith(".ipynb"))}async function p(T){var S;if(i.env.useFS&&!d(T,["http:","https:","blob:"]))return new c(T instanceof URL?T.protocol==="file:"?T.pathname:T.toString():T);if(typeof process<"u"&&((S=process==null?void 0:process.release)==null?void 0:S.name)==="node"){const A=!!(ji!=null&&ji.TESTING_REMOTELY),j=i.env.version,U=new Headers;if(U.set("User-Agent",`transformers.js/${j}; is_ci/${A};`),d(T,["http:","https:"],["huggingface.co","hf.co"])){const B=(ji==null?void 0:ji.HF_TOKEN)??(ji==null?void 0:ji.HF_ACCESS_TOKEN);B&&U.set("Authorization",`Bearer ${B}`)}return fetch(T,{headers:U})}else return fetch(T)}const m={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function y(T,S,A){if(!A)return null;const j=m[T]??`Error (${T}) occurred while trying to load file`;throw Error(`${j}: "${S}".`)}class P{constructor(S){this.path=S}async match(S){let A=s.join(this.path,S),j=new c(A);if(j.exists)return j}async put(S,A,j=void 0){let U=s.join(this.path,S);try{const W=A.headers.get("Content-Length"),B=parseInt(W??"0");let ee=0;await n.promises.mkdir(s.dirname(U),{recursive:!0});const Q=n.createWriteStream(U),Z=A.body.getReader();for(;;){const{done:J,value:X}=await Z.read();if(J)break;await new Promise((le,ne)=>{Q.write(X,L=>{if(L){ne(L);return}le()})}),ee+=X.length;const ae=B?ee/B*100:0;j==null||j({progress:ae,loaded:ee,total:B})}Q.close()}catch(W){try{await n.promises.unlink(U)}catch{}throw W}}}async function g(T,...S){for(let A of S)try{let j=await T.match(A);if(j)return j}catch{continue}}async function _(T,S,A=!0,j={},U=!1){if(!i.env.allowLocalModels){if(j.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!i.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,a.dispatchCallback)(j.progress_callback,{status:"initiate",name:T,file:S});let W;if(!W&&i.env.useCustomCache){if(!i.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!i.env.customCache.match||!i.env.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");W=i.env.customCache}if(!W&&i.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{W=await caches.open("transformers-cache")}catch(oe){console.warn("An error occurred while opening the browser cache:",oe)}}if(!W&&i.env.useFSCache){if(!i.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");W=new P(j.cache_dir??i.env.cacheDir)}const B=j.revision??"main",ee=E(T,S),Q=u(T),Z=Q?E(i.env.localModelPath,ee):ee,J=E(i.env.remoteHost,i.env.remotePathTemplate.replaceAll("{model}",T).replaceAll("{revision}",encodeURIComponent(B)),S);let X;const ae=W instanceof P?B==="main"?ee:E(T,B,S):J;let le=!1,ne;W&&(ne=await g(W,Z,ae));const L=ne!==void 0;if(ne===void 0){if(i.env.allowLocalModels)if(d(ee,["http:","https:"])){if(j.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${ee}.`);if(!i.env.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${ee}.`)}else try{ne=await p(Z),X=Z}catch(H){console.warn(`Unable to load from local path "${Z}": "${H}"`)}if(ne===void 0||ne.status===404){if(j.local_files_only||!i.env.allowRemoteModels){if(A)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${Z}".`);return null}if(!Q)throw Error(`Local file missing at "${Z}" and download aborted due to invalid model ID "${T}".`);if(ne=await p(J),ne.status!==200)return y(ne.status,J,A);X=ae}le=W&&typeof Response<"u"&&ne instanceof Response&&ne.status===200}(0,a.dispatchCallback)(j.progress_callback,{status:"download",name:T,file:S});let F;if(!(i.apis.IS_NODE_ENV&&U)){let oe;j.progress_callback?L&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(oe=new Uint8Array(await ne.arrayBuffer()),(0,a.dispatchCallback)(j.progress_callback,{status:"progress",name:T,file:S,progress:100,loaded:oe.length,total:oe.length})):oe=await M(ne,H=>{(0,a.dispatchCallback)(j.progress_callback,{status:"progress",name:T,file:S,...H})}):oe=new Uint8Array(await ne.arrayBuffer()),F=oe}if(le&&X&&await W.match(X)===void 0)if(F)await W.put(X,new Response(F,{headers:ne.headers})).catch(oe=>{console.warn(`Unable to add response to browser cache: ${oe}.`)});else{const oe=j.progress_callback?H=>(0,a.dispatchCallback)(j.progress_callback,{status:"progress",name:T,file:S,...H}):void 0;await W.put(X,ne,oe)}if((0,a.dispatchCallback)(j.progress_callback,{status:"done",name:T,file:S}),F){if(!i.apis.IS_NODE_ENV&&U)throw new Error("Cannot return path in a browser environment.");return F}if(ne instanceof c)return ne.filePath;const G=await(W==null?void 0:W.match(X));if(G instanceof c)return G.filePath;if(G instanceof Response)return new Uint8Array(await G.arrayBuffer());if(typeof G=="string")return G;throw new Error("Unable to get model file path or buffer.")}async function b(T,S,A=!0,j={}){const U=await _(T,S,A,j,!1);return U===null?null:new TextDecoder("utf-8").decode(U)}async function w(T,S,A=!0,j={}){const U=await b(T,S,A,j);return U===null?{}:JSON.parse(U)}async function M(T,S){const A=T.headers.get("Content-Length");A===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let j=parseInt(A??"0"),U=new Uint8Array(j),W=0;const B=T.body.getReader();async function ee(){const{done:Q,value:Z}=await B.read();if(Q)return;const J=W+Z.length;if(J>j){j=J;const ae=new Uint8Array(j);ae.set(U),U=ae}U.set(Z,W),W=J;const X=W/j*100;return S({progress:X,loaded:W,total:j}),ee()}return await ee(),U}function E(...T){return T=T.map((S,A)=>(A&&(S=S.replace(new RegExp("^/"),"")),A!==T.length-1&&(S=S.replace(new RegExp("/$"),"")),S)),T.join("/")}},"./src/utils/image.js":(e,t,r)=>{r.r(t),r.d(t,{RawImage:()=>m,load_image:()=>y});var n=r("./src/utils/core.js"),s=r("./src/utils/hub.js"),i=r("./src/env.js"),a=r("./src/utils/tensor.js"),o=r("?2b25");let l,c,d;const h=i.apis.IS_BROWSER_ENV||i.apis.IS_WEBWORKER_ENV;if(h)l=(P,g)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(P,g)},d=self.createImageBitmap,c=self.ImageData;else if(o)d=async P=>{const _=(await P.metadata()).channels,{data:b,info:w}=await P.rotate().raw().toBuffer({resolveWithObject:!0}),M=new m(new Uint8ClampedArray(b),w.width,w.height,w.channels);return _!==void 0&&_!==w.channels&&M.convert(_),M};else throw new Error("Unable to load image processing library.");const u={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},p=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class m{constructor(g,_,b,w){this.data=g,this.width=_,this.height=b,this.channels=w}get size(){return[this.width,this.height]}static async read(g){if(g instanceof m)return g;if(typeof g=="string"||g instanceof URL)return await this.fromURL(g);if(g instanceof Blob)return await this.fromBlob(g);if(typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&g instanceof OffscreenCanvas)return this.fromCanvas(g);throw new Error(`Unsupported input type: ${typeof g}`)}static fromCanvas(g){if(!h)throw new Error("fromCanvas() is only supported in browser environments.");const b=g.getContext("2d").getImageData(0,0,g.width,g.height).data;return new m(b,g.width,g.height,4)}static async fromURL(g){const _=await(0,s.getFile)(g);if(_.status!==200)throw new Error(`Unable to read image from "${g}" (${_.status} ${_.statusText})`);const b=await _.blob();return this.fromBlob(b)}static async fromBlob(g){if(h){const _=await d(g),b=l(_.width,_.height).getContext("2d");return b.drawImage(_,0,0),new this(b.getImageData(0,0,_.width,_.height).data,_.width,_.height,4)}else{const _=o(await g.arrayBuffer());return await d(_)}}static fromTensor(g,_="CHW"){if(g.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${g.dims.length} dimensions.`);if(_==="CHW")g=g.transpose(1,2,0);else if(_!=="HWC")throw new Error(`Unsupported channel format: ${_}`);if(!(g.data instanceof Uint8ClampedArray||g.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${g.type}`);switch(g.dims[2]){case 1:case 2:case 3:case 4:return new m(g.data,g.dims[1],g.dims[0],g.dims[2]);default:throw new Error(`Unsupported number of channels: ${g.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const g=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let _=0,b=0;_<this.data.length;_+=this.channels){const w=this.data[_],M=this.data[_+1],E=this.data[_+2];g[b++]=Math.round(.2989*w+.587*M+.114*E)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(g,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const g=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let _=0,b=0;_<this.data.length;++_)g[b++]=this.data[_],g[b++]=this.data[_],g[b++]=this.data[_];break;case 4:for(let _=0,b=0;_<this.data.length;_+=4)g[b++]=this.data[_],g[b++]=this.data[_+1],g[b++]=this.data[_+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(g,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const g=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let _=0,b=0;_<this.data.length;++_)g[b++]=this.data[_],g[b++]=this.data[_],g[b++]=this.data[_],g[b++]=255;break;case 3:for(let _=0,b=0;_<this.data.length;_+=3)g[b++]=this.data[_],g[b++]=this.data[_+1],g[b++]=this.data[_+2],g[b++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(g,this.width,this.height,4)}putAlpha(g){if(g.width!==this.width||g.height!==this.height)throw new Error(`Expected mask size to be ${this.width}x${this.height}, but got ${g.width}x${g.height}`);if(g.channels!==1)throw new Error(`Expected mask to have 1 channel, but got ${g.channels}`);const _=this.data,b=g.data,w=this.width*this.height;if(this.channels===3){const M=new Uint8ClampedArray(w*4);for(let E=0,T=0,S=0;E<w;++E)M[S++]=_[T++],M[S++]=_[T++],M[S++]=_[T++],M[S++]=b[E];return this._update(M,this.width,this.height,4)}else if(this.channels===4){for(let M=0;M<w;++M)_[4*M+3]=b[M];return this}throw new Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(g,_,{resample:b=2}={}){if(this.width===g&&this.height===_)return this;let w=u[b]??b;const M=(0,n.isNullishDimension)(g),E=(0,n.isNullishDimension)(_);if(M&&E)return this;if(M?g=_/this.height*this.width:E&&(_=g/this.width*this.height),h){const T=this.channels,S=this.toCanvas(),A=l(g,_).getContext("2d");return A.drawImage(S,0,0,g,_),new m(A.getImageData(0,0,g,_).data,g,_,4).convert(T)}else{let T=this.toSharp();switch(w){case"box":case"hamming":(w==="box"||w==="hamming")&&(console.warn(`Resampling method ${w} is not yet supported. Using bilinear instead.`),w="bilinear");case"nearest":case"bilinear":case"bicubic":T=T.affine([g/this.width,0,0,_/this.height],{interpolator:w});break;case"lanczos":T=T.resize({width:g,height:_,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${w} is not supported.`)}return await d(T)}}async pad([g,_,b,w]){if(g=Math.max(g,0),_=Math.max(_,0),b=Math.max(b,0),w=Math.max(w,0),g===0&&_===0&&b===0&&w===0)return this;if(h){const M=this.channels,E=this.toCanvas(),T=this.width+g+_,S=this.height+b+w,A=l(T,S).getContext("2d");return A.drawImage(E,0,0,this.width,this.height,g,b,this.width,this.height),new m(A.getImageData(0,0,T,S).data,T,S,4).convert(M)}else{const M=this.toSharp().extend({left:g,right:_,top:b,bottom:w});return await d(M)}}async crop([g,_,b,w]){if(g=Math.max(g,0),_=Math.max(_,0),b=Math.min(b,this.width-1),w=Math.min(w,this.height-1),g===0&&_===0&&b===this.width-1&&w===this.height-1)return this;const M=b-g+1,E=w-_+1;if(h){const T=this.channels,S=this.toCanvas(),A=l(M,E).getContext("2d");return A.drawImage(S,g,_,M,E,0,0,M,E),new m(A.getImageData(0,0,M,E).data,M,E,4).convert(T)}else{const T=this.toSharp().extract({left:g,top:_,width:M,height:E});return await d(T)}}async center_crop(g,_){if(this.width===g&&this.height===_)return this;const b=(this.width-g)/2,w=(this.height-_)/2;if(h){const M=this.channels,E=this.toCanvas(),T=l(g,_).getContext("2d");let S=0,A=0,j=0,U=0;return b>=0?S=b:j=-b,w>=0?A=w:U=-w,T.drawImage(E,S,A,g,_,j,U,g,_),new m(T.getImageData(0,0,g,_).data,g,_,4).convert(M)}else{let M=this.toSharp();if(b>=0&&w>=0)M=M.extract({left:Math.floor(b),top:Math.floor(w),width:g,height:_});else if(b<=0&&w<=0){const E=Math.floor(-w),T=Math.floor(-b);M=M.extend({top:E,left:T,right:g-this.width-T,bottom:_-this.height-E})}else{let E=[0,0],T=0;w<0?(E[0]=Math.floor(-w),E[1]=_-this.height-E[0]):T=Math.floor(w);let S=[0,0],A=0;b<0?(S[0]=Math.floor(-b),S[1]=g-this.width-S[0]):A=Math.floor(b),M=M.extend({top:E[0],bottom:E[1],left:S[0],right:S[1]}).extract({left:A,top:T,width:g,height:_})}return await d(M)}}async toBlob(g="image/png",_=1){if(!h)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:g,quality:_})}toTensor(g="CHW"){let _=new a.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(g!=="HWC")if(g==="CHW")_=_.permute(2,0,1);else throw new Error(`Unsupported channel format: ${g}`);return _}toCanvas(){if(!h)throw new Error("toCanvas() is only supported in browser environments.");const g=this.clone().rgba(),_=l(g.width,g.height),b=new c(g.data,g.width,g.height);return _.getContext("2d").putImageData(b,0,0),_}split(){const{data:g,width:_,height:b,channels:w}=this,M=g.constructor,E=g.length/w,T=Array.from({length:w},()=>new M(E));for(let S=0;S<E;++S){const A=w*S;for(let j=0;j<w;++j)T[j][S]=g[A+j]}return T.map(S=>new m(S,_,b,1))}_update(g,_,b,w=null){return this.data=g,this.width=_,this.height=b,w!==null&&(this.channels=w),this}clone(){return new m(this.data.slice(),this.width,this.height,this.channels)}convert(g){if(this.channels===g)return this;switch(g){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(g){if(h){if(i.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const _=g.split(".").pop().toLowerCase(),b=p.get(_)??"image/png",w=await this.toBlob(b);(0,n.saveBlob)(g,w)}else{if(i.apis.IS_FS_AVAILABLE)return await this.toSharp().toFile(g);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(h)throw new Error("toSharp() is only supported in server-side environments.");return o(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}const y=m.read.bind(m)},"./src/utils/maths.js":(e,t,r)=>{r.r(t),r.d(t,{FFT:()=>y,bankers_round:()=>_,cos_sim:()=>l,dot:()=>o,dynamic_time_warping:()=>b,interpolate_data:()=>n,log_softmax:()=>a,magnitude:()=>c,max:()=>h,medianFilter:()=>P,min:()=>d,permute_data:()=>s,round:()=>g,softmax:()=>i});function n(w,[M,E,T],[S,A],j="bilinear",U=!1){const W=A/T,B=S/E,ee=new w.constructor(S*A*M),Q=E*T,Z=S*A;for(let J=0;J<S;++J)for(let X=0;X<A;++X){const ae=J*A+X,le=(X+.5)/W-.5,ne=(J+.5)/B-.5;let L=Math.floor(le),F=Math.floor(ne);const G=Math.min(L+1,T-1),oe=Math.min(F+1,E-1);L=Math.max(L,0),F=Math.max(F,0);const H=le-L,Te=ne-F,Ce=(1-H)*(1-Te),Be=H*(1-Te),$e=(1-H)*Te,te=H*Te,O=F*T,ue=oe*T,Ee=O+L,fe=O+G,me=ue+L,ve=ue+G;for(let xe=0;xe<M;++xe){const _e=xe*Q;ee[xe*Z+ae]=Ce*w[_e+Ee]+Be*w[_e+fe]+$e*w[_e+me]+te*w[_e+ve]}}return ee}function s(w,M,E){const T=new Array(E.length),S=new Array(E.length);for(let U=E.length-1,W=1;U>=0;--U)S[U]=W,T[U]=M[E[U]],W*=T[U];const A=E.map((U,W)=>S[E.indexOf(W)]),j=new w.constructor(w.length);for(let U=0;U<w.length;++U){let W=0;for(let B=M.length-1,ee=U;B>=0;--B)W+=ee%M[B]*A[B],ee=Math.floor(ee/M[B]);j[W]=w[U]}return[j,T]}function i(w){const M=h(w)[0],E=w.map(A=>Math.exp(A-M)),T=E.reduce((A,j)=>A+j,0);return E.map(A=>A/T)}function a(w){const M=h(w)[0];let E=0;for(let A=0;A<w.length;++A)E+=Math.exp(w[A]-M);const T=Math.log(E);return w.map(A=>A-M-T)}function o(w,M){let E=0;for(let T=0;T<w.length;++T)E+=w[T]*M[T];return E}function l(w,M){const E=o(w,M),T=c(w),S=c(M);return E/(T*S)}function c(w){return Math.sqrt(w.reduce((M,E)=>M+E*E,0))}function d(w){if(w.length===0)throw Error("Array must not be empty");let M=w[0],E=0;for(let T=1;T<w.length;++T)w[T]<M&&(M=w[T],E=T);return[M,E]}function h(w){if(w.length===0)throw Error("Array must not be empty");let M=w[0],E=0;for(let T=1;T<w.length;++T)w[T]>M&&(M=w[T],E=T);return[M,E]}function u(w){return w>0&&(w&w-1)===0}class p{constructor(M){if(this.size=M|0,this.size<=1||!u(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=M<<1,this.table=new Float64Array(this.size*2);for(let T=0;T<this.table.length;T+=2){const S=Math.PI*T/this.size;this.table[T]=Math.cos(S),this.table[T+1]=-Math.sin(S)}let E=0;for(let T=1;this.size>T;T<<=1)++E;this._width=E%2===0?E-1:E,this._bitrev=new Int32Array(1<<this._width);for(let T=0;T<this._bitrev.length;++T){this._bitrev[T]=0;for(let S=0;S<this._width;S+=2){const A=this._width-S-2;this._bitrev[T]|=(T>>>S&3)<<A}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(M,E){const T=E||new Array(M.length>>>1);for(let S=0;S<M.length;S+=2)T[S>>>1]=M[S];return T}toComplexArray(M,E){const T=E||this.createComplexArray();for(let S=0;S<T.length;S+=2)T[S]=M[S>>>1],T[S+1]=0;return T}transform(M,E){if(M===E)throw new Error("Input and output buffers must be different");this._transform4(M,E,1)}realTransform(M,E){if(M===E)throw new Error("Input and output buffers must be different");this._realTransform4(M,E,1)}inverseTransform(M,E){if(M===E)throw new Error("Input and output buffers must be different");this._transform4(M,E,-1);for(let T=0;T<M.length;++T)M[T]/=this.size}_transform4(M,E,T){const S=this._csize;let j=1<<this._width,U=S/j<<1,W,B;const ee=this._bitrev;if(U===4)for(W=0,B=0;W<S;W+=U,++B){const Z=ee[B];this._singleTransform2(E,M,W,Z,j)}else for(W=0,B=0;W<S;W+=U,++B){const Z=ee[B];this._singleTransform4(E,M,W,Z,j,T)}const Q=this.table;for(j>>=2;j>=2;j>>=2){U=S/j<<1;const Z=U>>>2;for(W=0;W<S;W+=U){const J=W+Z-1;for(let X=W,ae=0;X<J;X+=2,ae+=j){const le=X,ne=le+Z,L=ne+Z,F=L+Z,G=M[le],oe=M[le+1],H=M[ne],Te=M[ne+1],Ce=M[L],Be=M[L+1],$e=M[F],te=M[F+1],O=Q[ae],ue=T*Q[ae+1],Ee=H*O-Te*ue,fe=H*ue+Te*O,me=Q[2*ae],ve=T*Q[2*ae+1],xe=Ce*me-Be*ve,_e=Ce*ve+Be*me,je=Q[3*ae],we=T*Q[3*ae+1],Oe=$e*je-te*we,Me=$e*we+te*je,We=G+xe,Le=oe+_e,rt=G-xe,Ye=oe-_e,ze=Ee+Oe,Ke=fe+Me,yt=T*(Ee-Oe),Ve=T*(fe-Me);M[le]=We+ze,M[le+1]=Le+Ke,M[ne]=rt+Ve,M[ne+1]=Ye-yt,M[L]=We-ze,M[L+1]=Le-Ke,M[F]=rt-Ve,M[F+1]=Ye+yt}}}}_singleTransform2(M,E,T,S,A){const j=M[S],U=M[S+1],W=M[S+A],B=M[S+A+1];E[T]=j+W,E[T+1]=U+B,E[T+2]=j-W,E[T+3]=U-B}_singleTransform4(M,E,T,S,A,j){const U=A*2,W=A*3,B=M[S],ee=M[S+1],Q=M[S+A],Z=M[S+A+1],J=M[S+U],X=M[S+U+1],ae=M[S+W],le=M[S+W+1],ne=B+J,L=ee+X,F=B-J,G=ee-X,oe=Q+ae,H=Z+le,Te=j*(Q-ae),Ce=j*(Z-le);E[T]=ne+oe,E[T+1]=L+H,E[T+2]=F+Ce,E[T+3]=G-Te,E[T+4]=ne-oe,E[T+5]=L-H,E[T+6]=F-Ce,E[T+7]=G+Te}_realTransform4(M,E,T){const S=this._csize;let j=1<<this._width,U=S/j<<1,W,B;const ee=this._bitrev;if(U===4)for(W=0,B=0;W<S;W+=U,++B){const J=ee[B];this._singleRealTransform2(E,M,W,J>>>1,j>>>1)}else for(W=0,B=0;W<S;W+=U,++B){const J=ee[B];this._singleRealTransform4(E,M,W,J>>>1,j>>>1,T)}const Q=this.table;for(j>>=2;j>=2;j>>=2){U=S/j<<1;const J=U>>>1,X=J>>>1,ae=X>>>1;for(W=0;W<S;W+=U)for(let le=0,ne=0;le<=ae;le+=2,ne+=j){const L=W+le,F=L+X,G=F+X,oe=G+X,H=M[L],Te=M[L+1],Ce=M[F],Be=M[F+1],$e=M[G],te=M[G+1],O=M[oe],ue=M[oe+1],Ee=H,fe=Te,me=Q[ne],ve=T*Q[ne+1],xe=Ce*me-Be*ve,_e=Ce*ve+Be*me,je=Q[2*ne],we=T*Q[2*ne+1],Oe=$e*je-te*we,Me=$e*we+te*je,We=Q[3*ne],Le=T*Q[3*ne+1],rt=O*We-ue*Le,Ye=O*Le+ue*We,ze=Ee+Oe,Ke=fe+Me,yt=Ee-Oe,Ve=fe-Me,wt=xe+rt,ut=_e+Ye,yr=T*(xe-rt),wr=T*(_e-Ye);if(M[L]=ze+wt,M[L+1]=Ke+ut,M[F]=yt+wr,M[F+1]=Ve-yr,le===0){M[G]=ze-wt,M[G+1]=Ke-ut;continue}if(le===ae)continue;const Hr=W+X-le,Qr=W+J-le;M[Hr]=yt-T*wr,M[Hr+1]=-Ve-T*yr,M[Qr]=ze-T*wt,M[Qr+1]=-Ke+T*ut}}const Z=S>>>1;for(let J=2;J<Z;J+=2)M[S-J]=M[J],M[S-J+1]=-M[J+1]}_singleRealTransform2(M,E,T,S,A){const j=M[S],U=M[S+A];E[T]=j+U,E[T+1]=0,E[T+2]=j-U,E[T+3]=0}_singleRealTransform4(M,E,T,S,A,j){const U=A*2,W=A*3,B=M[S],ee=M[S+A],Q=M[S+U],Z=M[S+W],J=B+Q,X=B-Q,ae=ee+Z,le=j*(ee-Z);E[T]=J+ae,E[T+1]=0,E[T+2]=X,E[T+3]=-le,E[T+4]=J-ae,E[T+5]=0,E[T+6]=X,E[T+7]=le}}class m{constructor(M){const E=2*(M-1),T=2*(2*M-1),S=2**Math.ceil(Math.log2(T));this.bufferSize=S,this._a=E;const A=new Float64Array(T),j=new Float64Array(S);this._chirpBuffer=new Float64Array(S),this._buffer1=new Float64Array(S),this._buffer2=new Float64Array(S),this._outBuffer1=new Float64Array(S),this._outBuffer2=new Float64Array(S);const U=-2*Math.PI/M,W=Math.cos(U),B=Math.sin(U);for(let ee=0;ee<T>>1;++ee){const Q=(ee+1-M)**2/2,Z=Math.sqrt(W**2+B**2)**Q,J=Q*Math.atan2(B,W),X=2*ee;A[X]=Z*Math.cos(J),A[X+1]=Z*Math.sin(J),j[X]=A[X],j[X+1]=-A[X+1]}this._slicedChirpBuffer=A.subarray(E,T),this._f=new p(S>>1),this._f.transform(this._chirpBuffer,j)}_transform(M,E,T){const S=this._buffer1,A=this._buffer2,j=this._outBuffer1,U=this._outBuffer2,W=this._chirpBuffer,B=this._slicedChirpBuffer,ee=this._a;if(T)for(let Q=0;Q<B.length;Q+=2){const Z=Q+1,J=Q>>1,X=E[J];S[Q]=X*B[Q],S[Z]=X*B[Z]}else for(let Q=0;Q<B.length;Q+=2){const Z=Q+1;S[Q]=E[Q]*B[Q]-E[Z]*B[Z],S[Z]=E[Q]*B[Z]+E[Z]*B[Q]}this._f.transform(j,S);for(let Q=0;Q<W.length;Q+=2){const Z=Q+1;A[Q]=j[Q]*W[Q]-j[Z]*W[Z],A[Z]=j[Q]*W[Z]+j[Z]*W[Q]}this._f.inverseTransform(U,A);for(let Q=0;Q<U.length;Q+=2){const Z=U[Q+ee],J=U[Q+ee+1],X=B[Q],ae=B[Q+1];M[Q]=Z*X-J*ae,M[Q+1]=Z*ae+J*X}}transform(M,E){this._transform(M,E,!1)}realTransform(M,E){this._transform(M,E,!0)}}class y{constructor(M){this.fft_length=M,this.isPowerOfTwo=u(M),this.isPowerOfTwo?(this.fft=new p(M),this.outputBufferSize=2*M):(this.fft=new m(M),this.outputBufferSize=this.fft.bufferSize)}realTransform(M,E){this.fft.realTransform(M,E)}transform(M,E){this.fft.transform(M,E)}}function P(w,M){if(M%2===0||M<=0)throw new Error("Window size must be a positive odd number");const E=new w.constructor(w.length),T=new w.constructor(M),S=Math.floor(M/2);for(let A=0;A<w.length;++A){let j=0;for(let U=-S;U<=S;++U){let W=A+U;W<0?W=Math.abs(W):W>=w.length&&(W=2*(w.length-1)-W),T[j++]=w[W]}T.sort(),E[A]=T[S]}return E}function g(w,M){const E=Math.pow(10,M);return Math.round(w*E)/E}function _(w){const M=Math.round(w);return Math.abs(w)%1===.5?M%2===0?M:M-1:M}function b(w){const M=w.length,E=w[0].length,T=[M+1,E+1],S=Array.from({length:T[0]},()=>Array(T[1]).fill(1/0));S[0][0]=0;const A=Array.from({length:T[0]},()=>Array(T[1]).fill(-1));for(let ee=1;ee<T[1];++ee)for(let Q=1;Q<T[0];++Q){const Z=S[Q-1][ee-1],J=S[Q-1][ee],X=S[Q][ee-1];let ae,le;Z<J&&Z<X?(ae=Z,le=0):J<Z&&J<X?(ae=J,le=1):(ae=X,le=2),S[Q][ee]=w[Q-1][ee-1]+ae,A[Q][ee]=le}for(let ee=0;ee<T[1];++ee)A[0][ee]=2;for(let ee=0;ee<T[0];++ee)A[ee][0]=1;let j=M,U=E,W=[],B=[];for(;j>0||U>0;)switch(W.push(j-1),B.push(U-1),A[j][U]){case 0:--j,--U;break;case 1:--j;break;case 2:--U;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${j}, ${U}]. Please file a bug report.`)}return W.reverse(),B.reverse(),[W,B]}},"./src/utils/tensor.js":(e,t,r)=>{r.r(t),r.d(t,{DataTypeMap:()=>a,Tensor:()=>o,cat:()=>E,full:()=>B,full_like:()=>ee,interpolate:()=>d,interpolate_4d:()=>h,layer_norm:()=>_,matmul:()=>u,mean:()=>j,mean_pooling:()=>g,ones:()=>Q,ones_like:()=>Z,permute:()=>c,quantize_embeddings:()=>ne,rand:()=>ae,randn:()=>le,rfft:()=>p,slice:()=>P,stack:()=>T,std_mean:()=>A,topk:()=>m,zeros:()=>J,zeros_like:()=>X});var n=r("./src/utils/maths.js"),s=r("./src/backends/onnx.js"),i=r("./src/ops/registry.js");const a=Object.freeze({float32:Float32Array,float16:typeof Float16Array<"u"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class o{constructor(...F){ie(this,"ort_tensor");return(0,s.isONNXTensor)(F[0])?this.ort_tensor=F[0]:this.ort_tensor=new s.Tensor(F[0],F[1],F[2]),new Proxy(this,{get:(G,oe)=>{if(typeof oe=="string"){let H=Number(oe);if(Number.isInteger(H))return G._getitem(H)}return G[oe]},set:(G,oe,H)=>G[oe]=H})}get dims(){return this.ort_tensor.dims}set dims(F){this.ort_tensor.dims=F}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){const[F,...G]=this.dims;if(G.length>0){const oe=G.reduce((H,Te)=>H*Te);for(let H=0;H<F;++H)yield this._subarray(H,oe,G)}else yield*this.data}_getitem(F){const[G,...oe]=this.dims;if(F=M(F,G),oe.length>0){const H=oe.reduce((Te,Ce)=>Te*Ce);return this._subarray(F,H,oe)}else return new o(this.type,[this.data[F]],oe)}indexOf(F){const G=this.data;for(let oe=0;oe<G.length;++oe)if(G[oe]==F)return oe;return-1}_subarray(F,G,oe){const H=F*G,Te=(F+1)*G,Ce="subarray"in this.data?this.data.subarray(H,Te):this.data.slice(H,Te);return new o(this.type,Ce,oe)}item(){const F=this.data;if(F.length!==1)throw new Error(`a Tensor with ${F.length} elements cannot be converted to Scalar`);return F[0]}tolist(){return l(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const F=this.data;for(let G=0;G<F.length;++G)F[G]=1/(1+Math.exp(-F[G]));return this}map(F){return this.clone().map_(F)}map_(F){const G=this.data;for(let oe=0;oe<G.length;++oe)G[oe]=F(G[oe],oe,G);return this}mul(F){return this.clone().mul_(F)}mul_(F){const G=this.data;for(let oe=0;oe<G.length;++oe)G[oe]*=F;return this}div(F){return this.clone().div_(F)}div_(F){const G=this.data;for(let oe=0;oe<G.length;++oe)G[oe]/=F;return this}add(F){return this.clone().add_(F)}add_(F){const G=this.data;for(let oe=0;oe<G.length;++oe)G[oe]+=F;return this}sub(F){return this.clone().sub_(F)}sub_(F){const G=this.data;for(let oe=0;oe<G.length;++oe)G[oe]-=F;return this}clone(){return new o(this.type,this.data.slice(),this.dims.slice())}slice(...F){const G=[],oe=[];for(let O=0;O<this.dims.length;++O){let ue=F[O];if(ue==null)oe.push([0,this.dims[O]]),G.push(this.dims[O]);else if(typeof ue=="number")ue=M(ue,this.dims[O],O),oe.push([ue,ue+1]);else if(Array.isArray(ue)&&ue.length===2){let[Ee,fe]=ue;if(Ee=Ee===null?0:M(Ee,this.dims[O],O,!1),fe=fe===null?this.dims[O]:M(fe,this.dims[O],O,!1),Ee>fe)throw new Error(`Invalid slice: ${ue}`);const me=[Math.max(Ee,0),Math.min(fe,this.dims[O])];oe.push(me),G.push(me[1]-me[0])}else throw new Error(`Invalid slice: ${ue}`)}const H=oe.map(([O,ue])=>ue-O),Te=H.reduce((O,ue)=>O*ue),Ce=this.data,Be=new Ce.constructor(Te),$e=this.stride();let te=!0;for(let O=1;O<H.length;++O)if(oe[O][0]!==0||oe[O][1]!==this.dims[O]){te=!1;break}if(te){const O=oe[0][0]*$e[0],ue=oe[0][1]*$e[0];if(ArrayBuffer.isView(Ce))Be.set(Ce.subarray(O,ue));else if(Array.isArray(Ce)){const Ee=Ce.slice(O,ue);for(let fe=0;fe<Ee.length;++fe)Be[fe]=Ee[fe]}else throw new Error("Unsupported data type for slicing")}else for(let O=0;O<Te;++O){let ue=0;for(let Ee=H.length-1,fe=O;Ee>=0;--Ee){const me=H[Ee];ue+=(fe%me+oe[Ee][0])*$e[Ee],fe=Math.floor(fe/me)}Be[O]=Ce[ue]}return new o(this.type,Be,G)}permute(...F){return c(this,F)}transpose(...F){return this.permute(...F)}sum(F=null,G=!1){return this.norm(1,F,G)}norm(F="fro",G=null,oe=!1){if(F==="fro")F=2;else if(typeof F=="string")throw Error(`Unsupported norm: ${F}`);const H=this.data,Te=(te,O)=>te+O**F;if(G===null){const te=H.reduce(Te,0)**(1/F);return new o(this.type,[te],[])}const[Ce,Be,$e]=S(Te,this,G,oe);if(F!==1)for(let te=0;te<Be.length;++te)Be[te]=Be[te]**(1/F);return new o(Ce,Be,$e)}normalize_(F=2,G=1){G=M(G,this.dims.length);const oe=this.norm(F,G,!0),H=this.data,Te=oe.data;for(let Ce=0;Ce<H.length;++Ce){let Be=0;for(let $e=this.dims.length-1,te=Ce,O=1;$e>=0;--$e){const ue=this.dims[$e];if($e!==G){const Ee=te%ue;Be+=Ee*O,O*=this.dims[$e]}te=Math.floor(te/ue)}H[Ce]/=Te[Be]}return this}normalize(F=2,G=1){return this.clone().normalize_(F,G)}stride(){return U(this.dims)}squeeze(F=null){return new o(this.type,this.data,b(this.dims,F))}squeeze_(F=null){return this.dims=b(this.dims,F),this}unsqueeze(F=null){return new o(this.type,this.data,w(this.dims,F))}unsqueeze_(F=null){return this.dims=w(this.dims,F),this}flatten_(F=0,G=-1){G=(G+this.dims.length)%this.dims.length;let oe=this.dims.slice(0,F),H=this.dims.slice(F,G+1),Te=this.dims.slice(G+1);return this.dims=[...oe,H.reduce((Ce,Be)=>Ce*Be,1),...Te],this}flatten(F=0,G=-1){return this.clone().flatten_(F,G)}view(...F){let G=-1;for(let H=0;H<F.length;++H)if(F[H]===-1){if(G!==-1)throw new Error("Only one dimension can be inferred");G=H}const oe=this.data;if(G!==-1){const H=F.reduce((Te,Ce,Be)=>Be!==G?Te*Ce:Te,1);F[G]=oe.length/H}return new o(this.type,oe,F)}neg_(){const F=this.data;for(let G=0;G<F.length;++G)F[G]=-F[G];return this}neg(){return this.clone().neg_()}gt(F){const G=new Uint8Array(this.data.length),oe=this.data;for(let H=0;H<oe.length;++H)G[H]=oe[H]>F?1:0;return new o("bool",G,this.dims)}lt(F){const G=new Uint8Array(this.data.length),oe=this.data;for(let H=0;H<oe.length;++H)G[H]=oe[H]<F?1:0;return new o("bool",G,this.dims)}clamp_(F,G){const oe=this.data;for(let H=0;H<oe.length;++H)oe[H]=Math.min(Math.max(oe[H],F),G);return this}clamp(F,G){return this.clone().clamp_(F,G)}round_(){const F=this.data;for(let G=0;G<F.length;++G)F[G]=Math.round(F[G]);return this}round(){return this.clone().round_()}mean(F=null,G=!1){return j(this,F,G)}min(F=null,G=!1){if(F===null){const Ce=(0,n.min)(this.data)[0];return new o(this.type,[Ce],[])}const[oe,H,Te]=S((Ce,Be)=>Math.min(Ce,Be),this,F,G,1/0);return new o(oe,H,Te)}max(F=null,G=!1){if(F===null){const Ce=(0,n.max)(this.data)[0];return new o(this.type,[Ce],[])}const[oe,H,Te]=S((Ce,Be)=>Math.max(Ce,Be),this,F,G,-1/0);return new o(oe,H,Te)}argmin(F=null,G=!1){if(F!==null)throw new Error("`dim !== null` not yet implemented.");const oe=(0,n.min)(this.data)[1];return new o("int64",[BigInt(oe)],[])}argmax(F=null,G=!1){if(F!==null)throw new Error("`dim !== null` not yet implemented.");const oe=(0,n.max)(this.data)[1];return new o("int64",[BigInt(oe)],[])}to(F){if(this.type===F)return this;if(!a.hasOwnProperty(F))throw new Error(`Unsupported type: ${F}`);let G;const oe=["int64","uint64"].includes(this.type),H=["int64","uint64"].includes(F);return oe&&!H?G=Number:!oe&&H&&(["float16","float32","float64"].includes(this.type)?G=Te=>BigInt(Math.floor(Te)):G=BigInt),new o(F,a[F].from(this.data,G),this.dims)}}function l(L,F){const G=L.length,oe=F.reduce((Te,Ce)=>Te*Ce);if(G!==oe)throw Error(`cannot reshape array of size ${G} into shape (${F})`);let H=L;for(let Te=F.length-1;Te>=0;Te--)H=H.reduce((Ce,Be)=>{let $e=Ce[Ce.length-1];return $e.length<F[Te]?$e.push(Be):Ce.push([Be]),Ce},[[]]);return H[0]}function c(L,F){const[G,oe]=(0,n.permute_data)(L.data,L.dims,F);return new o(L.type,G,oe)}function d(L,[F,G],oe="bilinear",H=!1){const Te=L.dims.at(-3)??1,Ce=L.dims.at(-2),Be=L.dims.at(-1);let $e=(0,n.interpolate_data)(L.data,[Te,Ce,Be],[F,G],oe,H);return new o(L.type,$e,[Te,F,G])}async function h(L,{size:F=null,mode:G="bilinear"}={}){if(L.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!F)throw new Error("`interpolate_4d` requires a `size` argument.");let oe;if(F.length===2)oe=[...L.dims.slice(0,2),...F];else if(F.length===3)oe=[L.dims[0],...F];else if(F.length===4)oe=F;else throw new Error("`size` must be of length 2, 3, or 4.");let H;if(G==="nearest")H=await i.TensorOpRegistry.nearest_interpolate_4d;else if(G==="bilinear")H=await i.TensorOpRegistry.bilinear_interpolate_4d;else if(G==="bicubic")H=await i.TensorOpRegistry.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${G}`);const Te=new o("int64",new BigInt64Array(oe.map(BigInt)),[oe.length]);return await H({x:L,s:Te})}async function u(L,F){return await(await i.TensorOpRegistry.matmul)({a:L,b:F})}async function p(L,F){return await(await i.TensorOpRegistry.rfft)({x:L,a:F})}async function m(L,F){const G=await i.TensorOpRegistry.top_k;return F==null?F=L.dims.at(-1):F=Math.min(F,L.dims.at(-1)),await G({x:L,k:new o("int64",[BigInt(F)],[1])})}const y=L=>new o("int64",L,[L.length]);async function P(L,F,G,oe,H){return await(await i.TensorOpRegistry.slice)({x:L,s:y(F),e:y(G),a:y(oe),t:y(H??new Array(oe.length).fill(1))})}function g(L,F){const G=L.data,oe=F.data,H=[L.dims[0],L.dims[2]],Te=new G.constructor(H[0]*H[1]),[Ce,Be,$e]=L.dims;let te=0;for(let O=0;O<Ce;++O){const ue=O*$e*Be;for(let Ee=0;Ee<$e;++Ee){let fe=0,me=0;const ve=O*Be,xe=ue+Ee;for(let je=0;je<Be;++je){const we=Number(oe[ve+je]);me+=we,fe+=G[xe+je*$e]*we}const _e=fe/me;Te[te++]=_e}}return new o(L.type,Te,H)}function _(L,F,{eps:G=1e-5}={}){if(L.dims.length!==2)throw new Error("`layer_norm` currently only supports 2D input.");const[oe,H]=L.dims;if(F.length!==1&&F[0]!==H)throw new Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");const[Te,Ce]=A(L,1,0,!0),Be=Te.data,$e=Ce.data,te=L.data,O=new te.constructor(te.length);for(let ue=0;ue<oe;++ue){const Ee=ue*H;for(let fe=0;fe<H;++fe){const me=Ee+fe;O[me]=(te[me]-$e[ue])/(Be[ue]+G)}}return new o(L.type,O,L.dims)}function b(L,F){return L=L.slice(),F===null?L=L.filter(G=>G!==1):typeof F=="number"?L[F]===1&&L.splice(F,1):Array.isArray(F)&&(L=L.filter((G,oe)=>G!==1||!F.includes(oe))),L}function w(L,F){return F=M(F,L.length+1),L=L.slice(),L.splice(F,0,1),L}function M(L,F,G=null,oe=!0){if(L<-F||L>=F){if(oe)throw new Error(`IndexError: index ${L} is out of bounds for dimension${G===null?"":" "+G} with size ${F}`);return L<-F?0:F}return L<0&&(L=(L%F+F)%F),L}function E(L,F=0){F=M(F,L[0].dims.length);const G=L[0].dims.slice();G[F]=L.reduce((Ce,Be)=>Ce+Be.dims[F],0);const oe=G.reduce((Ce,Be)=>Ce*Be,1),H=new L[0].data.constructor(oe),Te=L[0].type;if(F===0){let Ce=0;for(const Be of L){const $e=Be.data;H.set($e,Ce),Ce+=$e.length}}else{let Ce=0;for(let Be=0;Be<L.length;++Be){const{data:$e,dims:te}=L[Be];for(let O=0;O<$e.length;++O){let ue=0;for(let Ee=te.length-1,fe=O,me=1;Ee>=0;--Ee){const ve=te[Ee];let xe=fe%ve;Ee===F&&(xe+=Ce),ue+=xe*me,me*=G[Ee],fe=Math.floor(fe/ve)}H[ue]=$e[O]}Ce+=te[F]}}return new o(Te,H,G)}function T(L,F=0){return E(L.map(G=>G.unsqueeze(F)),F)}function S(L,F,G=null,oe=!1,H=null){const Te=F.data,Ce=F.dims;G=M(G,Ce.length);const Be=Ce.slice();Be[G]=1;const $e=new Te.constructor(Te.length/Ce[G]);H!==null&&$e.fill(H);for(let te=0;te<Te.length;++te){let O=0;for(let ue=Ce.length-1,Ee=te,fe=1;ue>=0;--ue){const me=Ce[ue];if(ue!==G){const ve=Ee%me;O+=ve*fe,fe*=Be[ue]}Ee=Math.floor(Ee/me)}$e[O]=L($e[O],Te[te],te,O)}return oe||Be.splice(G,1),[F.type,$e,Be]}function A(L,F=null,G=1,oe=!1){const H=L.data,Te=L.dims;if(F===null){const fe=H.reduce((_e,je)=>_e+je,0)/H.length,me=Math.sqrt(H.reduce((_e,je)=>_e+(je-fe)**2,0)/(H.length-G)),ve=new o(L.type,[fe],[]);return[new o(L.type,[me],[]),ve]}F=M(F,Te.length);const Ce=j(L,F,oe),Be=Ce.data,[$e,te,O]=S((Ee,fe,me,ve)=>Ee+(fe-Be[ve])**2,L,F,oe);for(let Ee=0;Ee<te.length;++Ee)te[Ee]=Math.sqrt(te[Ee]/(Te[F]-G));return[new o($e,te,O),Ce]}function j(L,F=null,G=!1){const oe=L.dims,H=L.data;if(F===null){const $e=H.reduce((te,O)=>te+O,0);return new o(L.type,[$e/H.length],[])}F=M(F,oe.length);const[Te,Ce,Be]=S(($e,te)=>$e+te,L,F,G);if(oe[F]!==1)for(let $e=0;$e<Ce.length;++$e)Ce[$e]/=oe[F];return new o(Te,Ce,Be)}function U(L){const F=new Array(L.length);for(let G=L.length-1,oe=1;G>=0;--G)F[G]=oe,oe*=L[G];return F}function W(L,F,G,oe){const H=L.reduce((Te,Ce)=>Te*Ce,1);return new o(G,new oe(H).fill(F),L)}function B(L,F){let G,oe;if(typeof F=="number")G="float32",oe=Float32Array;else if(typeof F=="bigint")G="int64",oe=BigInt64Array;else if(typeof F=="boolean")G="bool",oe=Uint8Array;else throw new Error(`Unsupported data type: ${typeof F}`);return W(L,F,G,oe)}function ee(L,F){return B(L.dims,F)}function Q(L){return W(L,1n,"int64",BigInt64Array)}function Z(L){return Q(L.dims)}function J(L){return W(L,0n,"int64",BigInt64Array)}function X(L){return J(L.dims)}function ae(L){const F=L.reduce((G,oe)=>G*oe,1);return new o("float32",Float32Array.from({length:F},()=>Math.random()),L)}function le(L){const F=L.reduce((oe,H)=>oe*H,1);function G(){const oe=1-Math.random(),H=1-Math.random();return Math.sqrt(-2*Math.log(oe))*Math.cos(2*Math.PI*H)}return new o("float32",Float32Array.from({length:F},()=>G()),L)}function ne(L,F){if(L.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(L.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(F))throw new Error("The precision must be either 'binary' or 'ubinary'");const G=F==="binary",oe=G?"int8":"uint8",H=G?Int8Array:Uint8Array,Te=L.data,Ce=new H(Te.length/8);for(let Be=0;Be<Te.length;++Be){const $e=Te[Be]>0?1:0,te=Math.floor(Be/8),O=Be%8;Ce[te]|=$e<<7-O,G&&O===0&&(Ce[te]-=128)}return new o(oe,Ce,[L.dims[0],L.dims[1]/8])}},"./src/utils/video.js":(e,t,r)=>{r.r(t),r.d(t,{RawVideo:()=>a,RawVideoFrame:()=>i,load_video:()=>o});var n=r("./src/utils/image.js"),s=r("./src/env.js");class i{constructor(c,d){this.image=c,this.timestamp=d}}class a{constructor(c,d){c.length>0&&c[0]instanceof n.RawImage&&(c=c.map((h,u)=>new i(h,(u+1)/(c.length+1)*d))),this.frames=c,this.duration=d}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function o(l,{num_frames:c=null,fps:d=null}={}){if(!s.apis.IS_BROWSER_ENV)throw new Error("`load_video` is currently only supported in browser environments.");if(c==null&&d==null)throw new Error("Either num_frames or fps must be provided.");const h=[],u=document.createElement("video");if(u.crossOrigin="anonymous",u.muted=!0,typeof l=="string")u.src=l;else if(l instanceof Blob)u.src=URL.createObjectURL(l);else if(l instanceof HTMLVideoElement)u.src=l.src;else throw new Error("Invalid URL or video element provided.");if(await new Promise(b=>u.onloadedmetadata=b),u.seekable.start(0)===u.seekable.end(0)){const w=await(await fetch(u.src)).blob();u.src=URL.createObjectURL(w),await new Promise(M=>u.onloadedmetadata=M)}const p=u.duration;let m,y;c!=null?(m=c,y=c===1?0:p/(c-1)):(y=1/d,m=Math.floor(p/y));let P=[];for(let b=0;b<m;++b)P.push(c===1?p/2:b*y);const g=document.createElement("canvas");g.width=u.videoWidth,g.height=u.videoHeight;const _=g.getContext("2d",{willReadFrequently:!0});for(const b of P){u.currentTime=b,await new Promise(T=>{u.onseeked=T}),_.drawImage(u,0,0,g.width,g.height);const w=_.getImageData(0,0,g.width,g.height),M=new n.RawImage(w.data,g.width,g.height,4),E=new i(M,b);h.push(E)}return u.remove(),new a(h,p)}}},wC={};function tr(e){var t=wC[e];if(t!==void 0)return t.exports;var r=wC[e]={exports:{}};return S8[e](r,r.exports,tr),r.exports}(()=>{var e=Object.getPrototypeOf?r=>Object.getPrototypeOf(r):r=>r.__proto__,t;tr.t=function(r,n){if(n&1&&(r=this(r)),n&8||typeof r=="object"&&r&&(n&4&&r.__esModule||n&16&&typeof r.then=="function"))return r;var s=Object.create(null);tr.r(s);var i={};t=t||[null,e({}),e([]),e(e)];for(var a=n&2&&r;typeof a=="object"&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach(o=>i[o]=()=>r[o]);return i.default=()=>r,tr.d(s,i),s}})();tr.d=(e,t)=>{for(var r in t)tr.o(t,r)&&!tr.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})};tr.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);tr.r=e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var x={};(()=>{/*!*****************************!*\
  !*** ./src/transformers.js ***!
  \*****************************/tr.r(x),tr.d(x,{ASTFeatureExtractor:()=>h.ASTFeatureExtractor,ASTForAudioClassification:()=>r.ASTForAudioClassification,ASTModel:()=>r.ASTModel,ASTPreTrainedModel:()=>r.ASTPreTrainedModel,AlbertForMaskedLM:()=>r.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>r.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>r.AlbertForSequenceClassification,AlbertModel:()=>r.AlbertModel,AlbertPreTrainedModel:()=>r.AlbertPreTrainedModel,AlbertTokenizer:()=>n.AlbertTokenizer,ArceeForCausalLM:()=>r.ArceeForCausalLM,ArceeModel:()=>r.ArceeModel,ArceePreTrainedModel:()=>r.ArceePreTrainedModel,AudioClassificationPipeline:()=>t.AudioClassificationPipeline,AutoConfig:()=>s.AutoConfig,AutoFeatureExtractor:()=>u.AutoFeatureExtractor,AutoImageProcessor:()=>y.AutoImageProcessor,AutoModel:()=>r.AutoModel,AutoModelForAudioClassification:()=>r.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>r.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>r.AutoModelForAudioTextToText,AutoModelForCTC:()=>r.AutoModelForCTC,AutoModelForCausalLM:()=>r.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>r.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>r.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>r.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>r.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>r.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>r.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>r.AutoModelForImageTextToText,AutoModelForImageToImage:()=>r.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>r.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>r.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>r.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>r.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>r.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>r.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>r.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>r.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>r.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>r.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>r.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>r.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>r.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>r.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>r.AutoModelForVision2Seq,AutoModelForXVector:()=>r.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>r.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>_.AutoProcessor,AutoTokenizer:()=>n.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>t.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>t.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>r.BartForConditionalGeneration,BartForSequenceClassification:()=>r.BartForSequenceClassification,BartModel:()=>r.BartModel,BartPretrainedModel:()=>r.BartPretrainedModel,BartTokenizer:()=>n.BartTokenizer,BaseModelOutput:()=>r.BaseModelOutput,BaseStreamer:()=>b.BaseStreamer,BeitFeatureExtractor:()=>m.BeitFeatureExtractor,BeitForImageClassification:()=>r.BeitForImageClassification,BeitModel:()=>r.BeitModel,BeitPreTrainedModel:()=>r.BeitPreTrainedModel,BertForMaskedLM:()=>r.BertForMaskedLM,BertForQuestionAnswering:()=>r.BertForQuestionAnswering,BertForSequenceClassification:()=>r.BertForSequenceClassification,BertForTokenClassification:()=>r.BertForTokenClassification,BertModel:()=>r.BertModel,BertPreTrainedModel:()=>r.BertPreTrainedModel,BertTokenizer:()=>n.BertTokenizer,BitImageProcessor:()=>m.BitImageProcessor,BlenderbotForConditionalGeneration:()=>r.BlenderbotForConditionalGeneration,BlenderbotModel:()=>r.BlenderbotModel,BlenderbotPreTrainedModel:()=>r.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>r.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>r.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>r.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>n.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>n.BlenderbotTokenizer,BloomForCausalLM:()=>r.BloomForCausalLM,BloomModel:()=>r.BloomModel,BloomPreTrainedModel:()=>r.BloomPreTrainedModel,BloomTokenizer:()=>n.BloomTokenizer,CLIPFeatureExtractor:()=>m.CLIPFeatureExtractor,CLIPImageProcessor:()=>m.CLIPImageProcessor,CLIPModel:()=>r.CLIPModel,CLIPPreTrainedModel:()=>r.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>r.CLIPSegForImageSegmentation,CLIPSegModel:()=>r.CLIPSegModel,CLIPSegPreTrainedModel:()=>r.CLIPSegPreTrainedModel,CLIPTextModel:()=>r.CLIPTextModel,CLIPTextModelWithProjection:()=>r.CLIPTextModelWithProjection,CLIPTokenizer:()=>n.CLIPTokenizer,CLIPVisionModel:()=>r.CLIPVisionModel,CLIPVisionModelWithProjection:()=>r.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>r.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>r.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>r.CamembertForSequenceClassification,CamembertForTokenClassification:()=>r.CamembertForTokenClassification,CamembertModel:()=>r.CamembertModel,CamembertPreTrainedModel:()=>r.CamembertPreTrainedModel,CamembertTokenizer:()=>n.CamembertTokenizer,CausalLMOutput:()=>r.CausalLMOutput,CausalLMOutputWithPast:()=>r.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>m.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>r.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>r.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>r.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>h.ClapFeatureExtractor,ClapModel:()=>r.ClapModel,ClapPreTrainedModel:()=>r.ClapPreTrainedModel,ClapTextModelWithProjection:()=>r.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>M.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>r.CodeGenForCausalLM,CodeGenModel:()=>r.CodeGenModel,CodeGenPreTrainedModel:()=>r.CodeGenPreTrainedModel,CodeGenTokenizer:()=>n.CodeGenTokenizer,CodeLlamaTokenizer:()=>n.CodeLlamaTokenizer,CohereForCausalLM:()=>r.CohereForCausalLM,CohereModel:()=>r.CohereModel,CoherePreTrainedModel:()=>r.CoherePreTrainedModel,CohereTokenizer:()=>n.CohereTokenizer,ConvBertForMaskedLM:()=>r.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>r.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>r.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>r.ConvBertForTokenClassification,ConvBertModel:()=>r.ConvBertModel,ConvBertPreTrainedModel:()=>r.ConvBertPreTrainedModel,ConvBertTokenizer:()=>n.ConvBertTokenizer,ConvNextFeatureExtractor:()=>m.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>r.ConvNextForImageClassification,ConvNextImageProcessor:()=>m.ConvNextImageProcessor,ConvNextModel:()=>r.ConvNextModel,ConvNextPreTrainedModel:()=>r.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>r.ConvNextV2ForImageClassification,ConvNextV2Model:()=>r.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>r.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>r.DFineForObjectDetection,DFineModel:()=>r.DFineModel,DFinePreTrainedModel:()=>r.DFinePreTrainedModel,DINOv3ConvNextModel:()=>r.DINOv3ConvNextModel,DINOv3ConvNextPreTrainedModel:()=>r.DINOv3ConvNextPreTrainedModel,DINOv3ViTImageProcessor:()=>m.DINOv3ViTImageProcessor,DINOv3ViTModel:()=>r.DINOv3ViTModel,DINOv3ViTPreTrainedModel:()=>r.DINOv3ViTPreTrainedModel,DPTFeatureExtractor:()=>m.DPTFeatureExtractor,DPTForDepthEstimation:()=>r.DPTForDepthEstimation,DPTImageProcessor:()=>m.DPTImageProcessor,DPTModel:()=>r.DPTModel,DPTPreTrainedModel:()=>r.DPTPreTrainedModel,DacDecoderModel:()=>r.DacDecoderModel,DacDecoderOutput:()=>r.DacDecoderOutput,DacEncoderModel:()=>r.DacEncoderModel,DacEncoderOutput:()=>r.DacEncoderOutput,DacFeatureExtractor:()=>h.DacFeatureExtractor,DacModel:()=>r.DacModel,DacPreTrainedModel:()=>r.DacPreTrainedModel,DataTypeMap:()=>l.DataTypeMap,DebertaForMaskedLM:()=>r.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>r.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>r.DebertaForSequenceClassification,DebertaForTokenClassification:()=>r.DebertaForTokenClassification,DebertaModel:()=>r.DebertaModel,DebertaPreTrainedModel:()=>r.DebertaPreTrainedModel,DebertaTokenizer:()=>n.DebertaTokenizer,DebertaV2ForMaskedLM:()=>r.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>r.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>r.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>r.DebertaV2ForTokenClassification,DebertaV2Model:()=>r.DebertaV2Model,DebertaV2PreTrainedModel:()=>r.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>n.DebertaV2Tokenizer,DecisionTransformerModel:()=>r.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>r.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>m.DeiTFeatureExtractor,DeiTForImageClassification:()=>r.DeiTForImageClassification,DeiTImageProcessor:()=>m.DeiTImageProcessor,DeiTModel:()=>r.DeiTModel,DeiTPreTrainedModel:()=>r.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>r.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>r.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>t.DepthEstimationPipeline,DepthProForDepthEstimation:()=>r.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>r.DepthProPreTrainedModel,DetrFeatureExtractor:()=>m.DetrFeatureExtractor,DetrForObjectDetection:()=>r.DetrForObjectDetection,DetrForSegmentation:()=>r.DetrForSegmentation,DetrImageProcessor:()=>m.DetrImageProcessor,DetrModel:()=>r.DetrModel,DetrObjectDetectionOutput:()=>r.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>r.DetrPreTrainedModel,DetrSegmentationOutput:()=>r.DetrSegmentationOutput,Dinov2ForImageClassification:()=>r.Dinov2ForImageClassification,Dinov2Model:()=>r.Dinov2Model,Dinov2PreTrainedModel:()=>r.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>r.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>r.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>r.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>r.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>r.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>r.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>r.DistilBertForTokenClassification,DistilBertModel:()=>r.DistilBertModel,DistilBertPreTrainedModel:()=>r.DistilBertPreTrainedModel,DistilBertTokenizer:()=>n.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>t.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>m.DonutFeatureExtractor,DonutImageProcessor:()=>m.DonutImageProcessor,DonutSwinModel:()=>r.DonutSwinModel,DonutSwinPreTrainedModel:()=>r.DonutSwinPreTrainedModel,EdgeTamModel:()=>r.EdgeTamModel,EfficientNetForImageClassification:()=>r.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>m.EfficientNetImageProcessor,EfficientNetModel:()=>r.EfficientNetModel,EfficientNetPreTrainedModel:()=>r.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>r.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>r.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>r.ElectraForSequenceClassification,ElectraForTokenClassification:()=>r.ElectraForTokenClassification,ElectraModel:()=>r.ElectraModel,ElectraPreTrainedModel:()=>r.ElectraPreTrainedModel,ElectraTokenizer:()=>n.ElectraTokenizer,EncodecFeatureExtractor:()=>h.EncodecFeatureExtractor,EosTokenCriteria:()=>w.EosTokenCriteria,Ernie4_5_ForCausalLM:()=>r.Ernie4_5_ForCausalLM,Ernie4_5_Model:()=>r.Ernie4_5_Model,Ernie4_5_PretrainedModel:()=>r.Ernie4_5_PretrainedModel,Ernie4_5_Tokenizer:()=>n.Ernie4_5_Tokenizer,EsmForMaskedLM:()=>r.EsmForMaskedLM,EsmForSequenceClassification:()=>r.EsmForSequenceClassification,EsmForTokenClassification:()=>r.EsmForTokenClassification,EsmModel:()=>r.EsmModel,EsmPreTrainedModel:()=>r.EsmPreTrainedModel,EsmTokenizer:()=>n.EsmTokenizer,ExaoneForCausalLM:()=>r.ExaoneForCausalLM,ExaoneModel:()=>r.ExaoneModel,ExaonePreTrainedModel:()=>r.ExaonePreTrainedModel,FFT:()=>c.FFT,FalconForCausalLM:()=>r.FalconForCausalLM,FalconModel:()=>r.FalconModel,FalconPreTrainedModel:()=>r.FalconPreTrainedModel,FalconTokenizer:()=>n.FalconTokenizer,FastViTForImageClassification:()=>r.FastViTForImageClassification,FastViTModel:()=>r.FastViTModel,FastViTPreTrainedModel:()=>r.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>t.FeatureExtractionPipeline,FeatureExtractor:()=>d.FeatureExtractor,FillMaskPipeline:()=>t.FillMaskPipeline,Florence2ForConditionalGeneration:()=>r.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>r.Florence2PreTrainedModel,Florence2Processor:()=>g.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>M.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>M.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>m.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>r.GLPNForDepthEstimation,GLPNModel:()=>r.GLPNModel,GLPNPreTrainedModel:()=>r.GLPNPreTrainedModel,GPT2LMHeadModel:()=>r.GPT2LMHeadModel,GPT2Model:()=>r.GPT2Model,GPT2PreTrainedModel:()=>r.GPT2PreTrainedModel,GPT2Tokenizer:()=>n.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>r.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>r.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>r.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>r.GPTJForCausalLM,GPTJModel:()=>r.GPTJModel,GPTJPreTrainedModel:()=>r.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>r.GPTNeoForCausalLM,GPTNeoModel:()=>r.GPTNeoModel,GPTNeoPreTrainedModel:()=>r.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>r.GPTNeoXForCausalLM,GPTNeoXModel:()=>r.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>r.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>n.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>r.Gemma2ForCausalLM,Gemma2Model:()=>r.Gemma2Model,Gemma2PreTrainedModel:()=>r.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>r.Gemma3ForCausalLM,Gemma3Model:()=>r.Gemma3Model,Gemma3PreTrainedModel:()=>r.Gemma3PreTrainedModel,Gemma3nAudioFeatureExtractor:()=>h.Gemma3nAudioFeatureExtractor,Gemma3nForConditionalGeneration:()=>r.Gemma3nForConditionalGeneration,Gemma3nPreTrainedModel:()=>r.Gemma3nPreTrainedModel,Gemma3nProcessor:()=>g.Gemma3nProcessor,GemmaForCausalLM:()=>r.GemmaForCausalLM,GemmaModel:()=>r.GemmaModel,GemmaPreTrainedModel:()=>r.GemmaPreTrainedModel,GemmaTokenizer:()=>n.GemmaTokenizer,GlmForCausalLM:()=>r.GlmForCausalLM,GlmModel:()=>r.GlmModel,GlmPreTrainedModel:()=>r.GlmPreTrainedModel,GraniteForCausalLM:()=>r.GraniteForCausalLM,GraniteModel:()=>r.GraniteModel,GraniteMoeHybridForCausalLM:()=>r.GraniteMoeHybridForCausalLM,GraniteMoeHybridModel:()=>r.GraniteMoeHybridModel,GraniteMoeHybridPreTrainedModel:()=>r.GraniteMoeHybridPreTrainedModel,GranitePreTrainedModel:()=>r.GranitePreTrainedModel,Grok1Tokenizer:()=>n.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>r.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>m.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>r.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>g.GroundingDinoProcessor,GroupViTModel:()=>r.GroupViTModel,GroupViTPreTrainedModel:()=>r.GroupViTPreTrainedModel,HeliumForCausalLM:()=>r.HeliumForCausalLM,HeliumModel:()=>r.HeliumModel,HeliumPreTrainedModel:()=>r.HeliumPreTrainedModel,HerbertTokenizer:()=>n.HerbertTokenizer,HieraForImageClassification:()=>r.HieraForImageClassification,HieraModel:()=>r.HieraModel,HieraPreTrainedModel:()=>r.HieraPreTrainedModel,HubertForCTC:()=>r.HubertForCTC,HubertForSequenceClassification:()=>r.HubertForSequenceClassification,HubertModel:()=>r.HubertModel,HubertPreTrainedModel:()=>r.HubertPreTrainedModel,IJepaForImageClassification:()=>r.IJepaForImageClassification,IJepaModel:()=>r.IJepaModel,IJepaPreTrainedModel:()=>r.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>r.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>m.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>r.Idefics3PreTrainedModel,Idefics3Processor:()=>g.Idefics3Processor,ImageClassificationPipeline:()=>t.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>t.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>h.ImageFeatureExtractor,ImageMattingOutput:()=>r.ImageMattingOutput,ImageProcessor:()=>p.ImageProcessor,ImageSegmentationPipeline:()=>t.ImageSegmentationPipeline,ImageToImagePipeline:()=>t.ImageToImagePipeline,ImageToTextPipeline:()=>t.ImageToTextPipeline,InterruptableStoppingCriteria:()=>w.InterruptableStoppingCriteria,JAISLMHeadModel:()=>r.JAISLMHeadModel,JAISModel:()=>r.JAISModel,JAISPreTrainedModel:()=>r.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>m.JinaCLIPImageProcessor,JinaCLIPModel:()=>r.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>r.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>g.JinaCLIPProcessor,JinaCLIPTextModel:()=>r.JinaCLIPTextModel,JinaCLIPVisionModel:()=>r.JinaCLIPVisionModel,Lfm2ForCausalLM:()=>r.Lfm2ForCausalLM,Lfm2Model:()=>r.Lfm2Model,Lfm2PreTrainedModel:()=>r.Lfm2PreTrainedModel,LiteWhisperForConditionalGeneration:()=>r.LiteWhisperForConditionalGeneration,Llama4ForCausalLM:()=>r.Llama4ForCausalLM,Llama4PreTrainedModel:()=>r.Llama4PreTrainedModel,LlamaForCausalLM:()=>r.LlamaForCausalLM,LlamaModel:()=>r.LlamaModel,LlamaPreTrainedModel:()=>r.LlamaPreTrainedModel,LlamaTokenizer:()=>n.LlamaTokenizer,LlavaForConditionalGeneration:()=>r.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>r.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>m.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>r.LlavaPreTrainedModel,LlavaProcessor:()=>g.LlavaProcessor,LlavaQwen2ForCausalLM:()=>r.LlavaQwen2ForCausalLM,LogitsProcessor:()=>M.LogitsProcessor,LogitsProcessorList:()=>M.LogitsProcessorList,LogitsWarper:()=>M.LogitsWarper,LongT5ForConditionalGeneration:()=>r.LongT5ForConditionalGeneration,LongT5Model:()=>r.LongT5Model,LongT5PreTrainedModel:()=>r.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>r.M2M100ForConditionalGeneration,M2M100Model:()=>r.M2M100Model,M2M100PreTrainedModel:()=>r.M2M100PreTrainedModel,M2M100Tokenizer:()=>n.M2M100Tokenizer,MBart50Tokenizer:()=>n.MBart50Tokenizer,MBartForCausalLM:()=>r.MBartForCausalLM,MBartForConditionalGeneration:()=>r.MBartForConditionalGeneration,MBartForSequenceClassification:()=>r.MBartForSequenceClassification,MBartModel:()=>r.MBartModel,MBartPreTrainedModel:()=>r.MBartPreTrainedModel,MBartTokenizer:()=>n.MBartTokenizer,MPNetForMaskedLM:()=>r.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>r.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>r.MPNetForSequenceClassification,MPNetForTokenClassification:()=>r.MPNetForTokenClassification,MPNetModel:()=>r.MPNetModel,MPNetPreTrainedModel:()=>r.MPNetPreTrainedModel,MPNetTokenizer:()=>n.MPNetTokenizer,MT5ForConditionalGeneration:()=>r.MT5ForConditionalGeneration,MT5Model:()=>r.MT5Model,MT5PreTrainedModel:()=>r.MT5PreTrainedModel,MarianMTModel:()=>r.MarianMTModel,MarianModel:()=>r.MarianModel,MarianPreTrainedModel:()=>r.MarianPreTrainedModel,MarianTokenizer:()=>n.MarianTokenizer,Mask2FormerImageProcessor:()=>m.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>m.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>r.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>m.MaskFormerImageProcessor,MaskFormerModel:()=>r.MaskFormerModel,MaskFormerPreTrainedModel:()=>r.MaskFormerPreTrainedModel,MaskedLMOutput:()=>r.MaskedLMOutput,MaxLengthCriteria:()=>w.MaxLengthCriteria,Metric3DForDepthEstimation:()=>r.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>r.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>r.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>r.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>r.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>r.MgpstrModelOutput,MgpstrPreTrainedModel:()=>r.MgpstrPreTrainedModel,MgpstrProcessor:()=>g.MgpstrProcessor,MgpstrTokenizer:()=>n.MgpstrTokenizer,MimiDecoderModel:()=>r.MimiDecoderModel,MimiDecoderOutput:()=>r.MimiDecoderOutput,MimiEncoderModel:()=>r.MimiEncoderModel,MimiEncoderOutput:()=>r.MimiEncoderOutput,MimiModel:()=>r.MimiModel,MimiPreTrainedModel:()=>r.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>M.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>M.MinNewTokensLengthLogitsProcessor,MistralForCausalLM:()=>r.MistralForCausalLM,MistralModel:()=>r.MistralModel,MistralPreTrainedModel:()=>r.MistralPreTrainedModel,MobileBertForMaskedLM:()=>r.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>r.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>r.MobileBertForSequenceClassification,MobileBertModel:()=>r.MobileBertModel,MobileBertPreTrainedModel:()=>r.MobileBertPreTrainedModel,MobileBertTokenizer:()=>n.MobileBertTokenizer,MobileLLMForCausalLM:()=>r.MobileLLMForCausalLM,MobileLLMModel:()=>r.MobileLLMModel,MobileLLMPreTrainedModel:()=>r.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>m.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>r.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>r.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>m.MobileNetV1ImageProcessor,MobileNetV1Model:()=>r.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>r.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>m.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>r.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>r.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>m.MobileNetV2ImageProcessor,MobileNetV2Model:()=>r.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>r.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>m.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>r.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>r.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>m.MobileNetV3ImageProcessor,MobileNetV3Model:()=>r.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>r.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>m.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>r.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>r.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>m.MobileNetV4ImageProcessor,MobileNetV4Model:()=>r.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>r.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>m.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>r.MobileViTForImageClassification,MobileViTImageProcessor:()=>m.MobileViTImageProcessor,MobileViTModel:()=>r.MobileViTModel,MobileViTPreTrainedModel:()=>r.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>r.MobileViTV2ForImageClassification,MobileViTV2Model:()=>r.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>r.MobileViTV2PreTrainedModel,ModelOutput:()=>r.ModelOutput,ModernBertDecoderForCausalLM:()=>r.ModernBertDecoderForCausalLM,ModernBertDecoderModel:()=>r.ModernBertDecoderModel,ModernBertDecoderPreTrainedModel:()=>r.ModernBertDecoderPreTrainedModel,ModernBertForMaskedLM:()=>r.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>r.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>r.ModernBertForTokenClassification,ModernBertModel:()=>r.ModernBertModel,ModernBertPreTrainedModel:()=>r.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>r.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>h.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>r.MoonshineForConditionalGeneration,MoonshineModel:()=>r.MoonshineModel,MoonshinePreTrainedModel:()=>r.MoonshinePreTrainedModel,MoonshineProcessor:()=>g.MoonshineProcessor,MptForCausalLM:()=>r.MptForCausalLM,MptModel:()=>r.MptModel,MptPreTrainedModel:()=>r.MptPreTrainedModel,MultiModalityCausalLM:()=>r.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>r.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>r.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>r.MusicgenForConditionalGeneration,MusicgenModel:()=>r.MusicgenModel,MusicgenPreTrainedModel:()=>r.MusicgenPreTrainedModel,NanoChatForCausalLM:()=>r.NanoChatForCausalLM,NanoChatModel:()=>r.NanoChatModel,NanoChatPreTrainedModel:()=>r.NanoChatPreTrainedModel,NeoBertForMaskedLM:()=>r.NeoBertForMaskedLM,NeoBertForQuestionAnswering:()=>r.NeoBertForQuestionAnswering,NeoBertForSequenceClassification:()=>r.NeoBertForSequenceClassification,NeoBertForTokenClassification:()=>r.NeoBertForTokenClassification,NeoBertModel:()=>r.NeoBertModel,NeoBertPreTrainedModel:()=>r.NeoBertPreTrainedModel,NllbTokenizer:()=>n.NllbTokenizer,NoBadWordsLogitsProcessor:()=>M.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>M.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>r.NomicBertModel,NomicBertPreTrainedModel:()=>r.NomicBertPreTrainedModel,NougatImageProcessor:()=>m.NougatImageProcessor,NougatTokenizer:()=>n.NougatTokenizer,OPTForCausalLM:()=>r.OPTForCausalLM,OPTModel:()=>r.OPTModel,OPTPreTrainedModel:()=>r.OPTPreTrainedModel,ObjectDetectionPipeline:()=>t.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>r.Olmo2ForCausalLM,Olmo2Model:()=>r.Olmo2Model,Olmo2PreTrainedModel:()=>r.Olmo2PreTrainedModel,OlmoForCausalLM:()=>r.OlmoForCausalLM,OlmoModel:()=>r.OlmoModel,OlmoPreTrainedModel:()=>r.OlmoPreTrainedModel,OpenELMForCausalLM:()=>r.OpenELMForCausalLM,OpenELMModel:()=>r.OpenELMModel,OpenELMPreTrainedModel:()=>r.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>m.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>r.OwlViTForObjectDetection,OwlViTImageProcessor:()=>m.OwlViTImageProcessor,OwlViTModel:()=>r.OwlViTModel,OwlViTPreTrainedModel:()=>r.OwlViTPreTrainedModel,OwlViTProcessor:()=>g.OwlViTProcessor,Owlv2ForObjectDetection:()=>r.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>m.Owlv2ImageProcessor,Owlv2Model:()=>r.Owlv2Model,Owlv2PreTrainedModel:()=>r.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>r.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>r.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>g.PaliGemmaProcessor,ParakeetFeatureExtractor:()=>h.ParakeetFeatureExtractor,ParakeetForCTC:()=>r.ParakeetForCTC,ParakeetPreTrainedModel:()=>r.ParakeetPreTrainedModel,PatchTSMixerForPrediction:()=>r.PatchTSMixerForPrediction,PatchTSMixerModel:()=>r.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>r.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>r.PatchTSTForPrediction,PatchTSTModel:()=>r.PatchTSTModel,PatchTSTPreTrainedModel:()=>r.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>r.Phi3ForCausalLM,Phi3Model:()=>r.Phi3Model,Phi3PreTrainedModel:()=>r.Phi3PreTrainedModel,Phi3VForCausalLM:()=>r.Phi3VForCausalLM,Phi3VImageProcessor:()=>m.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>r.Phi3VPreTrainedModel,Phi3VProcessor:()=>g.Phi3VProcessor,PhiForCausalLM:()=>r.PhiForCausalLM,PhiModel:()=>r.PhiModel,PhiPreTrainedModel:()=>r.PhiPreTrainedModel,Pipeline:()=>t.Pipeline,PreTrainedModel:()=>r.PreTrainedModel,PreTrainedTokenizer:()=>n.PreTrainedTokenizer,PretrainedConfig:()=>s.PretrainedConfig,PretrainedMixin:()=>r.PretrainedMixin,Processor:()=>P.Processor,PvtForImageClassification:()=>r.PvtForImageClassification,PvtImageProcessor:()=>m.PvtImageProcessor,PvtModel:()=>r.PvtModel,PvtPreTrainedModel:()=>r.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>h.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>r.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>r.PyAnnoteModel,PyAnnotePreTrainedModel:()=>r.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>g.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>r.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>t.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>r.Qwen2ForCausalLM,Qwen2Model:()=>r.Qwen2Model,Qwen2PreTrainedModel:()=>r.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>n.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>r.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>m.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>r.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>g.Qwen2VLProcessor,Qwen3ForCausalLM:()=>r.Qwen3ForCausalLM,Qwen3Model:()=>r.Qwen3Model,Qwen3PreTrainedModel:()=>r.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>r.RFDetrForObjectDetection,RFDetrModel:()=>r.RFDetrModel,RFDetrObjectDetectionOutput:()=>r.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>r.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>r.RTDetrForObjectDetection,RTDetrImageProcessor:()=>m.RTDetrImageProcessor,RTDetrModel:()=>r.RTDetrModel,RTDetrObjectDetectionOutput:()=>r.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>r.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>r.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>r.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>r.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>r.RTDetrV2PreTrainedModel,RawAudio:()=>i.RawAudio,RawImage:()=>a.RawImage,RawVideo:()=>o.RawVideo,RawVideoFrame:()=>o.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>M.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>r.ResNetForImageClassification,ResNetModel:()=>r.ResNetModel,ResNetPreTrainedModel:()=>r.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>r.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>r.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>r.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>r.RoFormerForTokenClassification,RoFormerModel:()=>r.RoFormerModel,RoFormerPreTrainedModel:()=>r.RoFormerPreTrainedModel,RoFormerTokenizer:()=>n.RoFormerTokenizer,RobertaForMaskedLM:()=>r.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>r.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>r.RobertaForSequenceClassification,RobertaForTokenClassification:()=>r.RobertaForTokenClassification,RobertaModel:()=>r.RobertaModel,RobertaPreTrainedModel:()=>r.RobertaPreTrainedModel,RobertaTokenizer:()=>n.RobertaTokenizer,Sam2ImageProcessor:()=>m.Sam2ImageProcessor,Sam2ImageSegmentationOutput:()=>r.Sam2ImageSegmentationOutput,Sam2Model:()=>r.Sam2Model,Sam2PreTrainedModel:()=>r.Sam2PreTrainedModel,Sam2Processor:()=>g.Sam2Processor,Sam2VideoProcessor:()=>g.Sam2VideoProcessor,Sam3ImageProcessor:()=>m.Sam3ImageProcessor,Sam3TrackerModel:()=>r.Sam3TrackerModel,SamImageProcessor:()=>m.SamImageProcessor,SamImageSegmentationOutput:()=>r.SamImageSegmentationOutput,SamModel:()=>r.SamModel,SamPreTrainedModel:()=>r.SamPreTrainedModel,SamProcessor:()=>g.SamProcessor,SapiensForDepthEstimation:()=>r.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>r.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>r.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>r.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>h.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>m.SegformerFeatureExtractor,SegformerForImageClassification:()=>r.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>r.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>m.SegformerImageProcessor,SegformerModel:()=>r.SegformerModel,SegformerPreTrainedModel:()=>r.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>r.Seq2SeqLMOutput,SequenceClassifierOutput:()=>r.SequenceClassifierOutput,SiglipImageProcessor:()=>m.SiglipImageProcessor,SiglipModel:()=>r.SiglipModel,SiglipPreTrainedModel:()=>r.SiglipPreTrainedModel,SiglipTextModel:()=>r.SiglipTextModel,SiglipTokenizer:()=>n.SiglipTokenizer,SiglipVisionModel:()=>r.SiglipVisionModel,SmolLM3ForCausalLM:()=>r.SmolLM3ForCausalLM,SmolLM3Model:()=>r.SmolLM3Model,SmolLM3PreTrainedModel:()=>r.SmolLM3PreTrainedModel,SmolVLMForConditionalGeneration:()=>r.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>m.SmolVLMImageProcessor,SmolVLMProcessor:()=>g.SmolVLMProcessor,SnacDecoderModel:()=>r.SnacDecoderModel,SnacEncoderModel:()=>r.SnacEncoderModel,SnacFeatureExtractor:()=>h.SnacFeatureExtractor,SnacModel:()=>r.SnacModel,SnacPreTrainedModel:()=>r.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>h.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>r.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>r.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>r.SpeechT5HifiGan,SpeechT5Model:()=>r.SpeechT5Model,SpeechT5PreTrainedModel:()=>r.SpeechT5PreTrainedModel,SpeechT5Processor:()=>g.SpeechT5Processor,SpeechT5Tokenizer:()=>n.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>r.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>r.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>r.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>r.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>r.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>n.SqueezeBertTokenizer,StableLmForCausalLM:()=>r.StableLmForCausalLM,StableLmModel:()=>r.StableLmModel,StableLmPreTrainedModel:()=>r.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>r.Starcoder2ForCausalLM,Starcoder2Model:()=>r.Starcoder2Model,Starcoder2PreTrainedModel:()=>r.Starcoder2PreTrainedModel,StoppingCriteria:()=>w.StoppingCriteria,StoppingCriteriaList:()=>w.StoppingCriteriaList,StyleTextToSpeech2Model:()=>r.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>r.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>t.SummarizationPipeline,SupertonicForConditionalGeneration:()=>r.SupertonicForConditionalGeneration,SupertonicPreTrainedModel:()=>r.SupertonicPreTrainedModel,SuppressTokensAtBeginLogitsProcessor:()=>M.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>r.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>m.Swin2SRImageProcessor,Swin2SRModel:()=>r.Swin2SRModel,Swin2SRPreTrainedModel:()=>r.Swin2SRPreTrainedModel,SwinForImageClassification:()=>r.SwinForImageClassification,SwinForSemanticSegmentation:()=>r.SwinForSemanticSegmentation,SwinModel:()=>r.SwinModel,SwinPreTrainedModel:()=>r.SwinPreTrainedModel,T5ForConditionalGeneration:()=>r.T5ForConditionalGeneration,T5Model:()=>r.T5Model,T5PreTrainedModel:()=>r.T5PreTrainedModel,T5Tokenizer:()=>n.T5Tokenizer,TableTransformerForObjectDetection:()=>r.TableTransformerForObjectDetection,TableTransformerModel:()=>r.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>r.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>r.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>M.TemperatureLogitsWarper,Tensor:()=>l.Tensor,Text2TextGenerationPipeline:()=>t.Text2TextGenerationPipeline,TextClassificationPipeline:()=>t.TextClassificationPipeline,TextGenerationPipeline:()=>t.TextGenerationPipeline,TextStreamer:()=>b.TextStreamer,TextToAudioPipeline:()=>t.TextToAudioPipeline,TokenClassificationPipeline:()=>t.TokenClassificationPipeline,TokenClassifierOutput:()=>r.TokenClassifierOutput,TokenizerModel:()=>n.TokenizerModel,TopKLogitsWarper:()=>M.TopKLogitsWarper,TopPLogitsWarper:()=>M.TopPLogitsWarper,TrOCRForCausalLM:()=>r.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>r.TrOCRPreTrainedModel,TranslationPipeline:()=>t.TranslationPipeline,UltravoxModel:()=>r.UltravoxModel,UltravoxPreTrainedModel:()=>r.UltravoxPreTrainedModel,UltravoxProcessor:()=>g.UltravoxProcessor,UniSpeechForCTC:()=>r.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>r.UniSpeechForSequenceClassification,UniSpeechModel:()=>r.UniSpeechModel,UniSpeechPreTrainedModel:()=>r.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>r.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>r.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>r.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>r.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>r.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>g.VLChatProcessor,VLMImageProcessor:()=>m.VLMImageProcessor,VaultGemmaForCausalLM:()=>r.VaultGemmaForCausalLM,VaultGemmaModel:()=>r.VaultGemmaModel,VaultGemmaPreTrainedModel:()=>r.VaultGemmaPreTrainedModel,ViTFeatureExtractor:()=>m.ViTFeatureExtractor,ViTForImageClassification:()=>r.ViTForImageClassification,ViTImageProcessor:()=>m.ViTImageProcessor,ViTMAEModel:()=>r.ViTMAEModel,ViTMAEPreTrainedModel:()=>r.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>r.ViTMSNForImageClassification,ViTMSNModel:()=>r.ViTMSNModel,ViTMSNPreTrainedModel:()=>r.ViTMSNPreTrainedModel,ViTModel:()=>r.ViTModel,ViTPreTrainedModel:()=>r.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>r.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>r.VitMatteForImageMatting,VitMatteImageProcessor:()=>m.VitMatteImageProcessor,VitMattePreTrainedModel:()=>r.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>r.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>m.VitPoseImageProcessor,VitPosePreTrainedModel:()=>r.VitPosePreTrainedModel,VitsModel:()=>r.VitsModel,VitsModelOutput:()=>r.VitsModelOutput,VitsPreTrainedModel:()=>r.VitsPreTrainedModel,VitsTokenizer:()=>n.VitsTokenizer,VoxtralForConditionalGeneration:()=>r.VoxtralForConditionalGeneration,VoxtralProcessor:()=>g.VoxtralProcessor,Wav2Vec2BertForCTC:()=>r.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>r.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>r.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>r.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>n.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>h.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>r.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>r.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>r.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>r.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>r.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>g.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>g.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>r.WavLMForAudioFrameClassification,WavLMForCTC:()=>r.WavLMForCTC,WavLMForSequenceClassification:()=>r.WavLMForSequenceClassification,WavLMForXVector:()=>r.WavLMForXVector,WavLMModel:()=>r.WavLMModel,WavLMPreTrainedModel:()=>r.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>h.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>r.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>r.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>h.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>r.WhisperForConditionalGeneration,WhisperModel:()=>r.WhisperModel,WhisperPreTrainedModel:()=>r.WhisperPreTrainedModel,WhisperProcessor:()=>g.WhisperProcessor,WhisperTextStreamer:()=>b.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>M.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>n.WhisperTokenizer,XLMForQuestionAnswering:()=>r.XLMForQuestionAnswering,XLMForSequenceClassification:()=>r.XLMForSequenceClassification,XLMForTokenClassification:()=>r.XLMForTokenClassification,XLMModel:()=>r.XLMModel,XLMPreTrainedModel:()=>r.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>r.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>r.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>r.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>r.XLMRobertaForTokenClassification,XLMRobertaModel:()=>r.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>r.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>n.XLMRobertaTokenizer,XLMTokenizer:()=>n.XLMTokenizer,XLMWithLMHeadModel:()=>r.XLMWithLMHeadModel,XVectorOutput:()=>r.XVectorOutput,YolosFeatureExtractor:()=>m.YolosFeatureExtractor,YolosForObjectDetection:()=>r.YolosForObjectDetection,YolosImageProcessor:()=>m.YolosImageProcessor,YolosModel:()=>r.YolosModel,YolosObjectDetectionOutput:()=>r.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>r.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>t.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>t.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>t.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>t.ZeroShotObjectDetectionPipeline,bankers_round:()=>c.bankers_round,cat:()=>l.cat,cos_sim:()=>c.cos_sim,dot:()=>c.dot,dynamic_time_warping:()=>c.dynamic_time_warping,env:()=>e.env,full:()=>l.full,full_like:()=>l.full_like,getCacheShapes:()=>s.getCacheShapes,hamming:()=>i.hamming,hanning:()=>i.hanning,interpolate:()=>l.interpolate,interpolate_4d:()=>l.interpolate_4d,interpolate_data:()=>c.interpolate_data,is_chinese_char:()=>n.is_chinese_char,layer_norm:()=>l.layer_norm,load_image:()=>a.load_image,load_video:()=>o.load_video,log_softmax:()=>c.log_softmax,magnitude:()=>c.magnitude,matmul:()=>l.matmul,max:()=>c.max,mean:()=>l.mean,mean_pooling:()=>l.mean_pooling,medianFilter:()=>c.medianFilter,mel_filter_bank:()=>i.mel_filter_bank,min:()=>c.min,ones:()=>l.ones,ones_like:()=>l.ones_like,permute:()=>l.permute,permute_data:()=>c.permute_data,pipeline:()=>t.pipeline,quantize_embeddings:()=>l.quantize_embeddings,rand:()=>l.rand,randn:()=>l.randn,read_audio:()=>i.read_audio,rfft:()=>l.rfft,round:()=>c.round,slice:()=>l.slice,softmax:()=>c.softmax,spectrogram:()=>i.spectrogram,stack:()=>l.stack,std_mean:()=>l.std_mean,topk:()=>l.topk,window_function:()=>i.window_function,zeros:()=>l.zeros,zeros_like:()=>l.zeros_like});var e=tr("./src/env.js"),t=tr("./src/pipelines.js"),r=tr("./src/models.js"),n=tr("./src/tokenizers.js"),s=tr("./src/configs.js"),i=tr("./src/utils/audio.js"),a=tr("./src/utils/image.js"),o=tr("./src/utils/video.js"),l=tr("./src/utils/tensor.js"),c=tr("./src/utils/maths.js"),d=tr("./src/base/feature_extraction_utils.js"),h=tr("./src/models/feature_extractors.js"),u=tr("./src/models/auto/feature_extraction_auto.js"),p=tr("./src/base/image_processors_utils.js"),m=tr("./src/models/image_processors.js"),y=tr("./src/models/auto/image_processing_auto.js"),P=tr("./src/base/processing_utils.js"),g=tr("./src/models/processors.js"),_=tr("./src/models/auto/processing_auto.js"),b=tr("./src/generation/streamers.js"),w=tr("./src/generation/stopping_criteria.js"),M=tr("./src/generation/logits_process.js")})();x.ASTFeatureExtractor;x.ASTForAudioClassification;x.ASTModel;x.ASTPreTrainedModel;x.AlbertForMaskedLM;x.AlbertForQuestionAnswering;x.AlbertForSequenceClassification;x.AlbertModel;x.AlbertPreTrainedModel;x.AlbertTokenizer;x.ArceeForCausalLM;x.ArceeModel;x.ArceePreTrainedModel;x.AudioClassificationPipeline;x.AutoConfig;x.AutoFeatureExtractor;x.AutoImageProcessor;var C8=x.AutoModel;x.AutoModelForAudioClassification;x.AutoModelForAudioFrameClassification;x.AutoModelForAudioTextToText;x.AutoModelForCTC;x.AutoModelForCausalLM;x.AutoModelForDepthEstimation;x.AutoModelForDocumentQuestionAnswering;x.AutoModelForImageClassification;x.AutoModelForImageFeatureExtraction;x.AutoModelForImageMatting;x.AutoModelForImageSegmentation;x.AutoModelForImageTextToText;x.AutoModelForImageToImage;x.AutoModelForMaskGeneration;x.AutoModelForMaskedLM;x.AutoModelForNormalEstimation;x.AutoModelForObjectDetection;x.AutoModelForPoseEstimation;x.AutoModelForQuestionAnswering;x.AutoModelForSemanticSegmentation;x.AutoModelForSeq2SeqLM;x.AutoModelForSequenceClassification;x.AutoModelForSpeechSeq2Seq;x.AutoModelForTextToSpectrogram;x.AutoModelForTextToWaveform;x.AutoModelForTokenClassification;x.AutoModelForUniversalSegmentation;x.AutoModelForVision2Seq;x.AutoModelForXVector;x.AutoModelForZeroShotObjectDetection;var $8=x.AutoProcessor;x.AutoTokenizer;x.AutomaticSpeechRecognitionPipeline;x.BackgroundRemovalPipeline;x.BartForConditionalGeneration;x.BartForSequenceClassification;x.BartModel;x.BartPretrainedModel;x.BartTokenizer;x.BaseModelOutput;x.BaseStreamer;x.BeitFeatureExtractor;x.BeitForImageClassification;x.BeitModel;x.BeitPreTrainedModel;x.BertForMaskedLM;x.BertForQuestionAnswering;x.BertForSequenceClassification;x.BertForTokenClassification;x.BertModel;x.BertPreTrainedModel;x.BertTokenizer;x.BitImageProcessor;x.BlenderbotForConditionalGeneration;x.BlenderbotModel;x.BlenderbotPreTrainedModel;x.BlenderbotSmallForConditionalGeneration;x.BlenderbotSmallModel;x.BlenderbotSmallPreTrainedModel;x.BlenderbotSmallTokenizer;x.BlenderbotTokenizer;x.BloomForCausalLM;x.BloomModel;x.BloomPreTrainedModel;x.BloomTokenizer;x.CLIPFeatureExtractor;x.CLIPImageProcessor;x.CLIPModel;x.CLIPPreTrainedModel;x.CLIPSegForImageSegmentation;x.CLIPSegModel;x.CLIPSegPreTrainedModel;x.CLIPTextModel;x.CLIPTextModelWithProjection;x.CLIPTokenizer;x.CLIPVisionModel;x.CLIPVisionModelWithProjection;x.CamembertForMaskedLM;x.CamembertForQuestionAnswering;x.CamembertForSequenceClassification;x.CamembertForTokenClassification;x.CamembertModel;x.CamembertPreTrainedModel;x.CamembertTokenizer;x.CausalLMOutput;x.CausalLMOutputWithPast;x.ChineseCLIPFeatureExtractor;x.ChineseCLIPModel;x.ChineseCLIPPreTrainedModel;x.ClapAudioModelWithProjection;x.ClapFeatureExtractor;x.ClapModel;x.ClapPreTrainedModel;x.ClapTextModelWithProjection;x.ClassifierFreeGuidanceLogitsProcessor;x.CodeGenForCausalLM;x.CodeGenModel;x.CodeGenPreTrainedModel;x.CodeGenTokenizer;x.CodeLlamaTokenizer;x.CohereForCausalLM;x.CohereModel;x.CoherePreTrainedModel;x.CohereTokenizer;x.ConvBertForMaskedLM;x.ConvBertForQuestionAnswering;x.ConvBertForSequenceClassification;x.ConvBertForTokenClassification;x.ConvBertModel;x.ConvBertPreTrainedModel;x.ConvBertTokenizer;x.ConvNextFeatureExtractor;x.ConvNextForImageClassification;x.ConvNextImageProcessor;x.ConvNextModel;x.ConvNextPreTrainedModel;x.ConvNextV2ForImageClassification;x.ConvNextV2Model;x.ConvNextV2PreTrainedModel;x.DFineForObjectDetection;x.DFineModel;x.DFinePreTrainedModel;x.DINOv3ConvNextModel;x.DINOv3ConvNextPreTrainedModel;x.DINOv3ViTImageProcessor;x.DINOv3ViTModel;x.DINOv3ViTPreTrainedModel;x.DPTFeatureExtractor;x.DPTForDepthEstimation;x.DPTImageProcessor;x.DPTModel;x.DPTPreTrainedModel;x.DacDecoderModel;x.DacDecoderOutput;x.DacEncoderModel;x.DacEncoderOutput;x.DacFeatureExtractor;x.DacModel;x.DacPreTrainedModel;x.DataTypeMap;x.DebertaForMaskedLM;x.DebertaForQuestionAnswering;x.DebertaForSequenceClassification;x.DebertaForTokenClassification;x.DebertaModel;x.DebertaPreTrainedModel;x.DebertaTokenizer;x.DebertaV2ForMaskedLM;x.DebertaV2ForQuestionAnswering;x.DebertaV2ForSequenceClassification;x.DebertaV2ForTokenClassification;x.DebertaV2Model;x.DebertaV2PreTrainedModel;x.DebertaV2Tokenizer;x.DecisionTransformerModel;x.DecisionTransformerPreTrainedModel;x.DeiTFeatureExtractor;x.DeiTForImageClassification;x.DeiTImageProcessor;x.DeiTModel;x.DeiTPreTrainedModel;x.DepthAnythingForDepthEstimation;x.DepthAnythingPreTrainedModel;x.DepthEstimationPipeline;x.DepthProForDepthEstimation;x.DepthProPreTrainedModel;x.DetrFeatureExtractor;x.DetrForObjectDetection;x.DetrForSegmentation;x.DetrImageProcessor;x.DetrModel;x.DetrObjectDetectionOutput;x.DetrPreTrainedModel;x.DetrSegmentationOutput;x.Dinov2ForImageClassification;x.Dinov2Model;x.Dinov2PreTrainedModel;x.Dinov2WithRegistersForImageClassification;x.Dinov2WithRegistersModel;x.Dinov2WithRegistersPreTrainedModel;x.DistilBertForMaskedLM;x.DistilBertForQuestionAnswering;x.DistilBertForSequenceClassification;x.DistilBertForTokenClassification;x.DistilBertModel;x.DistilBertPreTrainedModel;x.DistilBertTokenizer;x.DocumentQuestionAnsweringPipeline;x.DonutFeatureExtractor;x.DonutImageProcessor;x.DonutSwinModel;x.DonutSwinPreTrainedModel;x.EdgeTamModel;x.EfficientNetForImageClassification;x.EfficientNetImageProcessor;x.EfficientNetModel;x.EfficientNetPreTrainedModel;x.ElectraForMaskedLM;x.ElectraForQuestionAnswering;x.ElectraForSequenceClassification;x.ElectraForTokenClassification;x.ElectraModel;x.ElectraPreTrainedModel;x.ElectraTokenizer;x.EncodecFeatureExtractor;x.EosTokenCriteria;x.Ernie4_5_ForCausalLM;x.Ernie4_5_Model;x.Ernie4_5_PretrainedModel;x.Ernie4_5_Tokenizer;x.EsmForMaskedLM;x.EsmForSequenceClassification;x.EsmForTokenClassification;x.EsmModel;x.EsmPreTrainedModel;x.EsmTokenizer;x.ExaoneForCausalLM;x.ExaoneModel;x.ExaonePreTrainedModel;x.FFT;x.FalconForCausalLM;x.FalconModel;x.FalconPreTrainedModel;x.FalconTokenizer;x.FastViTForImageClassification;x.FastViTModel;x.FastViTPreTrainedModel;x.FeatureExtractionPipeline;x.FeatureExtractor;x.FillMaskPipeline;x.Florence2ForConditionalGeneration;x.Florence2PreTrainedModel;x.Florence2Processor;x.ForcedBOSTokenLogitsProcessor;x.ForcedEOSTokenLogitsProcessor;x.GLPNFeatureExtractor;x.GLPNForDepthEstimation;x.GLPNModel;x.GLPNPreTrainedModel;x.GPT2LMHeadModel;x.GPT2Model;x.GPT2PreTrainedModel;x.GPT2Tokenizer;x.GPTBigCodeForCausalLM;x.GPTBigCodeModel;x.GPTBigCodePreTrainedModel;x.GPTJForCausalLM;x.GPTJModel;x.GPTJPreTrainedModel;x.GPTNeoForCausalLM;x.GPTNeoModel;x.GPTNeoPreTrainedModel;x.GPTNeoXForCausalLM;x.GPTNeoXModel;x.GPTNeoXPreTrainedModel;x.GPTNeoXTokenizer;x.Gemma2ForCausalLM;x.Gemma2Model;x.Gemma2PreTrainedModel;x.Gemma3ForCausalLM;x.Gemma3Model;x.Gemma3PreTrainedModel;x.Gemma3nAudioFeatureExtractor;x.Gemma3nForConditionalGeneration;x.Gemma3nPreTrainedModel;x.Gemma3nProcessor;x.GemmaForCausalLM;x.GemmaModel;x.GemmaPreTrainedModel;x.GemmaTokenizer;x.GlmForCausalLM;x.GlmModel;x.GlmPreTrainedModel;x.GraniteForCausalLM;x.GraniteModel;x.GraniteMoeHybridForCausalLM;x.GraniteMoeHybridModel;x.GraniteMoeHybridPreTrainedModel;x.GranitePreTrainedModel;x.Grok1Tokenizer;x.GroundingDinoForObjectDetection;x.GroundingDinoImageProcessor;x.GroundingDinoPreTrainedModel;x.GroundingDinoProcessor;x.GroupViTModel;x.GroupViTPreTrainedModel;x.HeliumForCausalLM;x.HeliumModel;x.HeliumPreTrainedModel;x.HerbertTokenizer;x.HieraForImageClassification;x.HieraModel;x.HieraPreTrainedModel;x.HubertForCTC;x.HubertForSequenceClassification;x.HubertModel;x.HubertPreTrainedModel;x.IJepaForImageClassification;x.IJepaModel;x.IJepaPreTrainedModel;x.Idefics3ForConditionalGeneration;x.Idefics3ImageProcessor;x.Idefics3PreTrainedModel;x.Idefics3Processor;x.ImageClassificationPipeline;x.ImageFeatureExtractionPipeline;x.ImageFeatureExtractor;x.ImageMattingOutput;x.ImageProcessor;x.ImageSegmentationPipeline;x.ImageToImagePipeline;x.ImageToTextPipeline;x.InterruptableStoppingCriteria;x.JAISLMHeadModel;x.JAISModel;x.JAISPreTrainedModel;x.JinaCLIPImageProcessor;x.JinaCLIPModel;x.JinaCLIPPreTrainedModel;x.JinaCLIPProcessor;x.JinaCLIPTextModel;x.JinaCLIPVisionModel;x.Lfm2ForCausalLM;x.Lfm2Model;x.Lfm2PreTrainedModel;x.LiteWhisperForConditionalGeneration;x.Llama4ForCausalLM;x.Llama4PreTrainedModel;x.LlamaForCausalLM;x.LlamaModel;x.LlamaPreTrainedModel;x.LlamaTokenizer;x.LlavaForConditionalGeneration;x.LlavaOnevisionForConditionalGeneration;x.LlavaOnevisionImageProcessor;x.LlavaPreTrainedModel;x.LlavaProcessor;x.LlavaQwen2ForCausalLM;x.LogitsProcessor;x.LogitsProcessorList;x.LogitsWarper;x.LongT5ForConditionalGeneration;x.LongT5Model;x.LongT5PreTrainedModel;x.M2M100ForConditionalGeneration;x.M2M100Model;x.M2M100PreTrainedModel;x.M2M100Tokenizer;x.MBart50Tokenizer;x.MBartForCausalLM;x.MBartForConditionalGeneration;x.MBartForSequenceClassification;x.MBartModel;x.MBartPreTrainedModel;x.MBartTokenizer;x.MPNetForMaskedLM;x.MPNetForQuestionAnswering;x.MPNetForSequenceClassification;x.MPNetForTokenClassification;x.MPNetModel;x.MPNetPreTrainedModel;x.MPNetTokenizer;x.MT5ForConditionalGeneration;x.MT5Model;x.MT5PreTrainedModel;x.MarianMTModel;x.MarianModel;x.MarianPreTrainedModel;x.MarianTokenizer;x.Mask2FormerImageProcessor;x.MaskFormerFeatureExtractor;x.MaskFormerForInstanceSegmentation;x.MaskFormerImageProcessor;x.MaskFormerModel;x.MaskFormerPreTrainedModel;x.MaskedLMOutput;x.MaxLengthCriteria;x.Metric3DForDepthEstimation;x.Metric3DPreTrainedModel;x.Metric3Dv2ForDepthEstimation;x.Metric3Dv2PreTrainedModel;x.MgpstrForSceneTextRecognition;x.MgpstrModelOutput;x.MgpstrPreTrainedModel;x.MgpstrProcessor;x.MgpstrTokenizer;x.MimiDecoderModel;x.MimiDecoderOutput;x.MimiEncoderModel;x.MimiEncoderOutput;x.MimiModel;x.MimiPreTrainedModel;x.MinLengthLogitsProcessor;x.MinNewTokensLengthLogitsProcessor;x.MistralForCausalLM;x.MistralModel;x.MistralPreTrainedModel;x.MobileBertForMaskedLM;x.MobileBertForQuestionAnswering;x.MobileBertForSequenceClassification;x.MobileBertModel;x.MobileBertPreTrainedModel;x.MobileBertTokenizer;x.MobileLLMForCausalLM;x.MobileLLMModel;x.MobileLLMPreTrainedModel;x.MobileNetV1FeatureExtractor;x.MobileNetV1ForImageClassification;x.MobileNetV1ForSemanticSegmentation;x.MobileNetV1ImageProcessor;x.MobileNetV1Model;x.MobileNetV1PreTrainedModel;x.MobileNetV2FeatureExtractor;x.MobileNetV2ForImageClassification;x.MobileNetV2ForSemanticSegmentation;x.MobileNetV2ImageProcessor;x.MobileNetV2Model;x.MobileNetV2PreTrainedModel;x.MobileNetV3FeatureExtractor;x.MobileNetV3ForImageClassification;x.MobileNetV3ForSemanticSegmentation;x.MobileNetV3ImageProcessor;x.MobileNetV3Model;x.MobileNetV3PreTrainedModel;x.MobileNetV4FeatureExtractor;x.MobileNetV4ForImageClassification;x.MobileNetV4ForSemanticSegmentation;x.MobileNetV4ImageProcessor;x.MobileNetV4Model;x.MobileNetV4PreTrainedModel;x.MobileViTFeatureExtractor;x.MobileViTForImageClassification;x.MobileViTImageProcessor;x.MobileViTModel;x.MobileViTPreTrainedModel;x.MobileViTV2ForImageClassification;x.MobileViTV2Model;x.MobileViTV2PreTrainedModel;x.ModelOutput;x.ModernBertDecoderForCausalLM;x.ModernBertDecoderModel;x.ModernBertDecoderPreTrainedModel;x.ModernBertForMaskedLM;x.ModernBertForSequenceClassification;x.ModernBertForTokenClassification;x.ModernBertModel;x.ModernBertPreTrainedModel;x.Moondream1ForConditionalGeneration;x.MoonshineFeatureExtractor;x.MoonshineForConditionalGeneration;x.MoonshineModel;x.MoonshinePreTrainedModel;x.MoonshineProcessor;x.MptForCausalLM;x.MptModel;x.MptPreTrainedModel;x.MultiModalityCausalLM;x.MultiModalityPreTrainedModel;x.MusicgenForCausalLM;x.MusicgenForConditionalGeneration;x.MusicgenModel;x.MusicgenPreTrainedModel;x.NanoChatForCausalLM;x.NanoChatModel;x.NanoChatPreTrainedModel;x.NeoBertForMaskedLM;x.NeoBertForQuestionAnswering;x.NeoBertForSequenceClassification;x.NeoBertForTokenClassification;x.NeoBertModel;x.NeoBertPreTrainedModel;x.NllbTokenizer;x.NoBadWordsLogitsProcessor;x.NoRepeatNGramLogitsProcessor;x.NomicBertModel;x.NomicBertPreTrainedModel;x.NougatImageProcessor;x.NougatTokenizer;x.OPTForCausalLM;x.OPTModel;x.OPTPreTrainedModel;x.ObjectDetectionPipeline;x.Olmo2ForCausalLM;x.Olmo2Model;x.Olmo2PreTrainedModel;x.OlmoForCausalLM;x.OlmoModel;x.OlmoPreTrainedModel;x.OpenELMForCausalLM;x.OpenELMModel;x.OpenELMPreTrainedModel;x.OwlViTFeatureExtractor;x.OwlViTForObjectDetection;x.OwlViTImageProcessor;x.OwlViTModel;x.OwlViTPreTrainedModel;x.OwlViTProcessor;x.Owlv2ForObjectDetection;x.Owlv2ImageProcessor;x.Owlv2Model;x.Owlv2PreTrainedModel;x.PaliGemmaForConditionalGeneration;x.PaliGemmaPreTrainedModel;x.PaliGemmaProcessor;x.ParakeetFeatureExtractor;x.ParakeetForCTC;x.ParakeetPreTrainedModel;x.PatchTSMixerForPrediction;x.PatchTSMixerModel;x.PatchTSMixerPreTrainedModel;x.PatchTSTForPrediction;x.PatchTSTModel;x.PatchTSTPreTrainedModel;x.Phi3ForCausalLM;x.Phi3Model;x.Phi3PreTrainedModel;x.Phi3VForCausalLM;x.Phi3VImageProcessor;x.Phi3VPreTrainedModel;x.Phi3VProcessor;x.PhiForCausalLM;x.PhiModel;x.PhiPreTrainedModel;x.Pipeline;x.PreTrainedModel;x.PreTrainedTokenizer;x.PretrainedConfig;x.PretrainedMixin;x.Processor;x.PvtForImageClassification;x.PvtImageProcessor;x.PvtModel;x.PvtPreTrainedModel;x.PyAnnoteFeatureExtractor;x.PyAnnoteForAudioFrameClassification;x.PyAnnoteModel;x.PyAnnotePreTrainedModel;x.PyAnnoteProcessor;x.QuestionAnsweringModelOutput;x.QuestionAnsweringPipeline;x.Qwen2ForCausalLM;x.Qwen2Model;x.Qwen2PreTrainedModel;x.Qwen2Tokenizer;x.Qwen2VLForConditionalGeneration;x.Qwen2VLImageProcessor;x.Qwen2VLPreTrainedModel;x.Qwen2VLProcessor;x.Qwen3ForCausalLM;x.Qwen3Model;x.Qwen3PreTrainedModel;x.RFDetrForObjectDetection;x.RFDetrModel;x.RFDetrObjectDetectionOutput;x.RFDetrPreTrainedModel;x.RTDetrForObjectDetection;x.RTDetrImageProcessor;x.RTDetrModel;x.RTDetrObjectDetectionOutput;x.RTDetrPreTrainedModel;x.RTDetrV2ForObjectDetection;x.RTDetrV2Model;x.RTDetrV2ObjectDetectionOutput;x.RTDetrV2PreTrainedModel;x.RawAudio;var vC=x.RawImage;x.RawVideo;x.RawVideoFrame;x.RepetitionPenaltyLogitsProcessor;x.ResNetForImageClassification;x.ResNetModel;x.ResNetPreTrainedModel;x.RoFormerForMaskedLM;x.RoFormerForQuestionAnswering;x.RoFormerForSequenceClassification;x.RoFormerForTokenClassification;x.RoFormerModel;x.RoFormerPreTrainedModel;x.RoFormerTokenizer;x.RobertaForMaskedLM;x.RobertaForQuestionAnswering;x.RobertaForSequenceClassification;x.RobertaForTokenClassification;x.RobertaModel;x.RobertaPreTrainedModel;x.RobertaTokenizer;x.Sam2ImageProcessor;x.Sam2ImageSegmentationOutput;x.Sam2Model;x.Sam2PreTrainedModel;x.Sam2Processor;x.Sam2VideoProcessor;x.Sam3ImageProcessor;x.Sam3TrackerModel;x.SamImageProcessor;x.SamImageSegmentationOutput;x.SamModel;x.SamPreTrainedModel;x.SamProcessor;x.SapiensForDepthEstimation;x.SapiensForNormalEstimation;x.SapiensForSemanticSegmentation;x.SapiensPreTrainedModel;x.SeamlessM4TFeatureExtractor;x.SegformerFeatureExtractor;x.SegformerForImageClassification;x.SegformerForSemanticSegmentation;x.SegformerImageProcessor;x.SegformerModel;x.SegformerPreTrainedModel;x.Seq2SeqLMOutput;x.SequenceClassifierOutput;x.SiglipImageProcessor;x.SiglipModel;x.SiglipPreTrainedModel;x.SiglipTextModel;x.SiglipTokenizer;x.SiglipVisionModel;x.SmolLM3ForCausalLM;x.SmolLM3Model;x.SmolLM3PreTrainedModel;x.SmolVLMForConditionalGeneration;x.SmolVLMImageProcessor;x.SmolVLMProcessor;x.SnacDecoderModel;x.SnacEncoderModel;x.SnacFeatureExtractor;x.SnacModel;x.SnacPreTrainedModel;x.SpeechT5FeatureExtractor;x.SpeechT5ForSpeechToText;x.SpeechT5ForTextToSpeech;x.SpeechT5HifiGan;x.SpeechT5Model;x.SpeechT5PreTrainedModel;x.SpeechT5Processor;x.SpeechT5Tokenizer;x.SqueezeBertForMaskedLM;x.SqueezeBertForQuestionAnswering;x.SqueezeBertForSequenceClassification;x.SqueezeBertModel;x.SqueezeBertPreTrainedModel;x.SqueezeBertTokenizer;x.StableLmForCausalLM;x.StableLmModel;x.StableLmPreTrainedModel;x.Starcoder2ForCausalLM;x.Starcoder2Model;x.Starcoder2PreTrainedModel;x.StoppingCriteria;x.StoppingCriteriaList;x.StyleTextToSpeech2Model;x.StyleTextToSpeech2PreTrainedModel;x.SummarizationPipeline;x.SupertonicForConditionalGeneration;x.SupertonicPreTrainedModel;x.SuppressTokensAtBeginLogitsProcessor;x.Swin2SRForImageSuperResolution;x.Swin2SRImageProcessor;x.Swin2SRModel;x.Swin2SRPreTrainedModel;x.SwinForImageClassification;x.SwinForSemanticSegmentation;x.SwinModel;x.SwinPreTrainedModel;x.T5ForConditionalGeneration;x.T5Model;x.T5PreTrainedModel;x.T5Tokenizer;x.TableTransformerForObjectDetection;x.TableTransformerModel;x.TableTransformerObjectDetectionOutput;x.TableTransformerPreTrainedModel;x.TemperatureLogitsWarper;x.Tensor;x.Text2TextGenerationPipeline;x.TextClassificationPipeline;x.TextGenerationPipeline;x.TextStreamer;x.TextToAudioPipeline;x.TokenClassificationPipeline;x.TokenClassifierOutput;x.TokenizerModel;x.TopKLogitsWarper;x.TopPLogitsWarper;x.TrOCRForCausalLM;x.TrOCRPreTrainedModel;x.TranslationPipeline;x.UltravoxModel;x.UltravoxPreTrainedModel;x.UltravoxProcessor;x.UniSpeechForCTC;x.UniSpeechForSequenceClassification;x.UniSpeechModel;x.UniSpeechPreTrainedModel;x.UniSpeechSatForAudioFrameClassification;x.UniSpeechSatForCTC;x.UniSpeechSatForSequenceClassification;x.UniSpeechSatModel;x.UniSpeechSatPreTrainedModel;x.VLChatProcessor;x.VLMImageProcessor;x.VaultGemmaForCausalLM;x.VaultGemmaModel;x.VaultGemmaPreTrainedModel;x.ViTFeatureExtractor;x.ViTForImageClassification;x.ViTImageProcessor;x.ViTMAEModel;x.ViTMAEPreTrainedModel;x.ViTMSNForImageClassification;x.ViTMSNModel;x.ViTMSNPreTrainedModel;x.ViTModel;x.ViTPreTrainedModel;x.VisionEncoderDecoderModel;x.VitMatteForImageMatting;x.VitMatteImageProcessor;x.VitMattePreTrainedModel;x.VitPoseForPoseEstimation;x.VitPoseImageProcessor;x.VitPosePreTrainedModel;x.VitsModel;x.VitsModelOutput;x.VitsPreTrainedModel;x.VitsTokenizer;x.VoxtralForConditionalGeneration;x.VoxtralProcessor;x.Wav2Vec2BertForCTC;x.Wav2Vec2BertForSequenceClassification;x.Wav2Vec2BertModel;x.Wav2Vec2BertPreTrainedModel;x.Wav2Vec2CTCTokenizer;x.Wav2Vec2FeatureExtractor;x.Wav2Vec2ForAudioFrameClassification;x.Wav2Vec2ForCTC;x.Wav2Vec2ForSequenceClassification;x.Wav2Vec2Model;x.Wav2Vec2PreTrainedModel;x.Wav2Vec2Processor;x.Wav2Vec2ProcessorWithLM;x.WavLMForAudioFrameClassification;x.WavLMForCTC;x.WavLMForSequenceClassification;x.WavLMForXVector;x.WavLMModel;x.WavLMPreTrainedModel;x.WeSpeakerFeatureExtractor;x.WeSpeakerResNetModel;x.WeSpeakerResNetPreTrainedModel;x.WhisperFeatureExtractor;x.WhisperForConditionalGeneration;x.WhisperModel;x.WhisperPreTrainedModel;x.WhisperProcessor;x.WhisperTextStreamer;x.WhisperTimeStampLogitsProcessor;x.WhisperTokenizer;x.XLMForQuestionAnswering;x.XLMForSequenceClassification;x.XLMForTokenClassification;x.XLMModel;x.XLMPreTrainedModel;x.XLMRobertaForMaskedLM;x.XLMRobertaForQuestionAnswering;x.XLMRobertaForSequenceClassification;x.XLMRobertaForTokenClassification;x.XLMRobertaModel;x.XLMRobertaPreTrainedModel;x.XLMRobertaTokenizer;x.XLMTokenizer;x.XLMWithLMHeadModel;x.XVectorOutput;x.YolosFeatureExtractor;x.YolosForObjectDetection;x.YolosImageProcessor;x.YolosModel;x.YolosObjectDetectionOutput;x.YolosPreTrainedModel;x.ZeroShotAudioClassificationPipeline;x.ZeroShotClassificationPipeline;x.ZeroShotImageClassificationPipeline;x.ZeroShotObjectDetectionPipeline;x.bankers_round;x.cat;x.cos_sim;x.dot;x.dynamic_time_warping;var So=x.env;x.full;x.full_like;x.getCacheShapes;x.hamming;x.hanning;x.interpolate;x.interpolate_4d;x.interpolate_data;x.is_chinese_char;x.layer_norm;x.load_image;x.load_video;x.log_softmax;x.magnitude;x.matmul;x.max;x.mean;x.mean_pooling;x.medianFilter;x.mel_filter_bank;x.min;x.ones;x.ones_like;x.permute;x.permute_data;x.pipeline;x.quantize_embeddings;x.rand;x.randn;x.read_audio;x.rfft;x.round;x.slice;x.softmax;x.spectrogram;x.stack;x.std_mean;x.topk;x.window_function;x.zeros;x.zeros_like;So.allowLocalModels=!0;So.allowRemoteModels=!0;So.localModelPath="/models/";try{So.useBrowserCache=typeof window<"u"&&"caches"in window}catch{So.useBrowserCache=!1}So.backends.onnx.logLevel="fatal";So.backends.onnx.wasm.proxy=!1;const x3=e=>new Promise((t,r)=>{const n=new Image;n.addEventListener("load",()=>t(n)),n.addEventListener("error",s=>r(s)),n.setAttribute("crossOrigin","anonymous"),n.src=e});function b3(e){return e*Math.PI/180}function I8(e,t,r){const n=b3(r);return{width:Math.abs(Math.cos(n)*e)+Math.abs(Math.sin(n)*t),height:Math.abs(Math.sin(n)*e)+Math.abs(Math.cos(n)*t)}}async function A8(e,t,r=0){const n=await x3(e),s=document.createElement("canvas"),i=s.getContext("2d");if(!i)return"";const a=b3(r),{width:o,height:l}=I8(n.width,n.height,r);s.width=o,s.height=l,i.translate(o/2,l/2),i.rotate(a),i.translate(-n.width/2,-n.height/2),i.drawImage(n,0,0);const c=i.getImageData(t.x,t.y,t.width,t.height);return s.width=t.width,s.height=t.height,i.putImageData(c,0,0),s.toDataURL("image/png")}const j8=({imageUrl:e,onSave:t,onCancel:r,initialAspect:n})=>{const[s,i]=ke.useState("view"),[a,o]=ke.useState(!1),[l,c]=ke.useState(!1),[d,h]=ke.useState(""),[u,p]=ke.useState(null),[m,y]=ke.useState(null),[P,g]=ke.useState([e]),[_,b]=ke.useState(0),w=P[_],M=ke.useRef(null),[E,T]=ke.useState(30),[S,A]=ke.useState(!1),[j,U]=ke.useState({x:0,y:0}),[W,B]=ke.useState(1),[ee,Q]=ke.useState(0),[Z,J]=ke.useState(void 0),[X,ae]=ke.useState(null),le=ke.useRef(null),ne=ke.useRef(null),L=O=>{const ue=P.slice(0,_+1);ue.push(O),g(ue),b(ue.length-1)},F=()=>{_>0&&b(_-1)};ke.useEffect(()=>{s==="view"&&G()},[s,w]);const G=async()=>{const O=M.current;if(!O)return;const ue=O.getContext("2d");if(!ue)return;const Ee=await x3(w);O.width=Ee.width,O.height=Ee.height,ue.clearRect(0,0,O.width,O.height),ue.drawImage(Ee,0,0)},oe=async()=>{if(!l){c(!0),p(null),y(null);try{const O=!!navigator.gpu,ue="wasm",Ee="Xenova/modnet",fe=Le=>{Le.status==="initiate"?(h("Initializing..."),Le.file&&y("remote")):Le.status==="progress"?(y("remote"),h(`Downloading Model... ${Math.round(Le.progress||0)}%`)):Le.status==="done"&&(m||y("local"),h("AI Ready."))};if(!le.current||!ne.current){h(`Loading AI (${ue.toUpperCase()})...`);try{le.current||(le.current=await C8.from_pretrained(Ee,{device:ue,progress_callback:fe})),ne.current||(ne.current=await $8.from_pretrained(Ee,{progress_callback:fe}))}catch(Le){throw console.error("Model load error:",Le),le.current=null,ne.current=null,new Error(Le.message||"Failed to load AI model. Check connection.")}}h("Processing Image...");const me=le.current,ve=ne.current,xe=await vC.fromURL(w),{pixel_values:_e}=await ve(xe),{output:je}=await me({input:_e}),we=(await vC.fromTensor(je[0].mul(255).to("uint8")).resize(xe.width,xe.height)).data,Oe=document.createElement("canvas");Oe.width=xe.width,Oe.height=xe.height;const Me=Oe.getContext("2d");if(!Me)throw new Error("Canvas context failed");Me.drawImage(xe.toCanvas(),0,0);const We=Me.getImageData(0,0,xe.width,xe.height);for(let Le=0;Le<we.length;++Le)We.data[4*Le+3]=we[Le];Me.putImageData(We,0,0),L(Oe.toDataURL("image/png"))}catch(O){console.error(O),p(O.message||"AI Removal failed.")}finally{c(!1),h("")}}},H=O=>{const ue=M.current;if(!ue)return{x:0,y:0};const Ee=ue.getBoundingClientRect(),fe=ue.width/Ee.width,me=ue.height/Ee.height;let ve,xe;return"touches"in O?(ve=O.touches[0].clientX,xe=O.touches[0].clientY):(ve=O.clientX,xe=O.clientY),{x:(ve-Ee.left)*fe,y:(xe-Ee.top)*me}},Te=O=>{var me;if(!a)return;A(!0);const ue=(me=M.current)==null?void 0:me.getContext("2d");if(!ue)return;const{x:Ee,y:fe}=H(O);ue.globalCompositeOperation="destination-out",ue.beginPath(),ue.arc(Ee,fe,E/2,0,Math.PI*2),ue.fill(),ue.beginPath(),ue.moveTo(Ee,fe)},Ce=O=>{var me;if(!S||!a)return;const ue=(me=M.current)==null?void 0:me.getContext("2d");if(!ue)return;"touches"in O&&O.preventDefault();const{x:Ee,y:fe}=H(O);ue.lineWidth=E,ue.lineCap="round",ue.lineJoin="round",ue.lineTo(Ee,fe),ue.stroke()},Be=()=>{S&&(A(!1),M.current&&L(M.current.toDataURL("image/png")))},$e=ke.useCallback((O,ue)=>{ae(ue)},[]),te=async()=>{if(X)try{const O=await A8(w,X,ee);L(O),i("view"),U({x:0,y:0}),B(1),Q(0)}catch(O){console.error("Crop error:",O)}};return typeof document>"u"?null:DI.createPortal(f.jsxs("div",{className:"fixed inset-0 z-[9999] bg-[#09090b] flex flex-col text-white font-sans animate-in fade-in duration-300",children:[f.jsxs("div",{className:"h-16 px-4 flex items-center justify-between bg-black/80 backdrop-blur-md border-b border-white/10 z-50",children:[f.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-white/10 text-gray-400 transition-colors",children:f.jsx(Us,{size:24})}),f.jsx("div",{className:"font-bold text-sm tracking-wide text-gray-300",children:s==="crop"?"CROP & ROTATE":"STUDIO EDITOR"}),f.jsx("button",{onClick:()=>t(w),disabled:s==="crop",className:`p-2 rounded-full transition-colors ${s==="crop"?"opacity-0 pointer-events-none":"text-green-400 hover:bg-green-900/20"}`,children:f.jsx(Fl,{size:24,strokeWidth:3})})]}),f.jsxs("div",{className:"flex-1 relative bg-[#111] overflow-hidden flex items-center justify-center",children:[f.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20",style:{backgroundImage:"linear-gradient(45deg, #333 25%, transparent 25%), linear-gradient(-45deg, #333 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #333 75%), linear-gradient(-45deg, transparent 75%, #333 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"}}),s==="view"&&f.jsxs("div",{className:"relative w-full h-full flex items-center justify-center p-6",children:[l&&f.jsxs("div",{className:"absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center text-white animate-in fade-in p-6 text-center",children:[f.jsx(Ls,{size:48,className:"animate-spin text-blue-500 mb-4"}),f.jsx("p",{className:"font-bold text-lg tracking-wider mb-2",children:d||"PROCESSING..."}),m&&f.jsx("div",{className:"text-sm text-gray-400 mt-2 flex items-center gap-2 bg-white/10 px-3 py-1 rounded-full",children:m==="remote"?f.jsxs(f.Fragment,{children:[f.jsx(CR,{size:12,className:"text-blue-400"})," ",f.jsx("span",{children:"Downloading AI Model..."})]}):f.jsxs(f.Fragment,{children:[f.jsx(OR,{size:12,className:"text-green-400"})," ",f.jsx("span",{children:"Using Local AI..."})]})})]}),u&&f.jsxs("div",{className:"absolute inset-0 z-50 bg-black/90 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center animate-in fade-in",children:[f.jsx(LI,{size:48,className:"text-red-500 mb-4"}),f.jsx("h3",{className:"text-xl font-bold mb-2",children:"AI Error"}),f.jsx("p",{className:"text-xs text-gray-400 mb-6 max-w-xs break-words bg-gray-900 p-3 rounded border border-gray-800",children:u}),f.jsx("button",{onClick:()=>p(null),className:"bg-gray-800 text-gray-300 px-8 py-3 rounded-xl font-bold text-sm hover:bg-gray-700",children:"Close"})]}),f.jsx("canvas",{ref:M,className:`max-w-full max-h-full object-contain shadow-2xl border border-white/5 relative z-10 ${a?"cursor-crosshair":""}`,onMouseDown:Te,onMouseMove:Ce,onMouseUp:Be,onMouseLeave:Be,onTouchStart:Te,onTouchMove:Ce,onTouchEnd:Be}),f.jsx("button",{onClick:F,disabled:_<=0||l,className:"absolute top-6 right-6 z-30 w-12 h-12 bg-black/50 hover:bg-black/80 backdrop-blur border border-white/20 rounded-full flex items-center justify-center text-white shadow-xl disabled:opacity-30 disabled:cursor-not-allowed transition-all",children:f.jsx(WR,{size:20})})]}),s==="crop"&&f.jsx("div",{className:"absolute inset-0 z-20 bg-black",children:f.jsx(UV,{image:w,crop:j,zoom:W,rotation:ee,aspect:Z,onCropChange:U,onCropComplete:$e,onZoomChange:B,onRotationChange:Q,objectFit:"contain",showGrid:!0})})]}),f.jsxs("div",{className:"bg-[#09090b] border-t border-white/10 pb-safe z-50 relative",children:[f.jsxs("div",{className:"px-6 py-2 min-h-[60px] flex flex-col justify-center",children:[s==="view"&&a&&f.jsxs("div",{className:"flex items-center gap-4 animate-slide-up",children:[f.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase w-16",children:"Eraser"}),f.jsx("input",{type:"range",min:"5",max:"100",value:E,onChange:O=>T(Number(O.target.value)),className:"flex-1 h-1.5 bg-gray-700 rounded-full appearance-none accent-pink-500 cursor-pointer"}),f.jsx("div",{className:"w-8 h-8 rounded-full border border-white/30 flex items-center justify-center bg-white/10",children:f.jsx("div",{className:"rounded-full bg-pink-500",style:{width:Math.min(24,E/3),height:Math.min(24,E/3)}})})]}),s==="crop"&&f.jsxs("div",{className:"flex items-center gap-4 overflow-x-auto no-scrollbar py-2 animate-slide-up",children:[n&&f.jsx("button",{onClick:()=>J(n),className:`px-3 py-1.5 rounded-lg border text-xs font-bold whitespace-nowrap ${Z===n?"bg-blue-600 border-blue-600":"border-white/20 hover:bg-white/10"}`,children:"Item"}),f.jsx("button",{onClick:()=>J(1),className:`px-3 py-1.5 rounded-lg border text-xs font-bold whitespace-nowrap ${Z===1?"bg-blue-600 border-blue-600":"border-white/20 hover:bg-white/10"}`,children:"1:1"}),f.jsx("button",{onClick:()=>J(4/3),className:`px-3 py-1.5 rounded-lg border text-xs font-bold whitespace-nowrap ${Z===4/3?"bg-blue-600 border-blue-600":"border-white/20 hover:bg-white/10"}`,children:"4:3"}),f.jsx("div",{className:"w-[1px] h-6 bg-white/10 mx-2"}),f.jsx(RR,{size:16,className:"text-gray-500 ml-2"}),f.jsx("input",{type:"range",min:"0",max:"360",value:ee,onChange:O=>Q(Number(O.target.value)),className:"w-24 h-1.5 bg-gray-700 rounded-full appearance-none accent-blue-500"})]})]}),f.jsx("div",{className:"px-4 pb-4 pt-2 flex items-center gap-3",children:s==="crop"?f.jsxs(f.Fragment,{children:[f.jsx("button",{onClick:()=>i("view"),className:"flex-1 bg-gray-800 text-gray-300 font-bold text-sm py-3.5 rounded-xl hover:bg-gray-700 transition-all active:scale-95",children:"Cancel"}),f.jsxs("button",{onClick:te,className:"flex-1 bg-blue-600 text-white font-bold text-sm py-3.5 rounded-xl shadow-lg shadow-blue-900/30 hover:bg-blue-500 transition-all active:scale-95 flex items-center justify-center gap-2",children:[f.jsx(Fl,{size:18})," Apply Crop"]})]}):f.jsxs(f.Fragment,{children:[f.jsxs("button",{onClick:()=>{i("crop"),o(!1)},className:"flex-1 bg-white/5 border border-white/10 text-gray-200 py-3 rounded-xl flex flex-col items-center gap-1 hover:bg-white/10 transition-all active:scale-95",children:[f.jsx($R,{size:20,className:"text-blue-400"}),f.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Crop"})]}),f.jsxs("button",{onClick:oe,disabled:l,className:"flex-1 bg-white/5 border border-white/10 text-gray-200 py-3 rounded-xl flex flex-col items-center gap-1 hover:bg-white/10 transition-all active:scale-95 disabled:opacity-50",children:[l?f.jsx(Ls,{size:20,className:"animate-spin text-purple-400"}):f.jsx(HI,{size:20,className:"text-purple-400"}),f.jsx("span",{className:"text-[10px] font-bold uppercase",children:l?"Working...":"AI Auto"})]}),f.jsxs("button",{onClick:()=>o(!a),className:`flex-1 py-3 rounded-xl flex flex-col items-center gap-1 border transition-all active:scale-95 ${a?"bg-pink-500/20 border-pink-500 text-white":"bg-white/5 border-white/10 text-gray-200 hover:bg-white/10"}`,children:[f.jsx(AR,{size:20,className:a?"text-pink-400":"text-gray-400"}),f.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Eraser"})]})]})})]})]}),document.body)},O8=({itemForm:e,setItemForm:t,saveItem:r,onClose:n,handleDeleteClick:s,isDeleteConfirmOpen:i,setIsDeleteConfirmOpen:a,confirmDelete:o,editingId:l,currentUser:c,activePackItems:d,onToggleActivePack:h,isTogglingPack:u})=>{const p=ke.useRef(null),[m,y]=ke.useState(!1),P=w=>new Promise((M,E)=>{const T=new FileReader;T.readAsDataURL(w),T.onload=S=>{var j;const A=new Image;A.src=(j=S.target)==null?void 0:j.result,A.onload=()=>{const U=document.createElement("canvas"),W=1200,B=W/A.width;B<1?(U.width=W,U.height=A.height*B):(U.width=A.width,U.height=A.height);const ee=U.getContext("2d");if(ee){ee.drawImage(A,0,0,U.width,U.height);const Q=U.toDataURL("image/png");M(Q)}else E(new Error("Canvas context failed"))}},T.onerror=S=>E(S)}),g=async w=>{if(w.target.files&&w.target.files[0])try{const M=w.target.files[0],E=await P(M);t({...e,imageUrl:E})}catch(M){console.error("Image upload failed",M),alert("Failed to process image.")}},_=w=>{t({...e,imageUrl:w}),y(!1)},b=l&&d?d.some(w=>w.gearId===l):!1;return f.jsxs("div",{className:"fixed inset-0 z-[100]  pb-[88px] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 pb-safe",children:[f.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl max-h-[85vh] overflow-y-auto relative",children:[i&&o&&a&&f.jsxs("div",{className:"absolute inset-0 bg-white/98 z-20 flex flex-col items-center justify-center p-6 rounded-3xl animate-in fade-in duration-200",children:[f.jsx("div",{className:"bg-red-50 p-4 rounded-full mb-4 animate-bounce",children:f.jsx(To,{size:32,className:"text-red-500"})}),f.jsx("h4",{className:"text-lg font-bold text-gray-900 mb-2",children:"Delete Item?"}),f.jsxs("p",{className:"text-sm text-gray-500 text-center mb-6 leading-relaxed max-w-[200px]",children:["This will permanently remove ",f.jsx("b",{children:e.name})," from your inventory and all packs."]}),f.jsxs("div",{className:"flex gap-3 w-full",children:[f.jsx("button",{onClick:()=>a(!1),className:"flex-1 py-3 bg-gray-100 rounded-xl font-bold text-gray-600 hover:bg-gray-200 transition-colors",children:"Cancel"}),f.jsx("button",{onClick:o,className:"flex-1 py-3 bg-red-500 text-white rounded-xl font-bold shadow-lg hover:bg-red-600 transition-colors",children:"Delete"})]})]}),f.jsxs("div",{className:"space-y-4 pt-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Name"}),f.jsxs("div",{className:"flex gap-2 items-center",children:[f.jsx("input",{className:"w-full border border-gray-200 rounded-xl p-2 text-sm flex-1",value:e.name,onChange:w=>t({...e,name:w.target.value})}),l&&(c==null?void 0:c.activePackId)&&h&&f.jsx("button",{type:"button",onClick:h,disabled:u,className:`px-3 py-2 rounded-xl transition-all flex items-center gap-2 border shadow-sm active:scale-95 flex-shrink-0 ${b?"bg-green-50 border-green-200 text-green-600":"bg-white border-gray-200 text-gray-500 hover:border-blue-200 hover:text-blue-600"}`,children:u?f.jsx(Ls,{size:16,className:"animate-spin"}):f.jsxs(f.Fragment,{children:[b?f.jsx(Fl,{size:16}):f.jsx(Ti,{size:16}),f.jsxs("div",{className:"flex flex-col items-start leading-none",children:[f.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wide",children:b?"Added":"Add"}),f.jsx("span",{className:"text-[9px] opacity-80",children:"to Pack"})]})]})})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Image"}),e.imageUrl?f.jsxs("div",{className:"mt-1 w-full h-40 bg-gray-50 rounded-2xl border border-gray-200 overflow-hidden relative group",children:[f.jsx("img",{src:e.imageUrl,className:"w-full h-full object-contain",alt:"Preview",crossOrigin:"anonymous"}),f.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[f.jsxs("button",{onClick:()=>y(!0),className:"bg-black/70 text-white text-xs font-bold px-3 py-1.5 rounded-full hover:bg-black transition-colors flex items-center gap-1",children:[f.jsx(HI,{size:12})," Edit"]}),f.jsxs("div",{className:"flex gap-2 items-center",children:[f.jsx("button",{onClick:()=>{var w;return(w=p.current)==null?void 0:w.click()},className:"bg-blue-50 p-2 rounded-xl text-blue-600 hover:bg-blue-100 border border-blue-100",title:"Upload Image",children:f.jsx(o0,{size:18})}),f.jsx("input",{type:"file",ref:p,className:"hidden",accept:"image/*",onChange:g})]})]})]}):f.jsxs("div",{onClick:()=>{var w;return(w=p.current)==null?void 0:w.click()},className:"mt-1 w-full h-32 bg-gray-50 border-2 border-dashed border-gray-200 rounded-2xl flex flex-col items-center justify-center text-gray-400 hover:bg-gray-100 hover:border-blue-300 hover:text-blue-500 transition-all cursor-pointer gap-2 group",children:[f.jsx("div",{className:"bg-white p-3 rounded-full shadow-sm group-hover:scale-110 transition-transform",children:f.jsx(o0,{size:20})}),f.jsx("span",{className:"text-xs font-medium",children:"Upload Image"})]}),f.jsx("input",{type:"file",ref:p,className:"hidden",accept:"image/*",onChange:g})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Grid Size (Width x Height)"}),f.jsxs("div",{className:"flex gap-3 items-center",children:[f.jsxs("div",{className:"w-20",children:[f.jsx("label",{className:"text-[10px] text-gray-400 block mb-1",children:"Width"}),f.jsx("input",{type:"number",min:"1",max:"10",className:"w-full border border-gray-200 rounded-xl p-2 text-sm text-center",value:e.gridCols,onChange:w=>t({...e,gridCols:Number(w.target.value)})})]}),f.jsxs("div",{className:"w-20",children:[f.jsx("label",{className:"text-[10px] text-gray-400 block mb-1",children:"Height"}),f.jsx("input",{type:"number",min:"1",max:"10",className:"w-full border border-gray-200 rounded-xl p-2 text-sm text-center",value:e.gridRows,onChange:w=>t({...e,gridRows:Number(w.target.value)})})]}),f.jsxs("div",{className:"flex-1 h-28 flex items-center justify-center bg-gray-50 rounded-xl border border-dashed border-gray-200 ml-2",children:[f.jsx("div",{style:{width:(e.gridCols||1)*8,height:(e.gridRows||1)*8},className:"bg-blue-500 rounded-sm shadow-sm max-w-full max-h-full"}),f.jsx("span",{className:"text-[9px] text-gray-400 ml-2",children:"Preview"})]})]})]}),f.jsxs("div",{className:"flex gap-3",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Category"}),f.jsx("select",{className:"w-full border border-gray-200 rounded-xl p-2 text-sm bg-white",value:e.category,onChange:w=>t({...e,category:w.target.value}),children:Object.values(fr).map(w=>f.jsx("option",{value:w,children:w},w))})]}),f.jsxs("div",{className:"flex-1",children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Brand"}),f.jsx("input",{className:"w-full border border-gray-200 rounded-xl p-2 text-sm",value:e.brand,onChange:w=>t({...e,brand:w.target.value})})]})]}),f.jsxs("div",{className:"flex gap-3 items-end",children:[f.jsxs("div",{className:"flex-1 min-w-[80px]",children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Weight (g)"}),f.jsx("input",{type:"number",className:"w-full border border-gray-200 rounded-xl p-2 text-sm",value:e.weightGrams,onChange:w=>t({...e,weightGrams:Number(w.target.value)})})]}),f.jsxs("div",{className:"flex-1 min-w-[80px]",children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Price ()"}),f.jsx("input",{type:"number",className:"w-full border border-gray-200 rounded-xl p-2 text-sm",value:e.price,onChange:w=>t({...e,price:Number(w.target.value)})})]}),f.jsxs("div",{className:"flex items-center h-[38px] px-3 bg-gray-50 rounded-xl border border-gray-200 hover:bg-gray-100 transition-colors",title:"Is Consumable?",children:[f.jsx("input",{type:"checkbox",id:"consumable",checked:e.isConsumable,onChange:w=>t({...e,isConsumable:w.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-blue-600"}),f.jsx("label",{htmlFor:"consumable",className:"text-[10px] ml-2 text-gray-600 font-bold whitespace-nowrap cursor-pointer",children:"Consumable"})]})]})]}),f.jsxs("div",{className:"flex gap-3 mt-6",children:[l&&s&&f.jsx("button",{onClick:s,className:"bg-red-50 text-red-500 p-3 rounded-xl hover:bg-red-100 transition-colors",title:"Delete Item",children:f.jsx(To,{size:20})}),f.jsx("button",{onClick:n,className:"flex-1 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold",children:"Cancel"}),f.jsx("button",{onClick:r,className:"flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700",children:l?"Save":"Add"})]})]}),m&&e.imageUrl&&f.jsx(j8,{imageUrl:e.imageUrl,onSave:_,onCancel:()=>y(!1),initialAspect:(e.gridCols||1)/(e.gridRows||1)})]})},xC=({title:e,packForm:t,setPackForm:r,carryingGear:n,onClose:s,onConfirm:i,confirmText:a})=>f.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:f.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md p-6 shadow-2xl",children:[f.jsx("h3",{className:"text-lg font-bold mb-4",children:e}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Pack Name"}),f.jsx("input",{className:"w-full border border-gray-200 rounded-xl p-2 text-sm",autoFocus:!0,value:t.name,onChange:o=>r({...t,name:o.target.value})})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Grid Size (Columns x Rows)"}),f.jsxs("div",{className:"flex gap-3",children:[f.jsx("input",{type:"number",className:"flex-1 border border-gray-200 rounded-xl p-2 text-sm",value:t.gridCols,onChange:o=>r({...t,gridCols:Number(o.target.value)})}),f.jsx("input",{type:"number",className:"flex-1 border border-gray-200 rounded-xl p-2 text-sm",value:t.gridRows,onChange:o=>r({...t,gridRows:Number(o.target.value)})})]}),e.includes("Edit")&&f.jsx("div",{className:"text-[10px] text-orange-500 mt-1",children:"Warning: Reducing grid size may hide items outside bounds."})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"Linked Gear (Container)"}),f.jsxs("select",{className:"w-full border border-gray-200 rounded-xl p-2 text-sm bg-white",value:t.gearId||"",onChange:o=>r({...t,gearId:o.target.value||void 0}),children:[f.jsx("option",{value:"",children:"-- Select Carrying Gear --"}),n.map(o=>f.jsx("option",{value:o.id,children:o.name},o.id))]})]})]}),f.jsxs("div",{className:"flex gap-3 mt-6",children:[f.jsx("button",{onClick:s,className:"flex-1 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold",children:"Cancel"}),f.jsx("button",{onClick:i,className:"flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700",children:a})]})]})}),N8=({inventory:e,selectedPack:t,onClose:r,onAddItem:n,onRemoveItem:s,onAddOne:i})=>{const[a,o]=ke.useState(""),[l,c]=ke.useState("All"),d=ke.useRef(null),[h,u]=ke.useState(!1),[p,m]=ke.useState(0),[y,P]=ke.useState(0),[g,_]=ke.useState(!1),b=A=>{d.current&&(u(!0),_(!1),m(A.pageX-d.current.offsetLeft),P(d.current.scrollLeft))},w=()=>{u(!1)},M=()=>{u(!1)},E=A=>{if(!h||!d.current)return;A.preventDefault();const U=(A.pageX-d.current.offsetLeft-p)*2;d.current.scrollLeft=y-U,Math.abs(U)>5&&_(!0)},T=e.filter(A=>{const j=l==="All"||A.category===l,U=A.name.toLowerCase().includes(a.toLowerCase());return j&&U}),S=A=>{const j=t==null?void 0:t.items.find(U=>U.gearId===A);return j?j.quantity:0};return f.jsx("div",{className:"fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex flex-col justify-end  pb-[88px] sm:justify-center",children:f.jsxs("div",{className:"bg-gray-50 h-[85vh] sm:h-[80vh] w-full sm:max-w-md sm:mx-auto rounded-3xl sm:rounded-3xl flex flex-col shadow-2xl overflow-hidden animate-in slide-in-from-bottom",children:[f.jsxs("div",{className:"bg-white px-5 py-4 border-b border-gray-200 flex flex-col gap-3",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("h3",{className:"font-bold text-lg text-gray-800",children:["Add to ",t==null?void 0:t.name]}),f.jsx("button",{onClick:r,className:"bg-gray-100 p-2 rounded-full text-gray-500",children:f.jsx(Us,{size:18})})]}),f.jsxs("div",{className:"relative",children:[f.jsx(GI,{size:16,className:"absolute left-3 top-3 text-gray-400"}),f.jsx("input",{className:"w-full bg-gray-100 border-none rounded-xl pl-9 pr-4 py-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Search gear...",value:a,onChange:A=>o(A.target.value)})]}),f.jsx("div",{ref:d,className:"flex gap-2 pb-1 overflow-x-auto no-scrollbar cursor-grab active:cursor-grabbing",onMouseDown:b,onMouseLeave:w,onMouseUp:M,onMouseMove:E,children:["All",...Object.values(fr)].map(A=>f.jsx("button",{onClick:()=>{g||c(A)},className:`px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap flex-shrink-0 transition-colors ${l===A?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:A},A))})]}),f.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[f.jsx("div",{className:"grid grid-cols-2 gap-3",children:T.map(A=>{const j=S(A.id);return f.jsxs("div",{className:`bg-white rounded-2xl p-2 shadow-sm border transition-all ${j>0?"border-blue-500 ring-1 ring-blue-100":"border-transparent"}`,children:[f.jsxs("div",{className:"aspect-square bg-gray-100 rounded-xl overflow-hidden mb-2 relative",children:[f.jsx("img",{src:A.imageUrl,className:"w-full h-full object-cover",loading:"lazy"}),j>0&&f.jsx("div",{className:"absolute top-2 right-2 bg-blue-600 text-white text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center shadow-md border border-white",children:j})]}),f.jsxs("div",{className:"px-1",children:[f.jsx("div",{className:"text-xs font-bold text-gray-800 truncate mb-1",children:A.name}),f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("span",{className:"text-[10px] text-gray-400",children:[A.weightGrams,"g"]}),j===0?f.jsx("button",{onClick:()=>n(A),className:"bg-blue-50 text-blue-600 p-1.5 rounded-lg hover:bg-blue-100 transition-colors",children:f.jsx(Ti,{size:14,strokeWidth:3})}):f.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-lg p-0.5",children:[f.jsx("button",{onClick:()=>s(A),className:"p-1 text-gray-500 hover:bg-white rounded-md transition-colors",children:f.jsx(VI,{size:12,strokeWidth:3})}),f.jsx("button",{onClick:()=>i(A),className:"p-1 text-blue-600 hover:bg-white rounded-md transition-colors",children:f.jsx(Ti,{size:12,strokeWidth:3})})]})]})]})]},A.id)})}),T.length===0&&f.jsx("div",{className:"text-center text-gray-400 text-sm py-10",children:"No items match."})]})]})})},D8=({inventory:e,inventoryView:t,filterCategory:r,searchQuery:n,onEditItem:s})=>{const i=e.filter(a=>{const o=r==="All"||a.category===r,l=a.name.toLowerCase().includes(n.toLowerCase())||a.brand&&a.brand.toLowerCase().includes(n.toLowerCase());return o&&l});return f.jsx("div",{className:"space-y-4 pb-20 pt-4",children:i.length===0?f.jsxs("div",{className:"text-center py-12 bg-white/50 rounded-3xl border border-dashed border-gray-300",children:[f.jsx(Hf,{size:40,className:"mx-auto text-gray-300 mb-2"}),f.jsx("div",{className:"text-sm text-gray-500",children:"No items found."})]}):t==="list"?f.jsx("div",{className:"grid gap-3",children:i.map(a=>f.jsxs("div",{onClick:()=>s(a),className:"bg-white rounded-2xl p-3 flex items-center shadow-sm cursor-pointer hover:bg-gray-50 transition-colors",children:[f.jsxs("div",{className:"relative w-12 h-12 mr-3 flex-shrink-0",children:[f.jsx("img",{src:a.imageUrl,className:"w-full h-full rounded-xl bg-gray-100 object-cover"}),f.jsxs("div",{className:"absolute -bottom-1 -right-1 bg-gray-200 rounded px-1 text-[9px] font-mono border border-white shadow-sm",children:[a.gridCols,"x",a.gridRows]})]}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsx("h4",{className:"font-bold text-gray-800 text-sm truncate",children:a.name}),f.jsx(Wy,{size:12,className:"text-gray-300 flex-shrink-0 ml-2"})]}),f.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[f.jsx("span",{className:"bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded text-[10px] font-medium",children:a.category}),a.brand&&f.jsx("span",{className:"text-[10px] text-gray-400 border border-gray-100 px-1.5 rounded",children:a.brand}),f.jsxs("span",{className:"text-[10px] text-gray-500 font-mono",children:[a.weightGrams,"g"]})]})]})]},a.id))}):f.jsx("div",{className:"grid grid-cols-2 gap-3",children:i.map(a=>f.jsxs("div",{onClick:()=>s(a),className:"bg-white rounded-2xl p-2 shadow-sm cursor-pointer hover:shadow-md transition-all active:scale-95 flex flex-col h-full",children:[f.jsxs("div",{className:"aspect-square w-full bg-gray-100 rounded-xl overflow-hidden relative mb-2",children:[f.jsx("img",{src:a.imageUrl,className:"w-full h-full object-cover",loading:"lazy"}),f.jsxs("div",{className:"absolute top-1 right-1 bg-black/40 backdrop-blur-md text-white text-[9px] px-1.5 py-0.5 rounded-md font-bold",children:[a.gridCols,"x",a.gridRows]})]}),f.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[f.jsx("h4",{className:"font-bold text-gray-800 text-xs leading-tight mb-1 line-clamp-2",children:a.name}),f.jsx("div",{children:f.jsxs("div",{className:"flex justify-between items-end",children:[f.jsx("span",{className:"text-[10px] text-gray-400",children:a.category}),f.jsxs("span",{className:"text-[10px] font-mono font-bold text-blue-600",children:[a.weightGrams,"g"]})]})})]})]},a.id))})})},F8=({packs:e,searchQuery:t,activePackId:r,onSetActivePack:n,onManagePack:s})=>{const i=e.filter(a=>a.name.toLowerCase().includes(t.toLowerCase()));return f.jsx("div",{className:"space-y-4 pb-20 pt-4",children:f.jsxs("div",{className:"grid gap-4",children:[i.map(a=>{var o;return f.jsxs("div",{className:"bg-white/90 rounded-3xl p-4 shadow-md relative overflow-hidden",children:[f.jsxs("div",{className:"flex justify-between items-start mb-2",children:[f.jsxs("div",{className:"flex items-start space-x-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 overflow-hidden flex-shrink-0",children:(o=a.backpackGear)!=null&&o.imageUrl?f.jsx("img",{src:a.backpackGear.imageUrl,className:"w-full h-full object-cover"}):f.jsx(Gi,{className:"w-full h-full p-2 text-gray-400"})}),f.jsxs("div",{children:[f.jsx("h3",{className:"font-bold text-gray-800 text-lg leading-tight",children:a.name}),f.jsxs("div",{className:"flex gap-2 text-xs text-gray-500",children:[f.jsxs("span",{children:[a.items.length," Items"]}),f.jsx("span",{className:"text-gray-300",children:"|"}),f.jsxs("span",{children:[a.gridCols,"x",a.gridRows," Grid"]})]}),a.backpackGear&&f.jsxs("div",{className:"text-[10px] text-blue-500 mt-0.5",children:["Using: ",a.backpackGear.name]})]})]}),r===a.id?f.jsxs("span",{className:"bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded-full flex items-center gap-1",children:[f.jsx(kR,{size:10})," Active"]}):f.jsx("button",{onClick:()=>n(a.id),className:"text-[10px] text-gray-400 border border-gray-200 px-2 py-1 rounded-full hover:bg-blue-50 hover:text-blue-600",children:"Set Active"})]}),f.jsx("button",{onClick:()=>s(a),className:"w-full bg-blue-50 hover:bg-blue-100 text-blue-600 text-xs font-bold py-2 rounded-xl mt-2",children:"Manage Contents"})]},a.id)}),i.length===0&&f.jsx("div",{className:"text-center py-12 bg-white/50 rounded-3xl border border-dashed border-gray-300",children:f.jsx("div",{className:"text-sm text-gray-500",children:"No packs found."})})]})})},L8=({selectedPack:e,inventory:t,onBack:r,onEditPack:n,onOpenAddGear:s,onRemoveItem:i,onDeleteItem:a,onAddOne:o})=>{var c,d;const l=e.items.map(h=>{const u=t.find(p=>p.id===h.gearId);return u?{...u,quantity:h.quantity}:null}).filter(Boolean);return f.jsxs("div",{className:"pb-20 h-full flex flex-col mt-4",children:[f.jsx("button",{onClick:r,className:"text-white text-xs mb-2 flex items-center opacity-80 pl-2",children:" Back to Packs"}),f.jsxs("div",{className:"bg-white rounded-3xl flex-1 p-5 shadow-2xl min-h-[500px] animate-slide-up",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-xl font-bold text-gray-800",children:e.name}),f.jsxs("div",{className:"text-xs text-gray-500",children:[e.gridCols,"x",e.gridRows," Grid Layout"]})]}),f.jsx("div",{className:"flex gap-2",children:f.jsx("button",{onClick:n,className:"text-gray-500 p-2 bg-gray-100 rounded-full",children:f.jsx(zR,{size:16})})})]}),f.jsxs("div",{className:"mb-4 p-3 rounded-2xl bg-gray-50 border border-gray-200 flex items-center gap-3",children:[f.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-xl overflow-hidden flex-shrink-0",children:(c=e.backpackGear)!=null&&c.imageUrl?f.jsx("img",{src:e.backpackGear.imageUrl,className:"w-full h-full object-cover"}):f.jsx(Hf,{className:"w-full h-full p-3 text-gray-400"})}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs font-bold text-gray-600 uppercase",children:"Container"}),f.jsx("div",{className:"text-sm font-bold text-gray-900",children:((d=e.backpackGear)==null?void 0:d.name)||"No Backpack Selected"}),f.jsx("div",{className:"text-[10px] text-gray-500",children:e.backpackGear?`${e.backpackGear.weightGrams}g  ${e.backpackGear.price}`:"0g"})]})]}),f.jsxs("button",{onClick:s,className:"w-full py-3 mb-4 border border-dashed border-blue-300 bg-blue-50/50 rounded-xl flex items-center justify-center gap-2 text-blue-600 font-bold text-sm hover:bg-blue-100 transition-all active:scale-95",children:[f.jsx(Ti,{size:16})," Add Items from Warehouse"]}),f.jsx("h3",{className:"text-sm font-bold text-gray-700 mb-2",children:"Pack Contents"}),f.jsxs("div",{className:"space-y-2",children:[l.map((h,u)=>f.jsxs("div",{className:"flex justify-between items-center p-2 border-b border-gray-100 last:border-0",children:[f.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[f.jsx("div",{className:"w-8 h-8 rounded bg-gray-100 overflow-hidden flex-shrink-0 border border-gray-200",children:f.jsx("img",{src:h.imageUrl,className:"w-full h-full object-cover"})}),f.jsxs("div",{className:"min-w-0",children:[f.jsx("div",{className:"text-sm font-medium text-gray-800 truncate",children:h.name}),f.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-gray-400",children:[f.jsxs("span",{children:[h.weightGrams,"g"]}),f.jsx("span",{children:""}),f.jsxs("span",{children:["",h.price]})]})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs("div",{className:"flex items-center bg-gray-50 rounded-lg border border-gray-200 p-0.5",children:[f.jsx("button",{onClick:()=>i(h),className:"px-2 py-1 text-gray-500 hover:bg-gray-200 rounded text-xs font-bold",children:"-"}),f.jsx("span",{className:"px-2 text-xs font-bold text-gray-700 w-6 text-center",children:h.quantity}),f.jsx("button",{onClick:()=>o(h),className:"px-2 py-1 text-blue-500 hover:bg-blue-50 rounded text-xs font-bold",children:"+"})]}),f.jsx("button",{onClick:()=>a(h),className:"text-red-400 hover:text-red-600 p-1.5",children:f.jsx(To,{size:14})})]})]},u)),l.length===0&&f.jsx("div",{className:"text-center text-gray-400 text-xs py-4",children:"Empty Pack"})]})]})]})},R8=({onToggleNavbar:e})=>{var Ke,yt;const[t,r]=ke.useState("warehouse"),[n,s]=ke.useState(null),[i,a]=ke.useState([]),[o,l]=ke.useState("grid"),[c,d]=ke.useState("All"),[h,u]=ke.useState(""),[p,m]=ke.useState(!1),[y,P]=ke.useState([]),[g,_]=ke.useState(null),[b,w]=ke.useState(!1),[M,E]=ke.useState(!1),[T,S]=ke.useState(!1),[A,j]=ke.useState(!1),[U,W]=ke.useState(!1),[B,ee]=ke.useState(!1),[Q,Z]=ke.useState(""),[J,X]=ke.useState(null),[ae,le]=ke.useState({name:"",category:fr.MISC,weightGrams:0,price:0,brand:"",imageUrl:"",isConsumable:!1,consumableValue:100,gridCols:1,gridRows:1}),[ne,L]=ke.useState({name:"",gridCols:6,gridRows:8,gearId:void 0}),[F,G]=ke.useState(!1),oe={All:f.jsx(iu,{size:18}),[fr.SLEEPING]:f.jsx(iu,{size:18}),[fr.CARRYING]:f.jsx(Gi,{size:18})};ke.useEffect(()=>{H()},[]);const H=async()=>{const ut=(await rp()).teammates.find(yr=>yr.isCurrentUser);if(ut){s(ut);const yr=await Mj(ut.id);a(yr);const wr=await Tj(ut.id);if(P(wr),g){const Hr=wr.find(Qr=>Qr.id===g.id);_(Hr||null)}}},Te=Mf("inventory"),Ce=Mf("packs"),Be=()=>{if(Te.error){Z(Te.error),ee(!0);return}X(null),j(!1),le({name:"",category:fr.MISC,weightGrams:0,price:0,brand:"",imageUrl:"",isConsumable:!1,gridCols:1,gridRows:1}),w(!0)},$e=Ve=>{X(Ve.id),j(!1),le({...Ve}),w(!0)},te=async()=>{if(!n||!ae.name)return;const Ve={id:J||"",ownerId:n.id,name:ae.name,category:ae.category||fr.MISC,weightGrams:Number(ae.weightGrams),price:Number(ae.price),brand:ae.brand||"Generic",imageUrl:ae.imageUrl||"",isConsumable:ae.isConsumable,consumableValue:ae.isConsumable?100:void 0,gridCols:Math.min(10,Math.max(1,ae.gridCols||1)),gridRows:Math.min(10,Math.max(1,ae.gridRows||1))};if(J)await Z5({...Ve,id:J}),w(!1),H();else{const wt=await Y5({...Ve});wt.error?(w(!1),Z(wt.error),ee(!0)):(w(!1),H())}},O=()=>j(!0),ue=async()=>{J&&(await eV(J),j(!1),w(!1),H())},Ee=()=>{if(Ce.error){Z(Ce.error),ee(!0);return}L({name:"",gridCols:6,gridRows:8,gearId:void 0}),E(!0)},fe=async()=>{if(!n||!ne.name)return;const Ve=await tV(n.id,ne.name,ne.gridCols,ne.gridRows);if(Ve.error){E(!1),Z(Ve.error),ee(!0);return}Ve.data&&ne.gearId&&await S2(Ve.data.id,{gearId:ne.gearId}),E(!1),H()},me=()=>{g&&(L({name:g.name,gridCols:g.gridCols||6,gridRows:g.gridRows||8,gearId:g.gearId}),S(!0))},ve=async()=>{!g||!ne.name||(await S2(g.id,{name:ne.name,gridCols:ne.gridCols,gridRows:ne.gridRows,gearId:ne.gearId}),S(!1),H())},xe=async Ve=>{if(!g)return;const wt=await rl(g.id,Ve.id,1);wt.error?(Z(wt.error),ee(!0)):H()},_e=async Ve=>{g&&(await rl(g.id,Ve.id,-1),H())},je=async Ve=>{g&&(await rl(g.id,Ve.id,-9999),H())},we=async Ve=>{if(!g)return;const wt=await rl(g.id,Ve.id,1);wt.error?(Z(wt.error),ee(!0)):H()},Oe=async Ve=>{n&&(await J5(n.id,Ve),H())},Me=i.filter(Ve=>Ve.category===fr.CARRYING),We=()=>i.filter(Ve=>{const wt=c==="All"||Ve.category===c,ut=Ve.name.toLowerCase().includes(h.toLowerCase())||Ve.brand&&Ve.brand.toLowerCase().includes(h.toLowerCase());return wt&&ut}),Le=y.find(Ve=>Ve.id===(n==null?void 0:n.activePackId)),rt=Le?Le.items:[],Ye=async()=>{if(!Le||!J)return;const Ve=Le.items.some(wt=>wt.gearId===J);G(!0);try{if(Ve)await rl(Le.id,J,-9999);else{const wt=await rl(Le.id,J,1);wt.error&&(Z(wt.error),ee(!0))}await H()}finally{G(!1)}},ze=()=>f.jsxs("div",{className:"sticky top-0 z-40 px-5 pt-safe pb-2 space-y-3 transition-all",children:[f.jsxs("div",{className:"flex gap-3 items-center mt-2",children:[f.jsxs("div",{className:"relative",children:[f.jsx("button",{onClick:()=>m(!p),className:"w-11 h-11 bg-white/20 backdrop-blur-md border border-white/30 rounded-xl flex items-center justify-center text-white shadow-sm active:scale-95 transition-transform",children:oe[c]||f.jsx(iu,{size:18})}),p&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>m(!1)}),f.jsx("div",{className:"absolute top-full left-0 mt-2 w-48 bg-white rounded-2xl shadow-2xl border border-gray-100 z-50 overflow-hidden animate-in fade-in zoom-in-95 duration-100 origin-top-left",children:f.jsx("div",{className:"p-1 space-y-0.5",children:["All",...Object.values(fr)].map(Ve=>f.jsx("button",{onClick:()=>{d(Ve),m(!1)},className:`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-xs font-bold transition-colors ${c===Ve?"bg-blue-600 text-blue-600":"text-gray-600 hover:bg-gray-50"}`,children:f.jsx("span",{children:Ve})},Ve))})})]})]}),f.jsxs("div",{className:"flex-1 bg-white/20 backdrop-blur-md border border-white/30 rounded-xl flex items-center px-3 py-0 shadow-sm focus-within:bg-white/30 transition-all h-11",children:[f.jsx(GI,{size:16,className:"text-white/70 mr-2"}),f.jsx("input",{className:"bg-transparent border-none text-white text-sm placeholder-white/70 w-full focus:outline-none h-full",placeholder:t==="packs"?"Search packs...":"Search gear...",value:h,onChange:Ve=>u(Ve.target.value)}),h&&f.jsx("button",{onClick:()=>u(""),className:"text-white/70 hover:text-white",children:f.jsx(Us,{size:14})})]}),f.jsx("button",{onClick:t==="packs"?Ee:Be,className:`w-11 h-11 rounded-xl flex items-center justify-center shadow-lg active:scale-95 transition-transform border ${(t==="packs"?Ce.error:Te.error)?"bg-gray-100 border-gray-200 text-gray-400":"bg-white border-transparent text-blue-600"}`,children:(t==="packs"?Ce.error:Te.error)?f.jsx(Qf,{size:18}):f.jsx(Ti,{size:20,strokeWidth:2.5})})]}),f.jsxs("div",{className:"bg-black/10 backdrop-blur-sm p-1 rounded-xl flex relative border border-white/10",children:[f.jsxs("button",{onClick:()=>r("warehouse"),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-all duration-200 flex items-center justify-center gap-2 ${t==="warehouse"?"bg-white text-blue-600 shadow-sm":"text-white/80 hover:text-white"}`,children:[f.jsx(Hf,{size:14})," Warehouse"]}),f.jsxs("button",{onClick:()=>r("packs"),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-all duration-200 flex items-center justify-center gap-2 ${t==="packs"?"bg-white text-blue-600 shadow-sm":"text-white/80 hover:text-white"}`,children:[f.jsx(Gi,{size:14})," Backpacks"]})]}),t==="warehouse"&&f.jsxs("div",{className:"flex justify-between items-center pt-1 px-1 animate-fade-in",children:[f.jsxs("span",{className:"text-[10px] font-bold text-blue-100 uppercase tracking-wider",children:[c==="All"?"All Items":c,"  ",We().length]}),f.jsxs("div",{className:"flex bg-black/10 backdrop-blur-sm rounded-lg p-0.5 border border-white/10",children:[f.jsx("button",{onClick:()=>l("grid"),className:`p-1.5 rounded-md transition-all ${o==="grid"?"bg-white text-blue-600 shadow-sm":"text-white/70"}`,children:f.jsx(BI,{size:14})}),f.jsx("button",{onClick:()=>l("list"),className:`p-1.5 rounded-md transition-all ${o==="list"?"bg-white text-blue-600 shadow-sm":"text-white/70"}`,children:f.jsx(Uy,{size:14})})]})]})]});return f.jsxs("div",{className:"min-h-screen flex flex-col",children:[t!=="pack-detail"&&ze(),f.jsxs("div",{className:"flex-1 px-5",children:[t==="warehouse"&&f.jsx(D8,{inventory:i,inventoryView:o,filterCategory:c,searchQuery:h,onEditItem:$e}),t==="packs"&&f.jsx(F8,{packs:y,searchQuery:h,activePackId:n==null?void 0:n.activePackId,onSetActivePack:Oe,onManagePack:Ve=>{_(Ve),r("pack-detail")}}),t==="pack-detail"&&g&&f.jsx(L8,{selectedPack:g,inventory:i,onBack:()=>r("packs"),onEditPack:me,onOpenAddGear:()=>{W(!0)},onRemoveItem:_e,onDeleteItem:je,onAddOne:we})]}),U&&f.jsx(N8,{inventory:i,selectedPack:g,onClose:()=>W(!1),onAddItem:xe,onRemoveItem:Ve=>_e({...Ve}),onAddOne:we}),b&&f.jsx(O8,{itemForm:ae,setItemForm:le,saveItem:te,onClose:()=>w(!1),handleDeleteClick:O,isDeleteConfirmOpen:A,setIsDeleteConfirmOpen:j,confirmDelete:ue,editingId:J,currentUser:n,activePackItems:rt,onToggleActivePack:Ye,isTogglingPack:F}),M&&f.jsx(xC,{title:"Create New Backpack",packForm:ne,setPackForm:L,carryingGear:Me,onClose:()=>E(!1),onConfirm:fe,confirmText:"Create"}),T&&f.jsx(xC,{title:"Edit Backpack",packForm:ne,setPackForm:L,carryingGear:Me,onClose:()=>S(!1),onConfirm:ve,confirmText:"Update"}),B&&f.jsx(ow,{onClose:()=>{ee(!1),Z("")},onSuccess:()=>{ee(!1),Z(""),H()},isPro:(Ke=n==null?void 0:n.subscription)==null?void 0:Ke.isActive,currentPlan:(yt=n==null?void 0:n.subscription)==null?void 0:yt.plan,message:Q})]})},z8=({user:e,onLogout:t,onNavigate:r})=>{var ae,le,ne,L;const[n,s]=ke.useState(e),[i,a]=ke.useState(!1),[o,l]=ke.useState(!1),[c,d]=ke.useState(!1),[h,u]=ke.useState(!1),[p,m]=ke.useState(!1),[y,P]=ke.useState({name:"",username:""}),[g,_]=ke.useState(null),[b,w]=ke.useState(null),M=ke.useRef(null),E=ke.useRef(null);ke.useEffect(()=>{s(e)},[e]);const T=async()=>{const F=await aw();F&&s(F)},S=async()=>{await lV(),t()},A=F=>new Promise((G,oe)=>{const H=new FileReader;H.readAsDataURL(F),H.onload=Te=>{var Be;const Ce=new Image;Ce.src=(Be=Te.target)==null?void 0:Be.result,Ce.onload=()=>{const $e=document.createElement("canvas"),te=300;let O=Ce.width,ue=Ce.height;O>ue?O>te&&(ue*=te/O,O=te):ue>te&&(O*=te/ue,ue=te),$e.width=O,$e.height=ue;const Ee=$e.getContext("2d");Ee==null||Ee.drawImage(Ce,0,0,O,ue),G($e.toDataURL("image/jpeg",.7))}},H.onerror=Te=>oe(Te)}),j=()=>{P({name:n.name||"",username:n.username||""}),_(null),w(null),u(!0)},U=()=>{u(!1),w(null)},W=async F=>{var oe;const G=(oe=F.target.files)==null?void 0:oe[0];if(G){if(G.size>5*1024*1024){w("Image size must be less than 5MB");return}try{const H=await A(G);_(H)}catch{w("Failed to process image")}}},B=async()=>{m(!0),w(null);const F={name:y.name};g&&(F.avatarUrl=g);const{error:G}=await p5(n.id,F);G?(w(G),m(!1)):(await T(),u(!1),m(!1))},ee=async()=>{const F=await m5();if(F.error){alert(F.error);return}const G=new Blob([JSON.stringify(F,null,2)],{type:"application/json"}),oe=URL.createObjectURL(G),H=document.createElement("a");H.href=oe,H.download=`packmate_backup_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(oe)},Q=()=>{var F;(F=M.current)==null||F.click()},Z=async F=>{var H;const G=(H=F.target.files)==null?void 0:H[0];if(!G)return;if(!window.confirm("Warning: Importing data will overwrite your current plans, inventory, and settings. This action cannot be undone. Continue?")){M.current&&(M.current.value="");return}d(!0);const oe=new FileReader;oe.onload=async Te=>{var Ce;try{const Be=JSON.parse((Ce=Te.target)==null?void 0:Ce.result),$e=await g5(Be);$e.error?alert("Import failed: "+$e.error):(await T(),alert("Data imported successfully!"))}catch{alert("Invalid JSON file or file corrupted.")}finally{d(!1),M.current&&(M.current.value="")}},oe.readAsText(G)},J=(ae=n.subscription)==null?void 0:ae.isActive,X=((le=n.subscription)==null?void 0:le.plan)==="pro_yearly"?"Pro Yearly":((ne=n.subscription)==null?void 0:ne.plan)==="pro_monthly"?"Pro Monthly":"Free Plan";return f.jsxs("div",{className:"pt-12 pb-28 px-5 min-h-screen",children:[f.jsxs("div",{className:"text-center mb-8",children:[f.jsx("h1",{className:"text-3xl font-bold text-white drop-shadow-md mb-2",children:"Profile"}),f.jsx("p",{className:"text-blue-100 text-sm",children:"Manage your trekking persona"})]}),f.jsxs("div",{className:"glass-panel rounded-3xl p-6 mb-6 relative overflow-hidden shadow-lg",children:[!h&&f.jsx("button",{onClick:j,className:"absolute top-4 right-4 bg-white/20 p-2 rounded-full text-gray-600 hover:bg-white/40 hover:text-blue-600 transition-colors backdrop-blur-sm z-10",children:f.jsx(Wy,{size:16})}),f.jsxs("div",{className:"flex flex-col items-center relative z-0",children:[f.jsxs("div",{className:"relative group",children:[f.jsx("div",{className:"w-24 h-24 rounded-full bg-white p-1 shadow-xl overflow-hidden relative",children:f.jsx("img",{src:g||n.avatar,className:`w-full h-full rounded-full object-cover ${h?"opacity-80":""}`,alt:"Profile"})}),h&&f.jsx("button",{onClick:()=>{var F;return(F=E.current)==null?void 0:F.click()},className:"absolute inset-0 flex items-center justify-center bg-black/30 rounded-full cursor-pointer transition-opacity",children:f.jsx(PR,{size:24,className:"text-white drop-shadow-md"})}),!h&&f.jsx("div",{className:"absolute bottom-1 right-1 bg-green-500 w-5 h-5 rounded-full border-2 border-white shadow-sm"}),f.jsx("input",{type:"file",ref:E,onChange:W,className:"hidden",accept:"image/*"})]}),f.jsx("div",{className:"mt-4 text-center w-full",children:h?f.jsxs("div",{className:"space-y-3 w-full max-w-xs mx-auto animate-in fade-in",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase block text-left mb-1 ml-1",children:"Display Name"}),f.jsx("input",{value:y.name,onChange:F=>P({...y,name:F.target.value}),className:"w-full bg-white/50 border border-gray-200 rounded-xl px-3 py-2 text-sm font-bold text-gray-800 text-center focus:ring-2 focus:ring-blue-400 outline-none",placeholder:"Your Name"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase block text-left mb-1 ml-1",children:"Username"}),f.jsxs("div",{className:"relative opacity-70",children:[f.jsx("span",{className:"absolute left-3 top-2.5 text-gray-400 text-sm",children:"@"}),f.jsx("input",{value:y.username||"user_"+n.id.substring(0,8),disabled:!0,className:"w-full bg-gray-100 border border-gray-200 rounded-xl pl-7 pr-8 py-2 text-sm font-medium text-gray-500 text-center cursor-not-allowed"}),f.jsx(Qf,{size:14,className:"absolute right-3 top-3 text-gray-400"})]}),f.jsx("p",{className:"text-[9px] text-gray-400 mt-1",children:"Username cannot be changed."})]}),b&&f.jsx("div",{className:"text-xs text-red-500 bg-red-50 p-2 rounded-lg font-medium",children:b}),f.jsxs("div",{className:"flex gap-2 pt-2",children:[f.jsx("button",{onClick:U,className:"flex-1 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-xl text-xs font-bold transition-colors",children:"Cancel"}),f.jsxs("button",{onClick:B,disabled:p,className:"flex-1 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-xs font-bold shadow-md transition-colors flex items-center justify-center gap-2 disabled:opacity-70",children:[p?f.jsx(Ls,{size:14,className:"animate-spin"}):f.jsx(WI,{size:14}),"Save"]})]})]}):f.jsxs(f.Fragment,{children:[f.jsx("h2",{className:"text-xl font-bold text-gray-800",children:n.name}),f.jsxs("p",{className:"text-sm text-blue-500 font-medium mb-1",children:["@",n.username||"user_"+n.id.substring(0,8)]}),f.jsx("p",{className:"text-xs text-gray-400 mb-3",children:n.email}),f.jsxs("button",{onClick:()=>l(!0),className:`text-xs font-bold px-4 py-1.5 rounded-full shadow-sm flex items-center gap-1 transition-transform active:scale-95 mx-auto ${J?"bg-gradient-to-r from-amber-200 to-yellow-400 text-yellow-900":"bg-gray-100 text-gray-600 border border-gray-200"}`,children:[J&&f.jsx(zI,{size:12,fill:"currentColor"}),X]})]})})]})]}),f.jsx("div",{className:"glass-panel rounded-3xl overflow-hidden shadow-lg mb-6",children:f.jsxs("div",{className:"divide-y divide-gray-200/50",children:[f.jsxs("button",{onClick:()=>r("friends"),className:"w-full flex items-center justify-between p-4 hover:bg-white/40 transition-colors",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"bg-pink-100 p-2 rounded-lg text-pink-600",children:f.jsx(_f,{size:18})}),f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"My Friends"})]}),f.jsx(Cc,{size:16,className:"text-gray-400"})]}),f.jsxs("button",{onClick:ee,className:"w-full flex items-center justify-between p-4 hover:bg-white/40 transition-colors",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"bg-green-100 p-2 rounded-lg text-green-600",children:f.jsx(IR,{size:18})}),f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Export Data"})]}),f.jsx(Cc,{size:16,className:"text-gray-400"})]}),Ft()&&f.jsxs(f.Fragment,{children:[f.jsxs("button",{onClick:Q,disabled:c,className:"w-full flex items-center justify-between p-4 hover:bg-white/40 transition-colors",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"bg-blue-100 p-2 rounded-lg text-blue-600",children:f.jsx(o0,{size:18})}),f.jsx("span",{className:"text-sm font-medium text-gray-700",children:c?f.jsxs("span",{className:"flex items-center gap-2",children:[f.jsx(Ls,{className:"animate-spin",size:14})," Importing..."]}):"Import Data"})]}),f.jsx(Cc,{size:16,className:"text-gray-400"})]}),f.jsx("input",{type:"file",ref:M,onChange:Z,className:"hidden",accept:".json"})]}),f.jsxs("button",{onClick:()=>a(!0),className:"w-full flex items-center justify-between p-4 hover:bg-white/40 transition-colors",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"bg-purple-100 p-2 rounded-lg text-purple-600",children:f.jsx(UR,{size:18})}),f.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Privacy Policy"})]}),f.jsx(Cc,{size:16,className:"text-gray-400"})]})]})}),f.jsxs("button",{onClick:S,className:"w-full glass-card rounded-2xl p-4 text-red-500 font-medium flex justify-center items-center space-x-2 hover:bg-white/80 transition-colors shadow-lg",children:[f.jsx(UI,{size:18}),f.jsx("span",{children:"Log Out"})]}),i&&f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in",children:f.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md max-h-[80vh] flex flex-col shadow-2xl",children:[f.jsxs("div",{className:"p-5 border-b border-gray-100 flex justify-between items-center",children:[f.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Privacy Policy"}),f.jsx("button",{onClick:()=>a(!1),className:"bg-gray-100 p-2 rounded-full text-gray-500 hover:bg-gray-200",children:f.jsx(Cc,{className:"rotate-90",size:20})})]}),f.jsxs("div",{className:"p-6 overflow-y-auto text-sm text-gray-600 leading-relaxed space-y-4",children:[f.jsxs("p",{children:[f.jsx("strong",{children:"1. Data Storage"}),f.jsx("br",{}),"PackMate stores your data locally on your device in Demo Mode. When signed in, data is encrypted and stored securely in our cloud database."]}),f.jsxs("p",{children:[f.jsx("strong",{children:"2. Usage"}),f.jsx("br",{}),"We use your data solely to provide trekking planning and gear management features. We do not sell your personal information to third parties."]}),f.jsxs("p",{children:[f.jsx("strong",{children:"3. AI Analysis"}),f.jsx("br",{}),"When using AI features (like link analysis), the text content you provide is sent to our AI provider (Google Gemini) for processing. No personal identifiers are shared."]}),f.jsxs("p",{children:[f.jsx("strong",{children:"4. Export/Import"}),f.jsx("br",{}),"You maintain full ownership of your data. You can export your plans and inventory at any time using the Export feature."]})]}),f.jsx("div",{className:"p-4 border-t border-gray-100",children:f.jsx("button",{onClick:()=>a(!1),className:"w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700",children:"Close"})})]})}),o&&f.jsx(ow,{onClose:()=>l(!1),onSuccess:()=>{l(!1),T()},isPro:J,currentPlan:(L=n.subscription)==null?void 0:L.plan})]})},B8=({currentUser:e,onBack:t})=>{const[r,n]=ke.useState(null),[s,i]=ke.useState([]),[a,o]=ke.useState([]),[l,c]=ke.useState([]),[d,h]=ke.useState([]),[u,p]=ke.useState([]),[m,y]=ke.useState(null),[P,g]=ke.useState(""),[_,b]=ke.useState(null),[w,M]=ke.useState(!1),[E,T]=ke.useState(null),[S,A]=ke.useState(null),[j,U]=ke.useState(!1),[W,B]=ke.useState(null);ke.useEffect(()=>{ee()},[]);const ee=async()=>{U(!0),A(null);try{const L=await P5();y(L);const F=await rp();n(F);const G=await k5(L.leaderId);i(G);const oe=await E5();o(oe);const H=await x5();c(H);const Te=await b5();h(Te);const Ce=await $5();p(Ce)}catch(L){console.error("Load failed",L)}finally{U(!1)}},Q=async()=>{if(P){M(!0),b(null),A(null);try{const L=await w5(P);L?L.id===e.id?A("That's you!"):b(L):A("User not found.")}catch{A("Search failed.")}finally{M(!1)}}},Z=async()=>{if(!_)return;T("add-friend");const L=await v5(e.id,_.id);L.error?A(L.error):(g(""),b(null),await ee()),T(null)},J=async(L,F)=>{T(L),await M5(L,F),await ee(),T(null)},X=async(L,F)=>{T(L);const G=await I5(L,F);G&&G.status==="requires_switch_confirmation"?B({title:"Switch Teams?",message:"You are already in a team. Accepting this invite will remove you from your current team (transferring leadership if needed).",isDangerous:!0,onConfirm:async()=>{const oe=await A5(G.currentLeaderId,L);oe.error&&A(oe.error),await ee()}}):setTimeout(()=>ee(),500),T(null)},ae=L=>{B({title:"Remove Contact",message:"Are you sure you want to remove this person from your contacts?",isDangerous:!0,onConfirm:async()=>{T(L),o(G=>G.filter(oe=>oe.id!==L)),(await T5(e.id,L)).error&&(A("Failed to remove friend."),await ee()),T(null)}})},le=async L=>{T(L);const F=await S5(L);F.error?A("Invite failed: "+F.error):await ee(),T(null)},ne=(L,F)=>{const G=F==="leave",oe=G&&(m==null?void 0:m.isLeader);let H=G?"Are you sure you want to leave this team?":"Are you sure you want to remove this member from the team?";if(oe){const Te=s.filter(Ce=>Ce.id!==e.id&&Ce.status==="joined");Te.length>0?H=`You are the Leader. Leaving will transfer leadership to ${Te[0].name}.`:H="You are the Leader. Leaving will disband the team permanently as there are no other joined members."}B({title:G?oe?"Transfer & Leave":"Leave Team":"Remove Member",message:H,isDangerous:!0,onConfirm:async()=>{T(L);let Te={error:null};G?m&&(Te=await bj(m.leaderId)):Te=await C5(L),Te.error?A(Te.error):await ee(),T(null)}})};return f.jsxs("div",{className:"pt-12 pb-28 px-5 min-h-screen space-y-6 relative",children:[W&&f.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-6 animate-in fade-in duration-200",children:f.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-2xl max-w-sm w-full transform transition-all scale-100",children:[f.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:W.title}),f.jsx("p",{className:"text-sm text-gray-600 mb-6 leading-relaxed",children:W.message}),f.jsxs("div",{className:"flex gap-3 justify-end",children:[f.jsx("button",{onClick:()=>B(null),className:"px-5 py-2.5 rounded-xl bg-gray-100 text-gray-600 font-bold text-sm hover:bg-gray-200 transition-colors",children:"Cancel"}),f.jsx("button",{onClick:()=>{W.onConfirm(),B(null)},className:`px-5 py-2.5 rounded-xl font-bold text-sm text-white shadow-lg transition-transform active:scale-95 ${W.isDangerous?"bg-red-500 hover:bg-red-600":"bg-blue-600 hover:bg-blue-700"}`,children:"Confirm"})]})]})}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx("button",{onClick:t,className:"bg-white/20 p-2 rounded-full text-white hover:bg-white/30 transition-colors",children:f.jsx(bR,{size:20})}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-2xl font-bold text-white drop-shadow-md",children:"Team & Contacts"}),f.jsx("div",{className:"flex items-center gap-2",children:f.jsx("p",{className:"text-blue-100 text-xs",children:"Connect & Plan"})})]})]}),f.jsx("button",{onClick:ee,disabled:j,className:"bg-white/20 p-2 rounded-full text-white hover:bg-white/30 transition-colors",children:f.jsx(LR,{size:16,className:j?"animate-spin":""})})]}),S&&f.jsxs("div",{className:"bg-red-100 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-xs flex items-center gap-2",children:[f.jsx(LI,{size:16,className:"flex-shrink-0"}),f.jsx("span",{children:S})]}),(l.length>0||u.length>0)&&f.jsxs("div",{className:"space-y-2 animate-fade-in",children:[f.jsxs("div",{className:"flex items-center gap-2 px-2 text-white",children:[f.jsx(FR,{size:16,className:"text-yellow-300"}),f.jsx("h3",{className:"text-sm font-bold",children:"Notifications"})]}),f.jsxs("div",{className:"bg-white/90 rounded-2xl p-3 shadow-lg space-y-3",children:[l.map(L=>f.jsxs("div",{className:"flex justify-between items-center p-2 bg-blue-50 rounded-xl",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("img",{src:L.requester.avatar,className:"w-8 h-8 rounded-full border border-white"}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs font-bold text-gray-800",children:L.requester.name}),f.jsx("div",{className:"text-[9px] text-gray-500",children:"wants to be friends"})]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>J(L.friendshipId,!1),className:"bg-white p-1.5 rounded-lg text-gray-400 hover:text-red-500",children:f.jsx(Us,{size:14})}),f.jsx("button",{onClick:()=>J(L.friendshipId,!0),className:"bg-blue-600 p-1.5 rounded-lg text-white hover:bg-blue-700",children:f.jsx(Fl,{size:14})})]})]},L.friendshipId)),u.map(L=>f.jsxs("div",{className:"flex justify-between items-center p-2 bg-yellow-50 rounded-xl border border-yellow-100",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"bg-yellow-200 p-1.5 rounded-full",children:f.jsx(ku,{size:14,className:"text-yellow-800"})}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs font-bold text-gray-800",children:"Team Invitation"}),f.jsxs("div",{className:"text-[9px] text-gray-500",children:["From Leader: ",L.leaderName]})]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>X(L.leaderId,!1),className:"bg-white p-1.5 rounded-lg text-gray-400 hover:text-red-500",children:f.jsx(Us,{size:14})}),f.jsx("button",{onClick:()=>X(L.leaderId,!0),className:"bg-green-500 p-1.5 rounded-lg text-white hover:bg-green-600",children:f.jsx(Fl,{size:14})})]})]},L.leaderId))]})]}),s.length>0&&f.jsxs("div",{className:"space-y-3",children:[f.jsx("div",{className:"flex items-center justify-between px-2 text-white",children:f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(ku,{size:16,className:"text-white"}),f.jsx("h3",{className:"text-sm font-bold",children:m!=null&&m.isLeader?"My Team":"Joined Team"})]})}),f.jsx("div",{className:"glass-panel p-2 rounded-2xl min-h-[80px]",children:s.map(L=>{const F=L.id===e.id,G=L.role==="Leader",oe=L.status==="invited";let H=null,Te=null;return F?(Te="leave",H=f.jsx(UI,{size:16})):m!=null&&m.isLeader&&!F&&(Te="kick",H=f.jsx(VI,{size:16})),f.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-gray-100/50 last:border-0",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("div",{className:"relative",children:[f.jsx("img",{src:L.avatar,className:"w-10 h-10 rounded-full bg-gray-200 object-cover border border-white"}),F&&f.jsx("div",{className:"absolute -bottom-1 -right-1 bg-blue-500 text-[8px] text-white px-1 rounded shadow-sm",children:"ME"})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"text-sm font-bold text-gray-800 flex items-center gap-1",children:[L.name,G&&f.jsx("span",{className:"text-[8px] bg-yellow-200 text-yellow-800 px-1.5 py-0.5 rounded font-extrabold",children:"LEADER"})]}),f.jsx("div",{className:"text-[10px] flex items-center gap-1",children:oe?f.jsx("span",{className:"text-orange-500 bg-orange-100 px-1.5 rounded",children:"Invited..."}):f.jsx("span",{className:"text-green-600 bg-green-100 px-1.5 rounded",children:"Joined"})})]})]}),Te&&f.jsx("button",{onClick:Ce=>{Ce.stopPropagation(),ne(L.id,Te)},disabled:E===L.id,className:`p-2 rounded-full transition-colors relative z-10 ${Te==="leave"?"bg-red-50 text-red-500 hover:bg-red-100":"bg-gray-50 text-gray-400 hover:bg-red-50 hover:text-red-500"}`,children:E===L.id?f.jsx(Ls,{className:"animate-spin",size:16}):H})]},L.id)})})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"flex items-center gap-2 px-2 text-white",children:[f.jsx(_f,{size:16,className:"text-blue-200"}),f.jsx("h3",{className:"text-sm font-bold",children:"My Contacts"})]}),f.jsxs("div",{className:"glass-card p-2 rounded-2xl",children:[f.jsxs("div",{className:"bg-white/50 rounded-xl p-2 mb-3 flex gap-2",children:[f.jsx("input",{className:"w-full bg-white border border-gray-200 rounded-lg pl-3 p-2 text-xs outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Search email...",value:P,onChange:L=>g(L.target.value)}),f.jsx("button",{onClick:Q,disabled:w||!P,className:"bg-blue-600 text-white px-3 rounded-lg text-xs font-bold shadow-md",children:w?f.jsx(Ls,{size:12,className:"animate-spin"}):"Find"})]}),_&&f.jsxs("div",{className:"bg-blue-50 p-3 rounded-xl flex justify-between items-center mb-3 border border-blue-100",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("img",{src:_.avatar,className:"w-8 h-8 rounded-full border border-white"}),f.jsx("div",{className:"text-xs font-bold text-blue-900",children:_.name})]}),f.jsx("button",{onClick:Z,className:"text-[10px] bg-blue-600 text-white px-3 py-1.5 rounded-lg shadow-sm hover:bg-blue-700 transition-colors",children:"Add Contact"})]}),f.jsxs("div",{className:"space-y-2 max-h-[300px] overflow-y-auto pr-1",children:[a.length===0&&f.jsx("div",{className:"text-center text-xs text-gray-500 py-6",children:"No contacts yet."}),a.map(L=>{const F=s.some(oe=>oe.id===L.id),G=!m||m.isLeader;return f.jsxs("div",{className:"flex justify-between items-center p-2 bg-white rounded-xl shadow-sm border border-gray-100/50",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("img",{src:L.avatar,className:"w-9 h-9 rounded-full object-cover border border-gray-100"}),f.jsxs("div",{children:[f.jsx("div",{className:"text-xs font-bold text-gray-800",children:L.name}),f.jsx("div",{className:"text-[9px] text-gray-400",children:L.email})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[F?f.jsx("span",{className:"text-[9px] text-blue-500 bg-blue-50 px-2 py-0.5 rounded font-medium",children:"On Team"}):f.jsx("button",{onClick:oe=>{oe.stopPropagation(),le(L.id)},disabled:E===L.id||!G,className:`p-1.5 rounded-lg transition-colors ${G?"bg-blue-50 text-blue-600 hover:bg-blue-100":"bg-gray-50 text-gray-300 cursor-not-allowed"}`,title:G?"Invite to Team":"You must be a Leader to invite",children:E===L.id?f.jsx(Ls,{className:"animate-spin",size:16}):f.jsx(Ti,{size:16})}),f.jsx("div",{className:"w-[1px] h-4 bg-gray-200"}),f.jsx("button",{onClick:oe=>{oe.stopPropagation(),ae(L.id)},disabled:E===L.id,className:"text-gray-400 hover:text-red-500 hover:bg-red-50 p-1.5 rounded-lg transition-colors",children:f.jsx(To,{size:14})})]})]},L.id)})]})]})]})]})},U8=({onLogin:e})=>{const[t,r]=ke.useState(!0),[n,s]=ke.useState(!1),[i,a]=ke.useState(""),[o,l]=ke.useState(!1),[c,d]=ke.useState({email:"",password:"",name:""}),h=async m=>{m.preventDefault(),s(!0),a("");try{const{user:y,error:P}=t?await iV(c.email,c.password):await aV(c.email,c.password,c.name);P?a(P):y&&e(y)}catch{a("An unexpected error occurred")}finally{s(!1)}},u=()=>{l(!0)},p=async()=>{l(!1),s(!0);const m=await oV();e(m),s(!1)};return f.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden",children:[f.jsx("div",{className:"fixed top-[-20%] right-[-20%] w-[80%] h-[60%] rounded-full bg-blue-400/30 blur-[100px] pointer-events-none"}),f.jsx("div",{className:"fixed bottom-[-10%] left-[-10%] w-[60%] h-[50%] rounded-full bg-purple-400/20 blur-[80px] pointer-events-none"}),f.jsxs("div",{className:"relative z-10 w-full max-w-sm",children:[f.jsx("div",{className:"flex justify-center mb-8",children:f.jsx("div",{className:"bg-white/20 backdrop-blur-xl p-4 rounded-2xl border border-white/40 shadow-xl",children:f.jsx(Pu,{size:48,className:"text-white"})})}),f.jsxs("div",{className:"text-center mb-8",children:[f.jsx("h1",{className:"text-3xl font-black text-white mb-2 tracking-tight drop-shadow-sm",children:"PackMate"}),f.jsx("p",{className:"text-blue-100 font-medium",children:"Plan Together. Pack Lighter."})]}),f.jsxs("div",{className:"glass-panel p-8 rounded-3xl shadow-2xl",children:[f.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-6 text-center",children:t?"Welcome Back":"Create Account"}),f.jsxs("form",{onSubmit:h,className:"space-y-4",children:[!t&&f.jsxs("div",{className:"relative",children:[f.jsx(KI,{className:"absolute left-3 top-3.5 text-gray-400",size:18}),f.jsx("input",{type:"text",placeholder:"Full Name",required:!0,className:"w-full pl-10 pr-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm",value:c.name,onChange:m=>d({...c,name:m.target.value})})]}),f.jsxs("div",{className:"relative",children:[f.jsx(DR,{className:"absolute left-3 top-3.5 text-gray-400",size:18}),f.jsx("input",{type:"email",placeholder:"Email Address",required:!0,className:"w-full pl-10 pr-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm",value:c.email,onChange:m=>d({...c,email:m.target.value})})]}),f.jsxs("div",{className:"relative",children:[f.jsx(Qf,{className:"absolute left-3 top-3.5 text-gray-400",size:18}),f.jsx("input",{type:"password",placeholder:"Password",required:!0,className:"w-full pl-10 pr-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none text-sm",value:c.password,onChange:m=>d({...c,password:m.target.value})})]}),i&&f.jsx("div",{className:"text-red-500 text-xs text-center bg-red-50 p-2 rounded-lg",children:i}),f.jsx("button",{type:"submit",disabled:n,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-blue-200 transition-transform active:scale-95 flex items-center justify-center space-x-2",children:n?f.jsx(Ls,{className:"animate-spin",size:20}):f.jsxs(f.Fragment,{children:[f.jsx("span",{children:t?"Sign In":"Sign Up"}),f.jsx(MR,{size:20})]})})]}),f.jsxs("div",{className:"mt-6 text-center space-y-4",children:[f.jsx("button",{onClick:()=>r(!t),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:t?"Don't have an account? Sign Up":"Already have an account? Sign In"}),f.jsxs("div",{className:"flex items-center justify-center gap-2",children:[f.jsx("div",{className:"h-[1px] w-12 bg-gray-300"}),f.jsx("span",{className:"text-[10px] text-gray-400 uppercase",children:"Or"}),f.jsx("div",{className:"h-[1px] w-12 bg-gray-300"})]}),f.jsxs("button",{type:"button",onClick:u,className:"w-full bg-white border-2 border-blue-100 hover:border-blue-200 hover:bg-blue-50 text-blue-600 font-bold py-3 rounded-xl transition-colors flex items-center justify-center space-x-2 text-sm",children:[f.jsx(a0,{size:18}),f.jsx("span",{children:"Local Demo Mode"})]})]})]})]}),o&&f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-6 animate-in fade-in duration-200",children:f.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-2xl max-w-xs w-full transform transition-all scale-100",children:[f.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[f.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-3 text-blue-600",children:f.jsx(a0,{size:24})}),f.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Enter Demo Mode?"})]}),f.jsxs("p",{className:"text-xs text-gray-500 mb-6 text-center leading-relaxed bg-gray-50 p-3 rounded-xl border border-gray-100",children:[f.jsx("span",{className:"font-bold block mb-1 text-gray-700",children:"Temporary Session"}),"All data created in this mode is stored locally in-memory and will be ",f.jsx("span",{className:"text-red-500 font-bold",children:"lost"})," when you close the app or refresh."]}),f.jsxs("div",{className:"flex gap-3",children:[f.jsx("button",{onClick:()=>l(!1),className:"flex-1 py-3 rounded-xl bg-gray-100 text-gray-600 font-bold text-xs hover:bg-gray-200 transition-colors",children:"Cancel"}),f.jsx("button",{onClick:p,className:"flex-1 py-3 rounded-xl bg-blue-600 text-white font-bold text-xs shadow-lg hover:bg-blue-700 transition-transform active:scale-95",children:"Continue"})]})]})})]})},V8=()=>{const[e,t]=ke.useState(null),[r,n]=ke.useState("dashboard"),[s,i]=ke.useState(!0);ke.useEffect(()=>{a()},[]);const a=async()=>{try{const c=await aw();t(c),c&&Tf().catch(console.error)}catch(c){console.error("Auth check failed (Network/Config):",c)}finally{i(!1)}},o=()=>{t(null),n("dashboard")},l=()=>{switch(r){case"dashboard":return f.jsx($2,{onNavigate:n});case"plan":return f.jsx(_V,{});case"gear":return f.jsx(R8,{});case"friends":return e?f.jsx(B8,{currentUser:e,onBack:()=>n("dashboard")}):null;case"profile":return f.jsx(z8,{onLogout:o,user:e,onNavigate:n});default:return f.jsx($2,{onNavigate:n})}};return s?f.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-blue-500 text-white gap-4",children:[f.jsx("div",{className:"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"}),f.jsx("span",{className:"text-sm font-medium",children:"Connecting to PackMate..."})]}):e?f.jsxs("div",{className:"min-h-screen w-full relative overflow-x-hidden bg-gray-50",children:[f.jsx("div",{className:"fixed inset-0 bg-gradient-to-b from-blue-400 to-blue-50 pointer-events-none z-0"}),f.jsx("div",{className:"fixed top-[-10%] left-[-20%] w-[60%] h-[50%] rounded-full bg-white/20 blur-[100px] pointer-events-none z-0"}),f.jsx("div",{className:"fixed bottom-[10%] right-[-10%] w-[50%] h-[40%] rounded-full bg-green-400/20 blur-[80px] pointer-events-none z-0"}),f.jsx("main",{className:"relative z-10 max-w-md mx-auto w-full pb-10",children:l()}),r!=="friends"&&f.jsx(GR,{activeTab:r,onTabChange:n})]}):f.jsx(U8,{onLogin:c=>{t(c),Tf().catch(console.error)}})},M3=document.getElementById("root");if(!M3)throw new Error("Could not find root element to mount to");const W8=f_.createRoot(M3);W8.render(f.jsx(lF.StrictMode,{children:f.jsx(V8,{})}));
